define("dropbox",["modules/core/controller_registry","modules/clean/browse_interface","modules/clean/react/previews/preview_linkfile","modules/clean/base64","modules/clean/previews/file_view_rams_common","modules/core/uri","modules/clean/file_events","modules/clean/previews/preview_actions_helper","modules/clean/em_string","modules/clean/sharing/share_client","modules/constants/debug","modules/core/exception","modules/clean/sharing/share_modal","libs","modules/constants/legacy","modules/clean/uirequest","modules/clean/react/file_viewer/file_preview_update_watcher","modules/clean/history","modules/clean/sharing/shared_link_modal","external/underscore","modules/clean/ajax","modules/clean/sso_login_checks","modules/core/notify","external/swfobject","modules/clean/sharing/api","modules/clean/search/search_helpers","modules/clean/job_progress","modules/clean/pagination_manager","modules/constants/static","modules/clean/previews/pdf_loader","modules/constants/viewer","modules/clean/sharing/get_editable_link_prompt","modules/clean/sharing/constants","modules/clean/people/experiments/link_profile_service_modal","modules/clean/account/email","modules/clean/dbmodal","modules/clean/api_v2/client","modules/clean/events/rollback","modules/clean/react/browse/constants","modules/clean/react/previews/preview_image_zoom","modules/clean/display_format","modules/clean/event_load","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","modules/clean/components/role_picker","external/plupload_dev","modules/clean/react/previews/preview_video","external/keymaster","modules/clean/image_size","modules/clean/viewer","modules/core/controller_helpers","modules/clean/sharing/shared_content_link_sync_modal","modules/constants/python","modules/clean/sprite","modules/clean/react/reset_form","modules/clean/dbmodal_loading","modules/clean/undo","modules/clean/notserver","modules/clean/gandalf_util","modules/clean/multiaccount_login","modules/clean/datetime","modules/clean/video_util","modules/clean/sharing/members_list/members_list_modal","modules/clean/react/previews/preview_flippable","modules/clean/contacts/types","external/react","modules/clean/profile_services/profile_services_constants","modules/clean/loggers/file_preview_logger","modules/clean/react/activity/comment_count_bubble","modules/clean/db_bubble","modules/clean/react/previews/audio/preview_audio","external/flash_detect","external/purify","modules/clean/sharing/share_inband","modules/core/visibility","modules/dirty/react/file_viewer/controller","modules/constants/env","modules/clean/sharing/shared_folder_settings_modal","jquery","modules/core/ordered_dictionary","modules/clean/components/bubble_picker","modules/clean/groups/api","external/modernizr","modules/clean/teams/team_folder_modal","modules/clean/components/ajax_form","modules/clean/react/invite/invite_form_react","modules/clean/browse_events","modules/clean/react/modal","modules/clean/contacts/list","modules/clean/sharing/ui_util","modules/clean/profile_services/profile_services_link","modules/core/i18n","modules/constants/request","modules/clean/top_notif","modules/core/dom","modules/clean/web_timing_logger","modules/clean/payments/credit_card_util","modules/clean/react/previews/preview_image","modules/clean/form","modules/core/cookies","modules/clean/clipboard","modules/clean/payments/cash","modules/clean/browse/browse_drag_utils","modules/clean/account/email_verify_reasons","modules/clean/previews/util","modules/clean/react/hierarchical_nav_bar","modules/clean/payments/dfb_util","modules/clean/search/search_type","external/jquery_ui","modules/clean/contacts/cache","modules/clean/frame_messenger","modules/clean/analytics","modules/clean/photos/legacy_thumb_loader","modules/core/browser","modules/clean/react/previews/preview_blank","modules/clean/filepath","modules/core/html","modules/clean/static_urls"],function(e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,S,C,T,A,D,O,N,I,L,R,M,F,P,q,U,j,B,z,H,V,Y,W,K,J,G,Q,X,Z,ee,te,ne,ie,re,oe,se,ae,_e,le,ue,de,ce,he,fe,pe,me,ve,ge,we,be,ye,ke,Ee,xe,Se,Ce,Te,Ae,De,Oe,Ne,Ie,$e,Le,Re,Me,Fe,Pe,qe,Ue,je,Be,ze,He,Ve,Ye,We,Ke,Je,Ge,Qe,Xe,Ze,et,tt,nt,it,rt,ot,st,at,_t,lt,ut){var dt,ct,ht,ft={},pt=n.PreviewLinkfile,mt=(a.LegacyFilePreviewActions,a.LegacyFileViewerActions),vt=l.FolderShareApiClient,gt=d.alertd,wt=d.assert,bt=d.raiseAndReport,yt=d.reportException,kt=d.stackTrace,Et=x.SharingApi,xt=x.UserlessSharingApi,St=C.Job,Ct=C.ModalProgress,Tt=L.LinkProfileServiceModal,At=(R.ChangeEmail,R.EmailVerification),Dt=M.DBModal,Ot=M.DBModalStack,Nt=M.DBUserModal,It=(F.ApiV2Client,q.FileTypes),$t=(U.PreviewImageZoom,V.RolePickerState),Lt=(W.PreviewVideo,J.image_best_fit_size),Rt=(te.ResetStartForm,te.ResetFinishForm,re.NotServer,re.NotClients),Mt=le.MemberList,Ft=ue.PreviewFlippable,Pt=(pe.CommentCountBubbleFactory,be.ShareInband),qt=Le.SimpleModal,Ut=Fe.LinkedProfileServices,jt=Fe.ProfileServicesLinkingHandler,Bt=Pe.ungettext,zt=Pe._,Ht=(Pe.N_,Pe.E_,Pe.render_sentences,Ue.TopNotificationBar),Vt=(Ue.EUCookieNotificationBar,Ue.ExpiredIOSNotificationBar,Ue.PackratUnlimitedOptInNotificationBar,Ue.DfBAdminEarlyAccessSharingControlsBar,Ue.LocaleSwitchBar,Ue.SuperInactiveRecoverBar,He.PreviewImage,Ke.Cash,Ke.CashUtil),Yt=Qe.PermissionHelper,Wt=(Xe.HierarchicalNavBar,Ze.DfBTransitionInfoFetcher),Kt=(nt.ContactsCache,nt.DefaultContactsCache);INLINE_JS.$=$,INLINE_JS.$u=w,Function.prototype.defer=Function.prototype.defer.wrap(function(e){var t;return t=$A(arguments).slice(1),this.__tb__=kt(),e.apply(this,t)}),String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(e){var t,n,i;t=$A(arguments).slice(1);try{return e.apply(this,t)}catch(e){return n=e,wt(0,n.toString())}}),dt=ft.Jcached={cache:{},set:function(e,t,n){var i;return i=dt.cache[e],null==i&&(i=dt.cache[e]={}),i.value=t,i.expires=n?(new Date).getTime()+n:0},get:function(e){var t;return t=dt.cache[e],null==t||(new Date).getTime()>t.expires?(delete dt.cache[e],!1):t.value}},Function.prototype.cached=function(e){var t,n;return n=Math.random(),t=this,function(){var i;return i=dt.get(n),i!==!1?i:(i=t(),dt.set(n,i,e),i)}},Array.prototype.sort_by_key=function(e,t){var n;return null==t&&(t=!1),n=t?-1:1,this.sort(function(t,i){return t=e(t),i=e(i),i>t?-1*n:t>i?1*n:0})},Array.prototype.contains=function(e){return-1!==this.indexOf(e)},Array.prototype.remove=function(e,t){return t=t||e+1,this.splice(e,t-e)},Array.prototype.removeItem=function(e){var t;return t=this.indexOf(e),t>=0?this.remove(t):!1},Array.prototype.dict_by=function(e){var t,n,i,r,o;for(o={},t=i=0,r=this.length;r>i;t=++i)n=this[t],o[this[t][e]]=this[t];return o},Array.prototype.unique=function(){var e,t,n,i,r;for(e={},n=0,i=this.length;i>n;n++){if(t=this[n],"string"!=typeof t)return this;e[t]=0}r=[];for(t in e)r.push(t);return r},String.prototype.widthSplit=function(e){var t,n,i,r;for(null==e&&(e=15),t=[],n=this,r=0,i=n.substring(r,r+e);""!==i;)t.push(i),r+=e,i=n.substring(r,r+e);return t},Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,.5)}}),function(e){var t,n;return n=function(e){var t,n,i,r,o,s,a,_,l;if(e)if(Object.isArray(e)){for(t=[],i=0,o=e.length;o>i;i++)n=e[i],t.push(lt.escape(n).toHTML());e=new lt(t.join(""))}else if(e.top||e.bottom||e.before||e.after)for(_=["top","bottom","before","after"],r=0,s=_.length;s>r;r++)a=_[r],l=e[a],l&&(e[a]=arguments.callee(l));else Zt.isElm(e)||e.toElement||e.toHTML||(e=lt.escape(e));return e},Element.addMethods({db_observe:function(e,t,n){return e.observe(t,function(t){return n(t,e)})},smoothScrollIntoView:function(e,t){var n,i,r,o,s,a;return null==t&&(t={}),n={duration:.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut},t=Object.extend(n,t),r=e.viewportOffset(e),i=e.getDimensions(),a=document.viewport.getDimensions(),s=t.padding||0,r.top>s&&r.top+i.height<a.height-s?void 0:(o=r.top<s?-1*Math.floor(a.height/4):-1*Math.floor(3*a.height/4),t.offset=t.offset||o,new Effect.ScrollTo(e,t))},__sert:function(e,t){return Element.insert(e,n(t))},__date:function(e,t){return Element.update(e,n(t))},replace:t=function(t,i){return e(t,n(i))}})}(Element.replace),ct=function(e){if(null!=e?e.target:void 0)try{return document.activeElement=e.target===document?null:e.target}catch(e){}},ht=function(){try{return document.activeElement=null}catch(e){}},document.addEventListener&&(document.addEventListener("focus",ct,!0),document.addEventListener("blur",ht,!0)),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.lpad=function(e,t){var n;for(null==t&&(t="0"),n=this;n.length<e;)n=t+n;return n.toString()},String.prototype.reverse=function(){var e,t,n;return n=this.split(""),t=n.reverse(),e=t.join("")},String.prototype.count=function(e){return(this.length-this.gsub(e,"").length)/e.length},String.prototype.repeat=function(e){return new Array(e+1).join(this)},String.prototype.title=function(){return this.charAt(0).toUpperCase()+this.substr(1)},Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,e,t){var n,i,r,s,a,_,l,d,c,h,p,m,v,g,w;if(null==t&&(t={}),this.orig_req={url:e,options:t},this.start_time=ae.time(),t.method=t.method||"post",t.evalJS=!1,t.suppress_nonstandard_headers=!0,t.parameters=t.parameters||{},t.parameters.t=Ye.read(qe.JS_CSRF_COOKIE),t.parameters.is_xhr=!0,("post"===t.method.toLowerCase()||u.CPROFILE_ENABLED)&&(t.parameters.parent_request_id=qe.REQUEST_ID),u.CPROFILE_ENABLED&&(t.parameters.cProfile=u.CPROFILE_PARAMETER),f.PUBLIC_MODE_OVERRIDE&&(t.parameters.public_mode_override="1"),f.COUNTRY_OVERRIDE&&(t.parameters.public_mode_override=f.COUNTRY_OVERRIDE),u.GANDALF_PANEL&&0===e.indexOf("/")&&(t.parameters.gandalf_panel=1),Ajax.DBRequest.restrict&&(t.parameters.restrict=Ajax.DBRequest.restrict),i=t.cleanUp||function(){},this.subject_user=t.subject_user||t.job_user,t.job&&(this.job_id=Zt.nonce(),t.parameters.job_id=this.job_id,Pr.watch(this,t.dont_hide_progress_on_complete)),t.no_watch||nn.watch(this,!!t.job),h=t.onFailure,p=t.onSuccess,c=t.onComplete,d=function(e){return function(n){var i,r;return t.parameters.xhr_retry||!t.allow_retries?!1:0===(i=n.status)||500===i||502===i||503===i?(e.orig_req.options.parameters.xhr_retry=!0,e.orig_req.options.onFailure=h,e.orig_req.options.onSuccess=p,r=new Ajax.DBRequest(e.orig_req.url,e.orig_req.options),!0):!1}}(this),t.onFailure=function(n){var r,o,s;if(!St.handled(n.request.job_id)&&!d(n))return t.noAutonotify||(!Ee.IS_PROD&&500===n.status&&n.getHeader("X-Debug-Url")?(e=n.getHeader("X-Debug-Url"),r=zt("There was a problem completing this request.")+(' <a href="'+e+'" target="_blank">View debug</a>'),k.error(new lt(r))):k.error()),i(!1),h&&h(n),403===n.status&&(s=Zt.session_storage_get("reload-timestamp"),(!s||ae.time()-s>3e4)&&(Zt.session_storage_set("reload-timestamp",ae.time()),location.reload(!0))),wt(t.noAutonotify||403===(o=n.status)||404===o||502===o,"Ajax "+n.status+" on "+n.request.url)},t.onComplete=function(){return function(e){return e.responseText.length&&c&&0!==e.responseText.indexOf("async_task_started:")?c(e):void 0}}(this),t.onSuccess=function(n){return function(r){var s,a,_,l,u,c,f,m,v,g,w,b,y,E,x,S,C,T;if(T=ae.time()-r.request.start_time,!St.handled(r.request.job_id)){if(r.responseText.length)if(0===r.responseText.indexOf("err:"))t.noAutonotify||(m=r.responseText.substr(4),t.html_in_error_msg&&(m=new lt(m)),k.error(m)),h&&h(r);else{if(0===r.responseText.indexOf("async_task_started:")?(n.async_task_id=r.responseText.split(":")[1],Pr.watch(n)):p&&(0===r.responseText.indexOf("ok:")&&k.success(r.responseText.substr(3)),p(r)),C=r.getHeader("X-Server-Response-Time")||"-1",t.log_timing&&Be.log_ajax_transition.defer(T,void 0,void 0,void 0,C,e=Xt.absolutize(n.url)),a=Se("#cprofile"),!t.no_watch&&a.length){if(E=qe.REQUEST_ID+"-"+r.getHeader("X-Dropbox-Request-Id"),e=r.request.url.replace(/[^\/]*\/\/[^\/]+/,"").replace(/\?.*$/,""),g={request_id:E},y=r.request.url,-1!==y.indexOf(Ee.BLOCK_CLUSTER))g.block=1;else for(w=Ee.BATCH_THUMB_ENDPOINTS,c=0,f=w.length;f>c;c++)if(u=w[c],-1!==y.indexOf(u)){g.block=1;break}s=function(e,t,n,i){var r,s;return r=Se(i?'<a target="_blank" />':"<a />"),s=r.attr("href",String(o({authority:Ee.WEBSERVER,path:t,query:n}))).text(e+" ")},v=[["svg","/profile/cprofile/svg",!0],["pstats","/profile/cprofile/pstats",!1],["callgrind","/profile/cprofile/callgrind",!1],["IO","/profile/ioprofile",!0],["DB","/profile/dbprofile",!0]],S=function(){var e,t,n;for(n=[],e=0,t=v.length;t>e;e++)_=v[e],n.push(s(_[0],_[1],g,_[2]));return n}(),x=Se('<div class="ajax">').text("Ajax: "+e+" ("+C+"ms)").prepend(S),l=a.find(".ajax"),l.length>=10&&l.last().remove(),a.prepend(x)}Se("#gandalf_panel").length&&"/gandalf_panel"!==r.request.url.substring(0,14)&&null!=(b=window.gandalf_panel)&&b.add(r.request.url,r.getHeader("X-Dropbox-Request-Id"))}else if(!t.job){if(d(r))return;t.noAutonotify||r&&0===r.status||k.error(),h&&h(r)}return i(!0)}}}(this),t.onException=function(t,n){var i,r;if(window.console)throw n;return i="Error with AJAX callback for: "+e+" :::: "+n.toString(),r=kt(),r.pop(),yt(i,st.get_href(),"",r.join("\n"))},t.job&&(e+=(-1===e.indexOf("?")?"?":"&")+"long_running=1"),t.subject_user&&!(null!=(v=t.parameters)?v[O.UID_PARAM_NAME]:void 0)&&(e=o.parse(e).updateQuery(O.UID_PARAM_NAME,t.subject_user).toString()),n=$H({url:e}),t.parameters){for(n.update(t.parameters),g=n.keys(),r=0,_=g.length;_>r;r++)for(a=g[r],w=["passwd","password","oauth","ccn","host_id"],s=0,l=w.length;l>s;s++)m=w[s],-1!==a.indexOf(m)&&n.unset(a);n.unset("t")}return t.onSuccess.__tb_ajax_info__=t.onFailure.__tb_ajax_info__=Object.toJSON(n),$super(e,t)}}),"undefined"!=typeof key&&null!==key&&Object.extend(key,{main_modifier:function(){return Zt.is_mac()?decodeURIComponent("%E2%8C%98"):"ctrl"}}),Object.extend(Prototype.BrowserFeatures,{DB_CORS:window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest});var Jt=[].slice;window.$j||(window.$j=window.jQuery),INLINE_JS.$j=Se,Function.prototype.bind||(Function.prototype.bind=function(e){var t,n,i,r;if("function"==typeof monkey_check&&monkey_check(),"function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return t=Array.prototype.slice.call(arguments,1),r=this,i=function(){},n=function(){return r.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))},i.prototype=this.prototype,n.prototype=new i,n}),jQuery.fn.curry=function(){var e,t,n;return t=arguments[0],n=arguments[1],e=3<=arguments.length?Jt.call(arguments,2):[],null==n&&(n=window),"function"==typeof monkey_check&&monkey_check(),function(){var i;return i=1<=arguments.length?Jt.call(arguments,0):[],t.apply(n,Jt.call(e).concat(Jt.call(i)))}},jQuery.fn.stripTags=function(e){return"function"==typeof monkey_check&&monkey_check(),e.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},jQuery.fn.hasScrollBar=function(){return"function"==typeof monkey_check&&monkey_check(),this.get(0).scrollHeight>this.height()},jQuery.fn.viewportOffset=function(){return"function"==typeof monkey_check&&monkey_check(),je.viewport_offset(this)},jQuery.fn.visible=function(){return"function"==typeof monkey_check&&monkey_check(),jQuery(this).is(":visible")},jQuery.format=function(e,t){return"function"==typeof monkey_check&&monkey_check(),e.replace(/\{([^}]+)\}/g,function(e,n){return n in t?t[n]:e})},jQuery.cachedScript=function(e,t){return"function"==typeof monkey_check&&monkey_check(),t=Se.extend(t||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(t)},jQuery.browser=st,jQuery.addSubjectParam=function(e,t){var n;return"function"==typeof monkey_check&&monkey_check(),e.subject_user&&!(null!=(n=e.data)?n[O.UID_PARAM_NAME]:void 0)?t[O.UID_PARAM_NAME]=String(e.subject_user):void 0},jQuery.ajaxPrefilter(function(e,t){var n;return t.noDropboxDefaults?void 0:(n={t:Ye.read(qe.JS_CSRF_COOKIE),is_xhr:!0},jQuery.addSubjectParam(t,n),null!=jQuery.ajaxSettings.restrict&&(n.restrict=jQuery.ajaxSettings.restrict),e.data=Se.param(Se.extend(t.data,n),!0),!1)}),jQuery.ajax.retryOnce=function(e,t){var n;return"function"==typeof monkey_check&&monkey_check(),"abort"===t||0!==(n=e.status)&&500!==n&&502!==n&&503!==n||this.xhr_retry?void 0:(this.xhr_retry=!0,jQuery.ajax(this))};var Gt,Qt,Xt,Zt,en;Zt=INLINE_JS.Util=ft.Util={scroll_to_thumb:function(e){var t,n,i,r;return n=e.cumulativeOffset().top,t=e.getHeight(),r=je.scroll_offsets().top,i=je.viewport_dimensions().height,r>n||n+t>r+i?je.scroll_to(0,n-i/2):void 0},decode_sort_key:function(e){var t,n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],o.push("string"==typeof t?i.decode(t):t);return o},sort_by_rank_or_key:function(e,t){return null!=e.sort_rank&&null!=t.sort_rank?e.sort_rank-t.sort_rank:(wt(null!=e.sort_key&&null!=t.sort_key,"expected sort keys on both elms"),this._sort_by_key(e,t))},sort_by_key:function(e,t){return this._sort_by_key(e,t)},_sort_by_key:function(e,t){var n,i,r,o,s;for(o=e.sort_key,s=t.sort_key,n=i=0,r=o.length;r>=0?r>i:i>r;n=r>=0?++i:--i){if(null==s[n])return 1;if(typeof o[n]!=typeof s[n])return"string"==typeof o[n]?1:-1;if(o[n]!==s[n])return o[n]>s[n]?1:-1}return s.length>o.length?-1:0},add_sort_arrow_mouseover:function(e,t,n){var i,r,o,s,a;for(s=$$(n),a=[],i=0,r=s.length;r>i;i++)o=s[i],a.push(function(n){var i;if(e!==n)return ee.src(n.down("img"),"web","downtick-spacer"),n.removeClassName("bolded");if(n.addClassName("bolded"),!n.hasClassName("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ee.src(n.down("img"),"web",i)}(o));return a},add_sort_arrow_mouseover_j:function(e,t,n){var i,r,o,s,a;for(s=Se(n),a=[],i=0,r=s.length;r>i;i++)o=s[i],a.push(function(n){var i;if(e.attr("data-sort")!==Se(n).attr("data-sort"))return ee.src(Se(n).find("img")[0],"web","downtick-spacer"),Se(n).removeClass("bolded");if(Se(n).addClass("bolded"),!Se(n).hasClass("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ee.src(Se(n).find("img")[0],"web",i)}(o));return a},one_line_fit:function(e){var t,n;return t=$$(e),t.length<2?void 0:(n=function(){return function(){var e,i,r,o,s,a,_,l,u;if(r=t[0],a=t[t.length-1],o=r.cumulativeOffset().top,_=a.cumulativeOffset().top,o!==_){if(e=parseInt(r.getStyle("font-size"),10),u=e-1,8>u)return;for(s=0,l=t.length;l>s;s++)i=t[s],i.style.fontSize=u+"px";return n()}}}(this))()},nice_list:function(e){var t,n,i,r,o;return e?1===e.length?e[0]:2===e.length?zt("%(x)s and %(y)s").format({x:e[0],y:e[1]}):(o=zt("%(x)s, %(y)s, and %(z)s").split(/%\(x\)s|%\(y\)s|%\(z\)s/),wt(4===o.length,"bad item list format %(x)s, %(y)s, and %(z)s"),n=o[0],i=o[1],r=o[2],t=o[3],[n,e.slice(0,-1).join(i),r,e[e.length-1],t].join("")):""},list_em_snippet:function(e,t){var n,i,r,o,s,a;for(o="",t-=new _("...").length,i=r=0,s=e.length;(s>=0?s>r:r>s)&&(a=e[i],0!==i&&(a=", "+a),n=new _(a).length,!(n>t));i=s>=0?++r:--r)t-=n,o+=a;return{str:o,snipped:e.length-i}},start_of_day:function(e){var t;return t=new Date,t.setTime(e.getTime()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},to_iso8601_date:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=!1),t?(i=e.getUTCFullYear().toString()+"-"+(e.getUTCMonth()+1).toString().lpad(2)+"-"+e.getUTCDate().toString().lpad(2),n&&(i+=" "+e.getUTCHours().toString().lpad(2)+":"+e.getUTCMinutes().toString().lpad(2)+":"+e.getUTCSeconds().toString().lpad(2))):(i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),n&&(i+=" "+e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2))),i},to_mysql_date:function(e,t,n){var i,r,o;return i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),o=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2),r="."+e.getMilliseconds().toString().lpad(3),t?n?i+" "+o+r:i+" "+o:i},from_mysql_date:function(e){var t,n,i,r,o,s,a;return r=e.split(" "),t=r[0],s=r.length>1?r[1]:!1,n=t.split("-"),wt(3===n.length,"weird date format on "+this+", expected yyyy-mm-dd"),i=new Date(n[0],parseInt(n[1],10)-1,n[2]),s&&(a=s.split(":"),wt(3===a.length,"weird time format on "+this+", expected hh:mm:ss.ms"),i.setHours(a[0]),i.setMinutes(a[1]),o=a[2].split("."),i.setSeconds(o[0]),o.length>1&&i.setMilliseconds(o[1])),i},make_table:function(e,t){var n,i,r,o,s,a,_;r=new Element("table",t),o=new Element("tbody"),r.__sert(o);for(i in e)_=e[i],a=new Element("tr"),s=new Element("td").insert(i),n=new Element("td").insert(_),a.__sert(s),a.__sert(n),o.__sert(a);return r},validate_email:function(e){var t;return t=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9-][A-Z0-9.-]*\\.[A-Z]{2,15}$","i"),t.test(e)},scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(e){var t,n;return n=this.scried,t=n[e],t||(t=$(e),n[e]=t),t},urlquote:function(e){return e.split("/").map(encodeURIComponent).join("/")},ie8:Prototype.Browser.IE&&document.documentMode&&!0,ie:Prototype.Browser.IE,log:function(){var e,t;return Ee.IS_PROD?void 0:Prototype.Browser.IE?null!=(e=$("ieconsole"))?e.innerHTML+=$A(arguments).join(" ")+"<br>":void 0:"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,$A(arguments)):void 0},childElement:function(e,t){var n;return n=this.childElementWithIndex(e,t),n[0]},childElementWithIndex:function(e,t){var n,i,r,o,s,a;for(n=0,a=e.childNodes,r=o=0,s=a.length;s>o;r=++o)if(i=a[r],1===i.nodeType&&n++===t)return[i,r];return[!1,!1]},disableSelection:function(e){return e.onselectstart=function(){return!1},e.unselectable="on",e.style.MozUserSelect="none",e.style.cursor="default"},enableSelection:function(e){return e.onselectstart=function(){return!0},e.unselectable="off",e.style.MozUserSelect="",e.style.cursor=""},disable_ie_image_dragging:function(){return Prototype.Browser.IE&&Prototype.Browser.IEV<9?document.ondragstart=function(){return!1}:void 0},bsearch:function(e,t,n,i){var r,o,s,a;for(n||(n=function(e,t){return e-t}),r=e.length,o=0;r>o;)if(s=Math.floor(r/2+o/2),a=n(e[s],t),a>0)r=s;else{if(!(0>a))return s;o=s+1}return i?o:-1},nonce:function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString().lpad(6),n+t},focus:function(e){if(e){e=$(e);try{return e.focus()}catch(e){}}},sumStyles:function(e,t){var n,i,r,o;if(i=0,e)for(r=0,o=t.length;o>r;r++)n=t[r],i+=parseInt(e.getStyle(n),10)||0;return i},async_load_script:function(e){var t;return t=function(){var t,n;return n=document.createElement("script"),n.src=e,n.type="text/javascript",n.async=!0,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(n,t)},"complete"===document.readyState?t():null!=window.attachEvent?window.attachEvent("onload",t):window.addEventListener("load",t,!1)},smart_window_load:function(e){return"complete"===document.readyState?e.defer():Event.observe(window,"load",e)},isNumber:function(e){return!isNaN(Number(e,10))},shorten_url:function(e,t){return new Ajax.DBRequest("/shorten_url",{parameters:{url:e},onSuccess:function(e){return t(e.responseText)}})},falsy_to_empty:function(e){return e||""},preloaded_images:{},preload_image:function(e,t,n){var i;if(!this.preloaded_images[e])return i=new Image,null!=t&&Element.extend(i).observe("error",t),null!=n&&Element.extend(i).observe("load",n),i.src=e,this.preloaded_images[e]=i},get_preloaded_image:function(e){return this.preloaded_images[e]?this.preloaded_images[e].clone():new Element("img",{src:e})},clear_selected:function(){var e;if(window.getSelection){if(e=window.getSelection(),e.removeAllRanges)return e.removeAllRanges()}else if(document.selection)return document.selection.empty()},is_mac:function(){return-1!==navigator.appVersion.indexOf("Mac")},is_windows:function(){return-1!==navigator.appVersion.indexOf("Windows")},in_scrollbar:function(e){var t,n;return t=20,n=je.viewport_dimensions(),e>n.width-t},freshbutton_overlay:function(e,t){var n,i;return i=e instanceof jQuery&&e||Se(e),n=t instanceof jQuery&&t||Se(t),i.on("mouseover",function(){return function(){return n.addClass("hovered")}}(this)),i.on("mouseout",function(){return function(){return n.removeClass("hovered"),n.removeClass("pressed")}}(this)),i.on("mousedown",function(){return function(){return n.removeClass("hovered"),n.addClass("pressed")}}(this)),i.on("mouseup",function(){return function(){return n.removeClass("pressed")}}(this))},isElm:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},_track_twitter_chars_left:function(e,t){var n;return clearInterval(this.chars_left_interval),n=function(){return function(){var n,i;return n=$("twitter-chars"),i=t-$F(e).trim().length,0>i?n.addClassName("too-long"):n.removeClassName("too-long"),n.__date(i)}}(this),this.chars_left_interval=setInterval(n,250)},session_storage_set:function(e,t){return window.sessionStorage&&window.JSON?window.sessionStorage.setItem(e,JSON.stringify(t)):void 0},session_storage_get:function(e){return window.sessionStorage&&window.JSON?JSON.parse(window.sessionStorage.getItem(e)):void 0},pdf_plugins:function(){var e,t,n;return n=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi,e=function(){var e,i,r,o;for(r=window.navigator.plugins,o=[],e=0,i=r.length;i>e;e++)t=r[e],n.test(t.name)&&o.push(t);return o}()},get_window_location:function(){return window.location}},Zt.scrollLeft=Zt.scrollLeft.cached(50),Zt.scrollTop=Zt.scrollTop.cached(50),null==window.console&&(window.console={log:function(){},profile:function(){},profileEnd:function(){}}),document.observe("script:loaded",function(){var e,t,n,i,r;if(Zt.ie8){for(i=$$("#page-header a, #page-footer a"),r=[],e=0,t=i.length;t>e;e++)n=i[e],r.push("_blank"===n.target?n.target="":void 0);return r}}),Qt=__CONDITIONAL_JS__.Trace=ft.Trace=function(){var e;return e=[],{log:function(){var t;return t=ae.time()+": "+$A(arguments).join(" "),e.push(t)},get:function(){return e.join("\n")}}}(),Gt=ft.T=function(){return Qt.log.apply(this,$A(arguments))},document.observe("script:loaded",function(){return Gt("dom:loaded")}),Event.observe(window,"load",function(){return Gt("window:load")}),Xt=ft.URLUtil={absolutize:function(e){return e.startsWith("https://")||e.startsWith("http://")?e:"/"===e.charAt(0)?window.location.protocol+"//"+window.location.host+e:wt(0,"absolutize is confused by "+e)}},en=ft.Velocity={scroll_container:null,velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){return this.velocity=this.max_delta_y,0!==this.velocity&&(this.last_nonzero_velocity=this.velocity),this.max_delta_y=0},capture_new_y_pos:function(){var e,t;return null==this.old_y?void(this.old_y=null!=this.scroll_container?this.scroll_container.scrollTop:je.scroll_offsets().top):null==this.max_delta_y?void(this.max_delta_y=0):(t=null!=this.scroll_container?this.scroll_container.scrollTop:je.scroll_offsets().top,e=Math.abs(this.max_delta_y)<Math.abs(t-this.old_y),e?(this.max_delta_y=t-this.old_y,this.old_y=t):void 0)},start_capture:function(e){return this.scroll_container=e,this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500)),null!=this.scroll_container?this.scroll_container.observe("scroll",this.capture_new_y_pos.bind(this)):Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(e){return null==e&&(e=!1),wt(null!=this.velocity_calculator_interval,"Haven't started capturing velocity"),e?this.last_nonzero_velocity:this.velocity}};var tn;tn=ft.DomUtil={fromElm:function(e){return $(e).innerHTML},updateFromElm:function(e,t){return e=$(e),t=$(t),e.update(this.fromElm(t))},fillVal:function(e,t){var n,i,r,o,s,a;for(r=$$("."+t),s=[],n=0,i=r.length;i>n;n++)a=r[n],a=$(a),"INPUT"===a.tagName?(a.value=e,s.push(a.defaultValue=e)):(""!==a.innerHTML||"A"!==(o=a.tagName)&&"B"!==o&&"INPUT"!==o&&"I"!==o&&"LABEL"!==o&&"SELECT"!==o&&"SPAN"!==o&&"TEXTAREA"!==o||Zt.log("Filling an empty value; this may look broken in IE7",a),s.push(a.innerHTML=e));return s}};var nn;nn=ft.RequestWatcher={reqs:[],working_msg:zt("Still working...",{comment:"Comment about waiting for a process to complete"}),last_notification:null,TIMEOUT:10,watch:function(e,t){var n;return n=this.reqs,n.length||(this.int_id=setInterval(this.check_up.bind(this),500)),t&&(e.skip_message=!0),n.push([e,ae.time()])},check_up:function(){return this.scan(!1)},remove:function(e){return this.scan(e)},scan:function(e){var t,n,i,r,o,s,a,_,l;for(r=ae.time(),o=[],a=this.reqs,n=0,i=a.length;i>n;n++)s=a[n],_=s[0],l=s[1],t=r-l,4!==_.transport.readyState?(t>4e3&&!_.skip_message&&(_.skip_message=!0,k.isShown()&&k.current()===!ie.undo_notification&&(this.last_notification=k.success(this.working_msg))),t>1e3*this.TIMEOUT&&_.job&&_.transport.abort(),_!==e?o.push([_,l]):_.transport.abort()):this.clearWorkingMessage();return this.reqs=o,o.length?void 0:clearInterval(this.int_id)},clearWorkingMessage:function(){return k.isShown()&&k.current()===this.last_notification?k.clear():void 0}},Se(function(){var e,t,n,i;n=Prototype.Browser,i=[];for(e in n)t=n[e],t===!0&&i.push(Se(document.body).addClass(e.toLowerCase()));return i});var rn,on,Jt=[].slice;rn=ft.HTML5_HISTORY=Modernizr.history,Se(function(){return function(){return v.init()}}(this)),on=ft.HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",_get_location:function(){return window.location.href},_set_location:function(e){return window.location.href=e},_replace_location:function(e){return window.location.replace(e)},init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(e,t){return this.callback_map[e]=t,this.watch_timer?void 0:this.init()},check_hash:function(){var e,t,n,i,r,o;if(i=this._get_location().split("#")[1],null!=i&&(i=i.replace(/%27/g,"'")),this.last_hash!==i){if(this.last_hash=i,this.last_prefix&&""===i)i=this.last_prefix+":";else if(!i)return;return o=i.split(":"),r=o.first(),this.last_prefix=r,n=this.callback_map[r],null!=n&&(t=function(){var t,n,i,r;for(i=o.slice(1),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(decodeURIComponent(e));return r}(),n.apply(null,t)),$(document).fire("db:hash_change",{hash:i})}},_prepare_hash:function(e){var t,n;return n=$A(e).map(Zt.falsy_to_empty),t=n.map(encodeURIComponent),t.join(":")},set_hash:function(){var e,t;return e=1<=arguments.length?Jt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t)},replace_hash:function(){var e,t;return e=1<=arguments.length?Jt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t,!0)},_set_hash:function(e,t){return""===e&&(e="/"),this.last_hash=e,t?this._replace_location("#"+e):this._set_location("#"+e)}};var sn;sn=ft.SharingUtil=function(){function e(){}return e.success_string_for_recipients=function(e){var t;return t=1===e.length?-1===e[0].indexOf("@")?zt("Sent to %(recipient)s.",{comment:"Recipient is a user's name"}).format({recipient:e[0]}):zt("Sent to %(recipient)s.",{comment:"Recipient is an email address"}).format({recipient:e[0]}):2===e.length?-1===e[0].indexOf("@")?-1===e[1].indexOf("@")?zt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are users' names."}).format({recipient_first:e[0],recipient_second:e[1]}):zt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is a user's name, second is an email address"}).format({recipient_first:e[0],recipient_second:e[1]}):-1===e[1].indexOf("@")?zt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is an email address, second is a user's name"}).format({recipient_first:e[0],recipient_second:e[1]}):zt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are email addresses"}).format({recipient_first:e[0],recipient_second:e[1]}):zt("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format(-1===e[0].indexOf("@")?{recipient:e[0],num_others:e.length-1
}:{recipient:e[0],num_others:e.length-1})},e}();var an;an=INLINE_JS.SharingModals=ft.SharingModals=function(){function e(){}return e.logAndShowSharingModal=function(t,n){var i,r,s,a;if(a=Me.chooseShareUIType(t,{allowLegacyPublicLinks:Ir.public_folder_enabled,hasLegacyPublicAppToken:Ir.public_app_token}),i=Me.SHARE_UI_TYPE,a!==i.NO_SHARE&&At.get_for_user(Ir.active_user).verified_or_show())switch(a){case i.PUBLIC:return s=Ir.public_app_token?"/spa/"+Ir.public_app_token+t.ns_path:"/u/"+Ir.active_user.id+t.fq_path.substring(gr.PUBLIC_FOLDER_PATH_LENGTH),gr.showCopyPublicUrlModal(String(new o({scheme:"https",authority:Ee.PUBSERVER,path:s})));case i.TEAM_FOLDER:return e.show_share_existing_modal(t.fq_path,Ir.active_user);case i.SHARED_FOLDER:return rt.ShmodelUILogger.log_with_target_file("sf_invite",n,t),c.show(Ir.active_user,t,i.SHARED_FOLDER);case i.SHARED_FILE:return c.show(Ir.active_user,t,i.SHARED_FILE);case i.SHARED_LINK:return rt.ShmodelUILogger.log_with_target_file("token_share",n,t),r=t.fq_path,wt(r,"token_share: expected non-root fq_path"),Un.shmodel(r,n+"_token_share")}},e.show_shared_folder_options_modal=function(e,t,n,i){return null==n&&(n=!0),null==i&&(i=!0),Ot.push(new un(t,e,n,i))},e.show_share_inband_modal=function(e,t,n,i){return ti.createAndShowInbandModal(t,e,!0,n,!0,!1,i)},e.show_shared_folder_wizard=function(e){return new Rn(e,{element_id:"share-a-folder-wizard-modal"}).show()},e.get_select_role_modal=function(){return new Hi({element_id:"select-role-modal"})},e.start_wizard_without_user=function(){return G.get_viewer().is_paired?(null==this.select_role_modal&&(this.select_role_modal=e.get_select_role_modal()),this.select_role_modal.show()):this.start_wizard_for_user(G.get_viewer().get_users()[0])},e.start_wizard_for_user=function(t){return At.get_for_user(t).verified_or_show(Ge.SHARE_FOLDER)?e.show_shared_folder_wizard(t):void 0},e.show_share_existing_modal=function(e,t,n){var i;return null==n&&(n=!0),At.get_for_user(t).verified_or_show()?(i=new In(t,{folder_name:e,element_id:"invite-to-new-sf-wizard-modal-"+t.id,can_change_options:n}),i.show()):void 0},e.show_shmodel_or_invite_modal=function(e,t,n,i){return At.get_for_user(n).verified_or_show()?new Dn(n,{path:e,existing_sf:t,element_id:"create-link-or-invite-wizard-modal",target_item:i}).show():void 0},e.show_unshare_team_sf_modal=function(e,t,n){var i;return i=new xn(e,{element_id:"unshare-confirm-modal",team_shared_folder:!0,nested_shared_folder:!1,ns_id:t,folder_path:n}),i.show()},e.show_ignore_modal=function(e,t,n){var i,r,o;return wt(n,"Share ignore did not get an ns_id"),o=zt("Permanently remove '%(folder_name)s'").format({folder_name:_.em_snippet(t,15)}),i={ns_id:n},r=new Nt(e,{element_id:"ignore-confirm",title:o}),r.on_confirm_button_click=function(t){var o,a,_;return t.preventDefault(),o=Se(t.target),a=o.closest("form"),_=function(){return k.success(zt("Removed shared folder successfully.")),document.fire(s.SF_IGNORE,{target_ns_id:n,user_id:e.id}),r.hide()},ui.ajax_submit(a[0],!1,_,void 0,o[0],i)},r.show()},e.show_rejoin_modal=function(e,t,n){var i,r,o;return wt(n,"Rejoin didn't get an ns_id"),o=zt("Rejoin the shared folder '%(folder_name)s'?").format({folder_name:_.em_snippet(t,13)}),i={ns_id:n},r=new Nt(e,{element_id:"rejoin-confirm",title:o}),r.on_confirm_button_click=function(o){var a,_,l;return o.preventDefault(),a=Se(o.target),_=a.closest("form"),l=function(i){var o;return o=i.responseText,t=_t.filename(o),k.success(zt("Rejoined shared folder successfully.")),document.fire(s.SF_REJOIN,{target_ns_id:n,user_id:e.id,filename:t,mount_point:o}),r.hide()},ui.ajax_submit(_[0],!1,l,void 0,a[0],i)},r.show()},e.show_invites=function(){return Ot.push(new ne({element_id:"invitation-page-modal",endpoint_url:"/share_ajax/get_invitation_page"}))},e.show_shared_subfolder_modal=function(e,t){var n,i,r,o,s;return r=_.em_snippet(_t.filename(e),14),i=zt("Can't share folder"),o="'%(parent_shared_folder)s' ".format({parent_shared_folder:r}),tn.fillVal(o.escapeHTML(),"parent_shared_folder_name"),n=zt("Share '%(parent_shared_folder)s' folder"),s=n.format({parent_shared_folder:r}),$("share_parent_folder_button").value=s,mi.show(zt("Loading shared folder options..."),"<p style='margin: 3em 0; text-align: center;'> <img src='/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif' alt=''/></p>"),Se("#share_parent_folder_button").on("click",function(n){return function(){return mi.hide(),n.show_shared_folder_options_modal(e,t)}}(this)),mi.show(i,$("share_subfolder"))},e}();var _n;_n=ft.InviteFormController=function(){function e(e,t,n,i,r,o){var s,a;this.user=e,this.$form=t,this.members=n,this.invitees=i,this.new_style_groups=r,this.team_only=this.$form.data("team-only"),a={tokens:[",",";"],include_fb:!0,members:this.members,invitees:this.invitees,new_style_groups:this.new_style_groups,contacts_only:!0},"work"===this.user.role?(s=Autocompleter.TeamTokenizer,a.team_only=this.team_only):(s=Autocompleter.ContactsTokenizer,a.include_team=!0),"work"===this.user.role&&"undefined"!=typeof Ae&&null!==Ae&&(a.include_new_style_groups=!0),this.sharing_options_auto_completer=new s(this.user,o+"-new-collab-input",o+"-new-whobulk",o+"-hidden-input",a),vi._create(this.$form.find(".custom-message-container")[0]),"work"===this.user.role&&(this.team_shared_folder_controller=new Wn(this.$form))}return e.prototype.listen=function(){return this.sharing_options_auto_completer.listen()},e.prototype.reset_autocompleter=function(){return this.sharing_options_auto_completer.clearTokens()},e.prototype.tokenize=function(){return this.sharing_options_auto_completer.tokenize_emails_input(!0)},e.prototype.reset_options=function(){return Se(this.sharing_options_auto_completer.get_entry_container()).hide()},e.prototype.set_team_only=function(e){return this.team_only=e,this.sharing_options_auto_completer.setTeamOnly(e)},e.prototype.get_token_count=function(){return this.sharing_options_auto_completer.getTokenCount()},e.prototype.extract_invitees=function(){var e,t,n,i,r,o,s;for(r={},s=["emails","fb_ids","group_ids","new_style_group_ids"],n=0,o=s.length;o>n;n++)t=s[n],i=this.$form.find("input[name="+t+"]"),r[t]=[function(){var t,n,r;for(r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(Se(e).val());return r}()];return r},e.prototype.get_custom_message=function(){return this.$form.find("textarea[name='custom_message']").val()},e.prototype.get_access_type=function(){return this.$form.find(".can-edit-dropdown").data("selected-value")},e}();var ln,un,dn,cn,hn,fn,pn,mn,vn,gn,wn,bn,yn,kn,En,xn,Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty,Tn=function(e,t){return function(){return e.apply(t,arguments)}};yn=ft.SharedFolderBaseModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.options),this.team_shared_folder=this.options.team_shared_folder,this.nested_shared_folder=this.options.nested_shared_folder,this.path=this.options.folder_path,this.ns_id=this.options.ns_id,this.sharing_api=new Et(this.user)}return Sn(t,e),t.prototype.on_show=function(){return this.sharing_api.loading_elem=this.$modal_window},t}(Dt),un=ft.ExistingSharedFolderOptionsModal=function(e){function t(e,n,i,r,s){var a,l;this.user=e,null==i&&(i=!0),null==r&&(r=!0),this.restore_modal=s,this.__show_modal=Tn(this.__show_modal,this),this.__x_click_handler=Tn(this.__x_click_handler,this),wt(null!=n,"Missing folder path"),this.path=_t.normalize(n),l=zt("Shared folder options for '%(folder)s'"),l=l.format({folder:_.em_snippet(_t.filename(n),13)}),a={},a[O.UID_PARAM_NAME]=this.user.id,a.max_results=20,a.show_invite_form=i,a.show_folder_settings=r,Ot.register(ln.MODAL_DONE_VIEWING_EVENT,function(e){return function(){return"function"==typeof e.restore_modal?e.restore_modal():void 0}}(this)),t.__super__.constructor.call(this,{element_id:"folder-share-show-modal",title:l,endpoint_url:o({path:"/share_options"+this.path}).toString(),parameters:a})}return Sn(t,e),t.prototype.__x_click_handler=function(){var e;return t.__super__.__x_click_handler.apply(this,arguments),e={path:this.path},rt.SharedFolderActivityLogger.log("web","invite_modal_x_button",this.user,e),"function"==typeof this.restore_modal?this.restore_modal():void 0},t.prototype.__show_modal=function(){var e,n,i,r,o;return t.__super__.__show_modal.apply(this,arguments),e=Ir.containing_fq_path(),o=e!==this.path&&0===e.indexOf(this.path),o&&0===this.$modal_window.find("#banner-msg-sf-setting").length&&(i=zt("You’re viewing settings for the shared folder ‘<strong>%(sf_name)s</strong>’.").format({sf_name:_t.filename(this.path).escapeHTML()}),r=Se("<div id='banner-msg-sf-setting'> <t> "+i+" </t> </div>"),r.addClass("db-modal__banner db-modal__banner--warning"),this.$modal_window.find(".db-modal-box").append(r)),n={path:this.path},rt.SharedFolderActivityLogger.log("web","invite_modal_displayed",this.user,n)},t}(ne),ln=ft.ExistingSharedFolderOptionsContent=function(){function e(t,n,i,r,o,s){this.$root=t,this.options=r,this.show_invite_form=o,this.allows_editor_manage_membership=s,this.show_email_verification=Tn(this.show_email_verification,this),this.show_golden_gate_warning=Tn(this.show_golden_gate_warning,this),this.show_folder_settings=Tn(this.show_folder_settings,this),this.show_m2_folder_settings=Tn(this.show_m2_folder_settings,this),this.toggle_from_invite_mode=Tn(this.toggle_from_invite_mode,this),this.toggle_to_invite_mode=Tn(this.toggle_to_invite_mode,this),this.toggle_get_link_button_visibility=Tn(this.toggle_get_link_button_visibility,this),this.show_leave_folder_modal=Tn(this.show_leave_folder_modal,this),this.show_owner_leave_folder_warning=Tn(this.show_owner_leave_folder_warning,this),this.show_access_request_link_modal=Tn(this.show_access_request_link_modal,this),this.show_unshare_folder_modal=Tn(this.show_unshare_folder_modal,this),this.show_uninvite_modal=Tn(this.show_uninvite_modal,this),this.show_transfer_user_modal=Tn(this.show_transfer_user_modal,this),this.show_kick_group_modal=Tn(this.show_kick_group_modal,this),this.show_kick_user_modal=Tn(this.show_kick_user_modal,this),this.update_tf_access=Tn(this.update_tf_access,this),this.update_sf_perms=Tn(this.update_sf_perms,this),this.reinvite_user=Tn(this.reinvite_user,this),this.submit_invitations=Tn(this.submit_invitations,this),this.maybe_load_more=Tn(this.maybe_load_more,this),this.extract_user_data_and_call=Tn(this.extract_user_data_and_call,this),this.extract_invitee_data_and_call=Tn(this.extract_invitee_data_and_call,this),this.create_m2_inband_modal=Tn(this.create_m2_inband_modal,this),this._disable_token_for_sf=Tn(this._disable_token_for_sf,this),this.user=G.get_viewer().get_user_by_id(n),this.path=_t.normalize(i),this.options&&(this.members=this.options.folder_members,this.invitees=this.options.folder_invitees,this.new_style_groups=this.options.new_style_groups,this.num_total=this.options.num_total),this.$root.find(".bubble-dropdown").click(function(e){return Q.get_controller(Se(e.target).closest(".sf-action-dropdown")).closeDropdown(),!0}),this.start=20,this.max_results=20,this.$root.find(".member-container").on("scroll",function(e){return function(t){var n,i;return n=Se(t.currentTarget),i=n.find("#sf-members"),n.scrollTop()+n.innerHeight()>=i.innerHeight()?e.maybe_load_more():void 0}}(this)),this.sharing_api=new Et(this.user),this.sharing_api.loading_elem=this.$root,ci.register_all(),gi.register_all(),this.ns_id=this.$root.data("ns-id"),this.$invite_form=this.$root.find(".invite-more-form"),this.sf_access_type=this.$invite_form.find(".sf-invite-can-edit"),this.team_shared_folder=this.$root.data("team-shared-folder"),this.nested_shared_folder=this.$root.data("nested-shared-folder"),this.$allow_members_table=this.$root.find(".allow-members-table"),this.$folder_management_buttons=this.$root.find(".folder-management-buttons"),this.has_show_invite_form=!1,this.log_extras={path:this.path,ns_id:this.ns_id},this.sf_access_type.hide(),this.listen(),Ot.trigger(e.CONTENT_LOADED_EVENT)}return e.CONTENT_LOADED_EVENT="db:sharing_options:content_loaded",e.MODAL_DONE_VIEWING_EVENT="db:sharing_options:modal_done_viewing_event",e.prototype.listen=function(){var t,n,i,r,s;if(this.$root.find(".confirm-button").click(function(e){return function(t){return t.preventDefault(),e.submit_invitations()}}(this)),this.$root.find(".cancel-button").click(function(e){return function(t){return t.preventDefault(),e.toggle_from_invite_mode()}}(this)),this.show_invite_form){for(this.get_link_button=this.$root.find(".get-editable-link-invite"),this.$invite_input=this.$root.find("#sharing-options-new-collab-input"),s=["focus","keypress","contextmenu"],i=0,r=s.length;r>i;i++)n=s[i],this.$invite_input.off(n),this.$invite_input.on(n,this.toggle_to_invite_mode);this.$invite_input.keyup(this.toggle_get_link_button_visibility),this.$invite_input[0]&&(this.$invite_input[0].on("token:remove",this.toggle_get_link_button_visibility),this.$invite_input[0].on("token:add",this.toggle_get_link_button_visibility)),t=this.$root.find("#custom-message-wizard"),t.on("focus",this.toggle_to_invite_mode),this.$root.find(".change-m2-settings-link").on("click",this.show_m2_folder_settings),this.$root.find(".invite-verify-email").on("click",this.show_email_verification),this.$root.find(".golden-gate-upgrade-link").on("click",this.show_golden_gate_warning),this.$invite_form.length&&!this.team_shared_folder&&(this.invite_form_controller=new _n(this.user,this.$invite_form,this.members,this.invitees,this.new_style_groups,"sharing-options"))}return this.$root.find(".change-settings-link").on("click",this.show_folder_settings),this.$root.on("click","a.leave-folder",function(e){return function(t){return t.preventDefault(),rt.SharedFolderActivityLogger.log("web","invite_modal_leave_button",e.user,e.log_extras),e.show_leave_folder_modal()}}(this)),this.$root.on("click",".get-editable-link",function(e){return function(t){var n;return Se(document).trigger("collab:m2:prompt:dismiss"),e.create_m2_inband_modal(t,n=!1)}}(this)),this.$root.on("click",".get-editable-link-invite",function(e){return function(t){var n;return Se(document).trigger("collab:m2:prompt:dismiss"),e.create_m2_inband_modal(t,n=!0)}}(this)),this.$root.on("click","a.owner-leave-folder",function(e){return function(t){return t.preventDefault(),rt.SharedFolderActivityLogger.log("web","invite_modal_owner_leave_button",e.user,e.log_extras),e.show_owner_leave_folder_warning()}}(this)),this.$root.on("click","a.kick-user",function(e){return function(t){return e.extract_user_data_and_call(t,e.show_kick_user_modal)}}(this)),this.$root.on("click","a.kick-group",function(e){return function(t){var n,i,r;return t.preventDefault(),n=Se(t.currentTarget),r=n.data("group-name"),i=n.data("group-gid"),e.show_kick_group_modal(r,i)}}(this)),this.$root.on("click","a.make-owner",function(e){return function(t){return e.extract_user_data_and_call(t,e.show_transfer_user_modal)}}(this)),this.$root.on("click","a.send-email",function(){return function(e){var t,n;return e.preventDefault(),t=Se(e.currentTarget),n=t.data("email"),window.location=o({scheme:"mailto",path:n}).toString()}}(this)),this.$root.on("click","a.reinvite-user",function(e){return function(t){return e.extract_invitee_data_and_call(t,e.reinvite_user)}}(this)),this.$root.on("click","a.uninvite-user",function(e){return function(t){return e.extract_invitee_data_and_call(t,e.show_uninvite_modal)}}(this)),this.$root.on("click","input.sf-action-leave",function(e){return function(t){return t.preventDefault(),rt.SharedFolderActivityLogger.log("web","invite_modal_leave_button",e.user,e.log_extras),e.show_leave_folder_modal()}}(this)),this.$root.on("click","input.sf-action-unshare",function(e){return function(t){return t.preventDefault(),rt.SharedFolderActivityLogger.log("web","invite_modal_unshare_button",e.user,e.log_extras),e.show_unshare_folder_modal()}}(this)),this.$root.on("click","a.unshare_folder_link",function(e){return function(t){return t.preventDefault(),rt.SharedFolderActivityLogger.log("web","invite_modal_unshare_button",e.user,e.log_extras),e.show_unshare_folder_modal()}}(this)),this.$root.on("click","input.simple-sharing-remove-link",function(e){return function(t){return t.preventDefault(),e._disable_token_for_sf(function(){return Ot.pop()})}}(this)),this.$root.on("click","a.remove-link",function(e){return function(t){var n;return t.preventDefault(),n=function(){var t;return t=Dt.get_containing_modal(e.$root),t&&t instanceof ne?t.fetch():void 0},e._disable_token_for_sf(n)}}(this)),this.$root.on("click","input.sf-action-get-link",function(e){return function(t){return t.preventDefault(),e.show_access_request_link_modal()}}(this)),this.$root.on("click","input.sf-action-done",function(t){return function(n){return n.preventDefault(),rt.SharedFolderActivityLogger.log("web","invite_modal_done_button",t.user,t.log_extras),Ot.trigger(e.MODAL_DONE_VIEWING_EVENT),Ot.pop()}}(this)),this.$root.on("click","input#change-sf-perm-checkbox",function(e){return function(t){var n;return n=Se(t.currentTarget),e.update_sf_perms(n.prop("checked"))}}(this)),this.$root.on("click","input#change-tf-access-checkbox",function(e){return function(t){var n;return n=Se(t.currentTarget),e.update_tf_access(!n.prop("checked"))}}(this))},e.prototype._disable_token_for_sf=function(e){return b.WebRequest({url:o({path:"/sm/disable_token_at_path"+_t.normalize(this.path)}),subject_user:this.user.id,type:"POST",success:function(t){return function(){return Se(document).trigger($e.UPDATE),k.success(zt("Link removed")),rt.SimpleSharingLogger.log(t.user.id,25),"function"==typeof e?e():void 0}}(this),error:function(){return function(){return k.error(zt("An error occurred when removing link"))}}(this)})},e.prototype.create_m2_inband_modal=function(e,t){return e.preventDefault(),Ot.pop(),t?rt.SimpleSharingLogger.log(this.user.id,32):rt.SimpleSharingLogger.log(this.user.id,30),ti.createAndShowM2InbandModal(this.user,this.path)},e.prototype.extract_invitee_data_and_call=function(e,t){var n,i,r;return e.preventDefault(),n=Se(e.currentTarget),r=n.data("email-or-fbname"),i=n.data("invite-id"),t(r,this.ns_id,i)},e.prototype.extract_user_data_and_call=function(e,t){var n,i,r,o;return e.preventDefault(),n=Se(e.currentTarget),r=n.data("display-name"),i=n.data("email"),o=n.data("user-id"),t(r,i,o)},e.prototype.maybe_load_more=function(){var e,t,n;return(t=this.$root.closest("body").length)?null==this.num_total||this.start>=this.num_total?void Se("#more-members-spinner").hide():(Se("#more-members-spinner").show(),n={},n[O.UID_PARAM_NAME]=this.user.id,n.start=this.start,n.max_results=this.max_results,e=o({path:"/share_options"+this.path}).toString(),this.$root.removeClass("ajax-loading"),new p(this.$root,e,{data:n,success:function(e){return function(t){var n,i;return null!=(null!=(i=t.data)?i.options:void 0)&&(n=t.data.options,null!=e.members&&null!=n.folder_members&&Array.prototype.push.apply(e.members,n.folder_members),null!=e.invitees&&null!=n.folder_invitees&&Array.prototype.push.apply(e.invitees,n.folder_invitees),null!=e.new_style_groups&&null!=n.new_style_groups)?Array.prototype.push.apply(e.new_style_groups,n.new_style_groups):void 0}}(this),error:function(){return function(){return k.error("Unable to load all members of this folder.")}}(this)}),this.start=this.start+this.max_results):void 0},e.prototype.submit_invitations=function(){var e,t,n,i,r,o;return this.invite_form_controller.tokenize(),n=this.invite_form_controller.extract_invitees(),r=this.invite_form_controller.get_custom_message(),e=this.invite_form_controller.get_access_type(),i=w.clone(this.log_extras),i.access_type=e,rt.SharedFolderActivityLogger.log("web","invite_modal_send_invites_button",this.user,i),o=function(e){return function(t){var n;return n=Dt.get_containing_modal(e.$root),n&&n instanceof ne?n.fetch():Ot.pop(),k.success(t.responseText),document.fire(s.SF_INVITE,{target_ns_id:e.ns_id,user_id:e.user.id})}}(this),t=function(e){return function(t){return Nn.show_validation_error(t,e.$root.find(".tokenized_autocompleter_container"))}}(this),this.sharing_api.invite_more_to_folder(this.ns_id,n,r,e,o,t)},e.prototype.reinvite_user=function(e,t,n){return this.sharing_api.reinvite_user(t,n,function(t){return function(n){var i,r,o,s,a,_;return s=JSON.parse(n.responseText),a=s.status,"OK"===a?(_=zt("%(email_or_fbname)s was reinvited successfully"),_=_.format({email_or_fbname:e}),k.success(_)):(o=s.reason,i=zt("ACCEPTED"===o?"That invitation has already been accepted.":"DECLINED"===o?"That invitation has already been declined.":"You no longer have permission to perform this action."),k.error(i),s.reload&&(r=Dt.get_containing_modal(t.$root),r&&r instanceof ne)?r.fetch():void 0)}}(this))},e.prototype.update_sf_perms=function(e){var t,n,i;return this.$root.find("#change-sf-perm-saving").show(),t=e?1:0,i=function(t){return function(){return k.success(zt(e?"Editors can now manage membership of this folder.":"Editors can no longer manage membership of this folder.")),t.$root.find("#change-sf-perm-saving").hide()}}(this),n=function(e){return function(t){return k.error(0===t.responseText.indexOf("err:")?t.responseText.substr(4):zt("Error updating your preference! Please try again.")),e.$root.find("#change-sf-perm-saving").hide()}}(this),this.sharing_api.update_sf_permissions(this.ns_id,t,i,n)},e.prototype.update_tf_access=function(e){var t,n;return n=function(){return function(){return k.success(e?zt("Team members can now change folder contents."):zt("Team members can no longer change folder contents."))}}(this),t=function(){return function(){return k.error(zt("Error updating your preference! Please try again."))}}(this),this.sharing_api.update_team_folder_access_type(this.ns_id,e,n,t)},e.prototype.show_kick_user_modal=function(e,t,n){return Ot.push(new gn(this.user,{element_id:"kick-confirm-modal",ns_id:this.ns_id,user_name:e,folder_path:this.path,user_id:n}))},e.prototype.show_kick_group_modal=function(e,t){return Ot.push(new vn(this.user,{element_id:"kick-group-confirm-modal",ns_id:this.ns_id,group_name:e,folder_path:this.path,group_id:t}))},e.prototype.show_transfer_user_modal=function(e,t,n){return Ot.push(new kn(this.user,{element_id:"transfer-confirm-modal",user_id:n,user_name:e,ns_id:this.ns_id,folder_path:this.path}))},e.prototype.show_uninvite_modal=function(e,t,n){return Ot.push(new En(this.user,{element_id:"uninvite-confirm-modal",email_or_fbname:e,ns_id:t,invite_id:n,folder_path:this.path}))},e.prototype.show_unshare_folder_modal=function(){return Ot.push(new xn(this.user,{element_id:"unshare-confirm-modal",team_shared_folder:this.team_shared_folder,nested_shared_folder:this.nested_shared_folder,ns_id:this.ns_id,folder_path:this.path}))},e.prototype.show_access_request_link_modal=function(){return Ot.push(new Qn(this.user.id,this.path,void 0,!0))},e.prototype.show_owner_leave_folder_warning=function(){return k.error(zt("You can't leave this folder because you're the owner. You must transfer ownership to another member before you can leave."))},e.prototype.show_leave_folder_modal=function(){return Ot.push(new wn(this.user,{element_id:"leave-confirm-modal",team_shared_folder:this.team_shared_folder,ns_id:this.ns_id,folder_path:this.path}))},e.prototype.toggle_get_link_button_visibility=function(){var e,t,n,i,r,o;return t=0===(null!=(n=this.invite_form_controller)?n.get_token_count():void 0),e=""===(null!=(i=this.$invite_input)?i.val():void 0),t&&e?null!=(r=this.get_link_button)?r.show():void 0:null!=(o=this.get_link_button)?o.hide():void 0},e.prototype.toggle_to_invite_mode=function(){var e;return this.$allow_members_table.show(),this.$folder_management_buttons.hide(),this.$invite_form.removeClass("collapsed"),null!=(e=this.sf_access_type)&&e.show(),this.toggle_get_link_button_visibility(),!this.has_show_invite_form&&this.get_link_button.length>0&&rt.SimpleSharingLogger.log(this.user.id,31),this.has_show_invite_form=!0,Se(document).trigger("collab:m2:prompt:hide")},e.prototype.toggle_from_invite_mode=function(){var e,t;return this.$allow_members_table.hide(),this.$folder_management_buttons.show(),this.$invite_form.addClass("collapsed"),null!=(e=this.sf_access_type)&&e.hide(),null!=(t=this.invite_form_controller)&&t.reset_autocompleter(),this.toggle_get_link_button_visibility()},e.prototype.show_m2_folder_settings=function(){var e,t;return t=this.path,e=function(){var e;return e=new un(Ir.active_user,t),e.show()},Ot.pop(),xe.showInstance(ce.createElement(xe,{user:this.user,fq_path:this.path,is_shared_folder:!0,ns_id:this.ns_id,initial_allows_editor_manage_membership:this.allows_editor_manage_membership,done_callback:e}))},e.prototype.show_folder_settings=function(e){return rt.SharedFolderActivityLogger.log("web","invite_modal_change_settings",this.user,this.log_extras),e.preventDefault(),Ot.register(cn.SAVED_PERMISSIONS,function(e){return function(t,n){return null!=n?e.set_team_only(n):void 0}}(this)),Ot.push(new cn(this.user,this.path,this.ns_id))},e.prototype.show_golden_gate_warning=function(e){return e.preventDefault(),Ot.push(new pn(this.user,this.ns_id,{element_id:"golden-gate-warning-modal",ns_id:this.ns_id}))},e.prototype.show_email_verification=function(){return Ot.pop(),At.get_for_user(this.user).show()},e.prototype.set_team_only=function(e){var t;if(null!=this.invite_form_controller)return this.invite_form_controller.set_team_only(e),t=this.$invite_form.add(this.$root.find(".external-invite-message,.member-info .folder-settings")),e?t.addClass("team-only"):t.removeClass("team-only")},e}(),wn=ft.LeaveFolderModal=function(e){function t(){return this.before_show=Tn(this.before_show,this),this.on_show=Tn(this.on_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){var t;return e.preventDefault(),t=this.$modal_window.find("#keep_files").prop("checked"),this.sharing_api.leave_folder(this.ns_id,t,function(e){return function(){var n;return n=zt("You removed yourself from '%(msg)s'.").format({msg:_.em_snippet(_t.filename(e.path),25)}),k.success(n),document.fire(s.SF_LEAVE,{target_ns_id:e.ns_id,folder_deleted:!t,user_id:e.user.id}),Ot.clear()}}(this))},t.prototype.on_show=function(){return t.__super__.on_show.apply(this,arguments),this.team_shared_folder?(this.$modal_window.find(".keep_files_option").hide(),this.$modal_window.find(".keep_files_option").find("input").prop("checked",!1)):(this.$modal_window.find(".keep_files_option").show(),this.$modal_window.find(".keep_files_option").find("input").prop("checked",!0))},t.prototype.before_show=function(){var e;return e=zt("Leave the shared folder '%(folder_name)s'"),e=e.format({folder_name:_.em_snippet(_t.filename(this.path),14)}),this.format({".db-modal-title-text":e})},t}(yn),xn=ft.UnshareFolderModal=function(e){function t(){return this.before_show=Tn(this.before_show,this),this.on_show=Tn(this.on_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){var t;return e.preventDefault(),t=this.$modal_window.find("#keep_files").prop("checked"),this.sharing_api.unshare_folder(this.ns_id,t,function(e){return function(){var t;return t=zt("Unshared folder '%(folder_name)s'"),t=t.format({folder_name:_.em_snippet(_t.filename(e.path),25)}),k.success(t),document.fire(s.SF_UNSHARE,{target_ns_id:e.ns_id,user_id:e.user.id}),Ot.clear()}}(this))},t.prototype.on_show=function(){return t.__super__.on_show.apply(this,arguments),this.$modal_window.find(".tsf_unshare_desc").hide(),this.$modal_window.find(".nestedsf_unshare_desc").hide(),this.$modal_window.find(".regular_unshare_desc").hide(),this.team_shared_folder?this.$modal_window.find(".tsf_unshare_desc").show():this.nested_shared_folder?this.$modal_window.find(".nestedsf_unshare_desc").show():this.$modal_window.find(".regular_unshare_desc").show()},t.prototype.before_show=function(){var e;return e=zt(this.nested_shared_folder?"Reset membership for '%(folder_name)s'":"Unshare '%(folder_name)s'"),e=e.format({folder_name:_.em_snippet(_t.filename(this.path),21)}),this.format({".db-modal-title-text":e})},t}(yn),En=ft.UninviteModal=function(e){function t(e,n){this.before_show=Tn(this.before_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.email_or_fbname=n.email_or_fbname,this.ns_id=n.ns_id,this.invite_id=n.invite_id,t.__super__.constructor.call(this,e,n)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.sharing_api.cancel_invite(this.ns_id,this.invite_id,function(e){return function(t){var n,i,r,o,s;return r=JSON.parse(t.responseText),o=r.status,"OK"===o?(s=zt("%(email_or_fbname)s has been uninvited.").format({email_or_fbname:e.email_or_fbname}),k.success(s)):(i=r.reason,"ACCEPTED"===i?n=zt("That invitation has already been accepted."):"DECLINED"===i&&(n=zt("That invitation has already been declined.")),k.error(n)),Ot.pop()}}(this))},t.prototype.before_show=function(){var e;return e=zt("Uninvite %(email_or_fbname)s?").format({email_or_fbname:_.em_snippet(this.email_or_fbname,20)}),this.format({".uninvite-confirm-nickname":this.email_or_fbname,".uninvite-confirm-folder-name":_t.filename(this.path),".db-modal-title-text":e})},t}(yn),gn=ft.KickUserModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=Tn(this.before_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.user_id=this.options.user_id,this.user_name=this.options.user_name,t.__super__.constructor.call(this,this.user,this.options)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),t=this.$modal_window.find("#keep-files-check").prop("checked"),this.sharing_api.kick(this.ns_id,this.user_id,t,function(){return function(){return k.success(zt("User removed successfully.")),jn.reload_folder_info_if_two_account(),Ot.pop()}}(this)),n={ns_id:this.ns_id,kick_user_id:this.user_id,keep_files:t},rt.SharedFolderActivityLogger.log("web","invite_modal_kick_collaborator",this.user,n)},t.prototype.before_show=function(){var e;return e=zt("Remove %(person_name)s from this folder?"),e=e.format({person_name:this.user_name}),this.format({".kick-confirm-nickname":this.user_name,".db-modal-title-text":e})},t}(yn),vn=ft.KickGroupModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=Tn(this.before_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.group_id=this.options.group_id,this.group_name=this.options.group_name,t.__super__.constructor.call(this,this.user,this.options)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),Ae.remove_namespace_from_group({group_id:this.group_id,ns_id:this.ns_id},function(){return k.success(zt("Group removed successfully.")),jn.reload_folder_info_if_two_account(),Ot.pop()})},t.prototype.before_show=function(){var e;return e=zt("Remove %(group_name)s from this folder?"),e=e.format({group_name:this.group_name}),this.format({".kick-confirm-nickname":this.group_name,".db-modal-title-text":e})},t}(yn),bn=ft.MakeOwnerModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=Tn(this.before_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.member_uid=this.options.member_uid,this.member_name=this.options.member_name,this.ns_id=this.options.ns_id,this.access_type=this.options.access_type,t.__super__.constructor.call(this,this.user,this.options)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.sharing_api.update_member_access_type(this.ns_id,this.member_uid,this.access_type,function(e){return function(){return k.success(zt("%(name)s now is the owner.").format({name:e.member_name})),Ot.pop()}}(this))},t.prototype.before_show=function(){
var e;return e=zt("Make %(name)s the owner of this folder?"),e=e.format({name:_.em_snippet(this.member_name,14)}),this.format({".make-owner-confirm-nickname":this.member_name,".db-modal-title-text":e})},t}(yn),kn=ft.TransferOwnershipModal=function(e){function t(e,n){this.user=e,this.options=n,this.before_show=Tn(this.before_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.user_id=this.options.user_id,this.user_name=this.options.user_name,t.__super__.constructor.call(this,this.user,this.options)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.sharing_api.transfer_ownership(this.ns_id,this.user_id,function(){return function(){return k.success(zt("Ownership changed successfully")),Ot.pop()}}(this))},t.prototype.before_show=function(){var e;return e=zt("Make %(person_name)s the owner of this folder?"),e=e.format({person_name:_.em_snippet(this.user_name,14)}),this.format({".change_sf_owner-confirm-nickname":this.user_name,".db-modal-title-text":e})},t}(yn),cn=ft.ExistingSharedFolderPermissionsModal=function(e){function t(e,n,i,r){var o,s;this.user=e,this.path=n,this.ns_id=i,this.on_hide=r,o={ns_id:this.ns_id,folder_name:this.path},o[O.UID_PARAM_NAME]=this.user.id,s=zt("'%(folder_name)s' settings"),s=s.format({folder_name:_.em_snippet(_t.filename(this.path),13)}),t.__super__.constructor.call(this,{element_id:"folder-permissions-modal",title:s,endpoint_url:"/share_ajax/folder_settings",parameters:o})}return Sn(t,e),t.SAVED_PERMISSIONS="existing_sf_permissions:saved",t}(ne),pn=pn=function(e){function t(e,n){var i,r;this.user=e,this.ns_id=n,i={ns_id:this.ns_id},i[O.UID_PARAM_NAME]=this.user.id,r=zt("Confirm converting to Golden Gate folder"),t.__super__.constructor.call(this,{element_id:"golden-gate-warning-modal",title:r,endpoint_url:"/share_ajax/golden_gate_warning",parameters:i})}return Sn(t,e),t}(ne),mn=ft.GoldenGateWarningModalContents=function(){function e(e,t,n){this.$form=e,this.ns_id=n,this._submit=Tn(this._submit,this),this.user=G.get_viewer().get_user_by_id(t),this._listen()}return e.prototype._listen=function(){return this.$form.find(".confirm-button").click(this._submit),this.$form.find(".cancel-button").click(this._cancel)},e.prototype._submit=function(){return Ot.push(new hn(this.user,this.ns_id,{element_id:"golden-gate-warning-modal",ns_id:this.ns_id}))},e.prototype._cancel=function(){return Ot.pop()},e}(),hn=hn=function(e){function t(e,n){var i,r;this.user=e,this.ns_id=n,i={ns_id:this.ns_id},i[O.UID_PARAM_NAME]=this.user.id,r=zt("Confirm converting to Golden Gate folder"),t.__super__.constructor.call(this,{element_id:"golden-gate-warning-modal",title:r,endpoint_url:"/share_ajax/golden_gate_confirm",parameters:i})}return Sn(t,e),t}(ne),fn=ft.GoldenGateConfirmModalContents=function(e){function t(e,t,n){this.$form=e,this.ns_id=n,this.user=G.get_viewer().get_user_by_id(t),new Ne(this.$form,null,{should_submit_once:!0}),this.$form.on(Ne.SUCCESS_EVENT,function(e){return function(){return b.WebRequest({url:"/share_ajax/enable_golden_gate_step_two",subject_user:e.user,data:{ns_id:e.ns_id},success:function(){return k.success("Golden Gate enabled for this folder"),location.reload()}})}}(this)),this._listen()}return Sn(t,e),t.prototype._listen=function(){return this.$form.find(".cancel-button").click(this._cancel)},t.prototype._cancel=function(){return Ot.pop()},t}(ne),dn=ft.ExistingSharedFolderPermissionsContent=function(){function e(e,t,n){this.$form=e,this.ns_id=n,this._submit=Tn(this._submit,this),this.user=G.get_viewer().get_user_by_id(t),this.sharing_api=new Et(this.user),this.sharing_api.loading_elem=this.$form,this._listen()}return e.prototype._listen=function(){return this.$form.find(".confirm-button").click(this._submit),this.$form.find(".cancel-button").click(this._cancel)},e.prototype._cancel=function(){return Ot.pop()},e.prototype._submit=function(e){var t,n,i,r,o,s;return e.preventDefault(),n=this.$form.find("input[name=audience]:checked").val(),i=this.$form.find("input[name=inviter]:checked").val(),s=this.$form.find("input[name=shared_link_policy]:checked").val(),t=null!=(o=this.$form.find("input[name=activity_feed_enabled]:checked"))?o.val():void 0,this.sharing_api.update_sf_team_permissions(this.ns_id,n,i,s,t,function(){return function(e){var t,n;return t=JSON.parse(e.responseText),n=t.team_only_invite,k.success(t.message),Ot.trigger(cn.SAVED_PERMISSIONS,n),Ot.pop()}}(this)),r={ns_id:this.ns_id,audience:n,inviter:i},rt.SharedFolderActivityLogger.log("web","settings_modal_save",this.user,r)},e}();var An,Dn,On,Nn,In,$n,Ln,Rn,Mn,Fn,Pn,Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty,Tn=function(e,t){return function(){return e.apply(t,arguments)}};An=ft.BaseShareAFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.options),this.sharing_api=new Et(this.user)}return Sn(t,e),t.prototype.base_title=null,t.prototype.personal_title=null,t.prototype.work_title=null,t.prototype.before_show=function(){var e;return this.sharing_api.loading_elem=this.$modal_window,e=this.base_title,G.get_viewer().is_paired&&(e="personal"===this.user.role?this.personal_title:this.work_title.format({team_name:G.get_viewer().team_name})),this.format({".db-modal-title-text":e})},t}(Dt),Rn=ft.ShareAFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.user,this.options),this.base_title=zt("Share a folder"),this.personal_title=zt("Share a folder from your personal Dropbox"),this.work_title=zt("Share a folder from your %(team_name)s Dropbox")}return Sn(t,e),t.prototype.on_show=function(){return this.$modal_window.find("input#create-new-sf").prop("checked",!0),this.$modal_window.find("a.back").on("click",function(e){return function(t){return t.preventDefault(),an.start_wizard_without_user(),e.hide()}}(this)),this.$modal_window.find("#new-or-existing-sf li").on("click",function(e){return function(t){return Se(t.currentTarget).find('input[name="sf_type"]').prop("checked",!0),e.$modal_window.find("input#create-new-sf").is(":checked")?rt.SharedFolderActivityLogger.log("web","new_or_existing_modal_new_folder",e.user):rt.SharedFolderActivityLogger.log("web","new_or_existing_modal_existing_folder",e.user)}}(this))},t.prototype.on_confirm_button_click=function(e){var t,n,i,r,o,s;return e.preventDefault(),(n=this.$modal_window.find("input#create-new-sf").is(":checked"))?(r=null,"work"===this.user.role&&(o="shared-folder-type-wizard-modal",s=Dt.get_template(o),s.length&&(r=new Pn(this.user,{element_id:o}))),null===r&&(r=new Fn(this.user,{element_id:"share-new-folder-wizard-modal"})),this.hide(),i={selection:"new_folder"},rt.SharedFolderActivityLogger.log("web","new_or_existing_modal_next_button",this.user,i),r.show()):(t=this.$modal_window.find(".ajax-loading-indicator").show(),Se.ajax({url:"/share_ajax/account_has_existing_folders",type:"post",subject_user:this.user,success:function(e){return function(t){var n;return t=JSON.parse(t),t===!0?(r=new Mn(e.user,{element_id:"share-existing-folder-wizard-modal"}),i.has_existing_folder=!0):(n=zt("You don't have any existing folders. Please create and share a new folder."),r=new Fn(e.user,{element_id:"share-new-folder-wizard-modal",error_msg:n}),i.has_existing_folder=!1),e.hide(),r.show()}}(this),error:function(){return function(){return k.error()}}(this),complete:function(){return function(){return t.hide()}}(this)},i={selection:"existing_folder"},rt.SharedFolderActivityLogger.log("web","new_or_existing_modal_next_button",this.user,i)))},t}(An),Pn=ft.SharedFolderTypeWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.user,this.options),this.work_title=zt("Share a folder from your %(team_name)s Dropbox")}return Sn(t,e),t.prototype.on_show=function(){return this.$modal_window.find("input#team-folder-option").prop("checked",!0),this.$modal_window.find("a.back").on("click",function(e){return function(t){return t.preventDefault(),an.start_wizard_for_user(e.user),e.hide()}}(this)),this.$modal_window.find("#shared-folder-type li").on("click",function(e){return function(t){return Se(t.currentTarget).find('input[name="shared_folder_type"]').prop("checked",!0),e.$modal_window.find("input#team-folder-option").is(":checked")?rt.SharedFolderActivityLogger.log("web","shared_folder_type_team_folder",e.user):rt.SharedFolderActivityLogger.log("web","shared_folder_type_shared_folder",e.user)}}(this))},t.prototype.on_confirm_button_click=function(e){var t,n,i,r;return e.preventDefault(),t=function(e){return function(t,n){var i;return t.preventDefault(),n.hide(),i=new e.constructor(e.user,e.options),i.show()}}(this),n=this.$modal_window.find("input#team-folder-option").is(":checked"),n?(i=new Oe({element_id:"new-team-folder-modal",open_created_folder:!0,back_fn:t}),r="team_folder"):(i=new Fn(this.user,{element_id:"share-new-folder-wizard-modal",back_fn:t}),r="shared_folder"),rt.SharedFolderActivityLogger.log("web","shared_folder_type_next_button",this.user,{selection:r}),this.hide(),i.show()},t}(An),Nn=ft.InlineModalValidationError=function(){function e(){}return e.show_validation_error=function(e,t){var n,i,r,o,s,a;if(0===e.responseText.indexOf("err:{")){a=e.responseText.substr(4),s=JSON.parse(a);for(i in s)if(n=s[i],"message_text"in n)return o=t.find("span.error-message"),0===o.length&&(o=Se("<span/>").addClass("error-message"),t.prepend(o)),void o.text(n.message_text);return t.find("span.error-message").remove(),k.error()}return t.find("span.error-message").remove(),0===e.responseText.indexOf("err:")?(r=e.responseText.substr(4),k.error(r)):k.error()},e}(),Fn=ft.ShareNewFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,this.options.focus="#new-shared-folder-wizard input[type=text]",t.__super__.constructor.call(this,this.user,this.options),this.base_title=zt("Create a new shared folder"),this.personal_title=zt("Create a shared folder in your personal Dropbox"),this.work_title=zt("Create a shared folder in your %(team_name)s Dropbox")}return Sn(t,e),t.prototype.on_show=function(){var e,t,n,i;for(i=this.$modal_window.find(".suggestion-input"),t=0,n=i.length;n>t;t++)e=i[t],gi.register($(e));return this.$modal_window.find("#validate-folder-name").submit(function(e){return function(t){return t.preventDefault(),e.on_confirm_button_click(t)}}(this)),this.options.error_msg&&k.error(this.options.error_msg),this.$modal_window.find("a.back").on("click",function(e){return function(t){return e.options.back_fn?e.options.back_fn(t,e):(t.preventDefault(),e.hide(),an.start_wizard_for_user(e.user))}}(this))},t.prototype.on_confirm_button_click=function(e){var t,n,i,r;return e.preventDefault(),n=this.$modal_window.find("#new-shared-folder-name-input").val(),i={folder_name:n},rt.SharedFolderActivityLogger.log("web","name_new_folder_modal_next_button",this.user,i),r=function(e){return function(){var t;return t=new In(e.user,{folder_name:n,element_id:"invite-to-new-sf-wizard-modal-"+e.user.id}),e.hide(),t.new_folder=!0,t.show(),rt.SharedFolderActivityLogger.log("web","name_new_folder_modal_success",e.user,i)}}(this),t=function(e){return function(t){var n;return n=Ne.extract_errors(t.responseText),rt.SharedFolderActivityLogger.log("web","name_new_folder_modal_fail",e.user,i),n!==!1?"string"==typeof n?k.error(n):(Se("#new-shared-folder-name-input .error-message").remove(),Ne.fill_errors(Se("#validate-folder-name"),n)):void 0}}(this),this.sharing_api.validate_new_sf_path(n,r,t)},t}(An),Mn=ft.ShareExistingFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,this._hide=Tn(this._hide,this),this.on_show=Tn(this.on_show,this),t.__super__.constructor.call(this,this.user,this.options),this.base_title=zt("Choose folder to share"),this.personal_title=zt("Choose a folder from your personal Dropbox"),this.work_title=zt("Choose a folder from your %(team_name)s Dropbox")}return Sn(t,e),t.prototype.on_show=function(){return this.treeview_id="copy-move-treeview",this.treeview_parent_id=Se("#"+this.treeview_id).parent().attr("id"),yi.schedule_reset(),yi.move(this.treeview_id,"share-existing-treeview",{onSuccess:function(e){return function(){var t;return Se(document).on("db:treeview_selected",function(t,n){return e.folder_name=n}),t=Se(".first-treeview-link"),Zt.ie?void 0:t.click()}}(this),user:this.user}),this.$modal_window.find("a.back").on("click",function(e){return function(t){return t.preventDefault(),e.hide(),an.start_wizard_for_user(e.user)}}(this))},t.prototype._hide=function(){return yi.move(this.treeview_id,this.treeview_parent_id,{user:this.user}),t.__super__._hide.apply(this,arguments)},t.prototype.on_hide=function(){return Se(document).off("db:treeview_selected")},t.prototype.on_confirm_button_click=function(e){var t,n,i;return n={folder_name:this.folder_name},e.preventDefault(),this.folder_name&&this.$modal_window.find("#copy-move-treeview .highlight .s_web_folder_user").length?(this.hide(),rt.SharedFolderActivityLogger.log("web","choose_folder_modal_shared_next",this.user,n),an.show_shared_folder_options_modal(this.folder_name,this.user)):(i=function(e){return function(){var t;return t=new In(e.user,{folder_name:e.folder_name,element_id:"invite-to-new-sf-wizard-modal-"+e.user.id}),e.hide(),rt.SharedFolderActivityLogger.log("web","choose_folder_modal_not_shared_next",e.user,n),t.new_folder=!1,t.show()}}(this),t=function(e){return function(t){return Nn.show_validation_error(t,e.$modal_window.find("#choose-existing-folder"))}}(this),this.sharing_api.validate_existing_sf_path(this.folder_name,i,t))},t}(An),On=ft.CreateOrShareNewFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this._extract_invitees=Tn(this._extract_invitees,this),this._toggle_send_button_state=Tn(this._toggle_send_button_state,this),t.__super__.constructor.call(this,this.options),this.destination_dir=this.options.destination_dir,this.sharing_api=new Et(this.user),this.state="Create"}return Sn(t,e),t.prototype.on_show=function(){var e,t,n,i,r;return this.$send_button=this.$modal_window.find(".confirm-button"),this.$cancel_button=this.$modal_window.find(".cancel-button"),n="create-and-share-new-folder-invite-wizard-"+this.user.id,this.file_name_input=this.$modal_window.find("#create-and-share-new-folder-name-input"),this.file_name_input.focus(),t=n+"-new-collab-input",this.collab_input=this.$modal_window.find("#"+t),e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:!1,user_id:this.user.id,max_textbox_height:30},this.autocompleter=new Autocompleter.ContactsTokenizer(this.user,t,n+"-new-whobulk",n+"-hidden-input",e),null!=(i=this.file_name_input)&&i.keyup(this._toggle_send_button_state),null!=(r=this.collab_input)&&r.keyup(this._toggle_send_button_state),this.collab_input[0]&&(this.collab_input[0].on("token:remove",this._toggle_send_button_state),this.collab_input[0].on("token:add",this._toggle_send_button_state)),this._toggle_send_button_state()},t.prototype._toggle_send_button_state=function(){var e,t,n,i;return i=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),i=i&&""===this.collab_input.val(),e=this.file_name_input.val(),n=""===e,this.$send_button.prop("disabled",n),i?(this.$send_button.text(zt("Create folder")),this.state="Create"):(this.$send_button.text(zt("Share folder")),this.state="Share")},t.prototype._extract_invitees=function(){var e,t,n,i,r,o,s,a;for(n=this.$modal_window.find(".tokenized_autocompleter_container"),o={},a=["emails","fb_ids","group_ids","new_style_group_ids"],i=0,s=a.length;s>i;i++)t=a[i],r=n.find("input[name="+t+"]"),o[t]=function(){var t,n,i;for(i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(Se(e).val());return i}();return o},t.prototype.on_confirm_button_click=function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h;return e.preventDefault(),l=this.file_name_input.val(),r=zt("We can’t create folder '%(folder_name)s'"),r=r.format({folder_name:l}),i=function(){return k.error(r)},"Create"===this.state?(h="/cmd/new"+Zt.urlquote(this.destination_dir),u={to_path:l},u[O.UID_PARAM_NAME]=this.user.id,c=function(){var e;return e=zt("Created new folder '%(folder_name)s'"),e=e.format({folder_name:l}),k.success(e)},new b.WebRequest({url:h,data:u,success:c,error:i})):(this.autocompleter.tokenize_emails_input(!0),s=this._extract_invitees(),c=function(){var e;return e=zt("Shared new folder '%(folder_name)s'"),e=e.format({folder_name:l}),k.success(e)},_="",n="all",a="editors",d="0",t=null,o=this.destination_dir+"/"+l,this.sharing_api.share_path(o,s,_,n,a,d,t,!1,c,i)),this.hide()},t}(Dt),Dn=ft.CreateLinkOrInviteToFolderWizardModal=function(e){function t(e,n){this.user=e,this.options=n,t.__super__.constructor.call(this,this.options),this.sharing_api=new Et(this.user)}return Sn(t,e),t.prototype.before_show=function(){var e;return this.sharing_api.loading_elem=this.$modal_window,e=zt("Share '%(folder_name)s' with others"),e=e.format({folder_name:_.em_snippet(_t.filename(this.options.path),16)}),this.format({".db-modal-title-text":e})},t.prototype.on_show=function(){var e,t,n;return e="edu_modal",n=null!=(t=this.options.target_item)?t:null,rt.ShmodelUILogger.log("view",e,n),this.$modal_window.find(".option-to-share-folder").on("click",function(t){return function(){var i;return t.options.existing_sf?(rt.ShmodelUILogger.log("sf_options",e,n),i=new un(Ir.active_user,t.options.path)):(rt.ShmodelUILogger.log("sf_invite",e,n),i=new In(t.user,{folder_name:t.options.path,element_id:"invite-to-new-sf-wizard-modal-"+t.user.id})),t.hide(),i.show()}}(this)),this.$modal_window.find(".option-to-share-link").on("click",function(t){return function(){return rt.ShmodelUILogger.log("token_share",e,n),Un.shmodel(t.options.path,"create_link_or_invite_to_folder_modal"),t.hide()}}(this)),this.$modal_window.find(".learn-more").on("click",function(){return function(t){return t.preventDefault(),rt.ShmodelUILogger.log("clicked_learn_more",e,n),window.open("/help/274","_blank")}}(this))},t}(Dt),In=ft.InviteToNewSharedFolderWizardModal=function(e){function t(e,n,i){this.user=e,this.options=n,this.insert_folder_settings=Tn(this.insert_folder_settings,this),this.share_folder=Tn(this.share_folder,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.show_settings_modal=Tn(this.show_settings_modal,this),this.show_m2_settings_modal=Tn(this.show_m2_settings_modal,this),this._toggle_get_link_button_visibility=Tn(this._toggle_get_link_button_visibility,this),this.options.focus=".new-collab-input",t.__super__.constructor.call(this,this.options),this.sharing_api=new Et(this.user),this.folder_name=this.options.folder_name,this.must_check_verified=null!=this.options.must_check_verified||!1,this.can_change_options=null!=this.options.can_change_options?this.options.can_change_options:!0,this.progress_ever_blocked_by_verify=!1,this.has_inviter_restriction=this.options.has_inviter_restriction,this.exp=new qn(i)}return Sn(t,e),t.BEFORE_SHOW_EVENT="db:invite_to_new_shared_folder_wizard_modal:before_show",t.prototype.before_show=function(){var e;return this.sharing_api.loading_elem=this.$modal_window,e=this.exp.modal_title(zt("Share '%(folder_name)s' with others")),e=e.format({folder_name:_.em_snippet(_t.filename(this.folder_name),16)}),this.format({".db-modal-title-text":e}),this.$modal_window.find(".change-new-folder-settings").toggle(this.can_change_options),this.exp.before_show_modal()},t.prototype.on_show=function(){var e,t,n,i,r,o;for(o=this.$modal_window.find(".suggestion-input"),n=0,i=o.length;i>n;n++)t=o[n],gi.register($(t));return e=this.$modal_window.find(".invite-more-form"),this.invite_form_controller?this.invite_form_controller.listen():(r="invite-wizard-"+this.user.id,this.invite_form_controller=new _n(this.user,e,[],[],[],r),this.insert_folder_settings(this.invite_form_controller.team_only?"team":"")),this.get_link_button=this.$modal_window.find(".get-editable-link-invite"),this.get_link_button.length>0&&(N.showInstance(ce.createElement(N,{onDismiss:ti.dismissM2Prompt,shouldShow:Ir.simple_sharing_show_m2_prompt,targetedButton:this.get_link_button.get(0)})),rt.SimpleSharingLogger.log(this.user.id,27)),this.collab_input=this.$modal_window.find(".new-collab-input"),this.collab_input.focus(),this.collab_input.keyup(this._toggle_get_link_button_visibility),this.collab_input[0]&&(this.collab_input[0].on("token:remove",this._toggle_get_link_button_visibility),this.collab_input[0].on("token:add",this._toggle_get_link_button_visibility)),this.$modal_window.find(".change-new-folder-settings").on("click",function(e){return function(t){return t.preventDefault(),e.show_settings_modal()}}(this)),this.$modal_window.find(".m2-settings-link").on("click",function(e){return function(t){return t.preventDefault(),e.show_m2_settings_modal()}}(this)),this.$modal_window.find(".get-editable-link-invite").on("click",function(e){return function(t){var n,i,r,o,s;return t.preventDefault(),Se(document).trigger("collab:m2:prompt:dismiss"),o=e.$modal_window.find(".m2-settings-link"),o.length>0&&(e.inviter_restriction=e.has_inviter_restriction?"me":"all"),rt.SimpleSharingLogger.log(e.user.id,28),n=e.$modal_window.find(".get-link-invite-loading"),null!=n&&n.show(),s=function(t){var i,r,o,s,a,_;return null!=n&&n.hide(),s=Ve.parse_response(t),_=s[0],o=s[1],_?ti.createAndShowM2InbandModal(e.user,e.folder_name):(a=Ve.parse_error(o),r=a[0],i=a[1],k.error(r?i:zt("Failed to create link.")))},r=function(){return null!=n&&n.hide(),k.error(zt("Failed to create link."))},i={path:e.folder_name,emails:[],fb_ids:[],new_style_group_ids:[],custom_message:"",access_type:2,is_simple_sharing:!0,folder_settings:1,shared_link_policy:e.shared_link_policy_restriction,audience:e.audience_restriction,inviter:e.inviter_restriction},(e.audience_restriction||e.inviter_restriction)&&(i.custom_folder_settings=1),b.FormWebRequest({subject_user:e.user.id,url:"/share_ajax/existing_no_recipient",data:i,success:s.bind(e),error:r.bind(e),skipErrorHandling:!0})}}(this)),this.log_extras={path:this.folder_name},rt.SharedFolderActivityLogger.log("web","share_folder_modal_displayed",this.user,this.log_extras)},t.prototype._toggle_get_link_button_visibility=function(){var e,t,n,i,r;return"1"===this.shared_link_policy_restriction?void(null!=(n=this.get_link_button)&&n.hide()):(t=0===this.invite_form_controller.get_token_count(),e=this.collab_input&&""===this.collab_input.val(),t&&e?null!=(i=this.get_link_button)?i.show():void 0:null!=(r=this.get_link_button)?r.hide():void 0)},t.prototype.show_m2_settings_modal=function(){var e,n;return e=this.folder_name,n=function(n){var i;return i=new t(Ir.active_user,{folder_name:e,element_id:"invite-to-new-share-file-wizard-modal-"+Ir.active_user.id,has_inviter_restriction:!n}),i.show()},Ot.pop(),xe.showInstance(ce.createElement(xe,{user:this.user,fq_path:this.folder_name,is_shared_folder:!1,initial_allows_editor_manage_membership:!this.has_inviter_restriction,done_callback:n}))},t.prototype.show_settings_modal=function(){var e,t;return t=zt("'%(folder_name)s' settings"),t=t.format({folder_name:_.em_snippet(_t.filename(this.folder_name),13)}),e={folder_name:this.folder_name},this.audience_restriction&&(e.audience=this.audience_restriction),this.inviter_restriction&&(e.inviter=this.inviter_restriction),this.shared_link_policy_restriction&&(e.shared_link_policy=this.shared_link_policy_restriction),e[O.UID_PARAM_NAME]=this.user.id,Ot.register($n.SAVED_PERMISSIONS,function(e){return function(t,n){return e.insert_folder_settings(n.audience,n.inviter,n.shared_link_policy),e.invite_form_controller.reset_options()}}(this)),Ot.push(new ne({element_id:"folder-permissions-modal",title:t,endpoint_url:"/share_ajax/default_folder_settings",parameters:e}))},t.prototype.on_confirm_button_click=function(e){var t,n,i,r,o;return e.preventDefault(),this.invite_form_controller.tokenize(),n=this.invite_form_controller.extract_invitees(),o=this.invite_form_controller.get_custom_message(),t=this.invite_form_controller.get_access_type(),i=this.$modal_window.find("input#allow_other_members_to_share"),i.length>0&&(this.inviter_restriction=i.is(":checked")?"all":"me"),r=this.$modal_window.find(".m2-settings-link"),r.length>0&&(this.inviter_restriction=this.has_inviter_restriction?"me":"all"),this.share_folder(n,o,t,!0,!1)},t.prototype.share_folder=function(e,t,n,i,r,o){var a,_,l,u,d;return null==i&&(i=!0),null==r&&(r=!1),null==o&&(o=!1),_=function(e){return function(t){return e.$modal_window.find(".confirm-button").prop("disabled",!1),Nn.show_validation_error(t,e.$modal_window.find(".tokenized_autocompleter_container"))}}(this),u=function(e){return function(t){var n,r;return e.$modal_window.find(".confirm-button").prop("disabled",!1),r=JSON.parse(t.responseText),k.success(r.success_msg),e.progress_ever_blocked_by_verify&&rt.SharedFolderActivityLogger.log("web","email_verify_sharing_modal_share_succeess",e.user,l),document.fire(s.SF_NEW,{sf_info:jn.decode_sort_key(r.sf_info)}),i&&e.hide(),o?(n=new un(e.user,_t.normalize(e.folder_name)),n.show()):void 0}}(this),this.must_check_verified&&!this.user.is_email_verified?(this.progress_ever_blocked_by_verify=!0,rt.SharedFolderActivityLogger.log("web","email_verify_sharing_modal_blocked_on_verify",this.user,l),this.$modal_window.find(".confirm-button").prop("disabled",!0),d=zt("Verification email sent to %(email)s").format({email:this.user.email}),a=At.get_for_user(this.user),a.send_email("share_folder",function(){return k.success(d)}),Se("#resend-email-verification-link").click(function(){return a.send_email("share_folder",function(){return k.success(d)})}),this.$modal_window.find(".email-verify-message").show(),a.ensure_polling(function(e){return function(){return rt.SharedFolderActivityLogger.log("web","email_verify_sharing_modal_unblocked",e.user,l),k.success(zt("Email verified. Try sharing your folder again.")),e.$modal_window.find(".confirm-button").prop("disabled",!1),e.$modal_window.find(".email-verify-message").hide()}}(this))):(this.$modal_window.find(".confirm-button").prop("disabled",!0),this.sharing_api.share_folder(this.new_folder,this.folder_name,e,t,this.audience_restriction,this.inviter_restriction,this.shared_link_policy_restriction,n,r,u,_),l={path:this.folder_name,access_type:n},rt.SharedFolderActivityLogger.log("web","invite_modal_share_folder_button",this.user,l))},t.prototype.insert_folder_settings=function(e,t,n){var i;return this.audience_restriction=e,this.inviter_restriction=t,this.shared_link_policy_restriction=n,i=this.$modal_window.find(".invite-more-form, .external-invite-message,.folder-settings"),Ir.inside_team_folder?(i.addClass("in-team-folder"),i.removeClass("team-only")):(i.removeClass("in-team-folder"),"team"===this.audience_restriction?i.addClass("team-only"):i.removeClass("team-only"),"work"===this.user.role&&this.invite_form_controller.set_team_only("team"===this.audience_restriction)),this._toggle_get_link_button_visibility()},t}(Dt),Ln=ft.NewSharedFolderPermissionsModal=function(e){function t(e,n,i,r){var o,s;this.user=e,this.path=n,this.saved_state=i,this.done_callback=r,o={folder_name:this.path,audience:this.saved_state.audience?this.saved_state.audience:void 0,inviter:this.saved_state.inviter?this.saved_state.inviter:void 0,shared_link_policy:this.saved_state.shared_link_policy?this.saved_state.shared_link_policy:void 0,is_file:!1},o[O.UID_PARAM_NAME]=this.user.id,s=zt("‘%(folder_name)s’ settings"),s=s.format({folder_name:_.em_snippet(_t.filename(this.path),13)}),Ot.register($n.SAVED_PERMISSIONS,function(e){return function(t,n){return e.done_callback.bind(null,n.audience,n.inviter,n.shared_link_policy)()}}(this)),t.__super__.constructor.call(this,{element_id:"folder-permissions-modal",title:s,endpoint_url:"/share_ajax/default_folder_settings",parameters:o})}return Sn(t,e),t}(ne),$n=ft.NewSharedFolderPermissionsContent=function(){function e(e){this.$form=e,this._submit=Tn(this._submit,this),this._listen()}return e.SAVED_PERMISSIONS="new_sf_permissions:saved",e.prototype._listen=function(){return this.$form.find(".confirm-button").click(this._submit),this.$form.find(".cancel-button").click(this._cancel)},e.prototype._cancel=function(){return Ot.pop()},e.prototype._submit=function(t){var n,i,r;return t.preventDefault(),n=this.$form.find("input[name=audience]:checked").val(),i=this.$form.find("input[name=inviter]:checked").val(),r=this.$form.find("input[name=shared_link_policy]:checked").val(),Ot.trigger(e.SAVED_PERMISSIONS,{audience:n,inviter:i,shared_link_policy:r}),Ot.pop()},e}();var qn;qn=ft.InviteToNewSharedFolderWizardModalExperiments=function(){function e(e){this.rules=null!=e?e:{}}return e.prototype.modal_title=function(e){var t;return t={1:zt("Invite people to view and edit the files in '%(folder_name)s'"),2:zt("Give people access to the files in '%(folder_name)s'"),3:zt("Select people to share your '%(folder_name)s' folder with")},t[this.rules.growth_web_sf_modal_headline]||e},e.prototype.before_show_modal=function(){return Se(document).trigger(In.BEFORE_SHOW_EVENT)},e}();var Un;Un=ft.SharingShmodel=function(){function e(){}return e.shmodel=function(e,t){return new Qn(Ir.active_user.id,e,t).show()},e}();var jn;jn=INLINE_JS.Sharing=ft.Sharing={init:function(e,t,n,i){return this.show_inbox=n,this.simple_sharing_acl_enabled=i,this._decode_sort_keys(e),this._state={sf_info:{current:e.current,past:e.past},cmp:{"#sf-current":this._modified_cmp,"#sf-past":this._modified_cmp},is_ascending:{"#sf-current":!1,"#sf-past":!1},inbox_counts:{},sf_loading:e.more,delay_reload_folder:!1},G.get_viewer().is_paired&&(this.role_picker=Q.get_controller(Se("#role-selector")),this.role_picker.on_state_change=this._render.bind(this),se.set_during_login_callback(function(e){return function(t,n){return e._reload_folder_info(function(){return n()},function(){return n(zt("Error displaying shared folders")),window.location.reload()})}}(this))),this._listen(),this._tmpl=lt.tmpl("sf_list_item_tmpl"),this._render(),e.more&&this._display_spinner(),e.more&&b.WebRequest({url:"/share_ajax/list_folders",dataType:"json",data:{start:e.next},success:function(e){return function(t){return e._load_and_render_sf_list(t)}}(this),error:function(e){return function(){return e._sf_list_error()}}(this)}),this._update_inbox_counts(t,!0),this._display_view(),Be.mark_time_to_view(),Be.mark_time_to_interactive(),Se(document).on(Et.REQUEST_SUCCEEDED_EVENT,function(e){return function(t,n){return"/share_ajax/cancel_invite"===n.request_url||"/share_ajax/invite_more"===n.request_url||"/share_ajax/kick_user"===n.request_url?e._reload_folder_info():void 0}}(this))},_load_and_render_sf_list:function(e){return this._decode_sort_keys(e),this._state.sf_loading&&(this._state.sf_info.current.push.apply(this._state.sf_info.current,e.current),this._state.sf_info.past.push.apply(this._state.sf_info.past,e.past),this._state.sf_loading=!1),this._hide_spinner(),this._render(),this._state.delay_reload_folder?(this._state.delay_reload_folder=!1,this._reload_folder_info()):void 0},_sf_list_error:function(){return this._hide_spinner(),k.error(zt("We weren’t able to load the list of shared folders. Please refresh the page to try again."))},is_share_page:function(){return null!=this._state},_decode_sort_keys:function(e){return[e.current,e.past].each(function(e){return function(t){return t.each(function(t){return e.decode_sort_key(t)})}}(this))},decode_sort_key:function(e){return wt(null!=e.encoded_sort_key&&null==e.sort_key,"expected encoded sort keys on each elm"),e.sort_key=Zt.decode_sort_key(e.encoded_sort_key),delete e.encoded_sort_key,e},reload_folder_info_if_two_account:function(){return this._showing_two_accounts()?this._reload_folder_info():void 0},_reload_folder_info:function(e,t){var n;if(this.is_share_page())return n=function(t){return function(n){var i;return i=JSON.parse(n.responseText),
t._decode_sort_keys(i),t._state.sf_info=i,t._render(),"function"==typeof e?e():void 0}}(this),this._state.sf_loading?this._state.delay_reload_folder=!0:(new xt).get_folder_info(n,t)},refresh_inbox_counts:function(e){return(new xt).get_inbox_counts(function(t){return function(n){return t._update_inbox_counts(n,e)}}(this))},_update_inbox_counts:function(e,t){var n,i,r,o,s,a;a=0;for(o in e)n=e[o],a+=n;return Se("#inbox-count").text(a),Se("#inbox-count").toggleClass("show",a>0),this.is_share_page()&&(i=function(e,t){var n;for(o in e)if(n=e[o],t[o]!==e[o])return!1;return!0},t||!this._state||!i(this._state.inbox_counts,e))?(this._state.inbox_counts=e,a?(r=new Element("a",{id:"new-invites-link",href:"#"}),r.__sert(ee.make("web","email_32",{class:"link-img"})),s=Bt("%(total_count)d new shared folder invitation","%(total_count)d new shared folder invitations",a),s+=" \n",s=s.format({total_count:a}),r.__sert(s),r.observe("click",function(e){return function(t){return Event.stop(t),e.show_invites()}}(this)),$("invites-box").show(),$("invites-box").__date(r)):$("invites-box").hide(),a>0&&this.show_inbox?(this.show_inbox=!1,this.show_invites()):void 0):void 0},register_accept:function(e){return Se(e).closest(".sf-invite-action").addClass("loading"),new p(Se(e),e.action,{data:ui.collect_form_vars(e),complete:function(t){return function(){return Se(e).closest(".sf-invite-action").removeClass("loading"),t.refresh_inbox_counts(),t._reload_folder_info()}}(this),success:function(t){return function(n,i,r){var o,s,a,_;return n=null!=(_=JSON.parse(r.responseText))?_.data:void 0,o=Se(e).closest(".sf-invite-action"),o.addClass("sf-accepted"),(null!=n?n.redirect:void 0)?t._state&&t._state.current_total_count>1?(s=o.find(".view-folder-button"),s.click(function(){return window.location.href=null!=n?n.redirect:void 0})):window.location.href=null!=n?n.redirect:void 0:(a=Se(e).closest(".invitation-row").attr("data-invite-id"),t._remove_invite_row(a))}}(this)}),!1},upgrade_to_accept:function(e){return new p(Se(e),e.action,{data:ui.collect_form_vars(e)}),!1},register_decline:function(e,t,n){var i,r;return i=Se(e).closest("form"),null!=(r=i.closest(".sf-invite-action"))&&r.addClass("loading"),i.length&&new p(i,i[0].action,{data:ui.collect_form_vars(i[0]),complete:function(e){return function(){var r;return null!=(r=i.closest(".sf-invite-action"))&&r.removeClass("loading"),e._remove_invite_row(t),e.refresh_inbox_counts(),e._reload_folder_info(),n?n():void 0}}(this)}),!1},_remove_invite_row:function(e){var t,n,i,r;return t=Se("#invites-container"),n=t.find('[data-invite-id="'+e+'"]'),n&&(r=n.parent("tbody"),n.remove(),0===r.children().length&&(t.find(".invitation-table-container").hide(),t.find(".message-bottom").removeClass("message-bottom"),t.find(".message-top").removeClass("message-top"),0===t.find(".invites-message").length))?(i=Dt.get_containing_modal(t),null!=i?i.hide():void 0):void 0},_listen:function(){var e,t,n;return this.listen_modals(),e=function(e){return function(t,n,i){var r,o,s,a,_,l,u,d,c;for(u=e._get_current_sf_list_info(i),l=u[0],s=u[1],wt(n,"SF _transfer w/o target_ns_id"),r=a=0,_=l.length;_>a;r=++a)if(o=l[r],o.target_ns_id===n&&o.user_id===t){d=o,c=r;break}return wt(null!=c,"SF _transfer w/o js obj"),[d,c]}}(this),n=function(t){return function(n,i,r){var o,s,a,_,l,u,d,c,h;return s=t._get_current_sf_list_info(i),o=s[0],h=s[1],a=t._get_current_sf_list_info(r),d=a[0],c=a[1],_=e(n.memo.user_id,n.memo.target_ns_id,i),l=_[0],u=_[1],o.splice(u,1),t._empty_check(i),null!=n.memo.filename&&(l.filename=n.memo.filename),null!=n.memo.mount_point&&(l.mount_point=n.memo.mount_point),d.push(l),t._render()}}(this),t=function(t){return function(n,i){var r,o,s,a,_,l;return o=t._get_current_sf_list_info(i),r=o[0],l=o[1],s=e(n.memo.user_id,n.memo.target_ns_id,i),a=s[0],_=s[1],r.splice(_,1),t._render()}}(this),document.observe(s.SF_UNSHARE,function(){return function(e){return t(e,"#sf-current")}}(this)),document.observe(s.SF_LEAVE,function(){return function(e){return n(e,"#sf-current","#sf-past")}}(this)),document.observe(s.SF_REJOIN,function(e){return function(t){return n(t,"#sf-past","#sf-current"),e._reload_folder_info()}}(this)),document.observe(s.SF_IGNORE,function(){return function(e){return t(e,"#sf-past")}}(this)),document.observe(s.SF_NEW,function(e){return function(t){var n;return n=t.memo.sf_info,wt(n,"SF_NEW without info"),e._state.sf_loading?e._reload_folder_info():(e._state.sf_info.current.push(n),e._render())}}(this)),$("create-share").observe("click",function(){return function(e){return rt.SharedFolderActivityLogger.log("web","sharing_view_share_new",null,{},!0),$("create-share").hasClassName("disabled")?void 0:(Event.stop(e),an.start_wizard_without_user())}}(this)),Se("#learn-more-link").click(function(){return function(){return rt.SharedFolderActivityLogger.log("web","sharing_view_learn_more",null,{},!0)}}(this)),$("new-invites-link")&&$("new-invites-link").observe("click",function(e){return function(t){return Event.stop(t),e.show_invites()}}(this)),Se("#sf-current, #sf-past").each(function(e){return function(t,n){var i;return i=["#sf-current","#sf-past"][t],Se(".sf-list",n).on("click","a.options-link",function(t){var n,i,r,o,s,a,_,l,u;return t.preventDefault(),i=Se(t.target).closest("a.options-link"),s=i.attr("data-type"),n=i.attr("data-filename"),o=i.attr("data-mount"),l=parseInt(i.attr("data-nsid"),10),u=G.get_viewer().get_user_by_id(i.attr("data-user_id")),_=Se(t.target).closest("li.sf-folder").data("role"),a=i.attr("data-sf-perm-role"),"normal"===s?e.simple_sharing_acl_enabled?At.get_for_user(u).verified_or_show()&&ti.createAndShowInbandModal(u,o,!0,l,!0,!1,a):an.show_shared_folder_options_modal(o,u):"remove"===s?an.show_ignore_modal(u,n,l):"rejoin"===s&&an.show_rejoin_modal(u,n,l),r={option_type:s},l&&(r.ns_id=l),o&&(r.path=o),rt.SharedFolderActivityLogger.log("web","sharing_view_share_existing",u.id,r,!0)}),Se(".sf-sort",n).on("click","a.sort-option",function(t){var n,r,o;return t.preventDefault(),n=Se(t.target).closest("a.sort-option"),o={SF_BY_NAME:e._name_cmp,SF_BY_MODIFIED:e._modified_cmp},r=o[n.attr("data-sort")],e._state.cmp[i]===r?e._state.is_ascending[i]=!e._state.is_ascending[i]:(e._state.cmp[i]=r,e._state.is_ascending[i]=!0),Zt.add_sort_arrow_mouseover_j(n,e._state.is_ascending[i],i+" .sf-sort a.sort-option",!0),e._render_list_id(i)}),Zt.add_sort_arrow_mouseover_j(Se(".modified-sorter",n),e._state.is_ascending[i],i+" .sf-sort a.sort-option",!1)}}(this)),Se(".empty-share-button").click(function(){return function(e){return e.preventDefault(),rt.SharedFolderActivityLogger.log("web","sharing_view_share_new",null,{},!0),an.start_wizard_without_user()}}(this))},listen_modals:function(){return Se("#new-or-existing-sf li").click(function(){return function(e){var t;return Se("#new-or-existing-sf li").removeClass("active"),t=Se(e.target).closest("li"),t.find("input").prop("checked",!0),t.addClass("active")}}(this))},_showing_two_accounts:function(){var e;return G.get_viewer().is_paired&&(null!=(e=this.role_picker)?e.get_state():void 0)===$t.ALL},_render:function(){return this._render_list_id("#sf-current"),this._render_list_id("#sf-past"),Se("#sf-current").hasClass("empty-list")&&Se("#sf-past").hasClass("empty-list")?(Se("#page-content").addClass("no-shares"),Se("#empty-content").show()):(Se("#page-content").removeClass("no-shares"),Se("#empty-content").hide())},_render_list_id:function(e){var t,n,i,r,o,s,a,l,u,d;for(l=this._get_current_sf_list_info(e),s=l[0],i=l[1],d=this._showing_two_accounts(),t=function(t){return function(n,i){var r;return r=t._state.is_ascending[e]?1:-1,r*t._state.cmp[e](n,i,d)}}(this),s.sort(t),a=Se(".sf-list",e),a.empty(),r=0,o=s.length;o>r;r++)u=s[r],this._should_render(u)&&(n=this._tmpl({options_str:zt("Options"),remove_str:zt("Remove"),rejoin_str:zt("Rejoin"),is_past:i,sf:u,Sprite:ee,Emstring:_,Util:Zt,_:zt}),a.append(n.toHTML()));return this._empty_check(e)},_should_render:function(e){return null!=this.role_picker?this.role_picker.is_role_visible(e.role):!0},_empty_check:function(e){var t,n,i;return n=this._get_current_sf_list_info(e),t=n[0],i=n[1],Se(".sf-list",e).children().length?Se(e).removeClass("empty-list"):Se(e).addClass("empty-list")},_get_current_sf_list_info:function(e){switch(e){case"#sf-current":return[this._state.sf_info.current,!1];case"#sf-past":return[this._state.sf_info.past,!0];default:return wt(!1,"invalid sf list id")}},_name_cmp:function(e,t,n){return n?Zt.sort_by_key(e,t):Zt.sort_by_rank_or_key(e,t)},_modified_cmp:function(e,t){return e.modified_ts-t.modified_ts},include_fb:!1,use_fb_profile_pics:!0,show_invites:function(){var e,t,n;this._state.current_total_count=0,t=this._state.inbox_counts;for(n in t)e=t[n],this._state.current_total_count+=e;return this._state.current_total_count>0?an.show_invites():void 0},_display_view:function(){return function(){return Se("#sf-view").show()}}(this),_hide_view:function(){return function(){return Se("#sf-view").hide()}}(this),_display_spinner:function(){return Se(".sf-spinner").show()},_hide_spinner:function(){return Se(".sf-spinner").hide()}};var Bn;Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){var r,o,s,a,_;return this.user=e,this.baseInitialize(t,n,i),this.options.array=!1,this.options.larray=!1,this.options.frequency=.1,this._num_contacts_shown=0,this._num_query_results=0,o=this.options.include_fb===!0,null==this.options.include_team&&(this.options.include_team=!0),_=this.options.include_team===!0,a=this.options.include_new_style_groups===!0,s=this.options.include_me===!0,this.profile_services=Ut.get_linked_profile_services_for_user(this.user.id,this.update_import_contacts_link),this.link_handler=new jt,this._autocompleter_profile_services_item_tmpl=lt.tmpl("autocompleter_item_tmpl"),this.listen(),this.possible_email_pattern=/[.@_-]/,r=function(e){return function(t){return t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(o||(t=t.excludeFacebook()),a||(t=t.excludeNewStyleGroups()),_||(t=t.excludeTeamMembers()),s||(t=t.excludeMe())),e.setContacts(t)}}(this),function(){var e;return Kt.load_contacts(e=!1,function(e){return r(e),Kt.register_for_updates("autocompleter_contacts",r)})}.defer(),this.options.onShow=function(e,t){return t.style.position&&"absolute"!==t.style.position||(t.style.position="absolute",je.clone_position(Se(t),Se(e),{setHeight:!1,setTop:!1,setLeft:!1})),Se(t).fadeTo(150,1)}},link_callback:function(e){return jt.show_import_notifications(e)},getToken:function(){var e;return e=this.getTokenBounds(),this.element.value.substring(e[0],e[1])},listen:function(){var e;return this.install_profile_services_link_listener(),e=function(e){return function(){return e.profile_services.has_connected_services()||Se(e.element).val()?void 0:(e.activate(),setTimeout(function(){var t;return null!=(t=e.get_entry_container())?t.show():void 0},300),!0)}}(this),Se(this.element).click(e)},install_profile_services_link_listener:function(){var e;return Event.stopObserving(this.element,"blur"),e=function(e){return function(t){var n;return n=e.get_entry_container(),Se(t.target).hasClass("new-collab-input")&&Se(n).hasClass("people-default-show-import-shmodal-experiment")?void 0:Se(t.target).closest("li").hasClass("profile-services-link-handler")?void 0:(Se(n).hasClass("people-default-show-import-shmodal-experiment")&&(Se(n).removeClass("people-default-show-import-shmodal-experiment"),rt.PeopleExperimentsLogger.log(rt.PeopleExperimentsLogger.DEFAULT_SHOW_IMPORT_LINK_DISMISS,e.user.id)),null!=n?n.hide():void 0)}}(this),Se(this.element).closest(".db-modal-box").click(e),Se(this.element).closest("#modal-box").click(e)},get_entry_container:function(){var e;return null!=(e=this.element.up(".tokenized_autocompleter_container"))?e.down(".autocomplete"):void 0},profile_services_show:function(){var e,t,n,i;return e=this.get_entry_container(),(null!=(t=e.firstChild)&&null!=(n=t.firstChild)?n.value:void 0)>0?this.old_display=e.style.display:(this.old_contents="<ul></ul>",this.old_display="none"),this.profile_services_render_buttons(),null!=(i=$("flash_copy_container"))&&i.hide(),this.element.focus()},profile_services_render_buttons:function(){var e;return e=this.get_profile_services_button_list(),this.hasFocus=!0,this.updateChoices("<ul>"+e.join("")+"</ul>")},get_profile_services_button_list:function(){var e,t,n,i,r,o;for(o=[],r=he.contact_services(),t=0,n=r.length;n>t;t++)i=r[t],wt(this.profile_services.is_updated,"profile_services has not been updated"),e="",this.profile_services.service_is_connected(i)?e=zt("Connected"):this.profile_services.service_was_connected(i)&&(e=zt("Reconnect")),o.push(this._autocompleter_profile_services_item_tmpl({email_provider_num:i,email_provider_img:he.to_img(i),email_provider_name:he.to_name(i),bottom_text:e}).toHTML());return o},update_import_contacts_link:function(e){return function(t){return e.profile_services=t,e.profile_services.has_unconnected_services(!0)?Se(e.element).closest("form").find(".import-contacts-link").show():Se(e.element).closest("form").find(".import-contacts-link").hide()}}(this),hide_containing_modal:function(){return this.$hidden_modals=Se(".db-modal-wrapper:visible").first(),this.$hidden_modals.length?this.$hidden_modals.css("display","none"):(this.$hidden_modals=Se("#modal:visible, #modal-overlay:visible"),this.$hidden_modals.hide())},show_containing_modal:function(){return this.$hidden_modals.show(),this.$hidden_modals=null},setContacts:function(e){return this.options.array=e.contacts,this.options.larray=e.lcontacts,this.active||this.getToken()?this.getUpdatedChoices():void 0},getUpdatedChoices:function(){return this.updateChoices(this.options.selector())},selectEntry:function(){var e,t,n;return t=this.getCurrentEntry(),e=this.options.array[t.value],t.innerHTML=e.type===de.FB||e.type===de.NEW_STYLE_GROUP?e.name:e.email,n=this.options.tokens.length>1?this.options.tokens[0]+" ":"",t.innerHTML+=n,this.active=!1,this.updateElement(t),Se(this.element).trigger("db:autocompleted")}},Bn=function(e,t){var n;return n=Se("<div>"),n.addClass(e),"string"==typeof t||t instanceof String?n.text(t):n.append(t),n},{getNumContactsShown:function(){return this._num_contacts_shown},getNumQueryResults:function(){return this._num_query_results},setOptions:function(e){var t;return null==e&&(e={}),t={choices:5,selector:function(e){return function(){var t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,S,C,T,A,D,O,N,I,$,L,R,M,F,P,q,U,j,B,z,H,V,Y;for(j=[],d=e.getToken().toLowerCase(),k=e.options.array.length,o=e.options.array,O=e.options.larray,U=[],-1===d.indexOf(" ")&&U.push("\\s+"),-1===d.indexOf("+")&&U.push("\\+"),-1===d.indexOf("@")&&U.push("@"),-1===d.indexOf(".")&&U.push("\\."),-1===d.indexOf("&lt;")&&U.push("&lt;"),q=RegExp("("+U.join("|")+")"),v=0;d.length>0&&k>v;){switch(r=o[v],D=O[v],c=-1,u=[],I=[],m="",r.type){case de.EMAIL:u.push(r.name,r.email_snippet),I.push(D.name,D.email),m="/static/images/icons/mail28-vflHfHPJ0.png";break;case de.FB:u.push(r.name),I.push(D.name),m=jn.use_fb_profile_pics?"https://graph.facebook.com/"+D.fb_id+"/picture":"/static/images/icons/fb24-vflGnjfAv.png";break;case de.NEW_STYLE_GROUP:u.push(r.name,r.members),I.push(D.name,""),m="",null!=__CIRCULAR_DEPENDENCY__.GroupsListController&&(n=__CIRCULAR_DEPENDENCY__.GroupsListController.string_to_hsl(r.name),i=__CIRCULAR_DEPENDENCY__.GroupsListController.get_initials(r.name),h=Se("<span class='group-icon'>").css("border-color",n).css("color",n).text(i));break;default:wt(!1,"should never get here due to type: "+(r.type+", "+r.name+", "+r.email+", "+r))}for(b=f=0,S=I.length;S>f;b=++f){for(N=I[b],R=U.length?N.split(q):[N],a=0,w=0,C=R.length;C>w;w++)if(L=R[w]){if(0===L.indexOf(d)){c=a;break}a+=L.length}if(-1!==c){P=(d.length/L.length*9.4).toFixed(0),null!=r.sort_key&&(P+=r.sort_key),E=document.createTextNode(u[b].substr(0,c)),$=Se("<strong>").text(u[b].substr(c,d.length)),z=document.createTextNode(u[b].substr(c+d.length)),u[b]=[E,$,z];break}}r.type===de.FB&&u.push(zt("Facebook message")),-1!==c&&(m?p=Se('<img width="28px" height="28px">').attr("src",m):h&&(p=h),M=Bn("autocomplete-line",u[0]),Y=Bn("autocomplete-line autocomplete-secondary",u[1]),x=Bn("autocomplete-left",p),H=Bn(null,[M,Y]),A=Se("<li>").attr("value",v).append(x,H),j.push([P,A])),v++}for(j.sort(function(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}),e._num_query_results=j.length,j=j.slice(0,e.options.choices),B=Se("<ul>"),y=0,T=j.length;T>y;y++)V=j[y],B.append(V[1]);return e._num_contacts_shown=j.length,Se(e.element).hasClass("no-profile-services-link-handler")||e.profile_services.has_unconnected_services(!0)&&(s=Se(e.element).closest(".tokenized_autocompleter_container"),F=s.attr("data-provider"),g=zt(F===he.GOOGLE?"Select from your Gmail contacts":F===he.YAHOO?"Select from your Yahoo contacts":"Select from your contacts"),_=!1,F!==he.GOOGLE&&F!==he.YAHOO||e.profile_services.service_is_connected(F)?e.profile_services.has_connected_services()&&(_=!1,g=zt("Import Contacts")):_=!0,_?(l=e._autocompleter_profile_services_item_tmpl({email_provider_num:F,email_provider_img:he.to_img(F),email_provider_name:g,bottom_text:""}).toHTML(),B.append(l)):(p=ee.make("web","user_add"),M=Bn("autocomplete-line autocomplete-line-center",g),x=Bn("autocomplete-left",p),H=Bn(null,[M]),A=Se("<li>").addClass("profile-services-link-handler").append(x,H),B.append(A))),t=B.wrap("<span>").parent().html(),e.old_contents=t,t}}(this)},this.options=Object.extend(t,e)}});var zn;zn=ft.Token=Class.create({initialize:function(e,t,n,i){return this.element=$(e),this.token_manager=n,this.hidden_input=t,this.element.token=this,this.selected=!1,this.info=i,Se(this.element).closest(".tokenized_autocompleter_container").click(this.onclick.bindAsEventListener(this))},select:function(){var e;return this.token_manager.token=this,null!=(e=this.hidden_input)&&e.element.activate(),this.selected=!0,this.element.addClassName("token_selected")},deselect:function(){return this.token_manager.token===this&&(this.token_manager.token=null),this.selected=!1,this.element.removeClassName("token_selected")},onclick:function(e){return e&&e.preventDefault&&e.preventDefault(),this.detect(e)&&!this.selected?this.select():this.deselect()},remove:function(){return this.token_manager.remove(this)},detect:function(e){var t,n,i;for(n=e.target?e.target:e.srcElement,i=n.token,t=n;null==i&&t.parentNode;)t=t.parentNode,i=t.token;return null!=i&&i.element===this.element}});var Hn;Hn=ft.TokenManager=Class.create({initialize:function(e,t,n,i){return this.contact_search_logger=i,this.shift_boundary_right_func=t,this.shift_boundary_left_func=n,this.element=e,this.tokens=[],this.token=null},add:function(e){return this.tokens.push(e),this.element.fire("token:add",e.info)},populate:function(){var e,t,n,i,r,o,s;for(s=this.element.select(".token"),i=[],t=0,n=s.length;n>t;t++)o=s[t],e=o.hasClassName("token-warn"),r=new zn(o,null,this,{external:e}),i.push(this.add(r));return i},remove:function(e){var t;return null==e&&(e=this.token),null!=e?(this.contact_search_logger.flag_record_as_removed(e.info.value),t=this.tokens.indexOf(e),this.tokens.splice(t,1),e.element.remove(),this.token===e&&t<this.tokens.length?this.tokens[t].select():(this.token=null,null!=this.shift_boundary_right_func&&this.shift_boundary_right_func()),this.element.fire("token:remove",e.info)):void 0},removeAll:function(){var e,t,n,i,r;for(r=this.tokens.slice(0),this.tokens.clear(),n=[],e=0,t=r.length;t>e;e++)i=r[e],i.element.remove(),n.push(this.element.fire("token:remove",i.info));return n},shift_left:function(){var e;return e=this.token?this.tokens.indexOf(this.token):this.tokens.length,e>0?(this.token&&this.token.deselect(),this.tokens[e-1].select()):null!=this.shift_boundary_left_func?this.shift_boundary_left_func():void 0},shift_right:function(){var e;return e=this.tokens.indexOf(this.token),this.token&&this.token.deselect(),e+1<this.tokens.length?this.tokens[e+1].select():null!=this.shift_boundary_right_func?this.shift_boundary_right_func():void 0}});var Vn;Vn=ft.HiddenInput=Class.create({initialize:function(e,t,n){return this.element=$(e),this.auto_complete_element=t,this.token_manager=n,Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(e){switch(e.keyCode){case Event.KEY_LEFT:e.preventDefault(),this.token_manager.shift_left();break;case Event.KEY_TAB:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_RIGHT:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return!1}});var Yn=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,e,t,n,i,r){var o;return this.user=e,$super(this.user,t,n,r),this.contact_search_logger=new rt.ContactSearchLogger,this.token_manager=new Hn(this.element,this.generate_shift_boundary_right_func(),null,this.contact_search_logger),this.hidden_input=new Vn(i,this.element,this.token_manager),this.textbox_height=0,this.element.hacks||(this.element.should_use_borderless_hack=Prototype.Browser.WebKit,this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera,this.element.hacks=!0),(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack)&&Se(this.element).parent().addClass("tokenizer_input_borderless"),this.options.onShow=function(e,t){return je.clone_position(Se(t),Se(e.parentNode.parentNode),{setHeight:!1,setTop:!1,setLeft:!1}),t.show()},this.options.onHide=function(e,t){return t.hide(),Se(t).hasClass("people-default-show-import-shmodal-experiment")?Se(t).removeClass("people-default-show-import-shmodal-experiment"):void 0},this.max_textbox_height=270,null!=r.max_textbox_height&&(this.max_textbox_height=r.max_textbox_height),this.members=[],null!=r.members&&(this.members=r.members),this.invitees=[],null!=r.invitees&&(this.invitees=r.invitees),this.new_style_groups=[],null!=r.new_style_groups&&(this.new_style_groups=r.new_style_groups),this.contacts_only=!1,null!=r.contacts_only&&(this.contacts_only=r.contacts_only),o=-1!==v.get_url().indexOf("/referrals")?Se("#retrieve-contacts-button"):Se(this.element).closest("form").find(".tokenizer-submit-button")[0],Se(o).on("mousedown",this.beforeSubmit.bindAsEventListener(this)),Se(this.element).on("focus",this.onFocus.bindAsEventListener(this)),this.import_links=[],r.hide_import_contacts||(this.import_links=Se(".import-contacts-link")),this.calculate_input_size(),this.dynamically_resize_input(),this.check_populated(),setInterval(this.check_populated.bind(this),100)},onClick:function(e){var t,n;return t=e.findElement("li"),this.index=t.autocompleteIndex,n=this.selectEntry(),n?void 0:this.hide()},onBlur:function($super,e){return $(this.element.parentNode).removeClassName("focused"),this.element.up(".tokenizer").removeClassName("focused"),$super(e)},onFocus:function(){return $(this.element.parentNode).addClassName("focused"),this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(){return this.tokenize_emails_input(!0)},clearTokens:function(){return this.token_manager.removeAll(),this.calculate_input_size(),this.dynamically_resize_input()},getTokenCount:function(){return this.token_manager.tokens.length},getEmails:function(){var e,t;return e=Se(this.element).closest(".tokenized_autocompleter_container").find(".token-valid").find('[name="emails"]'),function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(Se(t).val());return r}().join(", ")},check_populated:function(){var e,t;return e=$(this.element.parentNode),t=""===this.element.value&&0===this.token_manager.tokens.length,e.hasClassName("populated")&&t?e.removeClassName("populated"):e.hasClassName("populated")||t?void 0:e.addClassName("populated")},clean_email_addr:function(e,t){var n,i,r;for(i=0,r=e.length;r>i;i++)n=e[i],t=t.sub(n,"");return t.trim()},get_regexp_from_delimiters:function(e){var t,n,i,r;for(n="",i=0,r=e.length;r>i;i++)t=e[i],n+=t+"|";return new RegExp("["+n+"\\r\\n|\\r|\\n|\\t]+")},createTokenInfo:function(e,t,n){var i,r;return r=!0,i=t,n===de.FB&&(i=e),n!==de.EMAIL||Zt.validate_email(t)?Yn.call(this.members,t)>=0?(r=!1,i=zt("Already member")):Yn.call(this.invitees,t)>=0?(r=!1,i=zt("Already invited")):n===de.NEW_STYLE_GROUP&&(Yn.call(this.new_style_groups,t)>=0?(r=!1,i=zt("Already member group")):(r=!0,i=zt("Group"))):r=!1,(t===this.user.email||t===this.user.id)&&(i=zt("You"),r=!this.contacts_only),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:r,bubble_title:i}},COMPOUND_EMAIL_REGEX:/([^<>]+)<([^@>]+@[^@>]+)>/,parse_compound_email:function(e){var t,n;return t=e.match(this.COMPOUND_EMAIL_REGEX),t?n=this.createTokenInfo(t[0],t[2],de.EMAIL):null},tokenize_emails_input:function(e,t){var n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b;if(i=this.options.tokens,v=this.get_regexp_from_delimiters(i),o=this.options.single_token?[this.element.value]:this.element.value.split(v),w="",e||(w=o[o.length-1],m=this.clean_email_addr(i,w),o=o.slice(0,o.length-1),(" "===(p=w[w.length-1])||">"===p)&&(m.match(this.COMPOUND_EMAIL_REGEX)||Zt.validate_email(m))&&(o.push(m),w="")),n=!1,b=[],o.length>0)for(a=0,u=o.length;u>a;a++)r=o[a],g=this.parse_compound_email(r),(null!=g?g.valid:void 0)?(n=!0,this.set_input_size(1),this.addContact(g)&&(h={sort_variant:Kt.sort_variant,context:"legacy_tokenizer",contact_type:de.EMAIL,contact_id:g.value,contact_name:g.display,did_select_suggestion:!1},this.contact_search_logger.add_record(h))):b.push(r);if(o=b,!this.options.single_token){for(f=[],_=0,d=o.length;d>_;_++)r=o[_],f.push.apply(f,r.split(" "));o=f}if(o.length>0)for(l=0,c=o.length;c>l;l++)if(r=o[l],r=this.clean_email_addr(i,r)){if(g=this.createTokenInfo(r,r,de.EMAIL),g.valid)n=!0;else if(t)continue;this.set_input_size(1),this.addContact(g)&&(h={sort_variant:Kt.sort_variant,context:"legacy_tokenizer",contact_type:de.EMAIL,contact_id:r,did_select_suggestion:!1},this.contact_search_logger.add_record(h))}return this.element.value!==w&&(this.element.value=w),s=this.element.up("form"),n&&ui.clear_errors(s),this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var e,t;return e=this.element,t=function(){return e.focus()}},set_input_size:function(e){return(null==e||0>e)&&(e=20),this.element.setStyle({width:e+"px"})},calculate_input_size:function(){return this.import_links.length?(this.import_links_width=this.import_links.width(),this.import_links_visible=this.import_links.is(":visible")):void 0},dynamically_resize_input:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w;for(f=$(this.element.parentNode.parentNode),m=parseInt(f.getStyle("width"),10)-15,p=parseInt(f.getStyle("height"),10),p!==this.textbox_height&&(this.textbox_height=p,f.setStyle(p>=this.max_textbox_height?{"overflow-y":"auto"}:{"overflow-y":"hidden"})),s=m,e=Se(".tokenizer-link",f.parentNode),e.length>0&&(s-=e.width()),g=this.token_manager.tokens,l=!1,w=0,r=0,a=g.length;a>r;r++)v=g[r],i=v.element,n=parseInt(i.getStyle("width"),10)+parseInt(i.getStyle("margin-right"),10),d=w+n,d>m?(w=n,l=!0):n>m?(w=0,l=!0):w=d;if(u=s-w,t=7*this.element.value.length,t>u&&(u=m),this.set_input_size(u),this.import_links.length&&this.import_links_visible&&(l||m-w-t<1.25*this.import_links_width)){for(this.import_links_visible=!1,c=this.import_links,h=[],o=0,_=c.length;_>o;o++)i=c[o],h.push(Se(i).fadeOut(100));return h}},onKeyPress:function(e){var t,n;if(this.dynamically_resize_input(),this.active)switch(e.keyCode){case 44:case 188:case 59:case 186:return e.shiftKey||(this.has_selected_contact_importer_entry()||this.has_selected_contact_importer())&&this.tokenize_emails_input(!0),void this.reset_observer();case Event.KEY_TAB:case Event.KEY_RETURN:return this.has_selected_profile_services_entry()||this.has_selected_profile_services()?(this.tokenize_emails_input(!0),this.hide(),void Event.stop(e)):(this.selectEntry(),this.hide(),this.active=!1,void Event.stop(e));case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else{if(this.tokenize_emails_input(!1),e.keyCode===Event.KEY_TAB||e.keyCode===Event.KEY_RETURN)return this.element.value&&e.preventDefault&&e.preventDefault(),void this.tokenize_emails_input(!0);if(""===this.element.value)((t=e.keyCode)===Event.KEY_LEFT||t===Event.KEY_BACKSPACE)&&this.token_manager.shift_left();else if((n=e.keyCode)===Event.KEY_LEFT||n===Event.KEY_RIGHT||n===Event.KEY_UP||n===Event.KEY_DOWN)return}return this.update_typeahead(),this.reset_observer()},update_typeahead:function(){return this.changed=!0,this.hasFocus=!0},reset_observer:function(){return this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},onObserverEvent:function($super){var e,t,n,i,r,o;if(this.active){for(o=this.element.value,r=this.options.tokens,n=0,i=r.length;i>n;n++)if(e=r[n],t=o.indexOf(e),-1!==t){if(this.has_selected_profile_services_entry())return this.tokenize_emails_input(!0),void this.hide();this.element.value=o.substr(0,t),this.selectEntry(),this.hide(),this.active=!1,this.element.value=o.substr(t+1);break}this.update_typeahead()}return this.tokenize_emails_input(!1),$super()},has_selected_profile_services:function(e){return null==e&&(e=this.getCurrentEntry()),Se(e).hasClass("profile-services-link-handler")},has_selected_profile_services_entry:function(e){var t;return null==e&&(e=this.getCurrentEntry()),0===e.value&&0!==(null!=(t=e.id)?t.length:void 0)},selectEntry:function(){var e,t,n,i,r,o,s,a,_;return t=this.getCurrentEntry(),this.has_selected_profile_services(t)?(rt.SharedFolderActivityLogger.log("web","import_contacts_button_clicked",this.user),this.profile_services_show(),!0):this.has_selected_profile_services_entry(t)?(o="suggestion",Se(this.get_entry_container()).hasClass("people-default-show-import-shmodal-experiment")&&(o+=" people-default-show-import-shmodal-experiment",rt.PeopleExperimentsLogger.log(rt.PeopleExperimentsLogger.DEFAULT_SHOW_IMPORT_CLICK,this.user.id,{provider:n})),n=t.id.split("_")[0],wt(Yn.call(he.contact_services(),n)>=0,"The 'id-value' of an autocompleter-entry is not a valid Third Party contact import service"),a=he.to_name(n),this.profile_services.service_is_connected(n)?void k.success(zt("You're already connected to %(service_name)s").format({service_name:a})):Yn.call(he.contact_services(),n)>=0?this.link_handler.auth_service_with_user(n,this.user.id,function(e){return function(t){return e.link_callback(t)}}(this),o):wt(!1,"Should never get here. entry_value: "+n)):(e=this.options.array[t.value],i=e.type===de.FB?e.fb_id:e.type===de.NEW_STYLE_GROUP?e.group_id:e.email,this.set_input_size(1),s=this.element.value,_=this.createTokenInfo(e.name.trim(),i,e.type),this.addContact(_)&&(r={sort_variant:Kt.sort_variant,context:"legacy_tokenizer",search_expr:s,selected_pos:this.index,num_query_results:this.getNumQueryResults(),contact_type:e.type,contact_id:i,contact_name:e.name.trim(),did_select_suggestion:!0},this.contact_search_logger.add_record(r)),ui.clear_errors(this.element.up("form")),this.dynamically_resize_input(),this.index=0,this.element.focus())},addContact:function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w;for(w=this.token_manager.tokens,i=0,_=w.length;_>i;i++)if(c=w[i],e.value===c.info.value)return!1;switch(this.element.value="",e.type){case de.FB:s="fb_ids",r=new Element("img",{src:"/static/images/icons/fb_16-vflbiYTkC.png"});break;case de.EMAIL:s="emails",r=new Element("img",{src:"/static/images/icons/email_16-vflcFyDTl.png"});break;case de.NEW_STYLE_GROUP:s="new_style_group_ids",r=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",class:"sprite sprite_groups s_groups_group"});break;case de.INVALID:
s="invalids",r=new Element("span",{class:"hidden"});break;default:wt(!1,"should never get here due to type: "+e.type)}for(h=this.getTokenClass(e),g=Se("<span class='x'>").addClass(h),g.on("click",function(e){return this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(e),!1}),p=new Element("input",{type:"hidden",name:s,value:e.value.toString()}),c=new Element("a",{class:"title_bubble token "+h,href:"#",tabindex:"-1",title:e.bubble_title}),o=new Element("span"),this.options.wrap_name?(m=new Element("div",{class:"token-display-text"}),m.__sert(e.display),f=m,t=1):(f=e.display,t=0),u=[p,r,f],a=0,l=u.length;l>a;a++)n=u[a],o.__sert(n);return Se(o).append(g),c.__date(new Element("span").__date(new Element("span").__date(new Element("span").__date(o)))),null!=(d=$(c).down(5).next(t))&&(d.innerHTML="&nbsp;"),v=new zn(c,this.hidden_input,this.token_manager,e),this.token_manager.add(v),this.element.up().__sert({before:c}),!0},getTokenClass:function(e){return e.valid?"token-valid":"token-error"},isTeamOnly:function(){return!1}});var Yn=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.TeamTokenizer=Class.create(Autocompleter.ContactsTokenizer,{initialize:function($super,e,t,n,i,r){return $super(e,t,n,i,r),this.warn_only=!r.team_only,this.element.observe("token:remove",this.notifyExternal.bind(this)),this.element.observe("token:add",this.notifyExternal.bind(this)),this.team_contacts={},this.suspended_contacts={},this.pending_contacts={},this.reloadContacts(!0)},isTeamOnly:function(){return!this.warn_only},setTeamOnly:function(e){return this.warn_only=!e,this.reloadContacts()},reloadContacts:function(e){return null==e&&(e=!1),Kt.load_contacts(e=e,function(e){return function(t){return e.setContacts(t)}}(this))},setContacts:function($super,e){var t,n,i,r;for(this.team_contacts={},this.team_contacts[G.get_viewer().work_email]=1,Se(this.element).hasClass("team-admin")||(e=e.excludeSuspended()),e=e.sortByTeamFirst(),r=e.contacts,n=0,i=r.length;i>n;n++)t=r[n],t.team&&"active"===t.join_state&&(this.team_contacts[t.email]=1),t.team&&"suspended"===t.join_state&&(this.suspended_contacts[t.email]=1),t.team&&"pending"===t.join_state&&(this.pending_contacts[t.email]=1);return $super(this.options.contact_filter?this.options.contact_filter(e):e)},createTokenInfo:function(e,t,n){var i,r,o,s,a;return a=!0,r=!1,i=t,s=!1,n===de.FB&&(i=e),n!==de.EMAIL||Zt.validate_email(t)?Yn.call(this.members,t)>=0?(a=!1,i=zt("Already member")):Yn.call(this.invitees,t)>=0?(a=!1,i=zt("Already invited")):n!==de.EMAIL||this.team_contacts[t]||this.pending_contacts[t]?n===de.FB?(a=this.warn_only,r=!0):n===de.NEW_STYLE_GROUP&&(Yn.call(this.new_style_groups,t)>=0?(a=!1,i=zt("Already member group")):(a=!0,i=zt("Group"))):(a=this.warn_only,r=!0):a=!1,(t===this.user.email||t===this.user.id)&&(i=zt("You"),a=!this.contacts_only),this.suspended_contacts[t]&&(i=zt("Suspended user"),s=!0),!e&&t&&(e=t.toString()),o={display:e,value:t,type:n,valid:a,external:r,bubble_title:i,suspended:s}},getTokenClass:function(e){return e.valid?e.suspended?"token-warn token-suspended":e.external?"token-warn":"token-valid":"token-error"},notifyExternal:function(e){var t,n,i;return i=e.memo,i.external?(n=this.token_manager.tokens.filter(function(e){return e.info.external}),t=n?n.length:0,this.element.fire("sf:token:external",{count:t})):void 0}});var Wn;Wn=ft.TeamSharedFolderInviteController=function(){function e(e){var t;this.element=$(e[0]),t=this.element.down(".new-collab-input"),t.observe("sf:token:external",this.handle_external.bind(this))}return e.prototype.handle_external=function(e){var t,n;return t=e.memo.count,n=this.element.down(".external-invite-message"),t>1?(tn.fillVal(t,"external-invite-num"),null!=n&&n.removeClassName("single"),null!=n?n.show():void 0):1===t?(null!=n&&n.addClassName("single"),null!=n?n.show():void 0):null!=n?n.hide():void 0},e}();var Kn;Kn=INLINE_JS.SharingModel=ft.SharingModel={ALBUM_THUMB_SIZE:260,ALBUM_PADDING:40,THUMBS_BATCH_SIZE:12,filename:null,c2d_vars:{},is_folder:!1,is_album:!1,gallery_enabled:!1,gallery_showing:!1,file_viewer_files:[],send_link_autocompleter:null,team_only_shmodel:!1,owner_name:null,sync_vars:{},can_show_upgrade_modal:null,init:function(e,t){return this.filename=e,this.c2d_url=null!=t?t:"/sm/c2d",this.init_logger(),Se(".nav-close").on("click",this.close_embedded_fileviewer.bind(this)),on_script_loaded(function(e){return function(){var t,n,i;return n=$("login-create-an-account"),n&&n.writeAttribute("href","/register?signup_tag=shmodel"),scrollTo(1,0),scrollTo(0,0),Se("#download_button_link[data-dl-link]").on("click",e.download_zip),e.set_viewport_size(),t=function(t,n){return e.do_c2d(n.id)},Se("#c2d-modal .login-form").on("db:login:success",t),Se("#c2d-modal .register-form").on("db:register:success",t),i=o.parse(window.location.href),i.getQuery().force_dl?(i.updateQuery({force_dl:0,dl:1}),window.location=i.toString()):void 0}}(this))},init_folder:function(e,t,n,i,r,o,a){return this.c2d_vars=e,this.sync_vars=t,this.is_folder=!0,this.gallery_enabled=n,this.gallery_showing=i,this.file_viewer_files=r,this.file_view_target=o,this.file_view_target===Z.FileViewTargetType.SHARED_CONTENT_LINK&&this.sync_vars.sf_id_enc&&Kn.show_shared_content_sync_modal("can_view",this.sync_vars.sf_id_enc,this.sync_vars.folder_name,this.sync_vars.folder_size,this.sync_vars.sync_role),on_script_loaded(function(e){return function(){return e._open_file_viewer(a),e.load_thumbs(),Se("#gallery-toggle").click(function(){return e.switch_mode("gallery")}),Se("#list-toggle").click(function(){return e.switch_mode("list")}),Se(".file-link").click(function(t){return e._open_file_viewer(Se(t.currentTarget).data("mediaIndex"))}),Se(document).on(s.FILE_ACTIVITY_UPDATE,function(e,t,n){return Se("[data-file-activity-key='"+n.activity_key+"']").find(".comment-count-bubble-wrapper").each(function(){var e;return null!=(e=this.reactComponent)?e.setProps({unresolvedCommentCount:n.unresolvedCommentCount(),unseenCommentCount:n.unseenCommentCount()}):void 0})})}}(this))},_open_file_viewer:function(e){return!w.isNumber(e)||0>e?void 0:(ro.show(this.file_viewer_files[e],G.get_viewer(),{files:this.file_viewer_files,file_view_target:this.file_view_target}),ro.set_preview_url(),!1)},init_album:function(){return this.is_album=!0,this._resize_album_view(),Event.observe(window,"resize",this._resize_album_view.bind(this)),on_script_loaded(function(e){return function(){return Se("#add_to_my_dropbox_link").on("click",function(){return e.show_c2d_modal()})}}(this))},init_file:function(e,t){return this.c2d_vars=t,this.is_folder=!1,this.c2d_vars.subpath||null!=this.c2d_vars.item_id||this.c2d_vars.is_package?void 0:this.c2d_vars.subpath="/"+e},init_logger:function(){return on_script_loaded(function(){return function(){var e;return e=$("login-hover-link"),e&&(e.observe("click",function(){return to.log(to.CLICK_SIGN_IN)}),e.observe("click",function(){return eo.log("click_sign_in")})),$("download_button_link")&&to.attachLogListener(to.CLICK_DOWNLOAD,$("download_button_link")),e=$("add_to_my_dropbox_link"),e&&(to.attachLogListener(to.CLICK_ADD_TO_MY_DROPBOX,e),eo.attachLogListener("click_add_to_my_dropbox",e)),$$(".remove-link").length&&to.attachLogListener(to.REMOVE_LINK,$$(".remove-link")[0]),$$(".shmodel-filename").length&&to.attachLogListener(to.CLICK_FILENAME,$$(".shmodel-filename")[0]),e=$("default_content_download_button"),e&&to.attachLogListener(to.CLICK_DOWNLOAD,e),e=$("default_content_a2md"),e&&to.attachLogListener(to.CLICK_ADD_TO_MY_DROPBOX,e),e=Se("#login-create-an-account")[0],to.attachLogListener(to.CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN,e),e=Se("#login-hover-cont .login-form")[0],to.attachLogListener(to.LOGIN_THRU_DEFAULT_DROPDOWN,e),Se("#share-button").click(function(){return to.log(to.CLICK_SHARE)})}}(this))},set_team_only_shmodel:function(e,t){return this.team_only_shmodel=e,this.owner_name=t},_resize_album_view:function(){var e;return e=Math.floor((je.viewport_dimensions().width-2*this.ALBUM_PADDING)/this.ALBUM_THUMB_SIZE)*this.ALBUM_THUMB_SIZE,$("content-wrapper").setStyle({display:"block",width:e+"px"})},load_thumbs:function(){var e,t,n;return n=$$(this.gallery_showing?".gallery-icon-view img":".browse-files .icon"),t=function(e){return e.src.endsWith(ee.SPACER)||e.addClassName("thumbnail"),Be.mark_time_to_view(),Be.mark_time_to_interactive()},e=ot.batch_load_thumbs(n,this.THUMBS_BATCH_SIZE,t),0===e?Be.mark_time_to_interactive():void 0},switch_mode:function(e){var t,n,i,r,o,s,a;for(a=$A(["gallery","list"]),i=0,r=a.length;r>i;i++)s=a[i],n=$(s+"-view-container"),t=$(s+"-toggle"),e===s?(n.show(),t.addClassName("selected")):(n.hide(),t.removeClassName("selected"));return history.replaceState&&(o=window.location.pathname,"list"===e&&(o+="?lst"),history.replaceState({},"",o)),this.gallery_showing=!this.gallery_showing,this.load_thumbs()},set_viewport_size:function(){var e;return $(document.body).hasClassName("mobile")?(e=new Element("meta",{name:"viewport",content:"width = 480"}),document.head.appendChild(e)):void 0},toggle_dropdown:function(e,t,n){var i,r;return e&&Event.extend(e).preventDefault(),t.visible()?void 0:this.is_album?fi.show(t,n,null,!0):(r=$$(".nav-header").first().getHeight(),i=$$(".nav-header .buttons").first().cumulativeOffset().top-4,0>i&&Zt.ie8&&(i=4),fi.show(t,n,r-i,!0))},prepare_confirm_remove_modal:function(e,t,n,i,r,o,s,a){var l,u,d;return n?(d=zt(i?"Unshare?":"Unshare album?"),l=Se("#album-disable-token-modal")[0],tn.fillVal(e.escapeHTML(),"album_unshare_name")):(o?(d=zt("Remove link created by %(name)s").format({name:s}),u=zt(t?'You are removing the link to "%(fname)s" created by <b>%(owner)s</b>.  Once the link is removed, no one else will be able to view this folder.<br/><br/>We\'ll notify <b>%(owner_email)s</b>.  Do you want to continue?':'You are removing the link to "%(fname)s" created by <b>%(owner)s</b>.  Once the link is removed, no one else will be able to view this file.<br/><br/>We\'ll notify <b>%(owner_email)s</b>.  Do you want to continue?'),u=u.format({fname:_.em_snippet(e,17),owner:s,owner_email:a})):(d=zt("Remove link to '%(name)s'").format({name:_.em_snippet(e,17)}),u=zt(t?"Are you sure you want to remove this link? Once the link is removed, nobody else will be able to view this folder.":"Are you sure you want to remove this link? Once the link is removed, nobody else will be able to view this file.")),l=Se("#disable-token-modal")[0],tn.fillVal(u,"disable-token-desc")),{title:d,contents:l}},confirm_remove:function(e,t,n,i,r,o,s,a,_,l){var u,d;return null==n&&(n=!1),null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=null),null==s&&(s=!1),null==a&&(a=null),null==_&&(_=null),null==l&&(l=null),wt(t,"confirm_remove missing tkey"),wt(e,"confirm_remove missing name"),wt(o,"confirm_remove missing user_id"),wt(!s||!i,"admin removal of collections not supported"),wt(!s||a,"missing link owner name for admin removal"),wt(!s||_,"missing link owner email for admin removal"),G.get_viewer().is_uid_signed_in(o)?(d=Kn.prepare_confirm_remove_modal(e,n,i,r,o,s,a,_),Kn.prepare_upgrade_modal(),u=function(){return"function"==typeof l&&l(),Kn.show_upgrade_modal(e)},mi.show(d.title,d.contents,{token:t,name:e,is_album:i,user_id:o,success_callback:u})):void se.show_modal({user_id:o,on_success:function(l){return function(){return l.confirm_remove(e,t,n,i,r,o,s,a,_)}}(this)})},show_upgrade_modal:function(e){var t,n;if(Kn.can_show_upgrade_modal){if(n=zt("You’ve removed the link to ‘%(fname)s’"),n=n.format({fname:_.em_snippet(e,17)}),t=Se("#share-link-remove-upgrade-modal"),!(t.length>0))return;return t.on("click",'[data-role="hide"]',function(e){return e.preventDefault(),mi.hide()}),Kn.can_show_upgrade_modal=!1,mi.show(n,t[0])}},prepare_upgrade_modal:function(){null===Kn.can_show_upgrade_modal&&new p(Se("#share-link-remove-upgrade-modal"),"/show_remove_link_upgrade_modal",{success:function(e){var t;return t=e.data,Kn.can_show_upgrade_modal=t.can_show_upgrade_modal}})},confirm_remove_from_event_gid:function(e,t,n,i,r,o,s,a){var _;return null==r&&(r=!1),null==o&&(o=null),null==s&&(s=null),null==a&&(a=null),wt(t,"confirm_remove missing event gid"),wt(e,"confirm_remove missing name"),wt(i,"confirm_remove missing user_id"),wt(G.get_viewer().is_uid_signed_in(i),"user not logged in"),wt(!r||o,"missing link owner name for admin removal"),wt(!r||s,"missing link owner email for admin removal"),_=Kn.prepare_confirm_remove_modal(e,n,!1,!1,i,r,o,s),mi.show(_.title,_.contents,{name:e,user_id:i,activity_log_event_gid_dbase64:t,redirect_to_member_id:a})},do_remove:function(e){var t,n,i;return wt(e.token||e.activity_log_event_gid_dbase64,"missing token or event gid_dbase64"),t=Se("#modal-content input").first(),t.attr("disabled",!0),Se("#modal-content").addClass("ajax-loading"),i=window.location.pathname,"/links"===i||"/links/your_links"===i||"/recents"===i||i.match("^/home|^/work|^/personal")?new Ajax.DBRequest("/sm/disable/"+e.token,{subject_user:e.user_id,onSuccess:function(){return function(){var t;return mi.hide(),"function"==typeof e.success_callback&&e.success_callback(),t=zt(e.is_album?"Unshared '%(name)s'":"Removed link for '%(name)s'"),t=t.format({name:e.name}),k.success(t),document.fire(s.LINKS_REMOVE,{token:e.token})}}(this),onComplete:function(){return function(){return t.attr("disabled",!1),Se("#modal-content").removeClass("ajax-loading")}}(this)}):(e.token?n=o({path:"/sm/disable/"+e.token}):(n=o({path:"/sm/disable_by_event_gid/"+e.activity_log_event_gid_dbase64}),n.updateQuery("redirect_to_member_id",e.redirect_to_member_id).toString()),ui.postRequest(n.updateQuery(O.UID_PARAM_NAME,e.user_id).toString()))},show_shmodal_onload:function(e,t,n,i){return null==i&&(i=null),Se(function(r){return function(){return v.remove_query_param("m"),G.get_viewer().is_uid_signed_in(i)?null!=i&&At.get_for_user(G.get_viewer().get_user_by_id(i)).verified_or_show()?r.show_shmodal(e,t,n,i):null==i?(wt(G.get_viewer().is_paired,"Expected viewer to be paired."),r.show_share_shmodel_role_chooser(e,t,n)):void 0:void se.show_modal({user_id:i,on_success:function(){return r.show_shmodal_onload(e,t,n,i)}})}}(this))},show_shmodal:function(e,t,n,i){var r,o,s,a,_,l,u,d,c,h;if(this.url=e,this.short_url=t,!G.get_viewer().is_uid_signed_in(i))return void se.show_modal({user_id:i,on_success:function(e){return function(){return e.show_shmodal(e.url,e.short_url,n,i)}}(this)});if(h=G.get_viewer().get_user_by_id(i),At.get_for_user(h).verified_or_show()){if(d="shmodal-user-"+i,mi.show(this._get_shmodal_title(h.is_team),tn.fromElm($(d))),_={},_[O.UID_PARAM_NAME]=i,ui.add_vars("shmodal-send-form",_),this._get_thumbnail_type())for(c=$$(".shmodal-image"),l=0,u=c.length;u>l;l++)a=c[l],a.addClassName("thumbnail");return s="contacts"===n?Autocompleter.ContactsTokenizer:Autocompleter.TeamTokenizer,this.send_link_autocompleter=new s(h,d+"-new-collab-input",d+"-new-whobulk",d+"-hidden-input",{tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===n,user_id:i}),this.configure_dropdown(),this.disabled||(FlashDetect.installed?(r=We.clipboard_overlay(this.url,Se("#"+d+"-copy-link"),Kn.copied_to_clipboard),r.css({position:"fixed",zIndex:1001}),r.children().height(r.height()),clearInterval(this.follow_freshbutton),o=function(){return function(){return je.clone_position(r,Se("#"+d+"-copy-link"),{offsetHeight:6,offsetWidth:6})}}(this),this.follow_freshbutton=setInterval(o,500)):$(d+"-copy-link").hide()),vi._create($("modal").down(".custom-message-container")),vi._create($("modal").down(".fb-post-sickinput")),vi._create($("modal").down(".twitter-post-sickinput")),this._populate_twitter_info(this.short_url,i),$(d+"-new-collab-input").focus(),to.log("shmodal_show")}},configure_dropdown:function(){var e,t,n,i,r;for(i=$$(".dropdown-menu-container"),t=0,n=i.length;n>t;t++)e=i[t],r=e.down(".dropdown-menu-trigger"),null!=r&&r.observe("click",function(){return function(e){var t;return t=e.target.up(".dropdown-menu-container"),t.toggleClassName("dropdown-shown")}}(this));return document.on("click",function(){return function(e){var t,n,i,r,o;if(!e.target.hasClassName("dropdown-menu-trigger")&&!e.target.up(".dropdown-menu-trigger")){for(r=$$(".dropdown-shown"),o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(t.removeClassName("dropdown-shown"));return o}}}(this))},copied_to_clipboard:function(){return k.success(zt("Link copied to clipboard")),mi.hide(),to.log("shmodal_copy_link"),rt.ViralLogger.log(G.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_copy_link",file_type:Kn.is_album?"collection":Kn.is_folder?"folder":-1===Kn.filename.indexOf(".")?"file":vr.EXTENSION_TO_CATEGORY[_t.file_extension(Kn.filename).toLowerCase()]||"file"})},get_shmodel_send_recipients:function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h;for(wt(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),c=[],h=[t,n,i,u],r=0,_=h.length;_>r;r++)for(s=h[r],a=0,l=s.length;l>a;a++)o=s[a],d=o.up().innerHTML.stripTags().escapeHTML(),c.push(d.substring(0,d.indexOf("&")));return c},close_embedded_fileviewer:function(e){var t;return e.preventDefault(),t=new it,t.configureParentMessaging(function(){},["parent-ready"]),t.startListening(),t.postMessageToParent("close-fileviewer")},send_shmodel_link:function(){var e,t,n,i;return e=$("shmodal-send-form"),wt(e,"Couldn't find the shmodal send form."),i=this.get_shmodel_send_recipients(e),n=function(){return function(){var e;return e=sn.success_string_for_recipients(i),k.success(e),mi.hide(),to.log("shmodal_send")}}(this),t=function(){return function(){return ui.remove_loading()}}(this),ui.ajax_submit(e,"/sm/share",n,t,e.down(".tokenizer-submit-button"))},show_content:function(e){var t,n,i,r;for($("shmodal-title-text").__date(Jn.to_title_str(e)),i=Jn.list,t=0,n=i.length;n>t;t++)r=i[t],r!==e&&($(Jn.to_toggle_str(r)).removeClassName("toggled"),$(Jn.to_content_str(r)).hide());return $(Jn.to_content_str(e)).show(),$(Jn.to_toggle_str(e)).addClassName("toggled"),Se("#modal .focusarea").focus()},show_send_content:function(){return this.show_content(Jn.SEND)},show_fb_content:function(){return this.show_content(Jn.FB)},show_twitter_content:function(){return this.show_content(Jn.TWITTER)},start_fb_post:function(e,t){var n,i,r,o;return i=function(n){return function(){return H.do_auth(n.do_fb_post.curry(e,t),t)}}(this),n=Se("#modal:visible, #modal-overlay:visible"),r=function(){return n.show()},H.authed_user_id===t?this.do_fb_post(e,t):G.get_viewer().is_uid_associated(H.authed_user_id)?(n.hide(),o=new z(G.get_viewer().get_user_by_id(t),r,i.bind(this)),o.show()):i()},start_twitter_post:function(e){return Yr.is_authed(e)?this.do_twitter_post(e):Yr.do_auth(this.do_twitter_post,e)},do_fb_post:function(e,t){return H.custom_show_posting=function(){return ui.add_loading($("shmodal-fb-post-submit"))},H.custom_show_complete=function(){return mi.hide(),k.success(zt("Successfully posted to Facebook")),to.log("shmodal_fb_post"),rt.ViralLogger.log(G.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_fb_post",file_type:Kn.is_album?"collection":Kn.is_folder?"folder":-1===Kn.filename.indexOf(".")?"file":vr.EXTENSION_TO_CATEGORY[_t.file_extension(Kn.filename).toLowerCase()]||"file"})},H.post($F("shmodal-fb-post-input"),e,null,null,null,function(){return mi.hide()},t)},do_twitter_post:function(e){var t;return(t=$F("shmodal-twitter-post-input"))?t.length>140?void k.error(zt("Your post must be 140 characters or less")):(Yr.custom_show_posting=function(){return $("twitter-chars").hide(),ui.add_loading($("shmodal-twitter-post-submit"))},Yr.custom_post(t,function(){return function(){return mi.hide(),k.success(zt("Successfully posted to Twitter")),to.log("shmodal_tweet"),rt.ViralLogger.log(G.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_twitter",file_type:Kn.is_album?"collection":Kn.is_folder?"folder":-1===Kn.filename.indexOf(".")?"file":vr.EXTENSION_TO_CATEGORY[_t.file_extension(Kn.filename).toLowerCase()]||"file"})}}(this),e)):void k.error(zt("Please enter a Twitter post"))},_get_shmodal_title:function(e){return null==e&&(e=!1),this.generate_title_content(this._get_shmodal_title_text(),function(e){return function(){return e.show_send_content()}}(this),function(e){return function(){return e.show_fb_content()}}(this),function(e){return function(){return e.show_twitter_content()}}(this),e)},generate_title_content:function(e,t,n,i,r){var o,s,a,_,l,u;return null==r&&(r=!1),_=Se("<div/>",{id:"shmodal-title"}),l=Se("<div/>",{id:"shmodal-title-text",text:e}),_.append(l),r||(a=Se("<a/>",{id:"shmodal-send-toggle",class:"freshtoggle ft-left toggled"}),a.html(ee.make("web","email_20")),a.on("click",t),s=Se("<a/>",{id:"shmodal-fb-toggle",class:"freshtoggle ft-middle"}),s.html(ee.make("web","fb_20")),s.on("click",n),u=Se("<a/>",{id:"shmodal-twitter-toggle",class:"freshtoggle ft-right"}),u.html(ee.make("web","twitter_20")),u.on("click",i),_.append([a,s,u])),o=Se("<div/>",{class:"clear"}),_.append(o),_[0]},_get_shmodal_title_text:function(){var e,t;return this.is_folder?(e=zt("Share link to ‘%(folder_name)s’"),e=e.format({folder_name:_.em_snippet(this.filename,15)})):(t=this._get_thumbnail_type(),t===vr.CATEGORY_TO_TRANSLATION.IMAGE?zt("Share this image"):t===vr.CATEGORY_TO_TRANSLATION.VIDEO?zt("Share this video"):zt("Share '%(filename)s'").format({filename:_.em_snippet(this.filename,18)}))},_get_thumbnail_type:function(){var e,t;return-1===this.filename.indexOf(".")?!1:(t=_t.file_extension(this.filename).toLowerCase(),e=vr.EXTENSION_TO_CATEGORY[t],!e||"IMAGE"!==e&&"VIDEO"!==e?!1:vr.CATEGORY_TO_TRANSLATION[e])},_populate_twitter_info:function(e,t){var n,i;return n=this.is_folder?zt("Just shared some files using @Dropbox"):(i=this._get_thumbnail_type(),zt(i&&i===vr.CATEGORY_TO_TRANSLATION.IMAGE?"Just shared an image using @Dropbox":"Just shared a file using @Dropbox")),$("shmodal-twitter-post-input").setValue(n+" "+e),Zt._track_twitter_chars_left("shmodal-twitter-post-input",140),Yr.is_authed(t)?Yr.get_user_info(function(e){return $("shmodal-twitter-profile").down(".profile-pic").__date(new Element("img",{src:e.profile_image_url_https})),$("shmodal-twitter-profile").down(".name").__date(e.name),$("shmodal-twitter-profile").down(".username").__date("@"+e.screen_name),$("modal").down(".twitter-post-sickinput").addClassName("shrank"),$("shmodal-twitter-profile").show()},t):void 0},download_zip:function(){var e,t,n,i,r;return e=Se("#download_button_link").attr("data-dl-link"),r=Se("#download_button_link").attr("data-test-link"),i="true"===Se("#download_button_link").attr("data-owner"),n=function(){return function(t){var n;return"OK"===t?window.location=e:0===t.indexOf("err:")?(n=zt(i?"The zip file is too large.":"The zip file is too large. Please add it to your Dropbox."),k.error(n)):k.error(zt("Failed to download zip file.")),!1}}(this),t=function(){return function(){return k.error(zt("Failed to download zip file.")),!1}}(this),r&&Se.support.cors===!0?Se.ajax({url:r,type:"POST",success:n,error:t}):window.location=e,!1},show_share_shmodel_role_chooser:function(e,t,n){return null==this.shmodel_select_role_modal&&(this.shmodel_select_role_modal=new zi({element_id:"share-shmodel-select-role-modal",link_url:e,short_url:t,tokenizer_type:n})),this.shmodel_select_role_modal.show().set_title(this._get_shmodal_title_text())},prompt_login_then_share:function(e,t,n,i){var r;return r=function(){return function(){var r;return mi.hide(),Se("#role-selector option").removeClass("disabled"),r=G.get_viewer().get_uid_by_role(i),G.get_viewer().sign_in_user_by_id(r),rt.ShmodelUILogger.log("via-shmodel-viewer"),Kn.show_shmodal(e,t,n,r)}}(this),G.get_viewer().is_role_signed_in(i)?r():se.show_modal({role:i,on_success:r})},show_c2d_modal:function(e,t){var n,i,r,o,s;if(null==e&&(e=""),null==t&&(t=!1),e){if(e===O.ROLE_PERSONAL&&wt("forbid"!==this.team_only_shmodel,"Can't copy to personal Dropbox if restricted"),!G.get_viewer().is_role_signed_in(e))return void se.show_modal({role:e,on_success:function(t){return function(){return t.show_c2d_modal(e)}}(this)})}else if(G.get_viewer().is_paired)return void new Vi({element_id:"select-role-modal"}).show();return rt.WebMiscActivityLogger.log("show-c2d-modal",{filename:this.filename,auth_google:null!=Se.find(".auth-google")}),o=e?"#c2d-modal-"+e:"#c2d-modal",s=this._c2d_modal_msg(e,G.get_viewer().team_name),n=this._c2d_modal_button_msg(e,G.get_viewer().team_name),i=this._c2d_modal_desc(e,G.get_viewer().team_name),t&&(i=this._c2d_modal_team_only_desc(G.get_viewer().team_name)+"<br/><br/>"+i),r=this._c2d_modal_login_desc(e,G.get_viewer().team_name),tn.fillVal(i,"c2d-desc"),tn.fillVal(r,"c2d-login-desc"),Se(".c2d-submit-button").val(n),Se(".c2d-login-register-desc").hide(),this.is_album?Se(".c2d-login-register-album-desc").show():this.is_folder?Se(".c2d-login-register-folder-desc").show():Se(".c2d-login-register-file-desc").show(),mi.show(s,Se(o)[0],!1,!1,!1,!1)},_c2d_modal_msg:function(e,t){var n,i;return null==e&&(e=""),null==t&&(t=""),this.c2d_vars.title?i=this.c2d_vars.title:e===O.ROLE_PERSONAL?(i=zt("Save '%(filename)s' to my personal Dropbox"),i.format({filename:_.em_snippet(this.filename,10)})):e===O.ROLE_WORK?(i=zt("Save '%(filename)s' to my %(team_name)s Dropbox"),n=Math.max(10,15-new _(t).length),i.format({filename:_.em_snippet(this.filename,n),team_name:t})):(i=zt("Save '%(filename)s' to my Dropbox"),i.format({filename:_.em_snippet(this.filename,15)}))},_c2d_modal_button_msg:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===O.ROLE_PERSONAL?n=zt("Save to my personal Dropbox"):e===O.ROLE_WORK?(n=zt("Save to my %(team_name)s Dropbox"),n.format({team_name:t})):zt("Save to my Dropbox")},_c2d_modal_team_only_desc:function(e){var t;return t=zt(this.is_album?"You can only add this album to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the album to members of <b>%(team_name)s</b>.":this.is_folder?"You can only add this folder to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the folder to members of <b>%(team_name)s</b>.":"You can only add this file to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the file to members of <b>%(team_name)s</b>."),t.format({owner_name:this.owner_name,team_name:e})},_c2d_modal_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===O.ROLE_PERSONAL?this.is_album?"warn"===this.team_only_shmodel?(n=zt("The photos and videos in this album were sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy them to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=zt("The photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):this.is_folder?"warn"===this.team_only_shmodel?(n=zt("This folder was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=zt("This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"warn"===this.team_only_shmodel?(n=zt("This file was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=zt("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===O.ROLE_WORK?(n=zt(this.is_album?"The photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):zt(this.is_album?"The photos and videos in this album will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":this.is_folder?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")},_c2d_modal_login_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===O.ROLE_PERSONAL?n=zt(this.is_album?"Once you sign in to your personal Dropbox, the photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":this.is_folder?"Once you sign in to your personal Dropbox, this folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"Once you sign in to your personal Dropbox, this file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===O.ROLE_WORK?(n=zt(this.is_album?"Once you sign in to your %(team_name)s Dropbox, the photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"Once you sign in to your %(team_name)s Dropbox, this folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"Once you sign in to your %(team_name)s Dropbox, this file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):void 0},do_c2d:function(e){var t;return wt(e,"Must specify a user_id for saving to Dropbox."),t=zt("Saving to your Dropbox..."),G.get_viewer().is_paired&&(G.get_viewer().get_user_by_id(e).is_team?(t=zt("Saving to your %(team_name)s Dropbox..."),t=t.format({team_name:G.get_viewer().team_name})):t=zt("Saving to your personal Dropbox...")),k.success(t),mi.hide(),new Ajax.DBRequest(this.c2d_url,{parameters:this.c2d_vars,job:this.is_folder,progress_text:t,subject_user:e,onSuccess:function(){return function(e){return e.responseText?st.redirect(e.responseText):void 0}}(this)})},show_shared_content_sync_modal:function(e,t,n,i,r){return t?X.showInstance(ce.createElement(X,{accessLevel:e,folderName:n,folderSize:i,syncSharedFolderCallback:Kn.sync_shared_folder.bind(Kn,t,r)})):void 0},request_shared_folder_sync:function(e){return null==e&&(e=""),Kn.sync_shared_folder(this.sync_vars.sf_id_enc,e)},sync_shared_folder:function(e,t){var n,i,r,o,s;if(t){if(!G.get_viewer().is_role_signed_in(t))return void se.show_modal({role:t,on_success:function(){return function(){return Kn.sync_shared_folder(e,t)}}(this)})}else if(G.get_viewer().is_paired)return void new Yi({element_id:"select-role-modal-sync"}).show();return s=G.get_viewer(),t?o=s.get_uid_by_role(t):(wt(!s.is_paired,"role can not be unspecified for paired viewer"),o=s.get_user_ids()[0]),r=zt("Adding to your Dropbox..."),s.is_paired&&(s.get_user_by_id(o).is_team?(r=zt("Adding to your %(team_name)s Dropbox..."),r=r.format({team_name:s.team_name})):r=zt("Adding to your personal Dropbox...")),k.success(r),n=new vt({userId:o}),i=n.mount({contentId:e}),i.then(function(e){var t,n,i;return n=e.path_lower,t=G.get_viewer().get_user_by_id(o),i=mr.make_browse_url_from_fq_path(t,n),st.redirect(i)}),i.catch(function(){return k.error(zt("We were unable to complete your request."))})}};var Jn;Jn=ft.ShmodalPanes={SEND:0,FB:1,TWITTER:2,list:[0,1,2],_content_str:["shmodal-send-content","shmodal-fb-content","shmodal-twitter-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle","shmodal-twitter-toggle"],
_title_str:["Share by Email",zt("Share on Facebook"),zt("Share on Twitter")],to_content_str:function(e){return this._content_str[e]},to_toggle_str:function(e){return this._toggle_str[e]},to_title_str:function(e){return 0===e?Kn._get_shmodal_title_text():this._title_str[e]},to_focus_str:function(e){return this._focus_str[e]}};var Gn,Qn,Xn,Tn=function(e,t){return function(){return e.apply(t,arguments)}},Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty;Qn=INLINE_JS.ShareLinkModal=ft.ShareLinkModal=function(e){function t(e,n,i,r,s){var a,_;this.user_id=e,null==r&&(r=!1),null==s&&(s=void 0),this.before_show=Tn(this.before_show,this),this.show=Tn(this.show,this),this.prompt_login_then_show=Tn(this.prompt_login_then_show,this),_={origin:i},_[O.UID_PARAM_NAME]=this.user_id,a=s?o({path:"/sm/get_link_modal_content/"+s}).toString():o({path:"/sm/share_link"+n}).toString(),t.__super__.constructor.call(this,{element_id:"share-link-modal",endpoint_url:a,parameters:_})}return Sn(t,e),t.prototype.prompt_login_then_show=function(){var e;return e=function(e){return function(){return mi.hide(),Se("#role-selector option").removeClass("disabled"),G.get_viewer().sign_in_user_by_id(e.user_id),rt.ShmodelUILogger.log("via-shmodel-viewer"),e.show()}}(this),G.get_viewer().is_uid_signed_in(this.user_id)?e():se.show_modal({user_id:this.user_id,on_success:e})},t.prototype.show=function(){var e;return e=G.get_viewer().get_user_by_id(this.user_id),At.get_for_user(e).verified_or_show(Ge.SHMODAL)?t.__super__.show.call(this):void 0},t.prototype.before_show=function(){var e,t,n,i;return i=this.$modal_window.find(".share-link-modal-content").length,i?(e={class:"ajax-loading-indicator",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"},n=Se("<img />",e),t=Se("<div />",{class:"loading-spinner"}).append(n),this.$modal_window.find(".dynamic-content").html(t)):void 0},t}(ne),Xn=ft.ShareLinkModalContent=function(){function e(e,t,n,i,r,o,a,l,u,d,c){var h,f,p,m;this.owner_id=e,this.tkey=t,this.fq_path=n,this.link=i,this.filename=r,this.is_dir=o,this.tokenizer_type=a,this.tokenizer_ctx_str=l,this.is_restricted_to_members=u,this.fq_path_of_restricting_sf=c,this._send_link=Tn(this._send_link,this),this._show_shared_link_remove_confirm_modal=Tn(this._show_shared_link_remove_confirm_modal,this),this._show_shared_link_settings_modal=Tn(this._show_shared_link_settings_modal,this),this._show_shared_folder_settings_modal=Tn(this._show_shared_folder_settings_modal,this),this._select_all_text=Tn(this._select_all_text,this),this._toggle_send_link_button=Tn(this._toggle_send_link_button,this),this._toggle_recipients_outside_team_warning=Tn(this._toggle_recipients_outside_team_warning,this),this._toggle_close_button_text=Tn(this._toggle_close_button_text,this),this._add_message_checkbox_changed=Tn(this._add_message_checkbox_changed,this),this._toggle_comment_option=Tn(this._toggle_comment_option,this),this._listen=Tn(this._listen,this),this._init_autocompleter=Tn(this._init_autocompleter,this),this.$content=Se(".share-link-modal-content"),this.modal=Dt.get_containing_modal(this.$content),this.modal&&("shared_folder"===this.tokenizer_type&&(this.shared_folder_members=Re.create_contacts_list(d)),p={filename:this.filename,fq_path:this.fq_path,tkey:this.tkey,user_id:this.owner_id},document.fire(s.LINKS_ADD,p),this.modal.set_title(zt("Share link to ‘%(filename)s’").format({filename:_.em_snippet(this.filename,15)})),this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),this.$send_link_button=this.$content.find(".confirm-button"),this.$share_link_url_input=this.$content.find(".copy-link-input-container input[type='text']"),this.$cancel_button=this.$content.find(".cancel-button"),this.$custom_message_textarea=this.$content.find("#share-link-modal-custom-message"),this.$comment_option_container=this.$content.find(".add-message-as-comment-container"),this._init_autocompleter(),this._listen(),null!=(h=this.$share_link_url_input[0])&&h.select(),null!==(f=oe.getGandalfRule("people-link-profile-on-share-experiment"))&&"CONTROL"!==f||!oe.isGandalfInVariant("people-default-show-import-shmodal-experiment","EXPERIMENT")||"shared_folder"===this.tokenizer_type||(m=function(e){return function(){var t,n,i;return t=Se(e.autocompleter.element).closest(".tokenized_autocompleter_container"),n=t.attr("data-provider"),e.autocompleter.activate(),Se(e.autocompleter.get_entry_container()).addClass("people-default-show-import-shmodal-experiment"),(null!=(i=t.find("[id*='_autocompleter_entry']"))?i.length:void 0)>0?rt.PeopleExperimentsLogger.log(rt.PeopleExperimentsLogger.DEFAULT_SHOW_IMPORT_SHOW,e.owner_id,{provider:n}):void 0}}(this),Ut.get_linked_profile_services_for_user(this.owner_id,m)))}return e.prototype._init_autocompleter=function(){var e,t;return e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===this.tokenizer_type,user_id:this.owner_id},this.autocompleter="shared_folder"===this.tokenizer_type?new Autocompleter.SharedFolderTokenizer(G.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e,this.shared_folder_members):"contacts"===this.tokenizer_type?new Autocompleter.ContactsTokenizer(G.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e):new Autocompleter.TeamTokenizer(G.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e),t=function(e){return function(t){return function(){return e.autocompleter.contact_search_logger.log_records(e.owner_id,t)}}}(this),this.modal.logger_keydown_close_handler=t(!0),this.modal.$overlay.on("click",t(!0)),this.modal.$db_modal_x.on("click",t(!0)),this.$send_link_button.on("click",t(!1)),this.$cancel_button.on("click",t(!0)),vi.init(),this.$collab_input.focus()},e.prototype._listen=function(){var e,t,n,i,r,o;return this.$send_link_button.on("click",this._send_link),this.$share_link_url_input.on("click",this._select_all_text),this.$cancel_button.on("click",function(){return function(){return Ot.pop()}}(this)),this.$content.find("#shared-link-permissions-link").on("click",this._show_shared_link_settings_modal),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),this.$content.find("#shared-link-delete-link").on("click",this._show_shared_link_remove_confirm_modal),this.$comment_option_container.length>0&&(this.$custom_message_textarea.on("input",this._toggle_comment_option),this.$comment_option_container.find("#add-message-as-comment").on("change",this._add_message_checkbox_changed)),null!=(e=this.$collab_input)&&e.keyup(this._toggle_send_link_button),null!=(t=this.$collab_input)&&t.on("input",this._toggle_send_link_button),null!=(n=this.$collab_input[0])&&n.observe("token:remove",this._toggle_send_link_button),null!=(i=this.$collab_input[0])&&i.observe("token:add",this._toggle_close_button_text),null!=(r=this.$collab_input[0])&&r.observe("token:remove",this._toggle_close_button_text),null!=(o=this.$collab_input[0])?o.observe("sf:token:external",this._toggle_recipients_outside_team_warning):void 0},e.prototype._toggle_comment_option=function(){var e;return e=this.$custom_message_textarea.val().length,e>0?this.$comment_option_container.css("visibility","visible"):this.$comment_option_container.css("visibility","hidden")},e.prototype._add_message_checkbox_changed=function(e){return b.WebRequest({url:"/file_activity/set_share_modal_checkbox_preference",data:{fq_path:this.fq_path,checked:e.currentTarget.checked},subject_user:this.owner_id})},e.prototype._toggle_close_button_text=function(){var e,t;return t=0===(null!=(e=this.autocompleter)?e.token_manager.tokens.length:void 0),this.$cancel_button.text(t?zt("Close"):zt("Cancel"))},e.prototype._toggle_recipients_outside_team_warning=function(e){var t,n;return t=Se(".external-recipient-warning-message"),t.length?(n=e.memo.count,e.memo.shared_folder_warning?n>0?t.show():t.hide():n>1?(t.find(".external-recpient-num").text(n),t.removeClass("single").show()):1===n?t.addClass("single").show():t.hide()):void 0},e.prototype._toggle_send_link_button=function(){var e,t;return t=0===(null!=(e=this.autocompleter)?e.token_manager.tokens.length:void 0),t=t&&""===Se.trim(this.$collab_input.val()),this.$send_link_button.prop("disabled",t)},e.prototype._select_all_text=function(e){return Se(e.currentTarget)[0].select()},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),t=G.get_viewer().get_user_by_id(this.owner_id),an.show_shared_folder_options_modal(this.fq_path_of_restricting_sf,t)},e.prototype._show_shared_link_settings_modal=function(e){var t;return e.preventDefault(),t=new Zn(this.owner_id,this.tkey),Ot.push(t)},e.prototype._show_shared_link_remove_confirm_modal=function(e){var t;return e.preventDefault(),t=function(){return Ot.pop(),Se(document).trigger(s.LINKS_REMOVE)},Kn.confirm_remove(this.filename,this.tkey,this.is_dir,!1,!1,this.owner_id,!1,null,null,t)},e.prototype._send_link=function(){var e,t,n,i,r;return n=this.$content.find(".share-link-modal-send-form")[0],i=this.get_shmodel_send_recipients(n),r=function(){return function(){var e;return e=sn.success_string_for_recipients(i),k.success(e),Ot.pop(),to.log("shmodal_send")}}(this),t=function(){return function(){return ui.remove_loading()}}(this),e=this.$content.find(".tokenizer-submit-button")[0],ui.ajax_submit(n,"/sm/share",r,t,e)},e.prototype.get_shmodel_send_recipients=function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h;for(wt(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),c=[],h=[t,n,i,u],r=0,_=h.length;_>r;r++)for(s=h[r],a=0,l=s.length;l>a;a++)o=s[a],d=o.up().innerHTML.stripTags().escapeHTML(),c.push(d.substring(0,d.indexOf("&")));return c},e}(),Gn=INLINE_JS.QuickSend=ft.QuickSend={_files:{},_uploading_fileids:{},init:function(e,t,n){var i;return this.owner_id=e,this.tokenizer_ctx_str=t,this.keep_visible=n,this.$content=Se("#browse-root-quick-send"),this.$content[0].writeAttribute("dropzone","copy move"),this.$content[0].writeAttribute("quicksend","true"),this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),null!=(i=this.$collab_input)&&i.keyup(this._toggle_send_button_state),this.$collab_input[0]&&(this.$collab_input[0].on("token:remove",this._toggle_send_button_state),this.$collab_input[0].on("token:add",this._toggle_send_button_state)),this.$send_button=this.$content.find("#quick-send-submit"),this.$send_button.on("click",this._send_link),this.$cancel_button=this.$content.find("#quick-send-cancel"),this.$cancel_button.on("click",this._cancel_button_clicked),this.$import_services=this.$content.find(".autocomplete"),Se("#browse-files").addClass("quicksend-collapsed"),Gn._update_location(),this.has_autocompleter_inited=!1,rt.SharedFolderActivityLogger.log("web","quick_send_displayed",Ir.active_user,{}),this.$collab_input.on("blur",function(){return setTimeout(function(){var e;return null!=(e=Gn.$import_services)?e.hide():void 0},100)}),Se("#quick-send-top-choose-button-send").click(function(){return Se("#quick-send-file-box").click()}),Se("#quick-send-choose-button").click(function(){return Se("#quick-send-file-box").click()}),Se(".quick-send-choose-file-link").click(function(){return Se("#quick-send-file-box").click()}),Se("#quick-send-file-box").on("change",function(){var e,t;return t=Se("#quick-send-file-box")[0].files,e=function(){return Ir.active_user||(Ir.active_user=G.get_viewer().get_user_by_id(Gn.owner_id)),_i.upload(Gn.DEST_FOLDER+"/",t)},Gn.get_folder_name(e)}),document.on(si.COMPLETE_EVT,Gn._file_upload_completed),document.on(si.ERROR_EVT,Gn._file_upload_errored),document.on($e.UPDATE,Gn._update_location)},_cancel_button_clicked:function(){return rt.SharedFolderActivityLogger.log("web","quick_send_cancel_button_clicked",Ir.active_user,{}),Gn._reset()},_init_autocompleter:function(){var e;if(!Gn.has_autocompleter_inited)return Gn.has_autocompleter_inited=!0,e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:!1,user_id:Gn.owner_id,max_textbox_height:30,viewer:G.get_viewer(),include_from_linked_accounts:!0},Gn.autocompleter=new Autocompleter.ContactsTokenizer(G.get_viewer().get_user_by_id(Gn.owner_id),Gn.collab_input_id,Gn.tokenizer_ctx_str+"-new-whobulk",Gn.tokenizer_ctx_str+"-hidden-input",e)},_send_link:function(){var e,t,n,i,r,o,s,a,_;rt.SharedFolderActivityLogger.log("web","quick_send_send_button_clicked",Ir.active_user,{}),Gn.autocompleter.tokenize_emails_input(!0),a=Gn.autocompleter.getTokenCount(),i=Se(".quick-send-left-form")[0],r=[],s=0;for(n in Gn._files)s+=1,t=Gn._files[n],r.push(t.fq_path);return o={num_recipients:a,num_files:s},rt.SharedFolderActivityLogger.log("web","quick_send_send_attempted",Ir.active_user,o),_=function(){return function(){return Gn._reset(),Gn._toggle_top_area_view(),rt.SharedFolderActivityLogger.log("web","quick_send_send_succeeded",Ir.active_user,{})}}(this),e=function(){return function(){return rt.SharedFolderActivityLogger.log("web","quick_send_send_failed",Ir.active_user,{})}}(this),ui.ajax_submit(i,"/sm/quick_send",_,e,null,{fq_paths:r.join(",")})},_update_file_area_view:function(){return Object.keys(Gn._files).length?(Se("#quick-send-drop-area").hide(),Se("#quick-send-files-area").show()):(Se("#quick-send-drop-area").show(),Se("#quick-send-files-area").hide()),Gn._toggle_send_button_state()},_toggle_top_area_view:function(){return Se("#quick-send-top-part-send").hide(),Se("#quick-send-top-part-confirm").show(),setTimeout(function(){return Se("#quick-send-top-part-send").show(),Se("#quick-send-top-part-confirm").hide()},3e3)},_update_location:function(){var e;return e=Gn.keep_visible||!!Ir.inside_root_folder,Gn._toggle_quick_send_module(e)},_toggle_quick_send_module:function(e){var t,n;if(Gn._visible!==e)return n=Gn.$content,e?(Gn._visible=!0,n.show(),Gn._update_collapsed_state()):(Gn._visible=!1,n.hide(),n.removeClass("collapsed expanded"),t=Se("#browse-files"),t.removeClass("quicksend-collapsed quicksend-expanded"))},_update_collapsed_view:function(e){var t,n,i,r;return n=Gn.$content,r=e?"collapsed":"expanded",n.hasClass(r)?void 0:(i=e?"expanded":"collapsed",n.removeClass(i),n.addClass(r),t=Se("#browse-files"),r=e?"quicksend-collapsed":"quicksend-expanded",i=e?"quicksend-expanded":"quicksend-collpased",t.removeClass(i),t.addClass(r),e?void 0:Gn._init_autocompleter())},_update_collapsed_state:function(){var e;return e=Object.keys(Gn._files).length,Gn._update_collapsed_view(0===e)},_remove_file:function(e,t){var n;return n=!1,e in Gn._uploading_fileids&&(n=!0,document.fire(si.CANCEL_EVT,{file:t}),Se(document).trigger(si.CANCEL_EVT,{file:t}),delete Gn._uploading_fileids[e]),e in Gn._files?($(e).remove(),delete Gn._files[e],Gn._update_upload_list_scroll(),Gn._update_file_area_view(),Gn._update_collapsed_state()):void 0},_reset:function(){var e,t,n,i;Gn.autocompleter.clearTokens(),n=Se(".quick-send-left-form")[0],n.reset(),i=[];for(t in Gn._files)e=Gn._files[t],i.push(Gn._remove_file(t,e.file_obj));return i},_has_added_fq_path:function(e){var t,n;for(n in Gn._files)if(t=Gn._files[n],t.fq_path===e)return!0;return!1},_update_upload_list_scroll:function(){var e,t;return e=Object.keys(Gn._files).length,t=Se("#quick-send-upload-files-list"),3>e?t.removeClass("scroll"):(t.addClass("scroll"),t.scrollTop=t.scrollHeight)},_add_file:function(e,t){var n,i,r,o,s,a,l,u,d,c;return a={size:e.bytes,source:t},rt.SharedFolderActivityLogger.log("web","quick_send_file_added",Ir.active_user,a),i=e.dest||Gn.DEST_FOLDER,d=j.format_bytes(e.bytes||0),n=lt.tmpl("upload_list_item_tmpl"),r=n({file:e,icon:_t.file_icon(e.name),filename_snippet:_.em_snippet(e.name,ai.FILENAME_SNIPPET_LENGTH),size:d,dest:i,dest_snippet:_.em_snippet(zt("Dropbox")+i,ai.DEST_SNIPPET_LENGTH,0),Sprite:ee}),u=we.sanitize(r.toHTML()),Se("#quick-send-upload-files-list").append(u),o=Se("#"+e.id),Gn._update_upload_list_scroll(),o.find(".dest-col").hide(),o.find(".time-col").hide(),c=o.find(".status-col").find("a.small-x-button"),s=e.id,c.on("click",function(){return Gn._remove_file(s,e)}),l=o.find(".remove-link"),l.on("click",function(){return Gn._remove_file(s,e)}),o.on("mouseenter",function(){return function(){return o.find(".status-col").hide(),l.show()}}(this)),o.on("mouseleave",function(){return function(){return o.find(".status-col").show(),l.hide()}}(this)),Gn._files[e.id]={file_div:r,fq_path:e.fq_path,bytes:e.size,file_obj:e},Gn._update_file_area_view(),Gn._update_collapsed_state()},_toggle_send_button_state:function(){var e,t,n;return n=0===(null!=(e=Gn.autocompleter)?e.token_manager.tokens.length:void 0),n=n&&""===Gn.$collab_input.val(),t=0===Object.keys(Gn._files).length||Object.keys(Gn._uploading_fileids).length>0,Gn.$send_button.prop("disabled",n||t)},_file_upload_errored:function(e){var t,n;return t=e.memo.file,t.id in Gn._uploading_fileids?(n={message:e.memo.message},rt.SharedFolderActivityLogger.log("web","quick_send_file_errored",Ir.active_user,n),delete Gn._uploading_fileids[t.id]):void 0},_file_upload_completed:function(e){var t;return t=e.memo.file,t.id in Gn._uploading_fileids?(rt.SharedFolderActivityLogger.log("web","quick_send_file_uploaded",Ir.active_user,{}),delete Gn._uploading_fileids[t.id],Gn._toggle_send_button_state()):void 0},get_folder_name:function(e){var t,n;return Gn.DEST_FOLDER?void e():(n=function(t){var n;return n=JSON.parse(t),Gn.DEST_FOLDER=n.folder_name,e()},t=function(){return k.error(zt("We couldn’t upload your file. Please try again."))},b.WebRequest({url:"/share/quick_send_folder_name",data:{},subject_user:Gn.owner_id,success:n,error:t}))},is_quicksend_dest:function(e){var t;return t=_t.normalize(e),t===Gn.DEST_FOLDER},add_external_file:function(e){var t,n;return n=e.dest+e.name,Gn._has_added_fq_path(n)?(k.success(zt("You’ve already added this file.")),document.fire(si.CANCEL_EVT,{file:e}),void Se(document).trigger(si.CANCEL_EVT,{file:e})):(e.fq_path=n,e.bytes=e.size,Gn._uploading_fileids[e.id]=!0,Gn._add_file(e,"external"),t=Se("#"+e.id),t.find(".upload-progress-bar").css({width:"0"}))},add_dropbox_file:function(e){var t;return e.dir?void k.error(zt("Please select files instead of folders.")):Gn._has_added_fq_path(e.fq_path)?void k.success(zt("You’ve already added this file.")):(e.name=e.filename,Gn._add_file(e,"dropbox"),t=Se("#"+e.id),t.find(".upload-progress-bar").css({width:"100%"}),t.addClass("complete"),setTimeout(function(){var e;return e=t.find(".status-col"),e.empty(),e.append(ee.make("web","s_check"))},0))}};var Zn,ei,Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty,Tn=function(e,t){return function(){return e.apply(t,arguments)}};Zn=ft.SharedLinkSettingsModal=function(e){function t(e,n,i){var r;this.owner_id=e,this.tkey=n,this.dismiss_callback=i,r={tkey:this.tkey},r[O.UID_PARAM_NAME]=this.owner_id,t.__super__.constructor.call(this,{element_id:"shared-link-settings-modal",endpoint_url:"/sm/shared_link_settings",parameters:r}),this.dismiss_callback&&(this.on_hide=this.dismiss_callback)}return Sn(t,e),t}(ne),ei=ft.SharedLinkSettingsModalContent=function(){function e(e,t,n,i){var r,o,s;this.owner_id=e,this.tkey=t,this.filename=n,this.saved_password_placeholder_value=i,this._save_settings=Tn(this._save_settings,this),this._toggle_password_input=Tn(this._toggle_password_input,this),this._enable_password_input_for_editing=Tn(this._enable_password_input_for_editing,this),this._date_change_callback=Tn(this._date_change_callback,this),this._show_calendar=Tn(this._show_calendar,this),this._hide_calendar=Tn(this._hide_calendar,this),this._future_date=Tn(this._future_date,this),this._enable_save_button=Tn(this._enable_save_button,this),this._custom_expiry_click_handler=Tn(this._custom_expiry_click_handler,this),this._hide_custom_expiry_label=Tn(this._hide_custom_expiry_label,this),this._show_custom_expiry_label=Tn(this._show_custom_expiry_label,this),this._toggle_expiration=Tn(this._toggle_expiration,this),this._expiry_picker_callback=Tn(this._expiry_picker_callback,this),this._listen=Tn(this._listen,this),this._detect_and_handle_blur_when_password_empty=Tn(this._detect_and_handle_blur_when_password_empty,this),this._is_clicked=Tn(this._is_clicked,this),this._change_password_click=Tn(this._change_password_click,this),this._init_expiration_section=Tn(this._init_expiration_section,this),this.MS_PER_DAY=864e5,this.$content=Se(".sharing-settings-modal-content"),this.modal=Dt.get_containing_modal(this.$content),this.modal&&(o=_.em_snippet(this.filename,18),s=zt("Link permissions for '%(filename)s'").format({filename:o}),this.modal.set_title(s),this.$form=this.$content.find(".shared-link-settings-modal-form"),this.$save_button=this.$form.find(".confirm-button"),this.$password_field_container=this.$form.find(".password-field-container"),this.$password=this.$form.find(".link-password-container"),this.$password_input=this.$password.find("input[name='password']"),this.$password_label=this.$password.find("label"),this.$change_password=this.$form.find(".change-link-password-container"),this.$selected_expiry=this.$form.find(".selected-expiration"),this.$unselected_expiry=this.$form.find(".unselected-expiration"),this.$custom_expiry=this.$form.find(".custom-expiration"),this.$selected_date_box=this.$form.find(".selected-date"),this.$selected_date=this.$form.find(".selected-date-text"),this.$calendar=this.$form.find("#expiration-calendar-container"),this.$expiry_posix=this.$form.find("#expiration-posix"),this.$static_expiry=this.$form.find(".static-expiration"),this.loaded_with_saved_password="yes"===this.$password_input.data("is-saved-password"),this.loaded_with_saved_password&&this._show_password_input(r=!0),this._init_expiration_section(),this._listen())}return e.prototype._init_expiration_section=function(){var e;return this.$form.find(".expiration-selection").show(),this.$expiry_posix.val()?(Se("#expiration-yes").prop("checked",!0),e=this._posix_time_to_date(parseInt(this.$expiry_posix.val())),this._set_selected_date_text(e),this._show_custom_expiry_label()):(this.$selected_expiry.hide(),this._hide_custom_expiry_label(),this.$unselected_expiry.show())},e.prototype._change_password_click=function(e){return e.preventDefault(),this._enable_password_input_for_editing()},e.prototype._is_clicked=function(e,t){return e.is(t.target)||e.has(t.target).length},e.prototype._detect_and_handle_blur_when_password_empty=function(e){return!this.$password.is(":visible")||this.$password_input.val()||this._is_clicked(this.$password_field_container,e)?void 0:this._show_password_input(!0)},e.prototype._listen=function(){return this.loaded_with_saved_password&&(Se(window).on("click",this._detect_and_handle_blur_when_password_empty),this.$change_password.find(".change-link-password").on("click",this._change_password_click)),this.$form.on("change",this._enable_save_button),this.$form.on("submit",this._save_settings),this.$save_button.on("click",this._save_settings),this.$content.find(".cancel-button").on("click",function(){return function(){return Ot.pop()}}(this)),this.$content.find(".audience-selection input[type=radio]").on("change",this._toggle_password_input),this.$content.find(".expiration-selection input[type=radio]").on("change",this._toggle_expiration),Se(window).on(Te.CHANGED,this._expiry_picker_callback)},e.prototype._expiry_picker_callback=function(e,t){var n,i;if(t.clicked_val!==t.old_val)return n=t.clicked_val,"custom"!==n?(i=this._future_date(parseInt(n)),this._set_expiration(i)):(this.$selected_expiry.hide(),this._show_custom_expiry_label(),this._set_selected_date_text(this._future_date(30)),this._show_calendar())},e.prototype._toggle_expiration=function(e){var t,n;return"expiration-yes"===Se(e.currentTarget).attr("id")?(this.$selected_expiry.show(),this._hide_custom_expiry_label(),this.$unselected_expiry.hide(),Q.get_controller(Se(".expiration-picker")).set_value(30),n=30,t=this._future_date(n),this._set_expiration(t),this._set_selected_date_text(t)):(this.$expiry_posix.val(""),this.$unselected_expiry.show(),this.$selected_expiry.hide(),this.$static_expiry.hide(),this._hide_custom_expiry_label(),this._hide_calendar())},e.prototype._show_custom_expiry_label=function(){return this.$custom_expiry.show(),this.$selected_expiry.hide(),this.$unselected_expiry.hide(),Se(window).on("click",this._custom_expiry_click_handler)},e.prototype._hide_custom_expiry_label=function(){return this.$custom_expiry.hide(),Se(window).off("click",this._custom_expiry_click_handler)},e.prototype._custom_expiry_click_handler=function(e){return this._is_clicked(this.$calendar,e)?void 0:this.$selected_date_box.is(e.target)||this.$selected_date_box.has(e.target).length?this.$calendar.is(":visible")?this.$calendar.hide():this._show_calendar():this.$calendar.is(":visible")?this.$calendar.hide():void 0},e.prototype._enable_save_button=function(){return this.$save_button.removeAttr("disabled")},e.prototype._future_date=function(e){var t;return t=Zt.start_of_day(new Date),t.setDate(t.getDate()+e),t},e.prototype._hide_calendar=function(){return this.$calendar.hide()},e.prototype._show_calendar=function(){var e,t,n;return Se(".selected-date").off("click"),this.calendar?this.$calendar.show():(n=this.$expiry_posix.val()?this._posix_time_to_date(parseInt(this.$expiry_posix.val())):this._future_date(30),t={disable_past:!0,first_day:this._future_date(1),last_day:this._future_date(365),selected_date:n,onDateChange:Se.proxy(this._date_change_callback,this)},this.calendar=new Ei("expiration-calendar-container",t)),e=this.$selected_date_box.offset().left,this.$calendar.show().offset({left:e})},e.prototype._posix_time_to_date=function(e){return new Date(1e3*e)},e.prototype._set_selected_date_text=function(e){return this.$selected_date.text(Br.localize(e))},e.prototype._set_expiration=function(e){var t,n;return wt(0===e.getMilliseconds()),wt(0===e.getSeconds()),wt(0===e.getMinutes()),wt(0===e.getHours()),n=(e.getTime()+this.MS_PER_DAY)/1e3,t=n-1,this.$expiry_posix.val(t)},e.prototype._date_change_callback=function(e){return this._set_selected_date_text(e),this._set_expiration(e),this._enable_save_button(),this._hide_calendar()},e.prototype._show_password_input=function(e){var t,n,i,r,o;return null==e&&(e=!1),t=this.$content.find("label[for=audience-password]").position().left,r=this.$content.find("#audience-password").position().left,n=t-r+10,this.$password.show().css({left:n}),this.$password_input.val(""),e?(this.$password_input.addClass("disabled").attr("readonly","true"),this.$password_input.data("is-saved-password","yes"),o="●●●●●●●●",this.$password_label.text(o).show(),i=this.$password.position(),this.$change_password.css({left:i.left,top:i.top}).show()):this._enable_password_input_for_editing()},e.prototype._enable_password_input_for_editing=function(){return this.$change_password.hide(),this.$password_input.removeAttr("readonly").removeClass("disabled"),this.$password_input.data("is-saved-password","no"),this.$password_label.text(zt("Set password")).show(),this.$password_input.focus(),this._enable_save_button()},e.prototype._toggle_password_input=function(e){var t;return"audience-password"===Se(e.currentTarget).attr("id")?this._show_password_input(t=this.loaded_with_saved_password):(this.$password.hide(),this.$change_password.hide(),this.$password_input.data("is-saved-password","no"))},e.prototype._save_settings=function(){var e,t,n,i;return"yes"===this.$password_input.data("is-saved-password")&&(n={type:"hidden",name:"password",value:this.saved_password_placeholder_value},e=Se("<input />",n),this.$form.append(e),this.$password_input.attr("name","inoperative_password")),i=function(){return function(){return Ot.pop(),k.success(zt("Settings saved."))}}(this),t=function(e){return function(){return e.$password.length&&e.$password.is(":visible")&&e.$password_input.focus(),ui.remove_loading()}}(this),ui.ajax_submit(this.$form[0],"/sm/change_shared_link_settings",i,t,this.$save_button[0])},e}();var ti;ti=ft.SimpleSharing=function(){function e(){}var t,n,i,r,o,s,a,_;return e.createAndShowMemberListModalFromBrowseFile=function(t,n){return e.createAndShowMemberListModal(t,n.fq_path,n.dir,n.target_ns,n.is_shared_folder(),n.could_be_shared_folder(),parseInt(n.sf_perm_role))},e.createAndShowInbandModalFromBrowseFile=function(t,n){return e.createAndShowInbandModal(t,n.fq_path,n.dir,n.target_ns,n.is_shared_folder(),n.could_be_shared_folder(),parseInt(n.sf_perm_role))},e.createAndShowInbandModalFromFile=function(t,n){return e.createAndShowInbandModal(t,n.fq_path,!1,n.ns_id,!1,!1,I.NameSpaceAccess.ACCESS_READER)},e.createAndShowM2InbandModal=function(e,t){var n,i;return i=function(e,t,n){return Ot.push(new Zn(e,t,n))},n=function(e){var t;return t=new un(Ir.active_user,e),t.show()},g.showInstance(g({needsFetchingTokenInfo:!0,user:e,fqPath:t,isDir:!0,canReaderSync:!1,isSharedFolder:!0,couldBeSharedFolder:!1,canEdit:!0,editableLinksM2Enabled:!0,showSharedLinkSettingsModal:i,onGoBackButtonClicked:n}))},t=function(e,t,n,i){return window.INLINE_JS.DBModalStack.push(new cn(e,t,n,i))},n=function(e,t,n,i,r){return window.INLINE_JS.DBModalStack.push(new Ln(e,t,n,i,r))},i=function(e,t,n){return window.INLINE_JS.DBModalStack.push(new un(e,t,!1,!1,n))},_=function(e,t,n){return window.INLINE_JS.DBModalStack.push(new xn(e,{element_id:"unshare-confirm-modal",team_shared_folder:!1,ns_id:n,folder_path:t}))},o=function(e,t,n,i,r){return window.INLINE_JS.DBModalStack.push(new gn(e,{element_id:"kick-confirm-modal",ns_id:n,user_name:r,folder_path:t,user_id:i}))},r=function(e,t,n,i,r){return window.INLINE_JS.DBModalStack.push(new vn(e,{element_id:"kick-group-confirm-modal",ns_id:n,group_name:r,folder_path:t,group_id:i}))},a=function(e,t,n,i,r){return window.INLINE_JS.DBModalStack.push(new En(e,{element_id:"uninvite-confirm-modal",email_or_fbname:r,ns_id:n,invite_id:i,folder_path:t}))},s=function(e,t,n){return Ot.push(new wn(e,{element_id:"leave-confirm-modal",ns_id:n,folder_path:t}))},e.createAndShowMemberListModal=function(e,l,u,d,c,h,f){return Mt.createAndShowModal(e,l,{show_dfb_existing_folder_settings_modal:t,show_dfb_new_folder_settings_modal:n,show_folder_members_modal:i,show_unshare_folder_modal:_,show_kick_user_modal:o,show_kick_group_modal:r,show_uninvite_modal:a,show_leave_folder_modal:s},Boolean(u),d,c,h,parseInt(f),Ir.simple_sharing_react_member_list_enabled)},e.createAndShowInbandModal=function(e,l,u,d,c,h,f){return Pt.createAndShowModal(e,l,{show_dfb_existing_folder_settings_modal:t,show_dfb_new_folder_settings_modal:n,show_folder_members_modal:i,show_unshare_folder_modal:_,show_kick_user_modal:o,show_kick_group_modal:r,show_uninvite_modal:a,show_leave_folder_modal:s},Boolean(u),d,c,h,parseInt(f),Ir.simple_sharing_react_member_list_enabled)},e}();var ni,ii,ri,oi,si,ai,_i,Yn=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};si=INLINE_JS.Upload=ft.Upload={QUEUE_EVT:"db:upload:queue",QUEUE_ERROR_EVT:"db:upload:queue_error",UPDATE_EVT:"db:upload:update",COMPLETE_EVT:"db:upload:complete",ERROR_EVT:"db:upload:error",CANCEL_EVT:"db:upload:cancel",CHOOSE_FILE_BASIC:"db:upload:choose_file_basic",APPLE_PACKAGE_EXTENSIONS:["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],
APPLE_PACKAGE_ERROR:-54321,current_dest:"",runtimes:function(){var e,t,n,i;n={"MSIE 8.0":"flash","MSIE 9.0":"flash"},t="html5";for(e in n)i=n[e],-1!==navigator.userAgent.indexOf(e)&&(t=i);return t}(),set_dest:function(e){return tn.fillVal(e,"dest-folder"),this.current_dest=e},init:function(e,t,n,i){var r;return this.set_dest(e),r=this.initPLU(n,i),t?r():B.window_load(r),Se("#flash-upload-container > .moxie-shim").each(function(e){return e.observe?(Zt.freshbutton_overlay(e,$("choose-button")),Zt.freshbutton_overlay(e,$("add-button"))):void 0}),ii.clear()},init_basic:function(){return Zt.freshbutton_overlay($("file-box"),$("basic-choose-button")),$("file-box").observe("click",function(){return document.fire(si.CHOOSE_FILE_BASIC)}),$("basic-choose-button").observe("mousemove",function(e){var t,n,i;return t=$("modal").cumulativeOffset(),i=e.clientY-t.top-3,n=e.clientX-t.left-$("file-box").getWidth()+3,$("file-box").setStyle({top:i+"px",left:n+"px"})}),$("file-box").observe("change",function(){var e,t,n,i,r,o;return mi.hide=function(){},$("modal-x").hide(),$("basic-upload-desc").hide(),$("basic-upload-buttons").hide(),$("file-box").hide(),t=$("file-box").getValue().split("\\").pop(),i=ee.make("web",_t.file_icon(t)),$("basic-upload-status").down(".icon").__date(i),e=zt("Uploading %(filename)s").format({filename:_.em_snippet(t,25)}),$("basic-upload-status").down(".file-desc").__date(e),$("basic-upload-status").show(),$("basic-uploading-message").show(),n=$("file-box").files,o=0,n&&(r=n[0].lastModifiedDate,r&&(o=Math.round(Date.parse(r)/1e3)||0)),o||(o=Math.round(Date.parse(new Date)/1e3)),$("mtime-utc").value=o,$("basic-upload-form").submit()})},initPLU:function(e,t){return function(n){return function(){var i,r;return i={url:"https://"+Ee.BLOCK_CLUSTER+"/chunked_upload",file_data_name:"file",runtimes:n.runtimes,multipart_params:{},multipart:!1,max_file_size:"10000mb",chunk_size:"8mb",max_retries:2,browse_button:"choose-button",container:"flash-upload-container",preinit:{PostInit:function(){return e&&e(),n.uploaderLoaded()},Error:n.uploadError.bind(n)},init:{FilesAdded:n.fileQueued.bind(n),UploadProgress:n.uploadProgress.bind(n),FileUploaded:n.uploadSuccess.bind(n),BeforeUpload:n.prepareFileForUploading.bind(n),ChunkUploaded:n.chunkUploaded.bind(n),UploadComplete:ii.finished.bind(ii),Refresh:function(){return"flash"===n.PLU.runtime&&$("upload-running-buttons").visible()?(je.clone_position(Se("#flash-upload-container"),Se("#add-button")),Se("#flash-upload-container > .moxie-shim")[0].style.width="100%",Se("#flash-upload-container > .moxie-shim")[0].style.height="100%"):void 0}},flash_swf_url:ut.UrlConstants.MOXIE_SWF_URL},null!=t&&Se.extend(i,t),r=new Y.Uploader(i),n.PLU=r,n.PLU.init()}}(this)},reset:function(){return ii.uploading&&ii.current_file&&this.PLU.removeFile(ii.current_file),ri.hide()},show_upload:function(){return $("upload-desc").hide(),$("dnd-upload-desc").hide(),$("upload-files-list").show(),$("upload-start-buttons").hide(),$("upload-running-buttons").show(),$("hide-button").show(),$("done-button").hide(),$("modal-overlay").visible()?void 0:ri.show()},updatePostParams:function(e){var t,n;n=this.PLU.settings.multipart_params;for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return this.PLU.settings.multipart_params=n},fileQueued:function(e,t){var n,i,r,o;for(i=0,r=t.length;r>i;i++)n=t[i],n.dest=void 0===("function"==typeof n.getNative&&null!=(o=n.getNative())?o.dest:void 0)?si.current_dest:n.getNative().dest;return document.fire(this.QUEUE_EVT,{files:t}),Se(document).trigger(this.QUEUE_EVT,{files:t}),Gn.is_quicksend_dest(n.dest)?void 0:this.show_upload()},uploadNext:function(){var e,t,n,i,r,o;return i=ii.next(),(n=w.contains(si.APPLE_PACKAGE_EXTENSIONS,_t.file_extension_for_logging(i.name))&&i.size%34===0||""===_t.file_extension_for_logging(i.name)&&i.size%34===0&&i.size<=3400)?(i.status=Y.FAILED,t={file:i,code:si.APPLE_PACKAGE_ERROR,message:zt("Can’t Upload"),tooltip_text:zt('To upload a package file via the web, try zipping it first, or <a href="https://www.dropbox.com/help/6691" target="_blank">learn more</a>.'),response:"",responseHeaders:"",status:400},this.uploadError(this.PLU,t),!1):(r={dest:ii.next().dest,t:Ye.read(qe.JS_CSRF_COOKIE)},r[O.UID_PARAM_NAME]=Ir.active_user,("url"===(o=_t.file_extension(i.name,e=!0))||"webloc"===o||"website"===o)&&(r.overwrite=0),si.updatePostParams(r),this.PLU.start(),ii.last_update_time=0,ii.last_update_size=0,!0)},pause:function(){return si.PLU.stop()},uploadProgress:function(e,t){return ii.cancelled_files[t.id]?void 0:(document.fire(this.UPDATE_EVT,{file:t,percent_complete:t.loaded/t.size}),Se(document).trigger(this.UPDATE_EVT,{file:t,percent_complete:t.loaded/t.size}))},generateUploadId:function(){var e,t,n,r;for(e="",t=n=0;15>=n;t=++n)e+=String.fromCharCode(Math.floor(256*Math.random()));return r=i.encode(e),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r=r.replace(/\=*$/,"")},chunkUploaded:function(e,t,n){var i;return i=JSON.parse(n.response||""),this.updatePostParams({offset:i.offset})},prepareFileForUploading:function(){var e;return e=ii.next(),this.updatePostParams({reported_total_size:e.size,dest:e.dest,t:Ye.read(qe.JS_CSRF_COOKIE),upload_id:this.generateUploadId(),offset:0})},uploadSuccess:function(e,t,n){var i,r,o;try{o=JSON.parse(n.response)}catch(e){i=e,o=null}return"{'error': 'quota'}"===n.response?(document.fire(this.ERROR_EVT,{file:t,message:zt("Quota exceeded"),tooltip_text:zt("Your upload failed because you are over quota.")}),Se(document).trigger(this.ERROR_EVT,{file:t,message:zt("Quota exceeded"),tooltip_text:zt("Your upload failed because you are over quota.")})):"{'error': 'empty'}"===n.response?(document.fire(this.CANCEL_EVT,{file:t,message:zt("Empty File")}),Se(document).trigger(this.CANCEL_EVT,{file:t,message:zt("Empty File")})):"{'error': 'ignored'}"===n.response?(document.fire(this.CANCEL_EVT,{file:t,message:zt("File Ignored")}),Se(document).trigger(this.CANCEL_EVT,{file:t,message:zt("File Ignored")})):"complete"===(null!=o?o.status:void 0)?(document.fire(this.COMPLETE_EVT,{file:t}),Se(document).trigger(this.COMPLETE_EVT,{file:t})):(document.fire(this.ERROR_EVT,{file:t}),Se(document).trigger(this.ERROR_EVT,{file:t}))},uploadComplete:function(e,t){return document.fire(this.COMPLETE_EVT,{file:t}),Se(document).trigger(this.COMPLETE_EVT,{file:t})},uploadError:function(e,t){var n,i,r;return r=t.file.id,Yn.call(ii.file_ids(),r)<0&&t.code!==si.APPLE_PACKAGE_ERROR&&(document.fire(this.QUEUE_EVT,{files:[t.file]}),Se(document).trigger(this.QUEUE_EVT,{files:[t.file]})),i=function(){switch(t.code){case Y.FILE_SIZE_ERROR:return zt("File too large");default:return zt("Upload Error")}}(),this.show_upload(),n={file:t.file,error_code:t.code,message:i},(null!=t?t.tooltip_text:void 0)&&(n.tooltip_text=t.tooltip_text),document.fire(this.ERROR_EVT,n),Se(document).trigger(this.ERROR_EVT,n)},grabURL:function(){var e;return e=$F("file-box"),/(^http|^https|^ftp):\/\//.match(e)&&($("url").value=e),!0},treeview_handler:function(e){var t;return tn.fillVal(e,"dest-folder"),t=$("basic-uploader-url"),t&&(t.href=t.href.replace(/(\/upload)(.*)(\?basic=1)/,function(t,n,i,r){return n+Zt.urlquote(e)+r})),ii.clear()},new_folder:function(){return yi.hide(),mi.show(zt("Create new folder..."),tn.fromElm("create-folder"),{action:this.do_new_folder.bind(this,Ir.active_user),wit_group:"new-folder-confirm"}),Zt.ie?void 0:Se("#first-treeview-link").trigger("click")},do_new_folder:function(e){var t,n;return mi.vars.selected_path?(n=$F("entered-name"),t=mi.vars.selected_path,new Ajax.DBRequest("/cmd/new"+Zt.urlquote(t)+"?to_path="+Zt.urlquote(n),{subject_user:e,onSuccess:function(e){return function(){return e.treeview_handler(_t.normalize(t)+"/"+n),yi.schedule_reset()}}(this),cleanUp:function(){}})):void k.error(zt("Please select a parent folder."))},uploaderLoaded:function(){return $("upload-loading").hide(),$("choose-button").show(),"flash"===si.PLU.runtime?(je.clone_position(Se("#flash-upload-container"),Se("#choose-button")),Se("#flash-upload-container > .moxie-shim")[0].style.top="0px",Se("#flash-upload-container > .moxie-shim")[0].style.left="0px",Se("#flash-upload-container > .moxie-shim")[0].style.width="100%",Se("#flash-upload-container > .moxie-shim")[0].style.height="100%"):(Se("#choose-button").click(function(e){return function(){return Se("#"+e.PLU.id+"_html5").click()}}(this)),Se("#add-button").click(function(){return function(){return Se("#choose-button").click()}}(this)))}},ii=ft.FileQueue={init:function(){return ii._listen()},_listen:function(){return document.observe(si.QUEUE_EVT,ii._file_queued.bind(this)),document.observe(si.QUEUE_ERROR_EVT,ii._file_queue_errored.bind(this)),document.observe(si.UPDATE_EVT,ii._file_updated.bind(this)),document.observe(si.COMPLETE_EVT,ii._file_completed.bind(this)),document.observe(si.ERROR_EVT,ii._file_errored.bind(this)),document.observe(si.CANCEL_EVT,ii._file_cancelled.bind(this))},_file_queued:function(e){var t,n,i,r,o;for(r=e.memo.files,o=[],n=0,i=r.length;i>n;n++)t=r[n],this.files[t.id]=t,ii.uploading||this._start_uploading(),this.current_file=t,o.push(Gt("File queued:",t.name));return o},_file_queue_errored:function(e){return this._file_queued(e),setTimeout(function(t){return function(){return t._file_errored(e)}}(this),250)},_file_updated:function(e){var t,n,i,r,o,s,a,_,l;return r=e.memo.file,s=e.memo.percent_complete,o=s*r.size,l=o+this.completed_size(),i=(new Date).getTime(),this.last_update_time&&(a=(i-this.last_update_time)/1e3,si.PLU.total.bytesPerSec?this.average_bps=si.PLU.total.bytesPerSec:(n=o-this.last_update_size,t=n/a,this.average_bps=((l-n)*this.average_bps+n*t)/l),_=(this.queue_size()-l)/this.average_bps,this.formatted_time=ae.format_time(_+this.num_left())),this.current_file=r,this.last_update_time=(new Date).getTime(),this.last_update_size=o},_file_completed:function(e){var t;return t=e.memo.file,this.completed_files[t.id]=!0,Gt("File completed:",t.name),this._check_if_finished(t)},_file_errored:function(e){var t;return t=e.memo.file,this.errored_files[t.id]=!0,ni.update_errors(),ri.update_errors(),Gt("File errored:",t.name),this._check_if_finished(t)},_file_cancelled:function(e){var t;return t=e.memo.file,this.cancelled_files[t.id]=!0,t.status===Y.UPLOADING?(si.PLU.stop(),si.PLU.removeFile(t),si.PLU.start()):si.PLU.removeFile(t),Gt("File cancelled:",t.name),this._check_if_finished(t)},_start_uploading:function(){var e;return this.uploading=si.uploadNext(),this.uploading?(this.all_cancelled=!1,window.onbeforeunload=e=function(){return function(){return zt("Leaving this page will cancel your uploads.")}}(this)):void 0},finished:function(){return this._finished_uploading()},_check_if_finished:function(){return this.empty()?this.uploading?this._finished_uploading():void 0:si.uploadNext()},_finished_uploading:function(){var e,t,n,i;if(this.uploading=!1,this.num_files()?this.errors()?(ni.errored(),ri.errored()):(ni.completed(),ri.completed()):ni.cancelled(),i=$("inline-upload-status").visible(),Ir.select_fq_paths=[],Ir.inside_dir){for(n in this.completed_files)t=this.files[n],e=_t.normalize(t.dest),Ir.select_fq_paths.push(e+"/"+t.name);Ir.force_reload()}else Ir.in_search_mode()&&hr.force_reload();return i&&ri.show(),mi.onHide=null,window.onbeforeunload=null},empty:function(){return!this.num_left()},num_files:function(){return this.file_ids().length},num_non_cancelled_files:function(){return this.file_ids().length-this.cancels()},next:function(){return w(this.files).filter(function(e){return function(t){return!(e.cancelled_files[t.id]||e.errored_files[t.id]||e.completed_files[t.id])}}(this))[0]},cancels:function(){return w(this.cancelled_files).keys().length},errors:function(){return w(this.errored_files).keys().length},queue_size:function(){var e,t,n,i,r,o;for(o=0,r=this.file_ids(),n=0,i=r.length;i>n;n++)t=r[n],e=this.files[t],this.errored_files[t]||this.cancelled_files[t]||"undefined"==typeof e.size||(o+=e.size);return o},completed_size:function(){var e,t,n,i,r;for(r=0,i=w(this.completed_files).keys(),t=0,n=i.length;n>t;t++)e=i[t],"undefined"!=typeof this.files[e].size&&(r+=this.files[e].size);return r},file_ids:function(){return w(this.files).map(function(){return function(e,t){return t}}(this))},totalPercentage:function(){return this.completed_size()/this.queue_size()},num_left:function(){return w(this.file_ids()).filter(function(e){return function(t){return!(e.cancelled_files[t]||e.errored_files[t]||e.completed_files[t])}}(this)).length},clear:function(){return this.files={},this.cancelled_files={},this.all_cancelled=!1,this.errored_files={},this.completed_files={},this.last_update_time=0,this.last_update_size=0,this.average_bps=0,this.formatted_time="",this.uploading=!1,window.onbeforeunload=null,"undefined"!=typeof mi&&null!==mi?mi.onHide=null:void 0}},ii.clear(),ai=ft.UploadFile={FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_tmpl:null,init:function(){return ai._tmpl=lt.tmpl("upload_list_item_tmpl"),ai._listen()},_listen:function(){return document.observe(si.QUEUE_EVT,ai._file_queued),document.observe(si.QUEUE_ERROR_EVT,ai._file_queue_errored),document.observe(si.UPDATE_EVT,ai._file_updated),document.observe(si.COMPLETE_EVT,ai._file_completed),document.observe(si.ERROR_EVT,ai._file_errored),document.observe(si.CANCEL_EVT,ai._file_cancelled)},_file_queued:function(e){var t,n,i,r,o;for(r=e.memo.files,o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(function(e){var t,n,i,r,o,s,a,l;return t=e.dest,Gn.is_quicksend_dest(t)?void Gn.add_external_file(e):(s=j.format_bytes(e.size||0),n=ai._tmpl({file:e,icon:_t.file_icon(e.name),filename_snippet:_.em_snippet(e.name,ai.FILENAME_SNIPPET_LENGTH),size:s,dest:t,dest_snippet:_.em_snippet(zt("Dropbox")+t,ai.DEST_SNIPPET_LENGTH,0),Sprite:ee}),$("upload-files-list").__sert(n),r=$(e.id),o=ii.num_files(),Un.show_share_button_in_file_uploader&&(i=Se("#"+e.id),i.find(".dest-col").hide()),a=$("upload-files-list"),6>=o?a.removeClassName("scroll"):a.addClassName("scroll"),a.scrollTop=a.scrollHeight,r.down(".dest").observe("click",function(){return Ir.reload_fqpath(r.readAttribute("data-dest"),!0),mi.hide()}),l=r.down(".status-col").down("a.small-x-button"),l.stopObserving("click"),l.observe("click",function(){return document.fire(si.CANCEL_EVT,{file:e}),Se(document).trigger(si.CANCEL_EVT,{file:e})}),r.down(".upload-progress-bar").setStyle({width:"0"}))}(t));return o},_file_queue_errored:function(e){return ai._file_queued(e),ai._file_errored(e)},_file_updated:function(e){var t,n,i,r;return t=e.memo.file,n=$(t.id),1===ii.num_files()&&(r=zt("%(time_left)s left").format({time_left:ii.formatted_time}),n.down(".time-col").__date(r)),i=parseInt(t.percent,10)+"%","100%"===i&&(n.down(".time-col").__date(),n.down(".status-col").__date(new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}))),n.down(".upload-progress-bar").setStyle({width:i})},_file_completed:function(e){var t,n,i;return t=e.memo.file,t.completed=!0,i=$(t.id),i.addClassName("complete"),Un.show_share_button_in_file_uploader&&!Gn.is_quicksend_dest(t.dest)&&(n=Se("#"+t.id),n.find(".share-link").show(),rt.SharedFolderActivityLogger.log("web","share_button_in_uploader_impression",Ir.active_user,{}),n.on("click",function(){var e,n;return mi.hide(),rt.SharedFolderActivityLogger.log("web","share_button_in_uploader_click",Ir.active_user,{}),e=t.dest+"/"+t.name,n="file_uploader",Un.shmodel(e,n)})),setTimeout(function(){return i.down(".status-col").__date(ee.make("web","s_check"))},0),i.down(".upload-progress-bar").setStyle({width:"100%"})},_file_errored:function(e){var t,n;return t=e.memo.file,n=$(t.id),n?ai._actual_file_errored(e):setTimeout(function(){return function(){return ai._actual_file_errored(e)}}(this),0)},_actual_file_errored:function(e){var t,n,i,r,o;return i=e.memo.file,r=$(i.id),r.addClassName("error"),r.down(".dest-col").hide(),r.down(".time-col").__date(),r.down(".status-col").__date(Element("img",{src:"/static/images/nosync-vfl18cuTS.png",srcset:"/static/images/nosync@2x.png 2x"})),r.down(".upload-progress-bar").setStyle({width:"100%"}),Gn.is_quicksend_dest(i.dest)?void 0:(n=e.memo.message||zt("Upload Error"),t=void 0,e.memo.tooltip_text?t=e.memo.tooltip_text:(t=zt('Something went wrong with the advanced uploader. If the problem persists, please use the <a id="basic_link">basic uploader</a> to upload via the website.'),Se(document).on("click","a#basic_link",function(){return li.show_basic_upload(),!1})),r.down(".error-msg").__date(n),o=r.down(".error-details"),o.observe("mouseover",function(){return bi.show(o,t)}),r.down(".error-col").show())},_file_cancelled:function(e){var t,n;return t=e.memo.file,n=$(t.id),n.addClassName("cancelled"),n.down(".dest-col").__date(zt(e.memo.message||"Canceled")),n.down(".time-col").__date(),n.down(".status-col").__date(Element("img",{src:"/static/images/cancelsync-vflGFIEUK.png",srcset:"/static/images/cancelsync@2x.png 2x"})),n.down(".upload-progress-bar").setStyle({width:"100%"})}},ni=ft.BulkUpload={init:function(){return this.elem=$("bulk-upload-status"),ni._listen()},_listen:function(){return document.observe(si.QUEUE_EVT,ni._file_queued.bind(this)),document.observe(si.UPDATE_EVT,ni._file_updated.bind(this))},_file_queued:function(){var e;return e=new Element("a",{class:"small-x-button"}),e.observe("click",function(){var e,t,n,i,r;for(ii.all_cancelled=!0,e=ii.file_ids().slice(0),r=[],n=0,i=e.length;i>n;n++)t=e[n],ii.completed_files[t]||ii.errored_files[t]?r.push(void 0):(document.fire(si.CANCEL_EVT,{file:ii.files[t]}),r.push(Se(document).trigger(si.CANCEL_EVT,{file:ii.files[t]})));return r}),this.elem.down(".status").__date(e)},_file_updated:function(){var e,t,n;return ii.num_files()>1&&(this.elem.removeClassName("error"),this.elem.removeClassName("complete"),this.elem.removeClassName("cancelled"),e=Bt("%d file","%d files",ii.num_non_cancelled_files()).format(ii.num_non_cancelled_files()),this.elem.down(".num-files").__date(e),t=zt("- %(size)s").format({size:j.format_bytes(si.PLU.total.size)}),this.elem.down(".size").__date(t),ii.formatted_time&&(n=zt("%(time_left)s left").format({time_left:ii.formatted_time}),this.elem.down(".time-left").__date(n)),this.elem.down(".upload-progress-bar").style.width=Math.min(100,(100*ii.totalPercentage()||0).toFixed(2))+"%",this.elem.show(),"flash"===si.PLU.runtime)?je.clone_position(Se("#flash-upload-container"),Se("#add-button")):void 0},update_errors:function(){var e;return e=Bt("- %d error","- %d errors",ii.errors()).format(ii.errors()),$("bulk-upload-status").down(".num-errors").__date(e)},completed:function(){var e,t;return $("hide-button").hide(),$("done-button").show(),ii.num_files()>1?(this.elem.addClassName("complete"),e=Bt("Uploaded %d file","Uploaded %d files",ii.num_non_cancelled_files()).format(ii.num_non_cancelled_files()),this.elem.down(".num-files").__date(e),t=zt("- %(size)s").format({size:j.format_bytes(ii.completed_size())}),this.elem.down(".size").__date(t),this.elem.down(".num-errors").__date(),this.elem.down(".time-left").__date(),this.elem.down(".status").__date(ee.make("web","s_check")),this.elem.down(".upload-progress-bar").style.width="100%"):void 0},errored:function(){var e;return $("hide-button").hide(),$("done-button").show(),this.completed(),e=Bt("- %d error","- %d errors",ii.errors()).format(ii.errors()),this.elem.down(".num-errors").__date(e)},cancelled:function(){return $("hide-button").hide(),$("done-button").show(),ii.num_files()>1?(this.elem.addClassName("cancelled"),this.elem.down(".num-files").__date(zt("All uploads canceled")),this.elem.down(".size").__date(),this.elem.down(".num-errors").__date(),this.elem.down(".time-left").__date(),this.elem.down(".status").__date(Element("img",{src:"/static/images/cancelsync-vflGFIEUK.png",srcset:"/static/images/cancelsync@2x.png 2x"})),this.elem.down(".upload-progress-bar").style.width="100%"):void 0}},ri=ft.InlineUploadStatus={FILENAME_SNIPPET_LENGTH:30,init:function(){return this._listen()},_listen:function(){return document.observe(si.QUEUE_EVT,ri._file_queued.bind(this)),document.observe(si.UPDATE_EVT,ri._file_updated.bind(this))},_file_queued:function(){var e,t;return e=$("inline-upload-status"),e.removeClassName("error"),e.removeClassName("complete"),e.down(".icon").__date(ee.make("web","s_sync")),e.down(".file-desc").__date(zt("Starting upload...")),e.down(".num-errors").__date(),t=Bt("%d file","%d files",ii.num_left()).format(ii.num_left()),e.down(".view-details").__date(t),e.down(".status").__date(),e.down(".inline-upload-progress").style.width="0%"},_file_updated:function(e){var t,n,i,r,o,s;return t=$("inline-upload-status"),n=e.memo.file,t.down(".icon").__date(ee.make("web","s_sync")),i=zt("Uploading %(filename)s").format({filename:_.em_snippet(n.name,this.FILENAME_SNIPPET_LENGTH)}),t.down(".file-desc").__date(i),ii.num_left()>1?(s=Bt("%d file left","%d files left",ii.num_left()-1).format(ii.num_left()-1),t.down(".view-details").__date(s)):t.down(".view-details").__date(zt("View details")),ii.formatted_time&&(o=zt("%(time_left)s left").format({time_left:ii.formatted_time}),t.down(".status").__date(o)),r=n.percent+"%",t.down(".inline-upload-progress").style.width=r},update_errors:function(){var e,t;return e=$("inline-upload-status"),t=Bt("- %d error","- %d errors",ii.errors()).format(ii.errors()),e.down(".num-errors").__date(t)},add_x_button:function(){var e,t;return t=new Element("a",{class:"small-x-button"}),t.observe("click",function(){return ri.hide(),si.reset()}),e=$("inline-upload-status"),e.down(".status").__date(t)},completed:function(){var e,t;return e=$("inline-upload-status"),e.addClassName("complete"),e.removeClassName("error"),e.down(".icon").__date(ee.make("web","s_check")),t=ii.num_files()>1?zt("Uploaded %(num_files)d files").format({num_files:ii.num_non_cancelled_files()}):zt("Uploaded %(filename)s").format({filename:_.em_snippet(ii.current_file.name,this.FILENAME_SNIPPET_LENGTH)}),e.down(".file-desc").__date(t),e.down(".num-errors").__date(),e.down(".view-details").__date(zt("View details")),this.add_x_button(),e.down(".inline-upload-progress").style.width="100%"},errored:function(){var e,t,n,i;return e=$("inline-upload-status"),e.addClassName("error"),e.removeClassName("complete"),e.down(".icon").__date(Element("img",{src:"/static/images/nosync-vfl18cuTS.png",srcset:"/static/images/nosync@2x.png 2x"})),t=void 0,ii.num_files()>1?(t=zt("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:ii.num_non_cancelled_files()-ii.errors(),num_files:ii.num_non_cancelled_files()}),e.down(".file-desc").__date(t),i=Bt("- %d error","- %d errors",ii.errors()).format(ii.errors()),e.down(".num-errors").__date(i)):(null!=ii.current_file&&(n=_.em_snippet(ii.current_file.name,this.FILENAME_SNIPPET_LENGTH)),t=n?zt("Unable to upload %(filename)s").format({filename:n}):zt("Unable to upload file"),e.down(".file-desc").__date(t),e.down(".num-errors").__date()),e.down(".view-details").__date(zt("View details")),this.add_x_button(),e.down(".inline-upload-progress").style.width="100%"},show:function(){return $("inline-upload-status").show()},hide:function(){return $("inline-upload-status").hide()}},_i=ft.UploadPrep={_drop_indicators:!1,_drop_dest_folder:null,file_counter:0,current_req:null,_notifications_cleared:!1,supported:function(){return Prototype.BrowserFeatures.DB_CORS},enabled:function(){return _i.supported()&&Ir.inside_dir&&!(Ir.in_search_mode()&&hr.fulltext_search_enabled)},browse_indicators_enabled:function(){var e,t,n,i;if(!_i.enabled())return!1;for(i=["modal-overlay"],t=0,n=i.length;n>t;t++)if(e=i[t],$(e).visible())return!1;return!0},modal_indicators_enabled:function(){var e;return _i.enabled()&&Se("#modal #upload-modal-dropzone").length&&Se("#modal").visible()&&(null!=(e=Se("#modal").offset())?e.left:void 0)>0},_show_border_drop_indicators:function(){return $$(".external-drop-indicator").each(function(e){return Se(e).css("opacity",0).fadeTo(500,.6)})},_hide_border_drop_indicators:function(){return $$(".external-drop-indicator").invoke("hide")},show_drop_indicators:function(e){var t;if(!_i._drop_indicators){if(_i.modal_indicators_enabled())t=$("upload-modal-dropzone"),je.clone_position(Se(t),Se("#modal"),{setLeft:!1,setTop:!1}),Se(t).fadeIn(500),_i._show_border_drop_indicators();else{if(!_i.browse_indicators_enabled())return;Ar._add_drop_indicators(e)}return $("drag-status").removeClassName("active"),_i._drop_indicators=!0}},hide_drop_indicators:function(){return _i._drop_indicators&&(_i._hide_border_drop_indicators(),Ar._remove_drop_indicators(),_i._notifications_cleared||k.clear(),$("upload-modal-dropzone").hide(),$("drag-status").addClassName("active"),setTimeout(function(){return _i._drop_indicators=!1,_i._drop_dest_folder=null,_i._notifications_cleared=!1},500)),_i._notifications_cleared=!0},folder_dragover:function(e){var t;return _i.browse_indicators_enabled()&&_i._drop_indicators?(oi.disabled?null==_i._drop_dest_folder&&(t=zt("You can't upload files because you're out of space."),k.error(t,60),_i._notifications_cleared=!1,_i._show_border_drop_indicators()):e!==_i._drop_dest_folder&&(e===Ir.containing_fq_path()?(Ir.inside_read_only_shared_folder?(t=zt("You don't have permission to add to this folder."),k.error(t,60)):(t=zt("Drop your file to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:li.upload_plain_snippet()}),k.success(new lt(t),60),_i._show_border_drop_indicators()),_i._notifications_cleared=!1):(k.clear(),_i._hide_border_drop_indicators())),_i._drop_dest_folder=e):void 0},supports_recursive_upload:function(e){var t;return window.File&&window.FileReader&&window.FileList&&window.Blob&&(null!=e&&null!=(t=e[0])?t.webkitGetAsEntry:void 0)},upload:function(e,t,n){var i,r,o,s;if(null==n&&(n=null),!Ir.inside_read_only_shared_folder){if(oi.disabled)return s=zt("You can't upload files because you're out of space."),k.error(s);if(_i.supports_recursive_upload(n))return _i._recursive_upload(e,n);for(r=0,o=t.length;o>r;r++)i=t[r],i.dest=e;return _i._upload(t,n)}},_recursive_upload:function(e,t){var n,i,r,o,s,a,_,l,u,d,c,h,f;for(u=[],f=[],i=function(t,n){return t.dest=e+_t.parent_dir(n.fullPath),u.push(t)},c=0,h=t.length;h>c;c++)d=t[c],a=d.webkitGetAsEntry(),null!==a&&(a.isDirectory?Gn.is_quicksend_dest(e)?k.error(zt("Please select files instead of folders.")):f.push(a):i(d.getAsFile(),a));return s=0,l=0,r=function(e,t){var n;return n=zt('The drag and drop uploader can\'t upload %(name)s because it contains Unicode characters. Use the <a id="use-advanced-uploader"> advanced uploader</a> instead.').format({name:t.name}),k.error(new lt(n)),Se("#use-advanced-uploader").on("click",function(e){return e.preventDefault(),li.show_upload()})},n=3e3,_=0,(o=function(){for(var e;f.length;)a=f.pop(),null!==a&&(a.isDirectory?!function(e){var t;return t=e.createReader(),s+=1,t.readEntries(function(e){var n,i,r;if(0!==e.length){for(i=0,r=e.length;r>i;i++)n=e[i],f.push(n);return t.readEntries(arguments.callee)}return s-=1},function(t){return s-=1,r(t,e)})}(a):(l+=1,e=function(e){return function(t){return i(t,e),l-=1}},a.file(e(a),function(e){return l-=1,r(e,a)})));return u.length>n&&!_?(_=1,void k.error(zt("The Dropbox website can't upload more than %(max_files)s files.").format({max_files:n}))):s||l?o.defer():u.length?_i._upload(u):void 0})()},_upload:function(e,t){var n,i;return null==t&&(t=null),t&&(n=this._parse_upload_items(t)),i=function(){var t,i,r,o,s;for(s=[],i=0,r=e.length;r>i;i++)t=e[i],navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(null!=n&&null!=(o=n[t.name])?o.isDirectory:void 0)&&(t.is_directory=!0),t.id=Y.guid(),s.push(si.PLU.addFile(t));return s},$("modal").visible()?i():(li.show_upload(i),mi.hide(null,!0))},_parse_upload_items:function(e){var t,n,i,r;for(t={},i=0,r=e.length;r>i;i++)n=e[i],n.getAsEntry?n=n.getAsEntry():n.webkitGetAsEntry&&(n=n.webkitGetAsEntry()),t[n.name]=n;return t}},oi=ft.OverQuotaUploads={disabled:!1,init:function(e){return this.disabled=e,this.disabled?Se("body").addClass("uploads-disabled"):void 0}};var li;li=INLINE_JS.FileOps=ft.FileOps={NOTIFICATION_SNIPPET_LEN:40,_find_app_by_id:function(e){var t,n,i,r;for(r=mi.vars.apps,n=0,i=r.length;i>n;n++)if(t=r[n],t.app_id===e)return t;return null},create_album_from_folder:function(e,t){return b.WebProgressRequest({url:"/collection_from_folder",data:{path:e,album_name:t},subject_user:G.get_viewer().photos_user,progress_text:zt("Creating album..."),success:function(e){return e=JSON.parse(e),st.redirect(e.url)}})},dir_handler:function(e,t){var n,i;return"string"==typeof t&&(t=$(t)),n=$$(".treeview .highlight")[0],n&&n.removeClassName("highlight"),i=t.up("div"),i.addClassName("highlight"),mi.selected_div=i,mi.shown()&&t.blur(),document.fire("db:dir_click",{path:e}),mi.vars.selected_path=e},show_folder_pick:function(e,t,n,i,r){var o;return tn.fillVal(_t.filename(t).escapeHTML(),"folder-pick-file"),yi.move("copy-move-treeview","folder-pick-treeview",{user:Ir.active_user}),o=zt(r?"Move":"Copy"),tn.fillVal(o,"folder-pick-action-text"),mi.show(e,$("folder-pick"),{fq_path:t,action:n,folder:i}),Se("#first-treeview-link").trigger("click")},show_bulk_folder_pick:function(e,t,n,i){var r,o,s;return s=ur.profile_files(n),o=ur.profile_summary(s),tn.fillVal(o,"bulk-folder-pick-file"),yi.move("copy-move-treeview","bulk-folder-pick-treeview",{user:Ir.active_user}),r=zt("move"===t?"Move":"copy"===t?"Copy":"Restore"),tn.fillVal(r,"bulk-folder-pick-action-text"),mi.show(e,$("bulk-folder-pick"),{files:n,action:i}),Se("#first-treeview-link").trigger("click")},show_copy:function(e,t){var n;return n=zt(t?"Copy folder to...":"Copy file to..."),yi.set_params({disable_read_only:!0}),li.show_folder_pick(n,e,li.do_copy,t,!1)},show_copy_bulk:function(e){var t;return t=Bt("Copy %(item_count)s item to...","Copy %(item_count)s items to...",e.length).format({item_count:e.length}),yi.set_params({disable_read_only:!0}),li.show_bulk_folder_pick(t,"copy",e,li.do_bulk_copy)},show_compress_bulk:function(e,t){return yi.set_params({disable_read_only:!0}),qt.show({title_text:Bt("Compress file?","Compress files?",t.length),body_html:Bt("Do you want to compress <strong>%(filename)s</strong>?<br/>This might take a while.","Do you want to compress %(file_count)s files?<br/>This might take a while.",t.length).format({file_count:t.length,filename:w.escape(t.first().filename)}),confirm_text:zt("Compress"),cancel_text:zt("Cancel"),confirm_callback:function(){return li.do_bulk_compress(e,t)}})},do_bulk_compress:function(e,t){var n;return k.clear(),n=t.pluck("fq_path"),b.WebProgressRequest({url:"/cmd/compress",data:{files:n},subject_user:e,progress_text:zt("Compressing..."),success:function(e){var n,i,r;return r=JSON.parse(e),n=r.compressed_files,wt(n.length>0,"Must have at least 1 compressed file"),i=w.escape(_t.filename(n.first().fq_path)),k.success(Bt("Compressed successfully to %(filename)s","Compressed %(file_count)s files successfully.",n.length).format({file_count:n.length,filename:i})),Se(document).trigger(s.COMPRESS,{original_files:t,compressed_files:n})}})},show_move_bulk:function(e){var t;return t=Bt("Move %(item_count)s item to...","Move %(item_count)s items to...",e.length).format({item_count:e.length}),yi.set_params({disable_read_only:!0}),li.show_bulk_folder_pick(t,"move",e,li.do_bulk_move)},show_move:function(e,t){var n;return n=zt(t?"Move folder to...":"Move file to..."),yi.set_params({disable_read_only:!0}),li.show_folder_pick(n,e,li.do_move,t,!0)},show_delete:function(e,t,n,i,r,o){var s,a;return null==r&&(r=null),null==o&&(o=!1),o?r?(wt(e.is_team,"Found a nested shared folder not on a business account"),a=G.get_viewer().team_name,s=zt("Are you sure you want to delete the shared folder ‘<strong>%(items)s</strong>’? People outside %(team_name)s you’ve shared this folder with will still have access unless you remove them from the <a href='/work%(file_path)s?shareoptions=1&share_subfolder=0'>member list</a>.").format({items:_t.filename(t).escapeHTML(),team_name:a.escapeHTML(),file_path:t.escapeHTML()})):s=zt("Are you sure you want to delete the shared folder ‘<strong>%(items)s</strong>’? This shared folder will stay shared with other members and you can rejoin it later.").format({
items:_t.filename(t).escapeHTML()}):s=r?zt("Are you sure you want to delete <strong>%(items)s</strong> from the shared folder ‘%(sf_name)s’?").format({items:_t.filename(t).escapeHTML(),sf_name:r.escapeHTML()}):zt("Are you sure you want to delete <strong>%(items)s</strong> from your Dropbox?").format({items:_t.filename(t).escapeHTML()}),qt.show({title_text:zt(n?"Delete folder?":"Delete file?"),body_html:'<div class="simple-modal-word-wrap-content">'+s+"</div>",confirm_text:zt("Delete"),cancel_text:zt("Cancel"),confirm_callback:function(){return i?li.do_nonbrowse_delete(e,[t]):li.do_delete(e,t)}})},show_bulk_delete:function(e,t,n){var i;return null==n&&(n=null),i=n?Bt("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(sf_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(sf_name)s’?",t.length).format({item_count:t.length,sf_name:n.escapeHTML()}):Bt("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",t.length).format({item_count:t.length}),qt.show({title_text:Bt("Delete %(item_count)s item?","Delete %(item_count)s items?",t.length).format({item_count:t.length}),body_html:i,confirm_text:zt("Delete"),cancel_text:zt("Cancel"),confirm_callback:function(){return li.do_bulk_delete(e,t)}})},show_purge:function(e,t){return qt.show({title_text:zt(t?"Permanently delete folder?":"Permanently delete file?"),body_html:zt("Are you sure you want to permanently delete <strong>%(items)s</strong> from your Dropbox?").format({items:_t.filename(e).escapeHTML()}),confirm_text:zt("Permanently delete"),cancel_text:zt("Cancel"),confirm_callback:function(){return li.do_purge(Ir.find_file(e))}})},show_bulk_purge:function(e){return qt.show({title_text:Bt("Permanently delete %d item?","Permanently delete %d items?",e.length).format(e.length),body_html:Bt("Are you sure you want to permanently delete %(item_count)s item from your Dropbox?","Are you sure you want to permanently delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length}),confirm_text:zt("Permanently delete"),cancel_text:zt("Cancel"),confirm_callback:function(){return li.do_bulk_purge(e)}})},show_bulk_restore:function(e){return qt.show({title_text:Bt("Restore %d item...","Restore %d items...",e.length).format(e.length),body_html:Bt("Are you sure you want to restore %(item_count)s item?","Are you sure you want to restore %(item_count)s items?",e.length).format({item_count:e.length}),confirm_text:zt("Restore"),cancel_text:zt("Cancel"),confirm_callback:function(){return li.do_bulk_restore(e)}})},wrap_strong:function(e){return""===Ir.containing_fq_path()?e.escapeHTML():"<strong>"+e.escapeHTML()+"</strong>"},upload_snippet:function(e){var t,n;return null==e&&(e=1e3),G.get_viewer().is_paired&&Ir.active_user.is_team&&(n=_.em_snippet(G.get_viewer().team_name,e).escapeHTML()),""===Ir.containing_fq_path()?G.get_viewer().is_paired?Ir.active_user.is_team?zt(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:n}):zt(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):zt(" upload to your Dropbox"):(t=_.em_snippet(_t.filename(Ir.containing_fq_path()),e).escapeHTML(),G.get_viewer().is_paired?Ir.active_user.is_team?zt(" upload to the folder <strong>%(folder)s</strong> in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:n}):zt(" upload to the folder <strong>%(folder)s</strong> in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):zt(" upload to the folder <strong>%(folder)s</strong>",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},upload_short_snippet:function(e){var t,n;return null==e&&(e=1e3),(n=Ir.containing_fq_path())?(t=_.em_snippet(_t.filename(n),e),zt("Upload to '%(folder_name)s'",{comment:"Upload a file to some folder on the website"}).format({folder_name:t})):zt("Upload to Dropbox",{comment:"Upload a file to the root Dropbox folder"})},upload_plain_snippet:function(e){return null==e&&(e=1e3),this.upload_snippet(e).replace("<strong>","'").replace("</strong>","'")},show_upload:function(e,t,n){var i,r,o,s,a,_;if(i=Ir.containing_fq_path(),oi.disabled)return tn.fillVal(this.wrap_strong(_t.filename(i)),"disabled-upload-foldername"),a=this.upload_short_snippet(20),mi.show(a,$("disabled-upload-modal"),{},!1),void rt.ProEventsLogger.log("view_upload_modal_already_oq");if(!FlashDetect.versionAtLeast(9)&&"flash"===si.runtimes)return li.show_basic_upload(),void $("enhanced-upload-toggle").hide();for(tn.fillVal(this.upload_snippet(20),"upload-foldername"),tn.fillVal(this.upload_plain_snippet(10),"dnd-upload-foldername"),$("upload-desc").visible()&&_i.supported()&&($("upload-desc").hide(),$("dnd-upload-desc").show()),a=this.upload_short_snippet(20),mi.show(a,tn.fromElm("advanced-upload-modal"),{wit_group:"advanced-uploader"},!1,!1,ii.num_files()),_=[$("modal").down(".basic-link-start"),$("modal").down(".basic-link-running")],r=0,o=_.length;o>r;r++)s=_[r],null!=s&&s.observe("click",function(){return li.show_basic_upload(),!1});return ii.num_files()?si.set_dest(_t.normalize(i)):si.init(_t.normalize(i),!0,e,n),ri.hide()},show_basic_upload:function(){return tn.fillVal(this.upload_snippet(20),"basic-upload-foldername"),mi.show(this.upload_short_snippet(20),$("basic-upload-modal"),{},!1),$("modal").down(".enhanced-link").observe("click",function(){return li.show_upload(),!1}),si.set_dest(_t.normalize(Ir.containing_fq_path())),si.init_basic()},show_undelete:function(e){var t,n,i;return tn.fillVal(e.filename.escapeHTML(),"undelete_filename"),t=ee.make("web",e.icon,{}),t.addClassName("link-img"),t.style.backgroundColor="transparent",n=li.build_revisions_uri(e.fq_path,Ir.active_user,{undelete:1}),$$(".undelete-icon").invoke("update",t),$$(".undelete-other-versions")[0].href=n,$$(".undelete-link")[0].href=n,i=zt("Restore file?"),mi.show(i,$("undelete-modal"),{file:e})},do_undelete:function(){var e,t;return e=mi.vars.file,t=zt("Restored '%(file_name)s'").format({file_name:e.filename}),new Ajax.DBRequest("/cmd/restore",{parameters:{files:[e.fq_path]},subject_user:Ir.active_user,job:!0,html_in_error_msg:!0,progress_text:zt("Restoring..."),onSuccess:function(){return mi.hide(),k.success(t),document.fire(s.RESTORE,{files:[e]})}}),!1},do_copy:function(e,t){var n;return e=e||mi.vars.fq_path,t=t||mi.vars.selected_path,n=Ir.find_file(e),wt(n,"Trying to copy a file we couldn't find."),li.do_bulk_copy([n],t)},do_bulk_copy:function(e,t){var n,i,r,o,a;if(Ir.pre_action_selection=Sr.get_selected_fq_paths(),e=e||mi.vars.files,wt(e.length>0,"Tried to copy 0 files"),"undefined"==typeof t){if("undefined"==typeof mi.vars.selected_path)return void k.error(zt("You need to select a destination for the file."));t=mi.vars.selected_path}for(t=_t.normalize(t),r=0,o=0,a=e.length;a>o;o++)if(n=e[o],n.dir&&0===(t+"/").indexOf(n.fq_path+"/"))return void k.error(zt("You cannot copy a folder into itself."));return i=e.pluck("fq_path"),k.clear(),new Ajax.DBRequest("/cmd/copy",{parameters:{files:i,to_path:t},subject_user:Ir.active_user,job:!0,html_in_error_msg:!0,progress_text:zt("Copying..."),onSuccess:function(r){var o,a,l,u,d,c,h,f;for(o=r.responseText.evalJSON().changesets,a=i.length,c=_.em_snippet(_t.filename(t),li.NOTIFICATION_SNIPPET_LEN).escapeHTML(),h=Bt("Copied %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Copied %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",a),h=h.format({count:a,location:c}),ie.notifyWithUndo(new lt(h),o,li.do_rollback),l=[],f=r.responseText.evalJSON().new_browse_files,u=0,d=f.length;d>u;u++)n=f[u],l.push(n.fq_path);return Ir.select_fq_paths=l,$("reload-link").observe("click",function(){return mr.set_path_url(null,t)}),yi.schedule_reset(),document.fire(s.COPY,{files:e,to_fq_path:t})}})},bulk_move_error:function(e,t){var n,i,r,o,s,a,_,l,u;if(r=Ir.find_file(t),o=ur.profile_files(e),l=void 0,a=void 0,u=void 0,r?(a=r.dir,l=r.fq_path,u=r.target_ns||r.ns_id):Ir.inside_dir&&Ir.can_get_details_from_fq_path(t)?(i=Ir.details_from_fq_path(t),a=!0,l=i.fq_path,u=i.ns_id):(a=!0,l=t,u=void 0),s=e.pluck("fq_path").collect(_t.normalize),-1!==s.indexOf(_t.normalize(l)))return zt("You cannot copy a folder into itself.");if(n=_=function(e){var t;return t=_t.parent_dir(e.fq_path),t===(l||"/")},e.all(n))return Bt("That file already exists in that folder.","Those files already exist in that folder.",e.length);if(!a)return zt("You cannot put files inside one another.");if(o.target_namespaces>0&&u&&u!==f.root_ns&&r){if(o.sandboxes>0){if(r.is_sandbox())return zt("You're not allowed to put an application folder inside another application folder.");if(r.is_shared_folder())return zt("You're not allowed to put an application folder inside a shared folder.")}else if(o.shared_folders>0){if(r.is_sandbox())return zt("You're not allowed to put a shared folder inside an application folder.");if(r.can_hold_shared_folders&&0===o.team_shared_folders)return;if(r.is_shared_folder())return zt("You're not allowed to put a shared folder inside another shared folder.")}return zt("You're not allowed to nest special folders.")}return Ir.public_folder_enabled&&"/Public"===l&&o.target_namespaces>0?zt("You're not allowed to move shared folders to your Public folder."):o.public_folder>0?zt("You're not allowed to move your Public folder."):o.deleted>0?zt("Moving deleted folders or files isn’t allowed."):void 0},do_move:function(e,t){var n;return e=e||mi.vars.fq_path,t=t||mi.vars.selected_path,n=Ir.find_file(e),wt(n,"Trying to move a file we couldn't find."),li.do_bulk_move([n],t)},do_nonbrowse_move:function(e,t,n){var i,r;return i=Se.Deferred(),r="/cmd/move",new Ajax.DBRequest(r,{parameters:{files:t,to_path:n},subject_user:e,job:!0,html_in_error_msg:!0,progress_text:zt("Moving…"),onSuccess:i.resolve,onFailure:i.reject}),i.promise()},do_bulk_move:function(e,t){var n,i,r,o;return Ir.pre_action_selection=Sr.get_selected_fq_paths(),(e=e||mi.vars.files)?(wt(e.length>0,"Tried to move 0 files"),o=t||mi.vars.selected_path||"",o=_t.normalize(o),(n=li.bulk_move_error(e,o))?void k.error(n):(i=e.pluck("fq_path"),k.clear(),r=function(t){var n,r,a,l;return n=t.responseText.evalJSON().changesets,r=i.length,a=_.em_snippet(_t.filename(o),li.NOTIFICATION_SNIPPET_LEN).escapeHTML(),l=Bt('Moved %(count)d item to ‘<a id="reload-link">%(location)s</a>’.','Moved %(count)d items to ‘<a id="reload-link">%(location)s</a>’.',r),l=l.format({count:r,location:a}),ie.notifyWithUndo(new lt(l),n,li.do_rollback),$("reload-link").observe("click",function(){return mr.set_path_url(null,o)}),yi.schedule_reset(),document.fire(s.MOVE,{files:e,to_fq_path:o})},li.do_nonbrowse_move(Ir.active_user.id,i,o).then(r))):void 0},do_rollback:function(e){return new Ajax.DBRequest("/cmd/rollback",{parameters:{ns_to_cs:JSON.stringify(e)},subject_user:Ir.active_user,job:!0,html_in_error_msg:!0,progress_text:zt("Undoing..."),onSuccess:function(){var e;return e=zt("Undo complete."),k.success(e),wt(Ir.pre_action_selection instanceof Array,"Expected a selection from before the action to be undone"),Ir.in_search_mode()?(hr.select_fq_paths=Ir.pre_action_selection,hr.force_reload()):(Ir.select_fq_paths=Ir.pre_action_selection,Ir.force_reload()),Ir.pre_action_selection=!1}})},do_bulk_delete:function(e,t){var n,i;return Ir.pre_action_selection=Sr.get_selected_fq_paths(),t=t||mi.vars.files,wt(t.length>0,"Tried to delete 0 files"),i=function(){var e,i,r;for(r=[],e=0,i=t.length;i>e;e++)n=t[e],r.push(n.fq_path);return r}(),k.clear(),new Ajax.DBRequest("/cmd/delete",{parameters:{files:i},subject_user:e,job:!0,html_in_error_msg:!0,progress_text:zt("Deleting..."),onSuccess:function(e){var n,r;return r=e.responseText.evalJSON(),n=Bt("Deleted %d item.","Deleted %d items.",i.length).format(i.length),ie.notifyWithUndo(n,r.changesets,li.do_rollback),yi.schedule_reset(),document.fire(s.DELETE,{files:t})}})},do_delete:function(e,t){var n;return n=Ir.find_file(t||mi.vars.fq_path),wt(n,"Trying to delete a file we couldn't find."),li.do_bulk_delete(e,[n])},do_nonbrowse_delete:function(e,t){var n,i;return n=Se.Deferred(),i=Bt("Deleted %(file_count)s item","Deleted %(file_count)s items",t.length),i=i.format({file_count:t.length}),k.success(i),new Ajax.DBRequest("/cmd/delete",{parameters:{files:t},subject_user:e,html_in_error_msg:!0,onSuccess:function(e){return document.fire(s.DELETE,{fq_paths:t}),n.resolve(e)},onFailure:function(e){return k.error(zt("Failed to perform the delete. Please try again later.")),n.reject(e)}}),n.promise()},do_nonbrowse_rename:function(e,t,n){var i;return i=Se.Deferred(),new Ajax.DBRequest("/cmd/rename"+encodeURIComponent(t),{parameters:{to_path:n},subject_user:e,html_in_error_msg:!0,onSuccess:function(e){return i.resolve(e)},onFailure:function(e){return i.reject(e)}}),i.promise()},do_purge:function(e){return wt(e,"Trying to purge a file we couldn't find."),li.do_bulk_purge([e])},do_bulk_purge:function(e){var t,n;return wt(e.length>0,"Tried to purge 0 files"),t=e.collect(function(e){return e.fq_path}),n=Bt("Permanently deleted %d item","Permanently deleted %d items",t.length).format(t.length),new Ajax.DBRequest("/cmd/purge",{parameters:{files:t},subject_user:Ir.active_user,job:!0,html_in_error_msg:!0,progress_text:zt("Deleting..."),onSuccess:function(){return k.success(n),yi.schedule_reset(),document.fire(s.PURGE,{files:e})}})},do_bulk_restore:function(e){var t,n,i;return e=e||mi.vars.files,i=mi.vars.user,wt(e.length>0,"Tried to restore 0 files"),t=e.collect(function(e){return e.fq_path}),n=Bt("Restored %d item","Restored %d items",t.length,{comment:"meaning, successfully restored x files and folders"}).format(t.length),new Ajax.DBRequest("/cmd/restore",{parameters:{files:t},subject_user:Ir.active_user,job:!0,html_in_error_msg:!0,progress_text:zt("Restoring..."),onSuccess:function(){return k.success(n),yi.schedule_reset(),document.fire(s.RESTORE,{files:e})}})},do_folder_restore:function(e,t){var n;return n=function(t){var n,i;return n=zt("Restoring '%(folder_name)s'").format({folder_name:_t.filename(e)}),i=t.responseText,i.startsWith("err:")?(i=i.substring(4),Se("#async-result").html(i),k.error(new lt(i),60)):(n=zt("Restored '%(folder_name)s'").format({folder_name:_t.filename(e)}),Se("#status-of-files").text(zt("Restored files")),k.success(n,60)),Se("#restore-done-heading").text(n),Se(".pre-restore").hide(),Se(".post-restore").show()},new Ajax.DBRequest("/cmd/restore",{parameters:{files:[e]},job:!0,html_in_error_msg:!0,progress_text:zt("Restoring..."),onSuccess:n,onFailure:n,subject_user:t})},do_bulk_download:function(e){var t,n,i,r;for(t=new Element("form",{action:o({scheme:"https",authority:Ee.BLOCK_CLUSTER,path:"/zip_batch"}).updateQuery(O.UID_PARAM_NAME,Ir.active_user.id).toString(),method:"post"}),i=0,r=e.length;r>i;i++)n=e[i],ui.add_vars(t,{files:n.fq_path});return ui.add_vars(t,{parent_path:Ir.block_hash_param||"/",w:Ir.block_hash}),$(document.body).__sert(t),t.submit()},do_bulk_photo_view:function(e,t){var n,i,r,s;return s={},s[O.UID_PARAM_NAME]=e.id,n=String(o({scheme:"https",authority:Ee.WEBSERVER,path:"/app/view_in_timeline",query:s})),i=new Element("form",{action:n,method:"post"}),ui.add_vars(i,{t:Ye.read(qe.JS_CSRF_COOKIE),ns_ids:JSON.stringify(function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)r=t[e],i.push(r.ns_id);return i}()),ns_paths:JSON.stringify(function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)r=t[e],i.push(r.ns_path);return i}())}),$(document.body).__sert(i),i.submit()},build_revisions_uri:function(e,t,n){return null==n&&(n={}),n[O.UID_PARAM_NAME]=String(t),oe.getGandalfRule("revision-history-web")?o({path:"/history"+e}).updateQuery(n):o({path:"/revisions"+e}).updateQuery(n)}};var ui,Cn={}.hasOwnProperty;ui=__CONDITIONAL_JS__.Forms=INLINE_JS.Forms=ft.Forms={submitOnlyOnce:function(){var e;return e=ui.submitted!==!0,ui.submitted=!0,e},disable:function(e){return e?setTimeout(function(){return e.disabled=!0},0):void 0},enable:function(e){return e?setTimeout(function(){return e.disabled=!1},0):void 0},_button_on_change:function(e,t,n,i){var r,o,s,a;return r=Se(e),r[t](),null==i&&(i=r.closest("form")),o=i[0],null==this.next_id&&(this.next_id=0),s=this.next_id++,null==this.initial_vars&&(this.initial_vars={}),this.initial_vars[s]=this.collect_form_vars(o),r.attr("data-id",s),i.data("button-id",s),a=function(e){return function(){var i,a,_;r[t](),a=e.collect_form_vars(o),Object.keys(a).length!==Object.keys(e.initial_vars[s]).length&&r[n](),_=[];for(i in a)_.push(a[i]!==e.initial_vars[s][i]?r[n]():void 0);return _}}(this),i.change(a),i.find("input").filter(":text").on("input",a),i.find("textarea").on("input",a)},show_button_on_change:function(e,t){return this._button_on_change(e,"hide","show",t)},hide_button_on_change:function(e,t){return this._button_on_change(e,"show","hide",t)},add_vars:function(e,t){var n,i,r;e=$(e),r=[];for(i in t)Cn.call(t,i)&&(n=new Element("input",{type:"hidden",name:i}),n.setValue(t[i]),r.push(e.__sert(n)));return r},collect_form_vars:function(e,t){var n,i,r,o,s,a;for(null==t&&(t=!1),e=e||$(document.body),i=e.select("input").concat(e.select("textarea")).concat(e.select("select")),s={},r=0,o=i.length;o>r;r++)n=i[r],n.name&&"t"!==n.name&&!Se(n).attr("data-ignore-var")&&(a=n.getValue(),(a||t)&&("string"!=typeof a&&(a=a.join(",")),null!=s[n.name]?"string"==typeof s[n.name]?s[n.name]=[s[n.name],a]:s[n.name].push(a):s[n.name]=a));return s},add_loading:function(e,t){var n;return e?(e=$(e),n=new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),n.addClassName("text-img ajax_submit_loading"),"after"===t?Se(e).after(n):Se(e).before(n)):void 0},remove_loading:function(){return Se(".ajax_submit_loading").remove()},ui_form_submit:function(e,t){return t=t||e.action,e.ajax_submitted?!1:(e.ajax_submitted=!0,new p(Se(e),t,{data:ui.collect_form_vars(e),success:function(t){return function(){var n,i;return i=Se(e).data("button-id"),null!=i?(n=Se(e).find("*[type='submit'][data-id='"+i+"']"),t.initial_vars[i]=t.collect_form_vars(e),n.hide()):void 0}}(this),complete:function(){return function(){return e.ajax_submitted=!1}}(this)}))},ajax_submit_obj:function(e){var t,n,i,r,o,s,a,_,l,u,d;return r=e.form,d=e.url,u=e.success_callback,i=e.fail_callback,t=e.button,a=e.more_vars,_=e.position,s=e.job,o=e.html_response,n=e.complete_callback,l=e.progress_text,ui.ajax_submit(r,d,u,i,t,a,_,s,o,n,l)},ajax_submit:function(e,t,n,i,r,o,s,a,_,l,u){var d,c,h,f,p;if(null==_&&(_=!1),e.ajax_submitted)return!1;for(e.ajax_submitted=!0,p=Se(e).find(".suggestion-input"),c=0,h=p.length;h>c;c++)d=p[c],gi.blank(d.identify())();return r&&ui.add_loading(r,s),f=ui.collect_form_vars(e),o&&Object.extend(f,o),new Ajax.DBRequest(t||e.action,{noAutonotify:!0,parameters:f,job:a,progress_text:u,evalJSON:!1,onSuccess:function(e){return ui.remove_loading(),n&&"function"==typeof n?n(e):void 0},onFailure:function(t){var n,r;return t&&(0===t.responseText.indexOf("err:")?(n=t.responseText.substr(4),0===n.indexOf("{")?(r=n.evalJSON(!0),ui.fill_errors(e,r)):(_&&(n=new lt(n)),k.error(n))):k.error(),ui.remove_loading(),i&&"function"==typeof i)?i(t):void 0},onComplete:function(t){var n,i,r;for(r=e.select(".suggestion-input"),n=0,i=r.length;i>n;n++)d=r[n],gi.blur_elm(d);return e.ajax_submitted=!1,l&&"function"==typeof l?l(t):void 0}}),!1},clear_errors:function(e){return e=e||$(document.body),this.hide_errors(e),e.select(".error-removable").invoke("remove")},fill_errors:function(e,t){var n,i,r,o,s,a;t=t||{},e=e||$(document.body),ui.clear_errors(e);for(s in t)Cn.call(t,s)&&(i=e.down("[data-error-field-name='"+s+"']")||e.down("[name='"+s+"']"),i&&(n=new Element("br",{class:"error-removable"}),r=new Element("span",{class:"error-message error-removable"}),o=t[s],wt(o.message_html||o.message_text,"Error message must have a message_html or message_text property"),o.message_html?r.update(o.message_html):r.__date(o.message_text),Se(i).before(r),Se(i).before(n),a=Se(e).find("input[name='"+s+"'], textarea[name='"+s+"']"),a&&a.addClass("input-error")));return this.show_errors(e)},value:function(e){var t,n,i,r,o;for(i=$$('input[name="'+e+'"]'),o=null,t=0,r=i.length;r>t;t++)n=i[t],o=$(n).getValue()||o;return o},postRequest:function(e,t,n){var i;return null==t&&(t={}),null==n&&(n={}),wt(null!=e,"postRequest missing action"),t.t=Ye.read(qe.JS_CSRF_COOKIE),i=new Element("form",{action:e,method:"POST"}),n.target&&(i.target=n.target),document.body.appendChild(i),ui.add_vars(i,t),i.submit()},hide_errors:function(e){var t,n,i,r,o;for(t=this.get_errors(e),r=[],n=0,i=t.length;i>n;n++)o=t[n],r.push(o.down("span.error-message")?o.hide():void 0);return r},show_errors:function(e){var t,n,i,r;for(t=this.get_errors(e),n=0,i=t.length;i>n;n++)r=t[n],r.down("span.error-message")&&r.show();return Se(".sick-input").find("label").css("top","")},get_errors:function(e){var t,n;return n=".error-bubble, .error-plain-text",t=e?e.select(n):$$(n)}},Se(function(){return ui.show_errors()});var di;di=ft.ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(e,t){var n,i,r,o;for(null==t&&(t=document.body),r=$(t).getElementsByClassName("act_as_block"),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(this.resize(e));return o},resize:function(e){var t,n,i,r;return e=$(e),n=e.up(),t=Zt.sumStyles(e,this.elm_list),i=Zt.sumStyles(n,this.parent_list),e.style.width="1px",r=n.getWidth()-t-i,r>0?e.style.width=r+"px":void 0}};var ci;ci=ft.BrowseStyleRows={register_all:function(){var e,t,n,i;for(n=$$(".bs-row"),e=0,t=n.length;t>e;e++)i=n[e],this.register(i);return Event.observe(document,"click",this.kill_current.bind(this)),Se(document).on("dropdown-opened",this.kill_current.bind(this))},register:function(e){var t;return e=$(e),e.db_observe("mouseover",this.mouseover.bind(this)),e.db_observe("mouseout",this.mouseout.bind(this)),t=e.down(".action-button"),t?t.db_observe("click",this.click.bind(this)):void 0},mouseover:function(e,t){return t.hasClassName("no-hover")?void 0:t.addClassName("hover")},mouseout:function(e,t){return t.removeClassName("hover")},click:function(e,t){var n,i,r;if("A"!==e.target.tagName)return i=t.up(".bs-row"),Event.stop(e),i.hasClassName("selected")?void this.kill_current(!1):(Se(document).trigger("dropdown-opened"),this.kill_current(!1),r=$(e.target),r.match(".bs-actions-list *")||i.addClassName("selected"),n=r.hasClassName("bs-row")?r:r.up(".bs-row"),n.style.zIndex=9)},kill_current:function(){var e,t,n,i,r;for(i=$$(".bs-row.selected"),r=[],t=0,n=i.length;n>t;t++)e=i[t],e.removeClassName("selected"),r.push(e.style.zIndex="");return r}};var hi;hi=ft.Bubble={make:function(e,t,n,i,r){var o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x;return null==t&&(t="left"),r=null!=r?r:{},["left","right"].contains(t)?(n=n||"middle",wt(["top","middle","bottom"].contains(n),"expected tail position ['top', 'middle', 'bottom'], got "+n)):["bottom","top"].contains(t)?(n=n||"center",wt(["left","center","right"].contains(n),"expected tail position ['left', 'center', 'right'], got "+n)):["none"].contains(t)||wt(!1,"unexpected tail side, got "+t),m=new Element("table"),"titled"===r.style?(m.addClassName("bluebubble"),v="bluebubble"):(m.addClassName("bubble"),v="bubble"),i&&(m.style.width=i+"px"),w=new Element("tbody"),k=new Element("tr"),b=new Element("td"),b.addClassName("tl"),p=new Element("td"),p.addClassName("t"),"titled"===r.style&&i&&(p.style.width=i-42+"px"),y=new Element("td"),y.addClassName("tr"),"top"===t&&(g=new Element("img",{src:"/static/images/"+v+"_arrow_top.png"}),g.addClassName("tarrow"),"titled"===r.style?(g.addClassName("arrow-"+n),s=new Element("div"),s.addClassName("arrow-container"),i&&(s.style.width=i-42+"px"),s.__sert(g),p.__sert(s)):(p.style.textAlign=n,p.__sert(g))),k.__sert(b),k.__sert(p),k.__sert(y),w.__sert(k),E=new Element("tr"),c=new Element("td"),c.addClassName("l"),"left"===t&&(o="titled"===r.style?new Element("img",{src:"/static/images/bluebubble_arrow_left-vfl8zzy_-.png"}):new Element("img",{src:"/static/images/bubble_arrow-vfl8m7tk-.png"}),o.addClassName("arrow"),c.__sert(o),c.vAlign=n),d=new Element("td"),d.addClassName("c"),d.update(e),h=new Element("td"),h.addClassName("r"),"right"===t&&(f=new Element("img",{src:"/static/images/bubble_arrow_right-vflmW3_2s.png"}),f.addClassName("rarrow"),h.__sert(f),h.vAlign=n),E.__sert(c),E.__sert(d),E.__sert(h),w.__sert(E),x=new Element("tr"),l=new Element("td"),l.addClassName("bl"),a=new Element("td"),a.addClassName("b"),"bottom"===t&&(_=new Element("img",{src:"/static/images/"+v+"_arrow_bottom.png"}),_.addClassName("barrow"),"titled"===r.style?(_.addClassName("arrow-"+n),s=new Element("div"),s.addClassName("arrow-container"),i&&(s.style.width=i-42+"px"),s.__sert(_),a.__sert(s)):(a.style.textAlign=n,a.__sert(_))),u=new Element("td"),u.addClassName("br"),x.__sert(l),x.__sert(a),x.__sert(u),w.__sert(x),m.__sert(w),m}};var fi;fi=INLINE_JS.FreshDropdown=ft.FreshDropdown={show:function(e,t,n,i){var r,o,s,a;return null==i&&(i=!1),Se(document).trigger("dropdownOpened",[1]),r=Se(t),n||(n=r[0].offsetHeight+10),this.hide_all(),o=Se(e).show(),a=o[0].offsetWidth,s=r[0].offsetWidth,je.clone_position(o,r,{setHeight:!1,setWidth:!1,offsetLeft:-1*(a-s)+22,offsetTop:n}),i&&o.width(a),r.addClass("pressed"),function(){return function(){return document.observe("click",fi.hide_all)}}(this).defer()},hide_all:function(){var e,t;return t=Se(".freshdropdown-menu"),e=0,t.each(function(){return Se(this).is(":visible")?e+=1:void 0}),t.hide(),Se(document).trigger("dropdownClosed",[e]),$$(".freshdropdown-button").invoke("removeClassName","pressed"),document.stopObserving("click",fi.hide_all)}};var pi;pi=ft.JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){return window.location.href.endsWith("#")&&0===window.pageYOffset&&0!==pi.last_page_offset?this.report():(this.last_page_offset=window.pageYOffset,this.last_hash=o.parse(window.location.href).fragment)},report:function(){return clearInterval(pi.interval),bt("Hash jump detected, last hash = "+this.last_hash+". You may have an onclick handler that isn't firing, or you are not preventing the default action (eg. by returning false in your handler)")}};var mi;mi=__CONDITIONAL_JS__.Modal=INLINE_JS.Modal=ft.Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(e,t,n,i,r,o,s,a,_){var l,u,d,c,h,f;return null==n&&(n=!1),null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=!1),null==s&&(s=""),null==a&&(a=!0),null==_&&(_=!1),mi.shown()&&mi._cleanup(),r=r||this.width,u="#modal-content .error-message, #modal-content .error-removable, #modal-content .error-bubble",$$(u).invoke("hide"),ii.uploading&&!o?(gt(zt("You can't do this while uploading.")),!1):(wt(t,"Missing modal content!"),h=this.vars._prev_scope,this.vars=n||{},this.vars._prev_scope=h,$("modal").setStyle({width:r+"px",margin:"0 0 0 "+Math.floor(-r/2).toString()+"px"}),this.vars.extra_class="",s&&($("modal").addClassName(s),this.vars.extra_class=s),o||(ii.num_files()&&(si.reset(),ii.clear()),c=Zt.childElement($("modal-content"),0),c&&c!==t&&$("grave-yard").__sert(c),l=new Element("div"),l.update(t),$("modal-content").__sert(l),t.show&&t.show(),Element.show("modal")),Se("#modal-overlay").off("click"),a?Se("#modal-overlay").on("click",function(e){return mi.hide(null,!1,!0),e.preventDefault(),e.stopPropagation()}):Se("#modal-overlay").on("click",function(e){return e.preventDefault(),e.stopPropagation()}),this.fix_position(),$("modal-overlay").show(),$("modal-behind").setStyle({width:r+20+"px",margin:"0 0 0 "+Math.floor(-r/2-10).toString()+"px"}),Se("#modal-behind").css("opacity",.2),$("modal-behind").show(),i?$("modal-content").select("#"+i.id).first().focus():Zt.ie||(d=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]"),d&&d.focus()),this.track_id||this.track_resizes(),e?(Zt.isElm(e)?Se("#modal-title").html(e):Se("#modal-title").text(e),Se("#modal-title").show(),f=Se("#modal-title").text(),Gt("Modal.show:",f)):(Se("#modal-title").hide(),Gt("Modal.show")),di.register(!1,"modal"),this.keydownHandler=this.keydown.bind(this),document.observe("keydown",this.keydownHandler),$("modal-content").style.height="auto",key.getScope()!==this.KEY_SCOPE&&(this.vars._prev_scope=key.getScope()),key.setScope(this.KEY_SCOPE),this.prevent_hide_if_loading=_,Se("#modal").find("input").filter(":visible:first").focus(),this.in_viewport()&&(this.scroll_locked=!0,je.scroll_lock_document()),Se(document).trigger("modalOpened",[1]),!1)},in_viewport:function(){var e,t,n,i,r;return e=Se("#modal"),t=e.height(),r=e.width(),n=je.viewport_dimensions(),i=je.viewport_offset(e),i.left>0&&i.top>0&&i.left+r<n.width&&i.top+t<n.height},fix_position:function(){var e,t;return t=document.viewport.getScrollOffsets().top+this.vertical_offset,e=parseInt($("modal").getStyle("height"),10),e+this.vertical_offset<document.viewport.getHeight()?($("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"}),$("modal-behind").setStyle({position:"fixed",height:e+20+"px",top:this.vertical_offset-10+"px"})):($("modal").setStyle({position:"absolute",top:t+"px"}),$("modal-behind").setStyle({position:"absolute",height:e+20+"px",top:t-10+"px"}))},keydown:function(e){var t,n,i,r;if(i=e.keyCode||e.which||e.charCode,(27===i||8===i&&!je.focus_in_input())&&(e.preventDefault(),this.hide(null,!1,!0)),9===i&&!je.focus_in_input()){for(n=$("modal").down("input[type=text], input[type=email]"),r=$("modal").down(".modal-tabs"),t=r;t&&t.next();)if(t=t.next(),t.visible()){n=t.down("input[type=text], input[type=email]");break}if(n)return e.preventDefault(),n.focus()}},shown:function(){return $("modal").visible()},hide:function(e,t,n){return e&&Event.stop(e),this.should_prevent_hide()?!1:(this.prevent_hide_if_loading=!1,this.onHide?void this.onHide(n):(this.onHide=null,Element.hide("modal-behind"),Element.hide("modal-overlay"),$("modal").removeClassName(this.vars.extra_class),t||ii.num_files()?($("modal").style.marginLeft="-10000000px",ii.uploading&&ri.show()):Element.hide("modal"),mi._cleanup(),this.track_id&&(clearInterval(this.track_id),this.track_id=!1),document.stopObserving("keydown",this.keydownHandler),document.activeElement&&-1===[document,window,document.body].indexOf(document.activeElement)&&$(document.activeElement).blur(),key.setScope(this.vars._prev_scope),Gt("Modal.hide")))},_cleanup:function(){return Se(document).trigger("modalClosed",[1]),this.scroll_locked?je.scroll_unlock_document():void 0},should_prevent_hide:function(){return this.prevent_hide_if_loading&&w.some(Se("#modal form"),function(e){return e.ajax_submitted})},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var e;return e=$("modal").getHeight(),this.old_height!==e||$("modal-behind").getHeight()<e?(this.old_height=e,this.fix_position()):void 0},vars:{}};var vi;vi=ft.SickInput={init:function(){var e,t,n,i,r;for(i=$$(".sick-input"),r=[],t=0,n=i.length;n>t;t++)e=i[t],e.hasClassName("sickified")||r.push(this._create(e));return r},_create:function(e){var t,n,i;if(null!=e)return n=e.identify(),i=e.down("input")||e.down("textarea")||e.down("select"),i.observe("focus",function(){return e.addClassName("focused")}),i.observe("blur",function(){return e.removeClassName("focused")}),t=function(){return e.hasClassName("populated")&&""===i.getValue()?e.removeClassName("populated"):e.hasClassName("populated")||""===i.getValue()||e.addClassName("populated"),n in vi._handler_map?vi._handler_map[n]():void 0},ui.show_errors(),t(),setInterval(t,100)},_handler_map:{},add_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]=t},remove_interval_handler:function(e,t){var n;return n=e.identify(),
this._handler_map[n]===t?delete this._handler_map[n]:void 0}};var gi;gi=ft.SuggestionInput={register:function(e){var t;return e=$(e),t=e.up("form"),gi.defaulted(e)||""===e.getValue()?e.setValue(e.title):e.addClassName("suggestion-input-unfaded"),e.observe("blur",this.blur.bind(this)),e.observe("focus",this.focus.bind(this)),e.observe("db:value_change",this.focus.bind(this)),t?(e.id||(e.id="r_elm_id_"+Math.random().toString()),t.observe("submit",gi.blank(e.id).bind(this))):void 0},register_all:function(){var e,t,n,i,r;for(i=$$(".suggestion-input"),r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(this.register(t));return r},blank:function(e){return function(t){return function(){var n;return(n=$(e))&&t.defaulted(n)?n.setValue(""):void 0}}(this)},defaulted:function(e){return e=$(e),e.getValue()===e.title},do_blank:function(e){return this.blank(e)()},clear:function(e){var t;return t={target:e},this.focus(t)},focus:function(e){var t;return(t=$(e.target))&&this.defaulted(t)?(t.addClassName("suggestion-input-unfaded"),t.setValue("")):void 0},blur_elm:function(e){return""===e.getValue()&&(e.removeClassName("suggestion-input-unfaded"),e.setValue(e.title)),e.blur()},blur:function(e){var t;return(t=$(e.target))?this.blur_elm(t):void 0},reset:function(e){var t;return(t=$(e))?(t.removeClassName("suggestion-input-unfaded"),t.setValue(t.title),t.defaulted=!0,t.blur()):void 0},setValue:function(e,t){var n;return(n=$(e))?(n.addClassName("suggestion-input-unfaded"),n.setValue(t),n.defaulted=!1):void 0}};var wi;wi=ft.TitleBubble=function(){var e,t,n,i,r,o,s;return s=0,e=0,o=function(e){return s=e},r=function(i){var r,o,a,_,l,u,d,c,h,f,p;return o=Se(i.currentTarget),p=o.attr("title"),(null!=p?p.length:void 0)&&(o.attr("data-title",p),o.removeAttr("title")),l=parseInt(o.data("title-delay")),_="title-bubble-"+e++,o.data("bubble-id",_),r=Se("<div/>",{id:_,class:"title_bubble_container"}),l||(r.css({opacity:0}),r.addClass("has-transition")),o.hasClass("white")&&r.addClass("white"),o.hasClass("black")&&r.addClass("black"),r.text(o.attr("data-title")),c=o.attr("data-title-html"),r.html(c),f="yes"!==o.attr("data-title-hide-tail"),f&&(a=Se("<div/>",{class:"tail"}),r.append(a)),Se(document.body).append(r),d=n(o[0],r[0]),u=t(d,r[0],o[0]),je.clone_position(r,o,{setWidth:!1,setHeight:!1,offsetTop:u.top-s,offsetLeft:u.left}),r.addClass("position-"+d),f&&je.clone_position(a,o,{setWidth:!1,setHeight:!1,setTop:!1,offsetLeft:u.left+u.tail_offset_left+Se(r).outerWidth()/2}),h=function(){var e;if(r.data("pending-delay")&&o.data("bubble-id")===_)return e=parseInt(o.data("title-fade-time"))||400,r.fadeIn(e)},l?(r.hide(),r.data("pending-delay",!0),setTimeout(h,l)):r.css({opacity:""})},n=function(e,t){var n,i,r;if(e=$(e),r=e.getAttribute("data-title-position"),n=document.viewport.getDimensions(),i=e.viewportOffset(),"above"!==r&&"below"!==r&&"right"!==r&&"left"!==r&&(r="above"),"left"===r){if(i.left<t.width)return"right"}else if("right"===r){if(n.width-(i.left+e.getWidth())<t.width)return"left"}else if("below"===r){if(n.height-(i.top+e.getHeight())<t.height)return"above"}else if("above"===r&&i.top<t.height)return"below";return r},t=function(e,t,n){var i,r,o,s,a,_,l,u,d,c;return t=$(t),n=$(n),o=document.viewport.getDimensions(),i=t.getDimensions(),s=n.viewportOffset(),r=6,a=0,_=0,d=0,c=0,("below"===e||"above"===e)&&(_="below"===e?n.getHeight()+r:-1*i.height-r,l=n.getWidth()/2-i.width/2,s.left+l+i.width>o.width?(a=o.width-s.left-i.width,d=l-a-5):(a=l,d=-5)),("left"===e||"right"===e)&&(a="right"===e?n.getWidth()+r:-1*i.width-r,u=n.getHeight()/2-i.height/2,s.top+u+i.height>o.height?(_=o.height-s.top-i.height,c=u-_-5):(_=u,c=-5)),{left:a,top:_,tail_offset_left:d,tail_offset_top:c}},i=function(e){var t,n,i;return n=Se(null!=e?e.currentTarget:void 0),t=Se("#"+n.data("bubble-id")),t.data("pending-delay")?(t.removeData("pending-delay"),i=parseInt(n.data("title-fade-time"))||400,t.fadeOut(i,function(){return t.remove()})):t.remove()},{init:function(){return Se(document).on("mouseenter",".title_bubble",r),Se(document).on("mouseleave",".title_bubble",i).on("mouseup",".title_bubble",i),Se(document).on("mouseenter",".title_bubble_sticky",r),Se(document).on("mouseleave",".title_bubble_sticky",i)},set_vertical_space:o,hide_all:function(){return Se(".title_bubble_container").remove()}}}();var bi;bi=INLINE_JS.Tooltip=ft.Tooltip={attach:function(e,t,n,i){var r,o;return null==i&&(i={}),e=$(e),n=n?$(n):null,r=hi.make(t,e.tail_position,i.tail_position,i.width,i),r.setStyle({display:"none",position:"absolute"}),$("floaters").__sert(r),r.style.zIndex=e.match("#modal-content *")||e.match(".db-modal-content *")?"13001":"","right"===e.tail_position&&(o=Zt.ie?32:12,r.style.marginLeft=-(r.getWidth()+e.getWidth()+o)+"px"),e.tooltip=r,e.out_target=n?!0:!1,e.observe("mouseout",this.mouseout("target",e)),e.observe("mouseover",this.mouseover("target",e)),e.out_trigger=n?!1:!0,n&&(n.observe("mouseout",this.mouseout("trigger",e)),n.observe("mouseover",this.mouseover("trigger",e))),e.out_tooltip=!0,r.observe("mouseout",this.mouseout("tooltip",e)),r.observe("mouseover",this.mouseover("tooltip",e))},update:function(e,t){return e.tooltip?$(e.tooltip).update(t):void 0},mouseover:function(e,t){return function(){return t["out_"+e]=!1}},mouseout:function(e,t){return function(){return t["out_"+e]=!0,bi.hide_if_out.defer(t)}},show_by:function(e){var t,n;return t=Se(e.tooltip),e=Se(e),t.show(),n=Math.floor(t[0].offsetHeight/2),je.clone_position(t,e,{setWidth:!1,setHeight:!1,offsetTop:Math.floor(e[0].offsetHeight/2)-n,offsetLeft:e[0].offsetWidth+1})},hide_if_out:function(e){var t;if(e.out_target&&e.out_trigger&&e.out_tooltip)return t=$(e.tooltip),t.hide()},show:function(e,t,n,i,r){return null==i&&(i="left"),e=$(e),e.tail_position||(e.tail_position=i),n=n?$(n):null,e.tooltip||this.attach(e,t,n,r),this.show_by(e)}};var yi;yi=INLINE_JS.TreeView=ft.TreeView={tv:{},loaded:!1,user:null,role_icon:"",set_params:function(e){return this.ajax_params=e},init:function(e,t,n){var i;return null==n&&(n="treeview"),this.tv[n]={},i=this.tv[n],i.autohide=null===t?!0:t,i.handler=e,i.viewdiv=$(n),i.hidefunc=this.hide.bindAsEventListener(this),this.ajax_params={},document.observe(lr.ADD,function(e){return function(){return e.schedule_reset()}}(this)),document.observe(lr.REMOVE,function(e){return function(){return e.schedule_reset()}}(this)),document.observe(lr.MOVE,function(e){return function(){return e.schedule_reset()}}(this))},schedule_reset:function(){return this.loaded=!1},reset:function(e){var t,n,i,r,o,s,a;return t={url:"/ajax_subtreeview",type:"post",data:Se.extend({},this.ajax_params),success:function(t){return function(n){var i,r;i=[];for(r in t.tv)t.tv.hasOwnProperty(r)?(t.tv[r].viewdiv.down(".treeview-folders").update(n),i.push(e&&e.onSuccess?e.onSuccess(n):void 0)):i.push(void 0);return i}}(this)},(null!=e?e.user:void 0)?(e.user.id!==(null!=(n=this.user)?n.id:void 0)&&(o=Se("<p />",{id:"treeview-loading"}),s=Se("<img />",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),o.append(s),a=" "+zt("Loading your folders"),o.append(a),Se("#dest-treeview .treeview-folders").html(o),this.user=e.user),t.subject_user=e.user,r=G.get_role_title(e.user),i=G.get_viewer().is_paired?e.user.is_team?"s_briefcase":"s_house":"dropbox",r||(r=zt("Dropbox")),Se("#first-treeview-link span").text(r),ee.replace(Se("#root-img")[0],"web",this.role_icon,i),this.role_icon=i):Se("#first-treeview-link span").text(zt("Dropbox")),Se.ajax(t)},toggle:function(e,t){var n;return Event.stop(e),n=this.tv[t||"treeview"],n.shown?(n.shown=!1,this.hide(e,t)):(n.shown=!0,this.show(e.target,t)),!1},hide:function(e,t){var n;return n=this.tv[t||"treeview"],e&&$(e.target).descendantOf(n.viewdiv)?void 0:(n.viewdiv.hide(),Event.stopObserving(window,"click",n.hidefunc),n.shown=!1)},show:function(e,t){var n,i;return i=this.tv[t||"treeview"],e=$(e),e.blur(),n=e.cumulativeOffset(),i.viewdiv.setStyle({top:n.top+e.getHeight()+"px",left:n.left-4+"px"}),i.viewdiv.show(),Event.observe(window,"click",i.hidefunc)},toggleNode:function(e){var t;return e=$(e),t=e.down("img"),t.className.match("bullet_plus")?ee.replace(t,"web","bullet_plus","bullet_minus"):ee.replace(t,"web","bullet_minus","bullet_plus"),e.up().next("div").toggle(),e.blur(),!1},toggleNodeAjax:function(e,t,n){var i,r;return e.fetched_children?this.toggleNode(e):(e=$(e),i=e.down("img"),r=ee._get(i),i.src="/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",Se.ajax({url:"/ajax_subtreeview"+t,type:"post",data:Se.extend({},this.ajax_params),subject_user:n,success:function(t){return function(n){var o;return o=new Element("div",{style:"display: none;"}).update(n),e.up().__sert({after:o}),e.fetched_children=!0,ee._set(i,r),t.toggleNode(e)}}(this),complete:function(){return/loading/.match(i.src)?ee._set(i,r):void 0}}),!1)},handle:function(e,t){var n,i;return n=$H(this.tv).keys(),(i=$(t).ancestors().find(function(e){return n.include(e.id)}))?(i=this.tv[i.id],Se(document).trigger("db:treeview_selected",[e]),i.handler&&i.handler(e,t),i.autohide&&this.hide(i.id),!1):void 0},move:function(e,t,n){var i;return i=$(e),this.loaded?n&&n.onSuccess&&n.onSuccess():this.reset({onSuccess:function(i){return function(){return i.loaded=1,i.move(e,t,n)}}(this),user:null!=n?n.user:void 0}),wt(i,"Couldn't find tree_id"),wt($(t),"Couldn't find location_id"),$(t).appendChild(i),i.show()}};var ki;ki=ft.ULSelectMenu=function(){var e,t,n,i,r,o,s,a,_,l,u;return e=function(e){return e.removeClassName("shown")},u=function(e){return e.toggleClassName("shown")},s=function(){return this.removeClassName("hover")},o=function(){return this.addClassName("hover")},a=function(e,t){var n,i,r,o;for(r=[],n=0,i=t.length;i>n;n++)o=t[n],r.push(e.insert(o));return r},i=function(e,t,n){return a(e,n),e.firstChild!==t?e.__sert({top:t}):void 0},_=function(e,t){var n;return n="selected",Se(e).find("."+n).removeClass(n),Se(t).addClass(n)},l=function(e,t){var n,i,r,o,s;for(o=e.select("li"),s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push(n.getAttribute("data-value")===t?_(e,n):void 0);return s},r=function(t,n,r){return function(){return t.hasClassName("selected")?(i(n,t,r),u(n)):(_(n,t),n.fire("db:change",t.getAttribute("data-value")),e(n))}},t=function(t){var n,i,a,_,l,u,d,c;if(_=t.select("li"),wt(_.length,"Empty list of options "+t.identify()),l=void 0,1===_.length)t.addClassName("one");else{for(i=0,a=_.length;a>i;i++)n=_[i],d=n.getAttribute("data-value"),wt(d,n.identify()+" missing data value"),n.observe("click",r(n,t,_)),n.observe("mouseenter",o),n.observe("mouseleave",s),n.hasClassName("selected")&&(l=n);$(document.body).observe("click",function(n){return $(n.target).up(".ul_select_menu")!==t?e(t):void 0})}return l||(l=_[0]),l.addClassName("selected"),c=new Element("span"),u=l.getDimensions(),c.setStyle({width:u.width+"px",height:u.height+"px",position:"relative",display:"inline-block"}),t.wrap(c)},n=function(){var e,n,i,r,o;for(r=$$(".ul_select_menu"),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(t(e));return o},Se(n),{init:function(e){return t(e)},set_selected_by_value:l}}();var Ei;Ei=ft.DBCalendar=Class.create({initialize:function(e,t){return this.options=t||{},this.container=$(e),wt(this.container,"Couldn't find the element"),this.today=new Date,this.options.disable_future&&(this.options.last_day=Zt.start_of_day(this.options.last_day||this.today)),this.options.disable_past&&(this.options.first_day=Zt.start_of_day(this.options.first_day||this.today)),this.view_date=Zt.start_of_day(this.options.selected_date||this.today),this.selected_date=Zt.start_of_day(this.options.selected_date||this.today),this.render()},_change_month:function(e,t){return Event.stop(e),this.view_date.setMonth(t),this.render()},is_valid_date:function(e,t,n,i,r){var o;return e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10),i=parseInt(i,10),r=parseInt(r,10),i=i||1970,r=r||(new Date).getFullYear()+1,t+=1,i>n?!1:n>r?!1:1>t||t>12?!1:0>=e?!1:2===t?(o=n%4===0&&(n%100!==0||n%400===0),o?29>=e:28>=e):4===t||6===t||9===t||11===t?30>=e:31>=e},change_date:function(e,t,n){var i;if(this.is_valid_date(e,t,n))return i=n!==this.view_date.getFullYear()||t!==this.view_date.getMonth(),this.selected_date=new Date(n,t,e),i?(this.view_date.setMonth(t),this.view_date.setFullYear(n),this.render()):(Se(this.container).find(".selected").removeClass("selected"),Se(this.container).find("a#day"+e+"-"+t).addClass("selected")),this.options.onDateChange?this.options.onDateChange(this.selected_date):void 0},render:function(){var e,t,n,i,r,o,s,a,_,l;return t=this.render_days(),i=Se(".current-month",t),s=i.first().data("date"),o=i.last().data("date"),l=s<=this.options.first_day,_=o>=this.options.last_day,e=new Element("div"),e.addClassName("calendar clearfix"),_||(this._next_month=function(e){return this._change_month(e,this.view_date.getMonth()+1)}.bind(this),r=new Element("a"),r.addClassName("changemonth next"),r.update(ee.make("web","arrowright",{})),Event.observe(r,"click",this._next_month),e.__sert(r)),l||(this._prev_month=function(e){return this._change_month(e,this.view_date.getMonth()-1)}.bind(this),a=new Element("a"),a.addClassName("changemonth prev"),a.update(ee.make("web","arrowleft",{})),Event.observe(a,"click",this._prev_month),e.__sert(a)),n=new Element("h5"),n.update(zt("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:ae.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()})),e.__sert(n),e.__sert(t),this.container.__date(e)},render_days:function(){var e,t,n,i,r,o,s,a,_;for(t=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1),a=t.getDay(),e=new Element("div"),e.addClassName("days"),n=r=_=a;0>=_?0>r:r>0;n=0>=_?++r:--r)s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s.setDate(s.getDate()-n),e.__sert(this.render_day(s,!0));for(i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);i.getMonth()===this.view_date.getMonth();)e.__sert(this.render_day(i)),i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),i.getDate()+1);for(o=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);6!==o.getDay();)o=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1),e.__sert(this.render_day(o,!0));return e},render_day:function(e,t){var n,i;return i=!t,this.options.last_day&&(t=t||e>this.options.last_day),this.options.first_day&&(t=t||e<this.options.first_day),n=new Element(t?"span":"a"),Se(n).data("date",e),i&&n.addClassName("current-month"),n.update(e.getDate()),n.addClassName("date"),n.writeAttribute("id","day"+e.getDate()+"-"+e.getMonth()),this.selected_date.getDate()===e.getDate()&&this.selected_date.getMonth()===e.getMonth()&&this.selected_date.getFullYear()===e.getFullYear()&&n.addClassName("selected"),t?n.addClassName("inactive"):(this._handler=function(e){var t;return t=e.target.identify().substr(3).split("-"),this.change_date(t[0],this.view_date.getMonth(),this.view_date.getFullYear())}.bind(this),Event.observe(n,"click",this._handler)),n}});var xi;xi=ft.DatePickerInput=Class.create({initialize:function(e,t){var n,i,r,o;return this.container=e,this.options={},Object.extend(this.options,t||{}),this.input=this.container.down(".input-date"),this.display=this.container.down(".visible-date"),o=this.input.value?Zt.from_mysql_date(this.input.value):new Date,this.container.hasAttribute("data-first")&&(r=Zt.from_mysql_date(this.container.getAttribute("data-first"))),n=null!=this.options.disable_future?this.options.disable_future:!0,i=null!=this.options.disable_past?this.options.disable_past:!0,this.cal_container=this.container.down(".cal-container"),this.calendar=new Ei(this.cal_container,{onDateChange:this.onDateChange.bind(this),first_day:r,disable_future:n,disable_past:i,selected_date:o}),this.container.observe("click",this.show_cal.bindAsEventListener(this)),$(document.body).observe("click",this.hide_cal.bind(this)),this.onDateChange(o)},show_cal:function(e){var t;return e&&Event.stop(e),t=$(e.target),t.match(".cal-container")||t.up(".cal-container")?void 0:(Se(".cal-container").hide(),this.cal_container.show())},hide_cal:function(){return this.cal_container.hide()},onDateChange:function(e){return this.input.value=Zt.to_mysql_date(e,!1),this.display.update(Br.localize(e)),this.hide_cal()}});var Si;Si=ft.TextInputDatePicker=Class.create({initialize:function(e,t){var n,i,r,o;return this.options={include_seconds:!0,include_microseconds:!0,choose_eod:!1},Object.extend(this.options,t||{}),this.input=$(e),wt(this.input,"Couldn't find the element "+e.toString()),r=new Date,o=this.input.value?Zt.from_mysql_date(this.input.value):!1,i=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()),this.cal_icon=ee.make("web","calendar_view_month",{align:"absmiddle"}),this.cal_container=new Element("div",{id:"cal_container_"+e,style:"display: none; position: absolute; z-index: 1"}),this.calendar=new Ei(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:i,selected_date:o}),this.input.__sert({after:this.cal_icon}),this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this)),n=Se(this.input),je.clone_position(Se(this.cal_container),n,{setWidth:!1,setHeight:!1,offsetTop:n[0].offsetHeight}),this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(e){return e&&Event.stop(e),this.cal_container.toggle()},hide_cal:function(e){return e&&Event.stop(e),this.cal_container.hide()},onDateChange:function(e){return this.options.choose_eod&&e.setTime(Zt.start_of_day(e).getTime()+86399999),this.input.value=Zt.to_mysql_date(e,this.options.include_seconds,this.options.include_microseconds),this.hide_cal()}}),B.window_load(di.register.bind(di)),Se(vi.init.bind(vi)),Se(gi.register_all.bind(gi)),Event.observe(window,"scroll",function(){return wi.hide_all()}),Se(function(){return pi.interval=setInterval(pi.check.bind(pi),500),wi.init()});var Ci,Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty;Ci=INLINE_JS.ChangeNameModal=ft.ChangeNameModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"change-name-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,r;return t.preventDefault(),n=Se(t.target),i=n.closest("form"),r=function(){return e.hide(),location.reload()},ui.ajax_submit(i[0],!1,r,null,n[0])}}(this)}return Sn(t,e),t}(Dt);var Ti,Ai,Tn=function(e,t){return function(){return e.apply(t,arguments)}},Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty;Ai=ft.ManageAliasModal=function(e){function t(e){this.options=e,this._poll_until_verified=Tn(this._poll_until_verified,this),this._get_params_from_target=Tn(this._get_params_from_target,this),this._on_load=Tn(this._on_load,this),this._show_action_panel=Tn(this._show_action_panel,this),this._input_enter_handler=Tn(this._input_enter_handler,this),this.resend_verify=Tn(this.resend_verify,this),this.remove_alias=Tn(this.remove_alias,this),this.add_alias=Tn(this.add_alias,this),this.refresh_alias=Tn(this.refresh_alias,this),this.on_show=Tn(this.on_show,this),t.__super__.constructor.call(this,this.options)}return Sn(t,e),t.prototype.before_show=function(e){return t.__super__.before_show.call(this,e),this.polling=0,e.find(".alias-action").on("click",this._show_action_panel),e.find(".alias-action-submit").on("click",this.add_alias),e.find("form").submit(function(){return!1}),e.find(".alias-action-inputs input").on("keyup",this._input_enter_handler)},t.prototype.on_show=function(){return this.refresh_alias(!0,this._poll_until_verified)},t.prototype.refresh_alias=function(e,t){return null==e&&(e=!0),e&&ui.clear_errors(),new Ajax.DBRequest("/account/alias/get",{subject_user:this.options.subject_user,onSuccess:function(e){return function(n){return e.$modal_window.find(".dynamic-content").html(n.responseText),e._on_load(n),"function"==typeof t?t():void 0}}(this),onFailure:function(e){return function(){return e.hide()}}(this)})},t.prototype.add_alias=function(e){var t,n,i,r;return e.preventDefault(),n=Se(e.currentTarget).closest("form"),t=n.find(".alias-action-submit"),r={},r[O.UID_PARAM_NAME]=this.options.subject_user.id,i=function(e){return function(){var t;return e.$modal_window.find(".alias-action-inputs input").val(""),e.polling=0,t=e.polling?null:e._poll_until_verified,e.refresh_alias(!0,t)}}(this),ui.ajax_submit(n[0],!1,i,!1,t[0],r,"before")},t.prototype.remove_alias=function(e){var t;return e.preventDefault(),t=this._get_params_from_target(e.currentTarget),new Ajax.DBRequest("/account/alias/remove",{subject_user:this.options.subject_user,parameters:t,onSuccess:function(e){return function(){return e.refresh_alias()}}(this)})},t.prototype.resend_verify=function(e){var t;return e.preventDefault(),t=this._get_params_from_target(e.currentTarget),new Ajax.DBRequest("/account/alias/send_verify",{subject_user:this.options.subject_user,parameters:t,onSuccess:function(e){return function(){return e.refresh_alias()}}(this)})},t.prototype._input_enter_handler=function(e){return e.preventDefault(),e.stopPropagation(),13===e.which?this.add_alias(e):void 0},t.prototype._show_action_panel=function(e){var t,n;return e.preventDefault(),n=Se(e.currentTarget).data("target"),this.$modal_window.find(".alias-action-panel").hide(),t=this.$modal_window.find("#"+n).show(),t.find("input:visible:enabled:first").focus()},t.prototype._on_load=function(){return ci.register_all(),this.$dynamic=this.$modal_window.find("#alias-list-container"),this.$dynamic.on("click",".alias-remove",function(e){return function(t){return e.remove_alias(t)}}(this)),this.$dynamic.on("click",".alias-verify",function(e){return function(t){return e.resend_verify(t)}}(this))},t.prototype._get_params_from_target=function(e){var t,n,i;return t=Se(e),i=t.data("alias-type"),n=t.closest(".alias-row").find(".alias-text").text(),{alias:n,alias_type:i}},t.prototype._poll_until_verified=function(){var e,t,n,i;return t=5,e=60,n=function(e){return function(){return e.refresh_alias(!1,e._poll_until_verified)}}(this),i=this.$dynamic.find(".alias-verify").length,i&&this.polling<e?(this.polling++,setTimeout(n,1e3*t)):this.polling=0},t}(Dt),Ti=INLINE_JS.AliasManager=ft.AliasManager={show:function(e){var t,n,i,r;if(r=G.get_viewer().get_user_by_role(e),null!=r){if(!r.is_email_verified)return void(e===O.ROLE_PERSONAL?personal_email_verification.verified_or_show():work_email_verification.verified_or_show());i=G.get_viewer().is_paired?e:"",n=zt("Manage your %(role_show)s contact methods").format({role_show:i}),t=new Ai({element_id:"manage-alias",title:n,subject_user:r,role:r.role}),t.show()}}};var Di;Di=INLINE_JS.BonusTable=ft.BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:!1,init:function(e){return this.user_id=e,Di._inited?void 0:(Di._inited=!0,$("bonus-loading").show(),Di._tmpl=lt.tmpl("bonus_row_tmpl"),Di.listen(),Di.get_next_page())},_render:function(e){var t,n,i,r;for(t=[],n=0,i=e.length;i>n;n++)r=e[n],t.push(Di._tmpl({row:r,Sprite:ee}));return $("bonus-table").__sert(t)},get_next_page:function(){return Di._fetching_page?void 0:(Di._fetching_page=!0,new Ajax.DBRequest("/account/bonus_page/"+Di._next_page,{onSuccess:function(e){var t,n,i;return t=e.responseText.evalJSON(),i=t.rows,n=t.has_more,Di._render(i),$("bonus-loading").hide(),n?(Di._next_page+=1,$("load-more-bonus").show()):$("load-more-bonus").hide(),Di._fetching_page=!1},subject_user:this.user_id}))},_max_referral_over:function(e){var t,n,i;return n=Se(e.currentTarget),i=zt("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!"),t=Se(hi.make(i,"right","middle")),Element.absolutize(t[0]),n.append(t),je.clone_position(t,n,{setWidth:!1,setHeight:!1}),t.css({width:"200px",left:parseInt(t.css("left"),10)-210+"px",top:parseInt(t.css("top"),10)-55+"px"})},_max_referral_out:function(){var e,t,n,i,r;for(i=Se(".reached-max-referral-bonus .bubble"),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(e.remove());return r},listen:function(){return Se("#load-more-bonus").on("click",Di.get_next_page.bind(Di)),Se(document).on("mouseenter",".reached-max-referral-bonus",Di._max_referral_over),Se(document).on("mouseleave",".reached-max-referral-bonus",Di._max_referral_out)},toggle:function(){return Se("#bonus-list").is(":visible")?(this.hide(),Se("#space-earned-link").text(zt("View all space earned"))):(this.show(),Se("#space-earned-link").text(zt("Hide space earned")))},show:function(){return Se("#bonus-list").slideDown(150)},hide:function(){return Se("#bonus-list").slideUp(150)}};var Oi,Ni,Ii;Oi=INLINE_JS.DowngradeReasons=ft.DowngradeReasons={reasons:{},addReason:function(e){return this.reasons[e]=!0},addReasons:function(e){var t,n,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(this.addReason(n));return r},change:function(e,t,n){var i,r,o,s,a,_;e=parseInt(e,10),r=$(t),wt(r,"Couldn't find container for DowngradeReason"),i=!1,a=this.reasons;for(s in a)o=a[s],_=$(n+s),wt(_,"Couldn't find container for ",n+s),o&&parseInt(s,10)===e?(_.show(),i=!0):_.hide();return i?r.show():r.hide()}},Ni=ft.DowngradeReasons2={init:function(){var e,t,n,i;for(i=["input[name=downgrade_reason_id]","input[name=other_reason_id]"],e=0,t=i.length;t>e;e++)n=i[e],Se(n).change(function(e){var t;return t=e.target.id.indexOf("other")>=0,Ni.change(t,e.target.getValue())});return Se(".shared-additional-info").attr("name","shared_additional_info")},change:function(e,t){var n;return Se(".downgrade-other-reason .error-message").hide(),e?void 0:(n="#downgrade-info-"+t,Se(".downgrade-info").hide(),Se(n).show(),Se(".downgrade-info textarea").removeAttr("name"),Se(n+" textarea").attr("name","additional_info"),Se("input[name=other_reason_id]").removeAttr("checked"))}},Ii=ft.DowngradeSurvey={init:function(){var e;return e="#downgrade-survey-form",Se(""+e).on("submit",function(){return function(t){var n,i;return i=Se(e+" input[name=other_reason_id]:checked").length,n=Se(e+" input[id=downgrade-radio-8]"),n.is(":checked")&&0===i?(Se(".downgrade-other-reason .error-message").show(),t.preventDefault()):void 0}}(this))}};var $i;$i=INLINE_JS.GetSpace=ft.GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,offer_highlight_color:"#ffa",init:function(e,t,n){var i;return $i._current_space=e,$i._why_msg=t,$i._twitter_url=n,$("space-actions").on("click",".space-action",$i.perform_action),i=o.parse(window.location.href).fragment,i?$i.highlight_offer(i):void 0},highlight_offer:function(e){var t,n;return t=Se("#"+e),n=t.css("background-color"),t.css("background-color",$i.offer_highlight_color).delay(2e3).animate({"background-color":n}).queue(function(){return t.css("background-color","")})},perform_action:function(e){var t,n;return n={contact_sales:$i._contact_sales,contact_support:$i._contact_support,teams:$i._teams,upgrade:$i._upgrade,plans:$i._plans,refer:$i._refer,get_started:$i._get_started,fb_link:$i._fb_link,twitter_link:$i._twitter_link,twitter_follow:$i._twitter_follow,why_like:$i._why_like,mailbox_link:$i._mailbox_link},t=$(e.target),t.hasClassName("space-action")||(t=t.up(".space-action")),n[t.id]()},_teams:function(){return window.location.href="/business?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return H.do_auth(function(){return $i._refresh_link_bonuses(),$i._completed($("fb_link"))},G.get_viewer().personal_user.id)},_twitter_link:function(){return Yr.do_auth(function(){return $i._refresh_link_bonuses(),Yr.set_is_authed(G.get_viewer().personal_user.id,!0),$i._completed($("twitter_link"))},G.get_viewer().personal_user.id)},_twitter_follow:function(){return Yr.is_authed(G.get_viewer().personal_user.id)?$i.follow_dropbox():Yr.do_auth($i.follow_dropbox,G.get_viewer().personal_user.id)},_why_like:function(){return mi.show(zt("Tell us why you love Dropbox"),$("why-i-like-modal")),$("why-i-like-input").focus(),Zt._track_twitter_chars_left("why-i-like-input",90)},_mailbox_link:function(){return window.location.href="http://www.mailboxapp.com/"},follow_dropbox:function(){return Yr.is_authed(G.get_viewer().personal_user.id)||($i._refresh_link_bonuses(),Yr.set_is_authed(G.get_viewer().personal_user.id,!0)),Yr.follow_dropbox({showWorking:function(){return $("twitter_follow").down(".title").__date(zt("Following Dropbox on Twitter..."))},onFailure:function(){return $("twitter_follow").down(".title").__date(zt("Follow Dropbox on Twitter"))},onSuccess:function(){return $("twitter_link")&&$("twitter_link").visible()&&$i._completed($("twitter_link")),$i._completed($("twitter_follow"))}},G.get_viewer().personal_user.id)},submit_why:function(){return $i._why_msg=$F("why-i-like-input"),ui.ajax_submit($("why-i-like-form"),!1,function(){return mi.hide(),$i._completed($("why_like"))},!1,$("why-i-like-submit"))},_completed:function(e){var t;return e.addClassName("completed"),e.down(".icon-col").__date(Element("img",{src:"/static/images/check_36-vflimxFPn.png"})),Se(e).css("opacity",.5).fadeTo(500,1),setTimeout(function(){return Se(e).css("opacity",1).slideUp().animate({opacity:0},{queue:!1,duration:"normal"})},1500),t=parseInt(e.down(".space").readAttribute("data-space"),10),$i._current_space+=t,$("current-space").__date(j.format_bytes($i._current_space)),$("current-space").addClassName("updated"),setTimeout(function(){return $("current-space").removeClassName("updated")},5e3)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};var Li;Li=ft.Help={toggle_more_help:!1,show_os:function(e,t,n){return t=$(t),$$(".os-filter").invoke("removeClassName","selected"),t.addClassName("selected"),$$(".help-os-section").invoke("hide"),$$(".help-os-"+n).invoke("show"),Event.stop(e)},vote:function(e,t){return new Ajax.DBRequest("/help/"+e+"/vote/"+t),Se("#help-vote-cont").fadeOut(),k.success(zt("Thanks for your feedback!"))}};var Ri,Mi,Fi,Pi,Tn=function(e,t){return function(){return e.apply(t,arguments)}},Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty;Mi=INLINE_JS.Hosts=ft.Hosts={attach_host_listener:function(e,t){var n,i,r,o;return n=Se("#"+e),r=n.data("host-ids"),i=n.data("display-name"),o=function(){return new Fi(r,i,t,null,null).show()},Se(".unlink-host-link",n).on("click",o),n.on("dblclick",function(){return Mi.edit(r,e)})},edit:function(e,t){var n,i,r,o,s,a;return r=Se("#"+t+" .host-item .sprite-text"),"true"===r.data("editing")?!1:(r.data("editing","true"),i=r.text(),r.data("previous",i),e=w.values(e),o=Se('<input type="text" class="name-input skinny-input" size="20" maxlength="256" style="word-wrap: break-word;" />').val(i),a=Se('<input type="button" class="button">').val(zt("Save")),a.on("click",function(){return Mi.doneEditing(e,t)}),n=Se('<input type="button" class="button grayed">').val(zt("Cancel")),n.on("click",function(){return Mi.cancelEditing(t)}),r.empty(),r.append(o,"&nbsp;",a,"&nbsp;",n),s=Se("input",r),s.on("keydown",function(){return Mi.checkKey(e,t)}),s.focus(),!1)},doneEditing:function(e,t){var n,i;return n=Se("#"+t+" .host-item .sprite-text"),i=Se("input",n).val(),Se.ajax({url:"/account/change_host_name",data:{host_ids:JSON.stringify(e),name:i},type:"POST"}).success(function(e){return Mi.unedit(n,JSON.parse(e).display_name)})},cancelEditing:function(e){var t;return t=Se("#"+e+" .host-item .sprite-text"),Mi.unedit(t,t.data("previous"))},unedit:function(e,t){return e.data("editing","false"),e.text(t)},dismiss:function(e,t,n,i,r){return new Se.ajax("/account/dismiss_unlink",{type:"POST",data:{host_id:e,user_id:t,team_id:n
},subject_user:r,success:function(){return i.remove()}}),!1},checkKey:function(e,t){return function(n){return n=n||window.event,n.keyCode===Event.KEY_RETURN&&Mi.doneEditing(e,t),n.keyCode===Event.KEY_ESC?Mi.cancelEditing(t):void 0}},show_device_unlink_modal:function(e,t,n,i,r,o){var s,a;return s=Se("#unlink-device-modal-"+r),a={both:w.values(i),personal:[i[O.ROLE_PERSONAL]],work:[i[O.ROLE_WORK]]},mi.show(n,s[0]),w.values(i).length>1&&s.addClass("show-selector"),Se("form input[type=submit]",s).on("click",function(n){return n.preventDefault(),i=a[Se(".unlink-select select",s).val()],ui.add_vars(Se("form",s)[0],{user_ids:JSON.stringify(i),app_id:t,device_id:JSON.stringify(e),device_name:o}),Se("form",s).submit()})}},Ri=ft.DeleteFailuresModal=function(e){function t(){return this.on_show=Tn(this.on_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),window.location.href="/delete_failures?host_id="+this.host_id,this.hide()},t.prototype.on_show=function(){var e;return e=Bt("Dropbox couldn't delete %(num_failures)d file from the computer <strong>%(host_name)s</strong>. You can download the name of this file and the reason why it couldn't be deleted.","Dropbox couldn't delete %(num_failures)d files from the computer <strong>%(host_name)s</strong>. You can download the names of these files and the reasons why they couldn't be deleted.",this.num_failures).format({host_name:this.name.escapeHTML(),num_failures:this.num_failures}),this.$modal_window.find(".failures_message").html(e)},t}(Dt),Pi=INLINE_JS.show_delete_failures_modal=ft.show_delete_failures_modal=function(e,t,n){var i;return i=new Ri({element_id:"delete-failures-modal"}),i.host_id=e,i.name=t,i.num_failures=n,i.show(),!1},Fi=INLINE_JS.UnlinkHostModal=ft.UnlinkHostModal=function(e){function t(e,n,i,r,o){this.host_ids=e,this.name=n,this.delete_support_type=i,this.owner_id=r,this.team_id=o,this.on_show=Tn(this.on_show,this),this._set_delete_text=Tn(this._set_delete_text,this),this.fail_callback=Tn(this.fail_callback,this),this.success_callback=Tn(this.success_callback,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"unlink-host-modal"}),this.show_host_selector=w(this.host_ids).values().length>1}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i;return e.preventDefault(),n=this.$modal_window.find(".unlink_host_form")[0],t=$(this.$modal_window.find(".confirm-button")[0]),this.$modal_window.find("[type=button]").attr("disabled",""),i={host_ids:JSON.stringify(this.get_selected_hosts())},ui.ajax_submit(n,!1,this.success_callback,this.fail_callback,t,i)},t.prototype.success_callback=function(){return window.location.reload()},t.prototype.fail_callback=function(){return this.$modal_window.find("[type=button]").removeAttr("disabled")},t.prototype._set_delete_text=function(e){return this.$modal_window.find(".delete_data_label").text(e)},t.prototype._get_unlink_select=function(){return this.$modal_window.find(".unlink-select select").val()},t.prototype._clear_delete_checkbox=function(){return this.$modal_window.find(".delete_data").prop("checked",!1)},t.prototype.on_show=function(){var e;return this._clear_delete_checkbox(),this.delete_support_type===f.DELETE_ON_UNLINK_OLD_CLIENT?this.$modal_window.find(".unlink_host_modal_content").addClass("show_old_client_modal"):this.delete_support_type===f.DELETE_ON_UNLINK_UNSUPPORTED?this.$modal_window.find(".unlink_host_modal_content .unlink_host_form").addClass("hidden"):this.delete_support_type===f.DELETE_ON_UNLINK_SUPPORTED_TEAM_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(){return e._get_unlink_select()===O.ROLE_PERSONAL?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(zt("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:G.get_viewer().team_name}))):this.delete_support_type===f.DELETE_ON_UNLINK_SUPPORTED_PERSONAL_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(){return e._get_unlink_select()===O.ROLE_WORK?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(zt("Delete files from my personal Dropbox the next time this computer comes online."))):this.delete_support_type===f.DELETE_ON_UNLINK_SUPPORTED&&(this._set_delete_text(zt("Delete files from these Dropboxes the next time this computer comes online.")),this.$modal_window.find(".unlink-choice").change(function(e){return function(){return e._set_delete_text(e._get_unlink_select()===O.ROLE_PERSONAL?zt("Delete files from my personal Dropbox the next time this computer comes online."):e._get_unlink_select()===O.ROLE_WORK?zt("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:G.get_viewer().team_name}):zt("Delete files from these Dropboxes the next time this computer comes online."))}}(this))),this.show_host_selector&&(e="<span class='host_name'></span>",this.$modal_window.find(".unlink-select").removeClass("hidden"),this.$modal_window.find(".unlink-modal-text").html(zt("Which Dropboxes do you want to unlink from %(host_name)s? Any Dropbox you unlink will immediately stop syncing.").format({host_name:e}))),this.$modal_window.find("[name=host_id]").attr("value",this.host_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=user_id]").attr("value",this.owner_id),this.$modal_window.find(".host_name").text(this.name)},t.prototype.get_selected_hosts=function(){var e;return 1===w.values(this.host_ids).length?w.values(this.host_ids):(e=Se(".unlink-choice").val(),"both"===e?w.values(this.host_ids):[this.host_ids[e]])},t}(Dt);var qi;qi=ft.News={DEFAULT_TAB:"recent-news",init:function(){return $("news-home").on("click","#nav a",function(e,t){var n;return t.hasAttribute("data-div")?(e.preventDefault(),n=t.readAttribute("data-div"),v.push_state("/news/"+n)):void 0}),v.add_callback("/news",qi.history_change)},change_tab:function(e){var t;return t=$$("#nav a[data-div="+e+"]").first(),$(t)?($$(".section").invoke("removeClassName","selected"),$$("#nav a").invoke("removeClassName","selected"),$(t).addClassName("selected"),$(e).addClassName("selected")):void 0},history_change:function(e){return e=e||qi.DEFAULT_TAB,qi.change_tab(e)}};var Ui;Ui=ft.Recover={init:function(){var e;return e=$("recover-form"),e.observe("submit",this.form_submit.bind(this))},form_submit:function(e){return this.clear_error(),e.preventDefault(),ui.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(e){var t;return t=JSON.parse(e.responseText),"error"===t.status&&this.show_error(t.msg),"ok"===t.status&&this.show_hosts(t),"redirect"===t.status?window.location.href=t.url:void 0},show_hosts:function(e){var t,n,i,r,o,s,a;for(ui.add_vars($("recover-form"),{check_file:"true"}),$("filename-to-create").update(e.filename),n=$("trusted-hosts"),n.update(),a=e.hosts,i=0,o=a.length;o>i;i++)t=a[i],s=new Element("li"),r="lnx","mac"===t.platform&&(r="osx"),"win"===t.platform&&(r="win"),s.__sert(ee.make("web",r)),s.__sert(new lt(t.display_name.escapeHTML())),n.appendChild(s);return $("login-step").hide(),$("hosts-step").show()},show_error:function(e){return $("error-messages").update(e),$("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var ji;ji=ft.Restore={next:function(){var e,t;return t=Se("ul.selected"),e=t.next("ul"),e.addClass("selected"),t.removeClass("selected"),e.next("ul").length?Se("#next-page").show():Se("#next-page").hide(),Se("#prev-page").show(),ji.inc_page(1)},prev:function(){var e,t;return t=Se("ul.selected"),e=t.prev("ul"),e.addClass("selected"),t.removeClass("selected"),e.prev("ul").length?Se("#prev-page").show():Se("#prev-page").hide(),Se("#next-page").show(),ji.inc_page(-1)},inc_page:function(e){var t,n;return t=parseInt(Se("#page_num").text(),10),n=t+e,Se("#page_num").text(n)},init:function(e,t,n){var i;return i=G.get_viewer().get_user_by_id(n),Se("#next-page").on("click",function(e){return ji.next(e),!1}),Se("#prev-page").on("click",function(e){return ji.prev(e),!1}),Se("#restore-submit-button").on("click",function(){return li.do_folder_restore(e,i),!1}),Se("#restore-cancel-button").on("click",function(){return st.redirect(t)}),Se("#restore-back-button").on("click",function(){return st.redirect(t)})}};var Bi,zi,Hi,Vi,Yi,Tn=function(e,t){return function(){return e.apply(t,arguments)}},Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty;Bi=ft.SelectRoleModal=function(e){function t(){return this.on_show=Tn(this.on_show,this),t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_select_role=null,t.prototype.on_show=function(){return Se(".role-options li").click(function(e){return function(t){var n,i;return n=Se(t.target).closest("li"),i=n.data("role"),wt(e.on_select_role,"missing on_select_role implementation"),e.on_select_role(i),e.hide()}}(this))},t}(Dt),Hi=ft.SharedFolderSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return jn.role_picker.ensure_role_is_visible(e),an.start_wizard_for_user(G.get_viewer().get_user_by_role(e))},e===se.logged_out_role?se.show_modal({role:e,on_success:t}):t()},t}(Bi),Vi=ft.ShmodelC2DSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return Kn.show_c2d_modal(e)},G.get_viewer().is_role_signed_in(e)?t():se.show_modal({role:e,on_success:t})},t}(Bi),Yi=ft.ShmodelSyncSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return Kn.request_shared_folder_sync(e)},G.get_viewer().is_role_signed_in(e)?t():se.show_modal({role:e,on_success:t})},t}(Bi),zi=ft.ShareShmodelSelectRoleModal=function(e){function t(){return this.on_select_role=Tn(this.on_select_role,this),t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_select_role=function(e){return Kn.prompt_login_then_share(this.options.link_url,this.options.short_url,this.options.tokenizer_type,e)},t}(Bi);var Wi;Wi=ft.TabController=Class.create({initialize:function(e,t){var n;return n=$(e),wt(n,e+" is missing."),this.container=n,this.options={killEvent:!0},Object.extend(this.options,t),this.listen()},listen:function(){var e,t,n,i,r,o;for(o=this,i=this.container.select("a"),r=[],t=0,n=i.length;n>t;t++)e=i[t],wt(e.id&&e.id.length>0,"Element is missing an id"),r.push(e.observe("click",function(e){return this.click(e)}.bindAsEventListener(o)));return r},click:function(e){return this.options.killEvent&&Event.stop(e),this.toggle($(e.target))},toggle:function(e){var t,n,i,r,o;return o=this.container.down("a.selected"),o&&(r=$(o.id+"-content"),r&&r.hide()),this.container.select(".selected").invoke("removeClassName","selected"),n=!1,e||(e=this.container.down("a"),n=!0),e.addClassName("selected"),t=$(e.id+"-content"),t&&t.show(),this.options.onTabChange&&this.options.onTabChange(e,o),this.options.url_prefix?(i=this.options.url_prefix,n||(i+="/"+e.id),v.push_state(i)):void 0}});var Ki;Ki=ft.InviteForm={initialized:!1,init:function(){return this.initialized?void 0:Se(function(e){return function(){return e.add_auto_completer=new Autocompleter.ContactsTokenizer(G.get_viewer().get_user_by_role(O.ROLE_WORK),"team-invite-new-collab-input","team-invite-new-whobulk","team-invite-hidden-input",{tokens:[",",";"],hide_import_contacts:!0,suggestions_disabled:!0,contact_filter:function(e){return e.excludeTeamMembers().excludeFacebook().excludeNewStyleGroups().excludeMe()}}),e.add_auto_completer.clearTokens(),e.tokenAdd=Se.proxy(e._tokenAdd,e),e.tokenRemove=Se.proxy(e._tokenRemove,e),Se("#team-invite-new-collab-input")[0].on("token:add",e.tokenAdd),Se("#team-invite-new-collab-input")[0].on("token:remove",e.tokenRemove),e.reset_licenses(),e.update_free_licenses_message(),e.initialized=!0,e.setup_tab_support(Se),vi.init()}}(this))},set_emails:function(e){return null!=e?Se(function(t){return function(){var n,i,r,o,s;for(t.init(),s=[],r=0,o=e.length;o>r;r++)n=e[r],i=t.add_auto_completer.createTokenInfo(null,n,de.EMAIL),s.push(t.add_auto_completer.addContact(i));return s}}(this)):void 0},rebind_modal_submit_autocompleter:function(){var e,t;return e=this.invite_modal.$modal_window,t=e.find(".tokenizer-submit-button"),t.on("mousedown",function(e){return function(){return e.add_auto_completer.beforeSubmit()}}(this)),this.setup_tab_support(e)},setup_tab_support:function(e){return e.find("#team-invite-new-collab-input").first().on("keyup change",function(){var t;return t=e.find(".new-collab-input").first(),""!==t.val()?t.attr("tabindex",-1):t.removeAttr("tabindex")})},reset_modal_licenses:function(){var e,t,n;return n=null!=__CIRCULAR_DEPENDENCY__.Dashboard?__CIRCULAR_DEPENDENCY__.Dashboard.get_licensed_members():null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.get_licensed_members():window.active_team_member_table.get_licensed_members(),this.total_licenses=null!=(e=null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&"function"==typeof t.get_total_licenses?t.get_total_licenses():void 0)?e:this.total_licenses,this.update_used_licenses(n),this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},reset_licenses:function(){return this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},get_new_users:function(){return this.new_users},_tokenAdd:function(){return this.available_licenses--,Se(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users++},_tokenRemove:function(){return this.available_licenses++,Se(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users--},already_invited_user:function(e){var t,n,i;if(window.active_team_member_table){t=window.active_team_member_table.data.users;for(i in t)if(n=t[i],n.email===e)return!0}},update_license_count:function(){var e,t;return e=Se("#license-count-message"),this.available_licenses<0?(t=zt("You need more licenses for this invitation."),e.addClass("over")):0===this.available_licenses?(t=zt("You have no remaining licenses."),e.removeClass("over")):this.available_licenses>0?(t=Bt("You have %(invites)d remaining license.","You have %(invites)d remaining licenses.",this.available_licenses).format({invites:this.available_licenses}),e.removeClass("over")):t="You have   remaining licenses.",e.text(t)},init_modal_licenses:function(e,t,n,i){return this.total_licenses=e,this.is_trial=t,this.allow_trial_add_licenses=n,this.is_trial&&!this.allow_trial_add_licenses&&(i=void 0),this.invite_modal||(this.invite_modal=new Ji(i,this.is_trial)),Se("body").trigger("invite-modal-initialized")},update_used_licenses:function(e){return this.used_licenses=e,this.reset_licenses()},init_form_licenses:function(e,t,n){return this.total_licenses=e,this.used_licenses=t,this.is_trial=n,Ki.reset_licenses()},add_total_licenses:function(e){return e=e||0,e>0&&(this.total_licenses+=e,this.available_licenses+=e,this.update_license_count(),null!=__CIRCULAR_DEPENDENCY__.Dashboard)?__CIRCULAR_DEPENDENCY__.Dashboard.add_licenses(e):void 0},on_add_licenses_exit:function(e,t){var n;return(null!=(n=this.invite_modal)?n.$modal_window:void 0)&&this.rebind_modal_submit_autocompleter(),this.add_total_licenses(t)},reset_modal:function(){var e;return e=this.invite_modal.$modal_window,gi.reset(e.find("#team-invite-message")[0]),this.add_auto_completer&&(this.add_auto_completer.clearTokens(),this.add_auto_completer.update.hide()),this.reset_modal_licenses(),e.find(".new-collab-input").val("")},on_add_licenses_click:function(e){var t;return e.preventDefault(),this.is_trial&&!this.allow_trial_add_licenses?(null!=(t=this.invite_modal)&&t.hide(),__CIRCULAR_DEPENDENCY__.add_more_licenses_to_trial()):(null!=this.add_licenses_cb&&Ot.unregister(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),this.add_licenses_cb=Se.proxy(this.on_add_licenses_exit,this),Ot.register(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),Ot.push(new __CIRCULAR_DEPENDENCY__.AddLicensesModal))},update_free_licenses_message:function(){var e;return e=this.invite_as_limited(),Se(".team-invite-add-licenses").toggle(!e),Se("#license-count-message").toggle(!e),Se("#license-free-message").toggle(e)},invite_as_limited:function(){var e;return e=Se('input[name="membership_type"]'),e&&e.is(":checked")}};var Ji,Tn=function(e,t){return function(){return e.apply(t,arguments)}},Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty;Ji=ft.InviteModal=function(e){function t(e,n){this.transition_view_model=e,this.is_trial=n,this._reset=Tn(this._reset,this),this._update_form_pricing_information=Tn(this._update_form_pricing_information,this),this._update_remaining_licenses_message=Tn(this._update_remaining_licenses_message,this),this._make_transition_info_request=Tn(this._make_transition_info_request,this),this._handle_token_change=Tn(this._handle_token_change,this),this._licenses_total=Tn(this._licenses_total,this),this.is_making_transition_info_request=Tn(this.is_making_transition_info_request,this),this.on_hide=Tn(this.on_hide,this),this.on_show=Tn(this.on_show,this),t.__super__.constructor.call(this,{element_id:"team-invite-wizard",focus:".new-collab-input",title:zt("Invite team members")}),this.inline_add_license=null!=this.transition_view_model,this.inline_add_license&&(this.transition_info_fetcher=new Wt([this.transition_view_model]),this.probability=Math.random()),this.skip_reset=!1,this.making_transition_info_request=!1,this.transition_info_callback=null}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){var t;return t=Ki.invite_as_limited()?0:this.add_qty,rr.add_users(e,t)},t.prototype.on_show=function(){var e,t;return this._reset(),t=Se('input[name="membership_type"]'),null!=t&&t.attr("checked",!1),null!=t&&t.click(function(e){return function(){return Ki.update_free_licenses_message(),e._updated_charges_messages(Ki.invite_as_limited())}}(this)),e=Se("#team-invite-wizard .team-invite-add-licenses"),e.on("click",Se.proxy(Ki.on_add_licenses_click,Ki)),Se(window).on("token:changed",this._handle_token_change),Ki.initialized&&(ui.clear_errors(),Ki.update_license_count(),Ki.update_free_licenses_message()),Ot.register(Ot.CLEAR,function(){return Ki.reset_modal()})},t.prototype.on_hide=function(){return Se(window).off("token:changed",this._handle_token_change)},t.prototype.is_making_transition_info_request=function(){return this.making_transition_info_request},t.prototype._licenses_to_add=function(){return-1*Ki.available_licenses},t.prototype._licenses_total=function(){return Ki.total_licenses+this._licenses_to_add()},t.prototype._getInvitesCount=function(){return Ki.total_licenses-Ki.used_licenses-Ki.available_licenses},t.prototype._handle_token_change=function(e,t){return this.remaining_licenses=t.remaining_licenses,this._updateConfirmButton(),this._update_remaining_licenses_message(),this.inline_add_license?(clearTimeout(this.fetch_transition_timeout_id),this.fetch_transition_timeout_id=setTimeout(function(e){return function(){return e._make_transition_info_request(),e.fetch_transition_timeout_id=null}}(this),100)):void 0},t.prototype._make_transition_info_request=function(){var e,t,n,i;return this.making_transition_info_request=!0,t=Math.floor(1e6*Math.random()),this.current_callback_token=t,e=this._licenses_to_add(),n=this._licenses_total(),i=function(i){return function(r){return i._update_form_pricing_information(t,e,n,null!=r?r[0]:void 0)}}(this),e>0?this.transition_info_fetcher.get(i,{total_users:this._licenses_total()}):i(null)},t.prototype._update_remaining_licenses_message=function(){var e;return e=this._get_remaining_licenses_message(this.remaining_licenses),this.$modal_window.find("#license-count-message").text(e)},t.prototype._get_remaining_licenses_message=function(e){var t;return t=0>e?zt("You need more licenses for this invitation."):0===e?zt("After this invitation, you'll have no remaining licenses."):Bt("After this invitation, you'll have %(count)d remaining license.","After this invitation, you'll have %(count)d remaining licenses.",e).format({count:e})},t.prototype._update_form_pricing_information=function(e,t,n,i){var r,o,s,a,_;if(e===this.current_callback_token)return i&&t>0?(this.add_qty=t,r=this.transition_view_model.state.currency,a=i.current_total.amount,s=Vt.formatCurrency(a,r),_=Vt.formatCurrency(i.recurring_total_tax.amount,r),o=this.is_trial?0:a,Se(".new-amount").text(s),Se(".add-qty").text(t),Se(".recurring-amount").text(_),Se(".total-qty").text(n),Se("#expected_price").val(o),this._updated_charges_messages(Ki.invite_as_limited())):this._reset(),this.making_transition_info_request=!1},t.prototype._updateConfirmButton=function(e){var t,n;return null==e&&(e=!1),t=Se(".team-invite-buttons .confirm-button"),n=e?zt(this.is_trial?"Invite and add":"Invite and buy"):Bt("Send invite","Send invites",this._getInvitesCount()),t.val(n)},t.prototype._reset=function(){return this.add_qty=0,Se(".charges-section").hide(),Se("#expected_price").val(0),this._updateConfirmButton()},t.prototype._updated_charges_messages=function(e){var t;return t=this.inline_add_license&&this.add_qty>0&&!e,Se(".charges-section").toggle(t),this._updateConfirmButton(t)},t}(Dt);var Gi,Qi,Xi,Zi,er,tr,nr,ir,rr,or,sr,ar,_r,Tn=function(e,t){return function(){return e.apply(t,arguments)}},Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty;rr=INLINE_JS.Team=ft.Team={_use_async_reset:!1,team_id:G.get_viewer().team_id,set_team_id:function(e){this.team_id=e},setup_beta_modal_listeners:function(){var e,t,n,i,r,o,s,a,_;for(t=Se(".feature-list .enroll-button"),i=Se(".feature-list .feedback-button"),r=0,s=t.length;s>r;r++)e=t[r],n=Se(e).data("feature"),Se(e).click(function(e){return function(){return new Qi(e).show()}}(n)),e.disabled=!1;for(_=[],o=0,a=i.length;a>o;o++)e=i[o],n=Se(e).data("feature"),_.push(Se(e).click(function(e){return function(){return new Xi(e).show()}}(n)));return _},invite_modal_show:function(e){return Ki.invite_modal?(this.invite_modal_already_initialized?(Ki.invite_modal.show(),Ki.rebind_modal_submit_autocompleter()):(Ki.invite_modal.show(),Ki.init(),this.invite_modal_already_initialized=!0),null!=window.active_team_member_table&&Ki.update_used_licenses(window.active_team_member_table.get_licensed_members()),Ki.set_emails(e)):Se("body").one("invite-modal-initialized",function(t){return function(){return t.invite_modal_show(e)}}(this))},init_admin:function(){return wi.set_vertical_space(2),Se("form.activity-report-generator").submit(this.submit_report_form.bind(this))},init_team_name_change_notice:function(){return Se(".team_name_change_notice .hide_link").click(function(e){return function(){return e.hide_team_name_change_banner()}}(this))},add_users:function(e,t){var n,i,r;return Event.stop(e),i=$("team-invite-form"),wt(i,"Couldn't find the team invite form."),n=Se(i).find("input[name='emails']"),0===n.length?void k.error(zt("You haven't included anyone to invite! Please invite at least one person.")):(r=function(r){return function(){var o;return o=ui.collect_form_vars(i),Se.extend(o,{team_id:r.team_id}),ui.add_loading(e.target),new Ajax.DBRequest("/account/team/add_users",{parameters:o,subject_user:G.get_viewer().work_user,progress_text:zt("Inviting members..."),noAutonotify:!0,onSuccess:function(e){var i,r,o,s;return ui.remove_loading(),Ki.reset_modal(),Ki.add_total_licenses(t),Ki.invite_modal.hide(),o=JSON.parse(e.responseText),o?(null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.add_users(null!=o?o.users:void 0):null!=__CIRCULAR_DEPENDENCY__.Dashboard&&__CIRCULAR_DEPENDENCY__.Dashboard.set_num_invited(null!=o?o.num_invited:void 0),i=function(){var e,t;e=null!=o?o.users:void 0,t=[];for(r in e)s=e[r],t.push(s);return t}(),1===i.length?k.success(zt("Invited %(user_email)s.").format({user_email:i[0].email})):i.length>1?k.success(zt("Invited %(user_count)d people.").format({user_count:i.length})):k.error(Bt("Skipped %(num_skipped)d person who is already a member of the team.","Skipped %(num_skipped)d people who are already members of the team.",n.length).format({num_skipped:n.length}))):k.error()},onFailure:function(e){var t,n;return e&&(0===e.responseText.indexOf("err:")?(t=e.responseText.substr(4),0===t.indexOf("{")?(n=t.evalJSON(!0),ui.fill_errors(i,n)):(t=new lt(t),k.error(t))):k.error()),ui.remove_loading(),Se("input[type='submit']").prop("disabled",!1)}})}}(this),setTimeout(function(){return Ki.invite_modal.is_making_transition_info_request()?void 0:r()},100))},show_demo_signup_modal:function(e,t,n,i,r){var o,s,a,_;return this.webinar_key=e,this.webinar_iso_datetime=t,this.webinar_date=n,this.webinar_title=i,this.tab_url=r,_=zt("Register for a webinar on %(start_time)s").format({start_time:this.webinar_date}),s=new Zi({element_id:"demo-signup-modal",title:_}),s.show(),s.$modal_window.find("input[name=webinar_key]").attr("value",this.webinar_key),s.$modal_window.find("input[name=webinar_title]").attr("value",this.webinar_title),s.$modal_window.find("input[name=Sales_Webinar_Topic__c]").attr("value",this.webinar_title),s.$modal_window.find("input[name=Sales_webinar_date__c]").attr("value",this.webinar_iso_datetime),a=s.$modal_window.find("input[name=retURL]"),a.attr("value",a.val()+"#"+this.tab_url),o=s.$modal_window.find("#demo-signup-form")[0],o.on("submit",s.on_confirm_button_click)},show_unsuspend_modal:function(e,t,n,i){var r;return r=new nr({element_id:"dfe-unsuspend-modal",focus:"confirm"}),r.user_name=e||n,r.email=n,r.user_id=t,r.team_id=this.team_id,r.refresh_cb=i,r.show(),!1},show_remove_or_deactivate_modal:function(e,t,n,i,r,o,s,a){var _;return _=new er({element_id:"dfe-remove-or-deactivate-user-modal",focus:".new-collab-input"}),_.user_name=t||i,_.email=i,_.user_id=n,_.team_id=this.team_id,_.invited=r,_.limited=o,_.hide_transfer_wipe=s,_.refresh_cb=a,_.show(),!1},show_remove_modal:function(e,t,n,i,r,o,s,a,_,l){var u;return u=new tr({element_id:"dfe-remove-user-modal",focus:".new-collab-input"}),u.user_name=t||i,u.email=i,u.user_id=n,u.team_id=this.team_id,u.invited=r,u.num_api_apps=o,u.hide_transfer_setting=s,u.hide_remote_wipe_setting=a,u.refresh_cb=l,u.user_is_managed=_,u.show(),!1},remove_user:function(e,t){var n,i,r;return alert("in remove_user"),Event.stop(e),i=Se("input[type=submit]","#remove-user-modal"),i.attr("disabled",1),r=mi.vars.user_id,n=t?!0:Se("input[name=should_disable]:checked","#remove-user-modal").val(),new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:this.team_id,user_id:r,should_disable:n},onSuccess:function(e){return function(t){var n,i,r;return r=JSON.parse(t.responseText),null!=(n=window.active_team_member_table)&&n.remove_user(mi.vars.user_id),null!=(i=window.removed_team_member_table)&&i.add_users(r),e.decrement_used_licenses(),k.success(zt("User removed."))}}(this),cleanUp:function(){return mi.hide(),i.removeAttr("disabled")}})},show_reinvite_modal:function(e,t,n,i){var r;return tn.fillVal(i,"reinvite-user-email"),tn.fillVal(t,"reinvite-user-team"),r=zt("Resend invite to '%(email_address)s'").format({email_address:_.em_snippet(i,18)}),mi.show(r,$("reinvite-user-modal"),{user_id:n,button:e})},email_verification:this.email_verification=new At("work"),show_email_verification_modal:function(){return this.email_verification.show_verify_modal(null,Ge.NEW_DFB_TEAM)},reinvite_user:function(e){var t;return Event.stop(e),t=mi.vars.user_id,new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){var n,i,r,o;return k.success(zt("Invite sent.")),null!=(i=$("team-member-info"))&&i.update(e.responseText),n=window.active_team_member_table,n?(o=n.data.users[t],o.invite_expired=!1,r={},r[t]=o,n.update_user_data(r)):void 0},cleanUp:function(){return mi.hide()}})},show_request_license_modal:function(e,t){var n;return n=zt("Send upgrade request?"),mi.show(n,$("request-license-modal"),{user_id:t,button:e})},request_license:function(e){var t;return Event.stop(e),t=mi.vars.user_id,new Ajax.DBRequest("/team/request_license",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(){return Se("#request_license_text").hide(),Se("#request-license-section").hide(),k.success(zt("Request sent."))},cleanUp:function(){return mi.hide()}})},show_user_activity_log_modal:function(e,t,n){var i;return i=Se("#activity-log-modal"),i.find(".activity-log-email").text(t),i.find(".activity-log-name").text(n),i.find("#activity-log-user-message").show(),mi.show(zt("Create activity report"),i[0],{user_id:e})},show_team_activity_log_modal:function(e,t){var n;return n=Se("#activity-log-modal"),n.find(".activity-log-email").text(e),n.find(".activity-log-name").text(t),n.find("#activity-log-team-message").show(),mi.show(zt("Create full activity report"),n[0])},generate_activity_log:function(e){var t,n,i,r,o,s,a;return Event.stop(e),n=Se("#activity-log-modal"),i=n.find("input[name='from_date']").val(),o=n.find("input[name='to_date']").val(),i>o?void k.error(zt("Your start date is after your end date.")):(r=this.team_id,a=mi.vars.user_id,s=(new Date).getTimezoneOffset().toString(),t=Se(".activity-report-generator .freshbutton-blue"),t.prop("disabled",!0),new Ajax.DBRequest("/team/events_report/csv",{parameters:{from_date:i,to_date:o,team_id:r,user_id:a,tzoffset:s},onSuccess:function(){return k.success(zt("Report started. We'll email you when it's ready."))},cleanUp:function(){return mi.hide(),t.prop("disabled",!1)}}))},show_reset_password_modal:function(e,t,n){var i;return Se("#reset-password-modal .member-name").text(t),i=zt("Reset password for '%(user_name)s'").format({user_name:t}),mi.show(i,$("reset-password-modal"),{user_id:n,button:e})},reset_password:function(e){var t;return Event.stop(e),t=mi.vars.user_id,new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(){return k.success(zt("User's password reset."))},cleanUp:function(){return mi.hide()}})},show_reset_all_passwords_modal:function(){return mi.show(zt("Reset all passwords"),$("reset-all-passwords-modal"))},set_async_password_reset:function(e){return this._use_async_reset=e},reset_all_passwords:function(){return new Ajax.DBRequest("/account/team/reset_all_passwords",{parameters:{team_id:this.team_id},job:this._use_async_reset,subject_user:G.get_viewer().work_user,progress_text:zt("Resetting all passwords..."),onSuccess:function(){return k.success(zt("All passwords reset."))},cleanUp:function(){return mi.hide()}})},show_admin_status_modal:function(e,t,n,i,r,o){var s,a,_,l;return a=r.trim()||i,_=void 0,s=void 0,l=void 0,o?(l=zt("Add admin permissions for '%(person_name)s'").format({person_name:a.escapeHTML()}),_=zt("Are you sure you want to add admin permissions for <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),s=zt("Add admin permissions",{comment:"make this user an admin; give them the permissions an admin has"})):(l=zt("Remove admin privileges from '%(person_name)s'").format({
person_name:a.escapeHTML()}),_=zt("Are you sure you want to remove admin permissions from <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),s=zt("Remove admin permissions",{comment:"clicking this button completes the action: it removes a person's admin status"})),tn.fillVal(i,"admin-status-email"),tn.fillVal(_,"admin-status-action"),tn.fillVal(s,"admin-status-button-action"),mi.show(l,$("admin-status-modal"),{user_id:n,button:e,admin_on:o}),!1},set_admin_status:function(e){var t;return Event.stop(e),t=mi.vars.user_id,new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:this.team_id,user_id:t,on:mi.vars.admin_on?"yes":"no"},onSuccess:function(e){var t,n;return t=zt(mi.vars.admin_on?"User's admin status granted.":"User's admin status removed."),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?(n=JSON.parse(e.responseText),window.active_team_member_table.update_user_data(n),k.success(t)):window.location=mi.vars.admin_on?"/team/admin/member?id=%d&msg=granted".format(mi.vars.user_id):"/team/admin/member?id=%d&msg=removed".format(mi.vars.user_id)},cleanUp:function(){return mi.hide()}})},show_disable_2fa_modal:function(e,t,n){return Se("#disable-2fa-modal .member-name").text(n),mi.show(zt("Disable two-step verification"),$("disable-2fa-modal"),{user_id:t,elm:e})},show_reset_2fa_modal:function(e,t,n){return Se("#reset-2fa-modal .member-name").text(n),mi.show(zt("Reset two-step verification"),$("reset-2fa-modal"),{user_id:t,user_name:n,elm:e})},reset_2fa:function(){return new Ajax.DBRequest("/account/team/reset_2fa",{parameters:{team_id:this.team_id,user_id:mi.vars.user_id},onSuccess:function(e){var t;return Se(".tfa_enabled").replaceWith(zt("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),k.success(zt("Two-step verification reset for %(user_name)s").format({user_name:mi.vars.user_name})),mi.hide()}})},disable_2fa:function(){return new Ajax.DBRequest("/account/team/disable_2fa",{parameters:{team_id:this.team_id,user_id:mi.vars.user_id},onSuccess:function(e){var t;return Se(".tfa_enabled").replaceWith(zt("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),k.success(zt("Two-step verification disabled.")),mi.hide()}})},show_sso_preview_email:function(e){return mi.show(zt("Email preview"),$(e))},show_sso_sample_email:function(e){return mi.show(zt("Sample email"),$(e))},show_user_message_modal:function(e,t,n){var i;return tn.fillVal(n,"user-message-email"),i=zt("Send email to '%(user_name)s'").format({user_name:e}),$("user-message").value="",mi.show(i,$("user-message-modal"),{user_name:e,user_id:t}),Zt.focus.defer("user-message")},send_user_message:function(){var e,t;return t=mi.vars.user_id,e=$F("user-message").trim(),new Ajax.DBRequest("/account/team/send_user_message",{parameters:{user_id:t,team_id:this.team_id,message:e},onSuccess:function(){var e;return e=mi.vars.user_name,k.success(zt("Message successfully sent to %(user_name)s.").format({user_name:e})),mi.hide()}})},hide_team_name_change_banner:function(){return new Ajax.DBRequest("/account/team/name_change_notice_received",{parameters:{team_id:this.team_id}}),Se(".team_name_change_notice").hide(),!1},hide_pin_banner:function(){return new Ajax.DBRequest("/team/invalidate_pin"),Se(".pin_notice").hide()},hide_pin_banner_with_user_id:function(e,t){var n;return n=function(){return Se(t).closest("span").removeClass("on").addClass("off")},null===e?new Ajax.DBRequest("/team/invalidate_pin",{onSuccess:n}):new Ajax.DBRequest("/team/invalidate_pin",{parameters:{user_id:e},onSuccess:n})},get_pin_with_user_id:function(e,t,n){var i;return null==n&&(n=null),null===n&&(n=function(e,t){return Se(t).closest("span").find(".pin-value").text(e.pin+" -"),Se(t).closest("span").removeClass("off").addClass("on")}),i=function(e){var i;return i=JSON.parse(e.responseText),n(i,t)},null===e?new Ajax.DBRequest("/team/generate_pin",{onSuccess:i}):new Ajax.DBRequest("/team/generate_pin",{parameters:{user_id:e},onSuccess:i})},send_team_message:function(e){var t;return Event.stop(e),t=$F("team-message").trim(),t?new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:this.team_id,message:t},onSuccess:function(){return k.success(zt("Message successfully sent to team.")),mi.hide()}}):void 0},show_security_message_modal:function(){return(new or).show()},send_team_security_message:function(e){var t,n;return Event.stop(e),n=$F("team-security-message").trim(),t=$("team-security-message-form"),new Ajax.DBRequest("/account/team/send_team_message",{parameters:t.serialize(!0),onSuccess:function(){return k.success(zt("Message successfully sent.")),mi.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(e,t){return this.used_licenses=e,this.total_licenses=t},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(e,t){return $("migration-url").value=t,mi.show(zt("Migration link for '%(email)s'").format({email:_.em_snippet(e,18)}),$("migrate-url-modal")),$("migration-url").select()},show_end_session_modal:function(e,t,n){return wi.hide_all(),Se("#end-session-modal .member-name").text(Se("#member-name").text()),mi.show(zt("Close web session",{comment:"Log out of your current Dropbox web session"}),$("end-session-modal"),{login_id:e,user_id:t,elm:n})},end_session:function(){return new Ajax.DBRequest("/logout_remote_session",{parameters:{remote_login_id:mi.vars.login_id,team_id:this.team_id,user_id:mi.vars.user_id},onSuccess:function(){return mi.hide(),rr.remove_closest_row(mi.vars.elm),k.success(zt("Web session closed."))}})},unlink_device:function(e,t,n,i,r,o,s){var a,_;return wi.hide_all(),a=$("unlink-device-modal-"+o),_=zt("Unlink %(device_name)s").format({device_name:n}),mi.show(_,a,{app_id:t,user_id:r,elm:s,device_id:e,display_name:n})},unlink_device_submit:function(){return new Ajax.DBRequest("/account/unlink_team_device",{parameters:{app_id:mi.vars.app_id,team_id:this.team_id,user_id:mi.vars.user_id,device_id:JSON.stringify(mi.vars.device_id)},subject_user:G.get_viewer().work_user,onSuccess:function(){return mi.hide(),rr.remove_closest_row(mi.vars.elm),k.success(zt("%(device_name)s unlinked.").format({device_name:mi.vars.display_name}))}})},disable_app:function(e,t,n,i){return wi.hide_all(),Se("#disable-app-modal .app-name").text(t),Se("#disable-app-modal .member-name").text(Se("#member-name").text()),mi.show(zt("Disable '%(app_name)s'?").format({app_name:t}),$("disable-app-modal"),{app_id:e,user_id:n,elm:i})},disable_app_submit:function(){return new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:mi.vars.app_id,keep_sandbox_files:!0,team_id:this.team_id,user_id:mi.vars.user_id},subject_user:G.get_viewer().work_user,onSuccess:function(e){return mi.hide(),rr.remove_closest_row(mi.vars.elm),k.success(e.responseText)}})},remove_closest_row:function(e){var t,n,i;return t=Se(e).closest(".team_admin_table_row"),n=Se(t).closest(".team_admin_table"),1===n.find(".team_admin_table_row").length?(i=n.prev(".team_admin_table_title"),i.length||(i=Se(".team_apps_table_panel")),i.remove(),n.remove()):t.remove()},submit_report_form:function(e){return Se(e.target.elements.tzoffset).val(""+(new Date).getTimezoneOffset()),!0}},Qi=ft.BetaEnrollConfirmationModal=function(e){function t(e){this.feature_name=e,this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"beta-enroll-confirmation-modal"})}return Sn(t,e),t.prototype.on_confirm_button_click=function(){return Se("<input>").attr({type:"hidden",name:"feature_name",value:this.feature_name}).appendTo("#beta-enroll-confirmation-modal form"),this.$modal_window.addClass("ajax-loading")},t}(Dt),Xi=ft.BetaFeedbackModal=function(e){function t(e){this.feature_name=e,this.success=Tn(this.success,this),t.__super__.constructor.call(this,{element_id:"beta-feedback-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,r;return t.preventDefault(),n=Se(t.target),i=n.closest("form"),r={feature_name:e.feature_name},ui.ajax_submit(i[0],!1,e.success,e.error,n[0],r)}}(this)}return Sn(t,e),t.prototype.success=function(){return k.success(zt("Thank you for your feedback.")),this.$modal_window.hide()},t.prototype.error=function(e){return 200!==e.status?k.error(zt("Failed to submit feedback. Please try again.")):void 0},t}(Dt),Zi=ft.DemoSignupModal=function(e){function t(){return this.on_show=Tn(this.on_show,this),this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i,r,o,s,a,_,l,u,d,c;return e.preventDefault(),d=$("demo-signup-form"),_=$("1210"),s=Se(d).find("input[name='first_name']").val(),Se(_).find("input[name='FirstName']").attr("value",s),a=Se(d).find("input[name='last_name']").val(),Se(_).find("input[name='LastName']").attr("value",a),o=Se(d).find("input[name='email']").val(),Se(_).find("input[name='Email']").attr("value",o),u=Se(d).find("input[name='phone_number']").val(),Se(_).find("input[name='Phone']").attr("value",u),t=Se(d).find("input[name='company_name']").val(),Se(_).find("input[name='Company']").attr("value",t),i=Se(d).find("select[name='company_size']"),n=i.find("option:selected").val(),Se(_).find("input[name='Company_size__c']").attr("value",n),r=$(this.$modal_window.find(".confirm-button")[0]),c=function(e){return function(){return e.$modal_window.hide(),_.submit()}}(this),l=ui.collect_form_vars(d,!0),ui.ajax_submit(d,!1,c,!1,r,l,!0)},t.prototype.on_show=function(){return this.$modal_window.find(".db-modal-content").css({"overflow-y":""}),vi.init()},t}(Dt),Gi=ft.AccountTransferBaseModal=function(e){function t(e,n,i){this.file_action_selector=n,this.transfer_choice_selector=i,this._clearInput=Tn(this._clearInput,this),this._markInputInvalid=Tn(this._markInputInvalid,this),this._markInputValid=Tn(this._markInputValid,this),this._tokenRemove=Tn(this._tokenRemove,this),this._tokenAdd=Tn(this._tokenAdd,this),this._selectChange=Tn(this._selectChange,this),this._isTransferSelected=Tn(this._isTransferSelected,this),this.checkAndApproveMemberRemoval=Tn(this.checkAndApproveMemberRemoval,this),this.on_cancel_button_click=Tn(this.on_cancel_button_click,this),this.execute_form=Tn(this.execute_form,this),this.get_cancel_button=Tn(this.get_cancel_button,this),this.get_confirm_button=Tn(this.get_confirm_button,this),this.get_button_class=Tn(this.get_button_class,this),this.set_modal_class=Tn(this.set_modal_class,this),this.handleAjaxFailure=Tn(this.handleAjaxFailure,this),this.on_show=Tn(this.on_show,this),t.__super__.constructor.call(this,e,this.file_action_selector,this.transfer_choice_selector)}return Sn(t,e),t.prototype.on_show=function(){return 0!==this.$modal_window.find("#manage-files-new-collab-input").length?(this.auto_completer=new Autocompleter.TeamTokenizer(G.get_viewer().get_user_by_role(O.ROLE_WORK),"manage-files-new-collab-input","manage-files-new-whobulk","manage-files-hidden-input",{hide_import_contacts:!0,suggestions_disabled:!0,wrap_name:!0,single_token:!0,contact_filter:function(e){return function(t){return t.excludeNonTeam().excludeNewStyleGroups().excludeByEmail(e.email)}}(this)}),this.tokenAdd=Se.proxy(this._tokenAdd,this),this.tokenRemove=Se.proxy(this._tokenRemove,this),this.$collab_input=this.$modal_window.find("#manage-files-new-collab-input")[0],this.$collab_input.on("token:add",this.tokenAdd),this.$collab_input.on("token:remove",this.tokenRemove),this.$textinput=this.$modal_window.find(".tokenized_autocompleter_container .textinput"),this.selectChange=Se.proxy(this._selectChange,this),this.$modal_window.find(this.file_action_selector).on("change",this.selectChange)):void 0},t.prototype.handleAjaxFailure=function(e){return 200===e.status&&this._isTransferSelected()?this._markInputInvalid():void 0},t.prototype.set_modal_class=function(e){var t,n,i,r,o,s;return i="suspending deleting approve_transfer_to_suspended",r=this.get_form(),r.removeClass(i),null!=e&&r.addClass(e),null!=(o=Se(".suspend_option_content"))&&o.removeClass("title_bubble no_suspend"),n=null!=this.limited&&this.limited,t=null!=this.invited&&this.invited,n||t?(Se(".suspend_option_content").addClass("title_bubble no_suspend"),s="",s=zt(t?"Invited members can not be suspended":"Limited members can not be suspended"),Se(".suspend_option_content").attr("data-title",s)):void 0},t.prototype.get_button_class=function(){var e;return e=this.get_form(),e.hasClass("suspending")?".confirm_deactivate_button":e.hasClass("deleting")?".confirm_delete_button":e.hasClass("approve_transfer_to_suspended")?".confirm_transfer_to_suspended_button":void 0},t.prototype.get_confirm_button=function(){var e;return e=this.get_button_class(),$(null!=e?this.$modal_window.find(e+" .confirm-button"):this.$modal_window.find(".confirm-button"))},t.prototype.get_cancel_button=function(){var e;return e=this.get_button_class(),$(null!=e?this.$modal_window.find(e+" .cancel-button"):this.$modal_window.find(".cancel-button"))},t.prototype.execute_form=function(){var e,t;return t=this.get_form()[0],e=this.get_confirm_button(),ui.ajax_submit(t,!1,this.success_callback,this.handleAjaxFailure,e)},t.prototype.on_cancel_button_click=function(e){var n;return e.preventDefault(),n=this.get_form(),n.hasClass("approve_transfer_to_suspended")?(this.reset_button_click(this.$confirm_button,this.on_confirm_button_click),this.reset_button_click(this.$cancel_button,this.on_cancel_button_click)):t.__super__.on_cancel_button_click.apply(this,arguments)},t.prototype.reset_button_click=function(e,t){return e.off("click"),null!=t?e.on("click",t):void 0},t.prototype.checkAndApproveMemberRemoval=function(e){var t,n;return!Se("#deactivate_option").is(":checked")&&Se("#transfer_files_on").is(":checked")&&!this.invited&&(t=Se(".tokenized_autocompleter_container .token-display-text"),n=Se(".tokenized_autocompleter_container .token-suspended"),t.length&&n.length)?(this.set_modal_class("approve_transfer_to_suspended"),this.$modal_window.find(".target_user_name").text(t.text()),this.$confirm_button=this.get_confirm_button(),this.reset_button_click(this.$confirm_button,function(e){return function(){return e.execute_form()}}(this)),this.$cancel_button=this.get_cancel_button(),void this.$cancel_button.on("click",e)):this.execute_form()},t.prototype._isTransferSelected=function(){return Se(this.transfer_choice_selector).prop("checked")},t.prototype._selectChange=function(){return this._isTransferSelected()?this.$textinput.removeClass("unselected"):this.$textinput.addClass("unselected")},t.prototype._tokenAdd=function(e){return this.$collab_input.hide(),e.memo.valid?this._markInputValid():this._markInputInvalid()},t.prototype._tokenRemove=function(){return this.$collab_input.show(),this._clearInput()},t.prototype._markInputValid=function(){return this._clearInput(),this.$textinput.addClass("valid")},t.prototype._markInputInvalid=function(){return this._clearInput(),this.$textinput.addClass("invalid")},t.prototype._clearInput=function(){return this.$textinput.removeClass("valid"),this.$textinput.removeClass("invalid")},t}(Dt),or=ft.TwoFactorMessageModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"team-security-message-modal",focus:"#team-security-message"})}return Sn(t,e),t.prototype.on_confirm_button_click=function(e){return rr.send_team_security_message(e),this.hide()},t}(Dt),nr=ft.DfeUnsuspendUserModal=function(e){function t(e){this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.success_callback=Tn(this.success_callback,this),t.__super__.constructor.call(this,e)}return Sn(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=zt("Unsuspend %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=email]").attr("value",this.email),this.$modal_window.find(".unsuspended_name").text(this.user_name),this.$modal_window.find(".unsuspended_email").text(this.email)},t.prototype.success_callback=function(){var e;return null!=(e=__CIRCULAR_DEPENDENCY__.MembersReact)&&e.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("unsuspended"):void 0},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".dfe-unsuspend-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),ui.ajax_submit(n,!1,this.success_callback,!1,t)},t}(Dt),er=ft.DfeRemoveOrDeactivateUserModal=function(e){function t(e){this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.success_callback=Tn(this.success_callback,this),this.on_show=Tn(this.on_show,this),this.handle_change_action=Tn(this.handle_change_action,this),this.switch_to_removal_mode=Tn(this.switch_to_removal_mode,this),this.switch_to_deactivation_mode=Tn(this.switch_to_deactivation_mode,this),this.show_removal_content=Tn(this.show_removal_content,this),this.show_deactivation_content=Tn(this.show_deactivation_content,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Sn(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-or-deactivate-user-modal")},t.prototype.set_form_action_to_deactivate=function(){return Se(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/suspend_user")},t.prototype.set_form_action_to_remove=function(){return Se(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/remove_user")},t.prototype.show_deactivation_content=function(){return this.set_modal_class("suspending")},t.prototype.show_removal_content=function(){return this.set_modal_class("deleting")},t.prototype.switch_to_deactivation_mode=function(){return this.show_deactivation_content(),this.set_form_action_to_deactivate()},t.prototype.switch_to_removal_mode=function(){return this.show_removal_content(),this.set_form_action_to_remove(),this.invited?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.handle_change_action=function(e){return e.preventDefault(),Se("#deactivate_option").is(":checked")?this.switch_to_deactivation_mode():this.switch_to_removal_mode()},t.prototype.on_show=function(){var e;return t.__super__.on_show.call(this),Se("input[name=deactivate_or_remove]").on("change",this.handle_change_action),this.$modal_window.find(".deleted_user_name").text(this.user_name),e=zt("Suspend or delete %(user_name)s").format({user_name:this.user_name}),this.limited||this.invited?(Se("#deactivate_option").prop("disabled",!0),Se("#delete_option").attr("checked","checked"),this.switch_to_removal_mode()):(Se("#deactivate_option").attr("checked","checked"),this.switch_to_deactivation_mode()),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.hide_transfer_wipe?(this.$modal_window.find(".transfer_data_on_remove_setting").remove(),this.$modal_window.find(".remote_wipe_setting").remove()):void 0},t.prototype.success_callback=function(){var e;return null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),e="",e=Se("#deactivate_option").is(":checked")?"suspended":"deleted",this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(e):void 0},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(Gi),tr=ft.DfeRemoveUserModal=function(e){function t(e){this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.switch_to_removal_mode=Tn(this.switch_to_removal_mode,this),this.success_callback=Tn(this.success_callback,this),this.on_show=Tn(this.on_show,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Sn(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-user-modal")},t.prototype.on_show=function(){var e,n;return t.__super__.on_show.call(this),this.$modal_window.find(".remove_user_name").text(this.user_name),n=this.invited?zt("Uninvite %(user_name)s").format({user_name:this.user_name}):zt("Delete %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(n),this.num_api_apps?(e=Bt("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_app").text(e)):this.$modal_window.find(".api_app_warning").hide(),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.user_is_managed?this.$modal_window.find(".remove-content-limited-member").remove():(this.$modal_window.find(".remove_content").remove(),this.$modal_window.find(".remote_wipe_setting").remove()),this.invited&&(this.$modal_window.find(".transfer_files_option").remove(),this.$modal_window.find(".remote_wipe_setting").remove(),this.get_form().addClass("invited")),this.hide_transfer_setting&&this.$modal_window.find(".transfer_files_option").remove(),this.hide_remote_wipe_setting?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.success_callback=function(e){var t,n,i,r;return r=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():(null!=(n=window.active_team_member_table)&&n.remove_user(this.user_id),null!=(i=window.removed_team_member_table)&&i.add_users(r)),t="",t=this.invited?"uninvited":"deleted",rr.decrement_used_licenses(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t):void 0},t.prototype.switch_to_removal_mode=function(){return this.set_modal_class()},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(Gi),ir=ft.ManageFilesModal=function(e){function t(e,n,i){this.source_user_id=e,this.source_user_name=n,this.options=i,this.on_confirm_button_click=Tn(this.on_confirm_button_click,this),this.switch_to_manage_files=Tn(this.switch_to_manage_files,this),this.success_callback=Tn(this.success_callback,this),t.__super__.constructor.call(this,this.options,"input[name=file_action]","#transfer_files_on")}return Sn(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".manage-files-modal")},t.prototype.on_show=function(){var e;return t.__super__.on_show.call(this),this.$modal_window.find("[name='source_user_id']").attr("value",this.source_user_id),this.$modal_window.find(".source-user-name").text(this.source_user_name),e=zt("Manage %(team_member)s's files").format({team_member:this.source_user_name}),this.$modal_window.find(".db-modal-title-text").text(e)},t.prototype.success_callback=function(e){var t;return t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.removed_team_member_table?window.removed_team_member_table.update_user_data(t):null!=__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),k.success(Se("#transfer_files_on").prop("checked")?zt("Transfer started",{comment:"This refers to the start of a file transfer from one Dropbox to another"}):zt("Permanently deleted files")),this.hide()},t.prototype.switch_to_manage_files=function(){return this.set_modal_class("manage-files-modal")},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_manage_files)},t}(Gi),ar=ft.show_manage_files_modal=function(e,t){var n;return n=new ir(e,t,{element_id:"manage-files-modal",focus:".new-collab-input"}),n.show()},_r=function(){var e;return e=function(e,t){var n,i;return Se(t).css("display","none"),n=Se(t).closest("#user_generate_liveops_pin"),i=n.find(".user_generate_liveops_pin_value"),i.text(e.pin),Se(t).addClass("liveops_pin_elem_invisible"),n.find(".user_generate_liveops_pin_text").removeClass("liveops_pin_elem_invisible")},rr.get_pin_with_user_id(null,this,e),!1},Se("#user_generate_liveops_pin_button").click(_r),sr=function(){return Se("#help_callus_title").hide(),Se("#help_callus_details").show(),!1},Se("#help_callus_trigger").click(sr);var lr;lr=ft.UpdateEvents={ADD:"db:add_file_objects",REMOVE:"db:remove_file_objects",MOVE:"db:move_file_objects"};var ur;ur=ft.BrowseUtil={THUMBS_BATCH_SIZE:16,make_browsefile:function(e,t){var n;return null==t&&(t=null),n=Object.clone(e),n.is_dir?(n.ago="",n.ts=0):n.target_ns=!1,n.sort_key=Zt.decode_sort_key(n.sort_key),n.request_id=null!=t?t:null,new vr(n)},filepreview_from_selected:function(e,t,n,i){var r,o,s,a;return null==t&&(t=!1),null==n&&(n=!1),null==i&&(i=Z.OREF_CONSTANTS.BROWSE_UNKNOWN),e.bytes<0||"download"===e.preview_type?void window.open(e.href,"_blank"):void(oe.getGandalfRule("file-viewer-react")?(o=this.getIndexOfFileInArray(Ir.files,e),ke.open(Ir.files,o,Ir.active_user,"react-file-viewer",{fileViewTarget:Z.FileViewTargetType.PRIVATE,fileViewOrigin:Z.FileViewOriginType.BROWSE,fileViewAction:Z.FileViewActionType.CLICK,shouldFocusCommentInput:n})):(a=v.get_url(),s=v.deconstruct_url(a),r=0===a.indexOf("/s/"),ro.show(e,Ir.active_user,{files:Ir.files,file_view_target:Z.FileViewTargetType.PRIVATE,should_focus_comment_input:n},i),t||r||s.qargs.preview===e.filename||ro.set_preview_url()))},profile_files:function(e){var t,n,i,r,o;for(r={files:0,folders:0,shared_folders:0,team_shared_folders:0,deleted:0,public_folder:0,rejoinables:0,sandboxes:0,target_namespaces:0,in_root_coll:0,compressible_count:0,can_permanently_delete:0},n=0,i=e.length;i>n;n++)t=e[n],t.dir?r.folders+=1:r.files+=1,t.is_sandbox()&&(r.sandboxes+=1),t.is_shared_folder()&&(r.shared_folders+=1),t.is_team_shared_folder()&&(r.team_shared_folders+=1),-1===t.bytes&&(r.deleted+=1),t.target_ns&&(r.target_namespaces+=1),"/public"===t.fq_path.toLowerCase()&&Ir.public_folder_enabled&&(r.public_folder=1),t.in_root_coll&&(r.in_root_coll+=1),t.compressible&&(r.compressible_count+=1),(null!=(o=Ir.permanent_delete_is_disabled_by_ns_id)?o[t.ns_id]:void 0)||(r.can_permanently_delete+=1);return r},profile_summary:function(e){var t,n;return t=Bt("%d file","%d files",e.files,{comment:"used in a phrase such as 'x files and y folders'"}).format(e.files),n=Bt("%d folder","%d folders",e.folders,{comment:"used in a phrase such as 'x files and y folders'"}).format(e.folders),e.files&&e.folders?zt("%(x_files)s and %(y_folders)s",{comment:"x_files will either be '1 file' or 'd files', similar for x_folders"}).format({x_files:t,y_folders:n}):e.files?t:e.folders?n:""},BROWSE_MODE:"browse",SEARCH_MODE:"search",SPECIAL_MODES:["search"],set_browse_mode:function(){var e,t,n,i,r,o,s,a;for(e=Se("#browse"),n=e.find("#browse-root-actions"),i=e.find("#browse-sort"),t=e.find("#browse-header-status"),a=this.SPECIAL_MODES,r=0,o=a.length;o>r;r++)s=a[r],e.removeClass(s),n.removeClass(s),i.removeClass(s),t.removeClass(s);return hr.reset_fulltext_search(!0),e.removeClass("fulltext_search"),n.removeClass("fulltext_search"),i.removeClass("fulltext_search"),t.removeClass("fulltext_search"),Se("#fulltext-search-loading").hide(),Se("#fulltext-search-all-link").hide()},set_special_mode:function(e){var t,n,i,r,o,s,a,_;for(t=Se("#browse"),i=t.find("#browse-root-actions"),r=t.find("#browse-sort"),n=t.find("#browse-header-status"),wt(-1!==this.SPECIAL_MODES.indexOf(e),"unknown mode"),_=this.SPECIAL_MODES,o=0,s=_.length;s>o;o++)a=_[o],a!==e&&(t.removeClass(a),i.removeClass(a),r.removeClass(a),n.removeClass(a));return t.addClass(e),i.addClass(e),r.addClass(e),n.addClass(e),e===this.SEARCH_MODE?(t.addClass("fulltext_search"),i.addClass("fulltext_search"),r.addClass("fulltext_search"),n.addClass("fulltext_search")):void 0},get_mode:function(){var e,t,n,i,r;for(r=this.BROWSE_MODE,i=this.SPECIAL_MODES,e=0,t=i.length;t>e;e++)n=i[e],Se("#browse").hasClass(n)&&(r=n);return r},load_visible_thumbs:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p;for(a=this.get_files_in_view(),t=a[1]-a[0],s=[Math.max(a[0]-t,0),a[0]],o=[Math.min(a[1],Ir.files.length),Math.min(a[1]+t,Ir.files.length)],e=[],f=[a,o,s],l=0,d=f.length;d>l;l++)for(r=f[l],i=r[0],_=r[1],p=Ir.files.slice(i,+_+1||9e9),u=0,c=p.length;c>u;u++)n=p[u],n.get_div()&&e.push(n.get_div().down("img"));return h=function(e){return e.src.endsWith(ee.SPACER)?void 0:(e.addClassName("thumbnail"),e.__sert({before:new Element("div",{class:"thumbnail-border"})}))},ot.batch_load_thumbs(e,this.THUMBS_BATCH_SIZE,h)},get_files_in_view:function(){var e,t,n,i,r,o,s,a,_,l,u;return s=[0,Ir.files.length-1],l=je.viewport_dimensions().height,u=je.scroll_offsets().top,(o=this._get_elm_height())?(e=Se("#browse-files"),i=parseInt(e.css("padding-top"),10),!e.length||isNaN(i)?s:("absolute"===Se("#browse-header").css("position")?(t=e.offset().top+i,n=t-u,n>0?(a=0,r=l-n,_=r/o):(a=Math.abs(n/o),_=Math.abs(l-n)/o)):(a=u/o,r=l-i,_=(r+u)/o),a=Math.max(Math.floor(a),0),_=Math.min(Math.floor(_),Ir.files.length-1),[a,_])):s},_get_elm_height:function(){var e,t;return Ir.files.length>=3&&Ir.files[1].get_div()?(e=Se(Ir.files[1].get_div()),t=e.outerHeight()+parseInt(e.css("margin-bottom"))+parseInt(e.css("margin-top"))):null},append_ellipsis:function(e){return zt("%(action_text)s…","web","action which requires further user interaction").format({action_text:e})},getIndexOfFileInArray:function(e,t){var n,i,r,o,s;for(s=-1,i=r=0,o=e.length;o>r;i=++r)n=e[i],n.sjid===t.sjid&&(s=i);return s}};var dr;dr=ft.Sort=function(){var e,t,n,i,r,o,s;return n=function(e){var t;return t=e?1:-1,function(e,n){return t*Zt.sort_by_rank_or_key(e,n)}},i=function(e){var t;return t=e?1:-1,function(e,n){return e.bytes>n.bytes?t:e.bytes<n.bytes?-t:t*dr.FILES_BY_NAME(e,n)}},e=function(e){var t;return t=e?1:-1,function(e,n){return t*(e.fq_path.toLowerCase()>n.fq_path.toLowerCase()?1:-1)}},t=function(e){var t;return t=e?1:-1,function(e,n){var i;return i=e.ts===n.ts?0:e.ts>n.ts?1:-1,t*i}},o=function(e){return function(t){var i,r;return r=e(t),i=n(!0),function(e,t){return e.dir^t.dir?(e.dir?1:0)-(t.dir?1:0):r(e,t)||i(e,t)}}},r=function(e){return function(t){var n,i;return dr.FOLDERS_FIRST?(i=e(t),n=t?1:-1,function(e,t){var r;return e.dir^t.dir?(r=(e.dir?0:1)-(t.dir?0:1),n*r):i(e,t)}):e(t)}},s=function(e){return function(t){var n,i;return i=dr.FILES_BY_NAME(t),n=t?1:-1,function(t,r){var o;return t.is_deleted^r.is_deleted?(t.is_deleted?1:0)-(r.is_deleted?1:0):(o=0,e?t.get_category()!==r.get_category()?o=t.get_category()<r.get_category()?-1:1:t.get_extension()!==r.get_extension()&&(o=t.get_extension()<r.get_extension()?-1:1):t.get_extension()!==r.get_extension()?o=t.get_extension()<r.get_extension()?-1:1:t.get_category()!==r.get_category()&&(o=t.get_category()<r.get_category()?-1:1),n*o||i(t,r))}}},{FILES_BY_NAME:r(n),SHARED_WITH:r(n),FILES_BY_SIZE:o(i),FILES_BY_LOCATION:o(e),FILES_BY_KIND:o(s(!0)),FILES_BY_EXTENSION:o(s(!1)),FILES_BY_MODIFIED:o(t),FOLDERS_FIRST:!Zt.is_mac(),ALL_BY_MODIFIED:t}}();var cr,Yn=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};cr=ft.FlexColumn=function(){var e,t,n,i,r,o,s,a;

for(e=[{label:"SHARED_WITH",func:dr.FILES_BY_NAME,display:zt("Shared With"),is_asc:!0},{label:"FILES_BY_KIND",func:dr.FILES_BY_KIND,display:zt("Kind"),is_asc:!0},{label:"FILES_BY_EXTENSION",func:dr.FILES_BY_EXTENSION,display:zt("Extension"),is_asc:!0},{label:"FILES_BY_SIZE",func:dr.FILES_BY_SIZE,display:zt("Size"),is_asc:!1}],t={},n={},r=[],i=[],s=0,a=e.length;a>s;s++)o=e[s],r.push(o.func),t[o.label]=o.display,n[o.label]=o.is_asc,i.push(o.label);return{SORT_FUNCTIONS:r,DISPLAY:t,IS_ASC:n,LABELS:i,has_label:function(e){return Yn.call(this.LABELS,e)>=0},has_sort:function(e){return Yn.call(this.SORT_FUNCTIONS,e)>=0},next:function(t){var n;return n=cr.LABELS.indexOf(t)+1,n===cr.LABELS.length&&(n=0),e[n]},set_column_display:function(n,i){return e[cr.LABELS.indexOf(n)].display=i,t[n]=i}}}();var hr;hr=ft.FileSearch={MAX_RESULTS:100,last_state:!1,last_fq_path:null,scoped_search:!0,last_new_search_ts:{},is_loaded:!1,init:function(e,t){return this.firefly_enabled=e,this.fulltext_search_enabled=t,Se(document).on("db:searchbar:submit",function(e){return function(t){return Ir.is_initialized?(t.preventDefault(),Se(t.target).blur(),e.search(!0)):void 0}}(this)),Se(document).on("db:searchbar:preview",function(e,t){return Ir.is_initialized?(e.preventDefault(),Ir.open_file(t.file,t.force_new_window,!0,Z.OREF_CONSTANTS.BROWSE_SEARCHBOX)):void 0})},get_state:function(){return S.queryParams(this.get_basic_query(),this.last_fq_path)},set_state:function(e){return this.last_fq_path=null!=e.last_fq_path?e.last_fq_path:"",this.scoped_search=""!==this.last_fq_path,Ir.inside_dir=this.scoped_search,this.set_basic_query(e.query_unnormalized),this.do_search(!1,!0)},state_changed:function(){var e,t;return e=this.get_state(),t=this.last_state,t===!1?!!e.query:e.query!==t.query||e.last_fq_path!==t.last_fq_path},get_basic_query:function(){return this._get_browse_search_input().val()},set_basic_query:function(e){return e!==this.get_basic_query()?this._get_browse_search_input().val(e):void 0},set_title:function(){var e,t;return e=this.get_state(),t=zt("Search - Dropbox"),e.query_unnormalized&&(t=e.query_unnormalized+" - "+t),document.title=t},_set_scope_path_to_browse_location:function(){return this.last_fq_path=Ir.inside_dir?Ir.containing_fq_path():""},do_search:function(e,t){var n,i,r,o;return null==t&&(t=!1),"function"==typeof Ir.entered_search&&Ir.entered_search(),o=!t&&!Ir.in_search_mode(),o&&this._set_scope_path_to_browse_location(),r=this.get_state(),(i=""===this.get_basic_query())?void(Ir.in_search_mode()&&(this._clear_on_reload=!1,this.exit_search())):(this.last_state=r,this._clear_on_reload=!0,Sr.deselect_all(),Ir.clear(),ur.set_special_mode("search"),this.scoped_search=""!==this.last_fq_path,t||(n=null,v.push_state("/search/"+Ir.active_user.role,r)),this.set_title(),this.reset_fulltext_search(this.scoped_search),this.last_new_search_ts=new Date,Se("#fulltext-search-loading").show(),this.ask_server("/ajax_fulltext_search",e,0,this.MAX_RESULTS,!1),Gt("search"))},search:function(e){return null==e&&(e=!1),e!==this.scoped_search&&(this.last_state=!1),this.scoped_search=this.scoped_search&&e,this.scoped_search||(this.last_fq_path=""),this.do_search(!1)},load_more_results:function(){var e;return this.end_of_results?void 0:(e=this.search_pos,this.end_of_active_results&&(e=this.deleted_search_pos),this.ask_server("/ajax_fulltext_search",!1,e,this.MAX_RESULTS,this.end_of_active_results))},firefly_filename_search:function(){return this.do_search(!0)},update_empty:function(){var e;return e=zt("No results found"),this.scoped_search&&(e=zt("No results found in '%(path)s'").format({path:_t.filename(this.last_fq_path)})),Se("#noresults-header").text(e),Se("#fulltext-search-all-link").hide(),Se("#noresults-directions").toggle(!this.scoped_search),Se("#noresults-search-all-link").toggle(this.scoped_search)},show_empty:function(){return this.update_empty(),$("search-empty").show()},hide_empty:function(){return $("search-empty").hide()},reset_fulltext_search:function(e){return Sr.deselect_all(),Ir.clear(),Ir.reset_state(),Ir.update_header_status(""),this.search_pos=0,this.deleted_search_pos=0,this.end_of_active_results=!1,this.end_of_results=!1,this.scoped_search=e,Se("#fulltext-search-all-link").hide()},exit_search:function(){var e;return Ir.in_search_mode()&&(e=[Ir.inside_deleted_dir,Ir.inside_deleted_sandbox,Ir.inside_deleted_shared_folder],w.any(e)||(Ir.deleted_shown=!1)),$("browse").removeClassName("pending-search"),this.hide_empty(),mr.set_path_url(null,this.last_fq_path,Ir.deleted_shown)},force_reload:function(){return this.search()},ask_server:function(e,t,n,i,r){var o,s,a,_,l,u;return u=this.get_state(),l=null,_=new Date,l=r?et.DELETED:t?et.COMPLETION:et.FULLTEXT,o={firefly:this.firefly_enabled,infinite_scroll:n>0?!0:!1,path_scoped:!1,search_type:l,query_string:u.query},rt.SearchClientActivityLogger.log("query_started",Ir.active_user.id,o),n||Se("#web-search-results").html(zt("Searching...")),Se("#browse").addClass("pending-search"),s={query:u.query},n&&(s.start=n),i&&(s.max_results=i),r&&(s.deleted=r),this.scoped_search&&(s.fq_path=this.last_fq_path),t||(this.last_fulltext_query=u.query),t&&(s.filename_only=!0),a=!1,new Ajax.DBRequest(e,{no_watch:!0,evalJSON:!1,parameters:s,log_timing:!0,onSuccess:function(e){return function(t){var n,i,r,s,l;if(Ir.in_search_mode())return s=t.request.parameters.parent_request_id,n=JSON.parse(t.responseText),l=n.file_info.length,u.query===e.last_fulltext_query&&_>=e.last_new_search_ts&&(e.search_pos=e.search_pos+l,e.end_of_active_results&&(e.deleted_search_pos=e.deleted_search_pos+l),l<e.MAX_RESULTS&&(e.end_of_results=!0&&e.end_of_active_results,e.end_of_active_results=!0,e.end_of_results?Se("#fulltext-search-loading").hide():a=!0),e.update_results(n,a,s)),i=n.file_info.length>0?n.file_info[0]:null,o=rt.SearchClientActivityLogger.create_completion_log_dict(o,s,t.request.start_time,u.query,u.query===(null!=(r=e.last_state)?r.query:void 0),l,null,i),rt.SearchClientActivityLogger.log("query_completed",Ir.active_user.id,o)}}(this),onFailure:function(e){return function(t){var n;return o=rt.SearchClientActivityLogger.create_completion_log_dict(o,t.request.parameters.parent_request_id,t.request.start_time,u.query,u.query===(null!=(n=e.last_state)?n.query:void 0),null,t.status),rt.SearchClientActivityLogger.log("query_failed",Ir.active_user.id,o)}}(this),cleanUp:function(e){return function(){return a?e.load_more_results():Se("#browse").removeClass("pending-search")}}(this),subject_user:Ir.active_user})},update_results:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=null),i=this.get_state(),Ir.update(e,n),Ir.set_selection_from_fq_paths_or_index(hr),t?void 0:(this._update_number_results(this.search_pos),Ir.files.length?this.hide_empty():this.show_empty())},_update_number_results:function(e){var t,n;return t=0===e?"":this.end_of_results?this.fulltext_search_enabled?Bt("%(num_results)s result in files, folders, and content.","%(num_results)s results in files, folders, and content.",e).format({num_results:e}):Bt("%(num_results)s result in files and folders.","%(num_results)s results in files and folders.",e).format({num_results:e}):this.fulltext_search_enabled?Bt("Over %(num_results)s result in files, folders, and content.","Over %(num_results)s results in files, folders, and content.",e).format({num_results:e}):Bt("Over %(num_results)s result in files and folders.","Over %(num_results)s results in files and folders.",e).format({num_results:e}),n=zt("Search")+" - "+t,Ir.update_header_status(t),n=zt("Results for '%(query)s'").format({query:this.get_state().query}),this.scoped_search&&(n=zt("Results for '%(query)s' in '%(path)s'").format({query:this.get_state().query,path:_t.filename(this.last_fq_path+"'")})),Se("#web-search-results").text(n),this.scoped_search?Se("#fulltext-search-all-link").show():void 0},history_change_handler:function(e,t){var n,i,r;return i="string"==typeof this._get_browse_search_input().find("input").attr("value"),r=i&&!this.is_loaded,t&&(this.last_state=t),this.last_state?((this.state_changed()||r)&&this.set_state(this.last_state),ro.shown()||key.setScope(Ir.KEY_SCOPE),Sr.get_selected_files().length&&(n=Sr.get_selected_files()[0].get_div(),Ir.scrollToWithPadding(n,2*n.getHeight())),this.is_loaded=!0):void mr.set_path_url(f.root_ns,"")},clear_searchbox:function(){return this._get_browse_search_input().val("")},_get_browse_search_input:function(){return Se("#browse-search-input")}};var fr;fr=ft.BrowseKeys={_handlers:{},init:function(){},init_advanced:function(){var e,t,n;n=this.advanced_dict;for(t in n)e=n[t],key(e.key,Ir.KEY_SCOPE,e.onPress);return this.customize_chart(),Zt.is_mac()&&Prototype.Browser.Gecko?document.observe("keypress",function(e){return function(t){return 63!==t.charCode||je.focus_in_input()?void 0:e.advanced_dict.help.onPress()}}(this)):void 0},customize_chart:function(){var e,t,n,i;for(e=Zt.is_mac()?".key-windows":".key-macos",n=0,t=void 0,i=[];;){if(t=$("keys-chart").down(e,n++),!t)break;i.push(t.hide())}return i},toggle_chart:function(){return"none"===$("keys-chart").style.display?this.show_chart():this.hide_chart()},show_chart:function(){var e,t;return e=$("keys-chart"),e.style.position="fixed",t=$("browse-sort"),Ir.in_search_mode()?t=$("browse-header-wrapper"):"none"===t.getStyle("display")&&(t=$("browse-root-actions")),je.clone_position(Se(e),Se(t),{setHeight:!1}),e.style.top=t.cumulativeOffset()[1]+t.getHeight()+"px",e.setOpacity(.9),e.show()},hide_chart:function(){return $("keys-chart").hide()},advanced_dict:{rename:{title:zt("Rename selected files",{comment:"'selected' means files that have been highlighted by the user to be acted upon"}),key:"f2",onPress:function(){var e;return e=Sr.get_selected_files(),e.length?e.first().edit():void 0}},delete:{title:zt("Delete selected files",{comment:"'selected' means files that have been highlighted by the user to be acted upon"}),key:"delete, command+backspace, backspace",onPress:function(e){var t,n,i,r;if(Event.stop(e),Ir.inside_read_only_shared_folder&&k.warning(zt("You don't have permission to delete files in this folder.")),r=Sr.get_selected_files(),1===r.length)return n=r.first(),n.is_deleted?li.show_purge(n.fq_path,n.dir):(t=n.mount_point?_t.filename(n.mount_point):null,li.show_delete(Ir.active_user,n.fq_path,n.dir,void 0,t,n.is_shared_folder()));if(r.length>1){if(i=ur.profile_files(r),i.deleted===r.length)return li.show_bulk_purge(r);if(0===i.deleted)return li.show_bulk_delete(Ir.active_user,r)}}},help:{title:zt("Show/hide keyboard shorcuts"),key:"shift+/, "+key.main_modifier()+"+/",onPress:function(){return fr.toggle_chart()}},close_help:{title:zt("Hide keyboard shorcuts"),key:"escape",onPress:function(){return fr.hide_chart()}},up_dir:{title:zt("Up a folder",{comment:"meaning, go from the current folder to its containing (parent) folder. this is one step up only -- the parent, not the root."}),key:"left",onPress:function(){var e,t;return Ir.keyboard_nav=!0,Ir.reloading?void 0:Ir.inside_dir?(Ir.containing_ns_path()||Ir.containing_ns_id()===f.root_ns?(t=Ir.containing_ns_id(),e=_t.normalize(_t.parent_dir(Ir.containing_ns_path()))):(t=f.root_ns,e=_t.normalize(_t.parent_dir(Ir.containing_fq_path()))),Ir.containing_ns_path()!==e||Ir.containing_ns_id()!==t?(Ir.select_fq_paths=[Ir.containing_fq_path()],mr.set_path_url(t,e)):Sr.flicker_selected()):Sr.flicker_selected()}},open_file:{title:zt("Open highlighted file"),key:"enter",onPress:function(){var e,t;return t=Sr.get_selected_files(),1===t.length&&(e=t[0],Ir.open_file(e,!1,!1,Z.OREF_CONSTANTS.BROWSE_FILE_OPEN)),!1}},open_dir:{title:zt("Open highlighted folder"),key:"right",onPress:function(){var e,t;return Ir.keyboard_nav=!0,t=Sr.get_selected_files(),1===t.length&&(e=t[0],e.dir?(Ir.select_index=0,Ir.open_folder(e)):Sr.flicker_selected()),!1}},undo:{title:zt("Undo recent move/copy/rename/delete"),key:key.main_modifier()+"+z",onPress:function(){return ie.perform_undo(),!1}},search:{title:zt("Search"),key:"/",onPress:function(){return Se(document).trigger("db:searchbar:focus"),!1}}}};var pr;pr=ft.BrowseSharedLink={store_shared_link_info:function(e,t,n){return"/"===e.charAt(0)&&(e=e.substring(1)),this._shared_link_fq_dir=e,this._shared_link_file=n,this._shared_link_url=t},shared_link_handler:function(e){return pr._shared_link_url==="/s/"+e||pr._shared_link_url==="/scl/"+e&&0===e.indexOf("fi")?(mr.load_browse_view(void 0,encodeURIComponent(pr._shared_link_fq_dir)),Ir.open_preview(pr._shared_link_file)):pr._shared_link_url==="/sh/"+e||pr._shared_link_url==="/scl/"+e&&0===e.indexOf("fo")?(mr.load_browse_view(void 0,encodeURIComponent(pr._shared_link_fq_dir)),pr._shared_link_file&&Ir.open_preview(pr._shared_link_file)):location.reload(),pr.highlight_user()},close_shared_link_view:function(){return window.location.pathname===this._shared_link_url?mr.set_path_url(null,"/"+this._shared_link_fq_dir):void 0},highlight_user:function(){return Ir.active_user.role===O.ROLE_WORK?(Se("#work-nav-item").addClass("selected"),Se("#personal-nav-item").removeClass("selected")):(Se("#personal-nav-item").addClass("selected"),Se("#work-nav-item").removeClass("selected"))}};var mr;mr=ft.BrowseURL={_DEFAULTS:{d:!1,select:!1,open_preview:!1},_get_helper:function(e){var t;return t=v.deconstruct_url().qargs,e in t?!!t[e]:(wt(e in this._DEFAULTS,"bad query param in BrowseURL"),this._DEFAULTS[e])},get_del:function(){return this._get_helper("d")},ns_to_fq_path:function(e,t){var n;return e===Ir.active_user.root_ns||e in Ir.ns_id_to_mount_point||(e=Ir.active_user.root_ns),e===Ir.active_user.root_ns?t:(n=Ir.ns_id_to_mount_point[e],n+t)},make_browse_url_from_fq_path:function(e,n,i){var r,s,a,_;null==i&&(i={}),wt("string"==typeof n,"expected explicit fq_path string"),a=o({path:t.get_browse_root(e)+n}),s=v.deconstruct_url().qargs;for(r in i)_=i[r],r in this._DEFAULTS&&!!_!==this._DEFAULTS[r]&&(s[r]=_);for(r in s)r in this._DEFAULTS||delete s[r];return v.construct_url(String(a),s)},_make_url:function(e,t,n){var i;return null==n&&(n={}),e||(e=Ir.active_user.root_ns),wt("number"==typeof e,"expected ns_id as a number"),wt("string"==typeof t,"expected explicit ns_path string"),i=this.ns_to_fq_path(e,t),this.make_browse_url_from_fq_path(Ir.active_user,i,n)},set_path_url:function(e,t,n){var i,r,o;return e?(r=parseInt(e,10),e=isNaN(r)?f.root_ns:r):e=Ir.active_user.root_ns,t=_t.normalize(t),o=null!=n?this._make_url(e,t,{d:n?1:0}):this._make_url(e,t),i=v.deconstruct_url(o),v.push_state(i.path,i.qargs)},set_del_url:function(e){var t,n,i;return i=v.deconstruct_url(),t=i.path,n=i.qargs,e?n.d="1":delete n.d,v.push_state(t,n)},_first_load:!0,_last_ns_dir:null,_last_ns_id:null,load_browse_view:function(e,t,n){var i,r,o;return null==n&&(n=!1),key.setScope(Ir.KEY_SCOPE),t=_t.normalize(t),o=!1,this._first_load||(o=!Ir.inside_dir||t!==this._last_ns_dir||e!==this._last_ns_id||Ir.in_search_mode()),i=n!==Ir.deleted_shown,Ir.deleted_shown=n,(this._first_load||o||i)&&Ir.reload(e,t,!0),this._first_load=!1,this._last_ns_dir=t,this._last_ns_id=e,Sr.get_selected_files().length&&(r=Sr.get_selected_files()[0].get_div())?Ir.scrollToWithPadding(r,2*r.getHeight()):void 0},history_change_handler:function(e,n){var i,r,s,a,_;if(a=n.ns,_="1"===n.d,this.load_browse_view(a,e,_),null!=n.preview){if(r="/"+o.encode(n.preview),e&&(r="/"+e+r),i=Ir.find_file(o.decode(r)),null==i)return rt.UserActivityLogger.log("web","browse_preview_does_not_exist"),v.replace_state(t.get_browse_root(Ir.active_user));if(oe.getGandalfRule("file-viewer-react"))return s=ur.getIndexOfFileInArray(Ir.files,i),ke.open(Ir.files,s,Ir.active_user,"react-file-viewer",{fileViewTarget:Z.FileViewTargetType.PRIVATE,fileViewOrigin:Z.FileViewOriginType.BROWSE,fileViewAction:Z.FileViewActionType.CLICK});if(!ro.shown()||ro.file!==i)return Ir.open_preview(i,Z.OREF_CONSTANTS.BROWSE_UNKNOWN,!0)}else{if(!oe.getGandalfRule("file-viewer-react")&&ro.shown())return ro.hide();if(oe.getGandalfRule("file-viewer-react")&&ke.isShown())return ke.close()}},parse_b2_hash:function(e){var t,n,i,r,o;return r=e.split(":"),4!==r.length?!1:(i=r[0],t="1"===r[2],n=r[3],(o=!n||Zt.isNumber(n))?(n=parseInt(n,10)||f.root_ns,{ns_id:n,ns_path:i,deleted:t}):!1)}};var vr;vr=ft.BrowseFile=Class.create({initialize:function(e){var t,n,i,r;return t=_t.filename(e.fq_path),this.can_hold_shared_folders=e.can_hold_shared_folders,this.allows_shared_link=e.allows_shared_link?1:0,this.icon=e.icon,this.filename=t,this.filename_highlights=null!=(n=e.filename_highlights)?n:[],this.unresolved_comment_count=e.unresolved_comment_count,this.unseen_comment_count=e.unseen_comment_count,this.update_caption(),this.ns_id=e.ns_id,this.ns_path=e.ns_path,this.fq_path=e.fq_path,this.mount_point=e.mount_point,this.hash=e.hash,this.href=e.href,this.size="None"!==e.size?e.size:"",this.file_id=e.file_id,this.bytes=e.bytes,this.is_deleted=-1===this.bytes,this.ago=e.ago,this.ts=e.ts,this.dir=e.is_dir?1:0,this.target_ns=e.target_ns,this.sort_rank=e.sort_rank,this.sort_key=e.sort_key||[""],this.sjid=e.sjid,this.tkey=void 0,this.thumbnail_url_tmpl=e.thumbnail_url_tmpl,this.large_thumbnail_url_tmpl=e.large_thumbnail_url_tmpl,this.type=e.type,this.preview_type=e.preview_type,e.last_modified_fname&&(this.last_modified_fname=_.em_snippet(e.last_modified_fname,Mr),this.last_modified_name=e.last_modified_name),this.event_type=e.event_type,this.htmlified_link=e.htmlified_link,this.linkfile_link=e.linkfile_link,this.direct_blockserver_link=e.direct_blockserver_link,this.doc_preview_status=e.doc_preview_status,this.in_root_coll=e.in_root_coll,this.compressible=e.compressible,this.user_id=e.user_id,this.sf_perm_role=e.sf_perm_role,this.fulltext_search=e.fulltext_search,this.read_only=e.read_only?!0:!1,this.is_read_only_mount=e.is_read_only_mount?!0:!1,this.request_id=null!=(i=e.request_id)?i:null,this.match_type=null!=(r=e.match_type)?r:"UNKNOWN_MATCH",this.video_transcode_url=e.video_transcode_url},track_in_browse:function(){return this.to_key()in vr._file_index?void 0:(Ir.add_file(this),vr._file_index[this.to_key()]=this)},is_shared_folder:function(){return this.type===It.SHARED_FOLDER||this.type===It.TEAM_SHARED_FOLDER},is_team_shared_folder:function(){return this.type===It.TEAM_SHARED_FOLDER},could_be_shared_link:function(){return this.allows_shared_link},could_be_shared_folder:function(){var e,t,n,i;return t=Ir.public_folder_enabled&&this.fq_path.toLowerCase().startsWith("/public/"),i=Ir.public_folder_enabled&&"/public"===this.fq_path.toLowerCase(),n=this.target_ns,e=this.ns_id!==f.root_ns,!(this.type!==It.FOLDER||n||t||i||this.is_sandbox()||e&&(!this.can_hold_shared_folders||Ir.inside_read_only_shared_folder))},is_sandbox:function(){return this.type===It.SANDBOX},get_div:function(){return $("f_"+this.to_key())},rename:function(e,t,n,i,r,o){var a,_,l;return _=this.fq_path,Ir.pre_action_selection=[_],a=Ir.find_file(e),a&&Ir.remove_file(a),this.filename=_t.filename(e),this.update_caption(),this.fq_path=e,this.ns_path=t,this.htmlified_link=o,this.hash=n,this.sort_key=i,this.sort_rank=null,this.last_modified_fname=null,this.dir?(this.href="/home"+Zt.urlquote(e),this.target_ns&&(Ir.ns_id_to_mount_point[this.target_ns]=e)):(l=this.href.split("/"),l[l.length-1]=Zt.urlquote(this.filename)+("?w="+n),this.href=l.join("/"),this.icon=r),Ir.in_search_mode()&&(this.filename_highlights=[]),vr._file_index[this.to_key()]=this,Ir.update_file_pos(this),Se(document).trigger(s.RENAME,{old_fq_path:_,file:this})},edit:function(){var e,t,n,i,r;return this.editing=!0,Ir.selectable(),r=function(e){return function(t){var n,i,r,o,s,a,_,l,u,d;return d=t.responseText.evalJSON(!0),wt(1===d.new_browse_files.length,"No new file data returned."),r=d.new_browse_files.first(),o=r.fq_path,s=r.hash,u=Zt.decode_sort_key(r.sort_key),_=r.icon,l=r.ns_path,a=r.htmlified_link,n=d.changesets,i=zt("Rename complete."),ie.notifyWithUndo(i,n,li.do_rollback),e.rename(o,l,s,u,_,a),Sr.set_selected_files([e]),e.get_div().smoothScrollIntoView(),ur.load_visible_thumbs(),Ir.fire_visible_change_callbacks()}}(this),t=o({path:"/cmd/rename"+this.fq_path}).updateQuery(O.UID_PARAM_NAME,Ir.active_user).toString(),n=Ir.in_search_mode()?".filename-col":".filename-col a",e=new Ajax.InPlaceEditor(this.get_div().down(n),t,{htmlResponse:!1,okControl:!1,cancelControl:!1,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:!0,initialText:this.filename,cancelIfSame:!0,clickToEdit:!1,onComplete:function(e){return function(){return e.editing=!1}}(this),onFailure:function(){},savingText:zt("Saving..."),ajaxOptions:{job:!0,subject_user:Ir.active_user,html_in_error_msg:!0,progress_text:zt("Renaming..."),method:"POST",onCreate:k.clear,onSuccess:r,onUninitialized:Ir.unselectable},callback:function(e){return function(t,n){return{to_path:n||"",folder:e.dir?"yes":""}}}(this)}),e.enterEditMode(),i=this.get_div().down(".editor_field"),"selectionEnd"in i&&this.filename.lastIndexOf(".")>-1?i.selectionEnd=this.filename.lastIndexOf("."):void 0},to_key:function(){return this.ns_id+"_"+this.sjid},get_category:function(){var e,t;return this.dir&&(Ir.inside_dir&&""===Ir.containing_fq_path()&&"public"===this.filename.toLowerCase()&&Ir.public_folder_enabled&&(e="PUBLIC_FOLDER"),null==e&&(e=this.type===It.FOLDER?"FOLDER":this.type===It.PACKAGE?"FOLDER":this.type===It.TEAM_SHARED_FOLDER?"TEAM_SHARED_FOLDER":this.type===It.SHARED_FOLDER?"SHARED_FOLDER":this.type===It.SANDBOX?"SANDBOX":this.target_ns?"SHARED_FOLDER":"FOLDER")),null==e&&(e=vr.EXTENSION_TO_CATEGORY[this.get_extension()]||"FILE"),t=this.is_deleted?vr.CATEGORY_TO_DELETED_TRANSLATION[e]:vr.CATEGORY_TO_TRANSLATION[e],wt(t,"CATEGORY MISSING FOR "+e),t},get_icon_alt:function(){return this.dir?zt(this.is_shared_folder()?this.is_team_shared_folder()?this.is_read_only_mount?"Read-only team folder":"Team folder":this.is_read_only_mount?"Read-only shared folder":"Shared folder":this.is_read_only_mount?"Read-only folder":"Folder"):""},get_extension:function(){return this.dir||-1===this.filename.indexOf(".")?void 0:_t.file_extension(this.filename).toLowerCase()},is_shmodelable:function(){return!this.is_deleted&&Ir.is_shmodelable_path(this.fq_path)},update_caption:function(){var e;return e=Ir.inside_dir?Nr:Fr,this.unresolved_comment_count>0&&(e-=Lr),this.caption=_.em_snippet(this.filename,e)}}),vr._CATEGORIES={IMAGE:"bmp cr2 gif ico jpeg jpg nef png psd tif tiff svg svgz",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"ai cdr csv doc docx docm eps fla indd keynote numbers otf pages pdf ppt pptx pptm pps ppsx ppsm ps rtf swf txt wpd xls xlsx xlsm",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 c coffee cpp cs css cxx h html java js less php py rb sass scss sh sql vb xhtml xml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"},vr.EXTENSION_TO_CATEGORY={},vr.CATEGORY_TO_TRANSLATION={FILE:zt("file"),FOLDER:zt("folder"),SHARED_FOLDER:zt("shared folder"),TEAM_SHARED_FOLDER:zt("team folder"),PUBLIC_FOLDER:zt("folder"),IMAGE:zt("image"),VIDEO:zt("video"),AUDIO:zt("audio"),DOCUMENT:zt("document"),COMPRESSED_FILE:zt("archive"),CODE:zt("code"),DISK_IMAGE:zt("disk image"),EXECUTABLE:zt("executable"),SHORTCUT:zt("shortcut"),LINK:zt("link"),FONT:zt("font"),SANDBOX:zt("app folder")},vr.CATEGORY_TO_DELETED_TRANSLATION={FILE:zt("deleted file"),FOLDER:zt("deleted folder"),SHARED_FOLDER:zt("deleted shared folder"),TEAM_SHARED_FOLDER:zt("deleted team folder"),PUBLIC_FOLDER:zt("deleted folder"),IMAGE:zt("deleted image"),VIDEO:zt("deleted video"),AUDIO:zt("deleted audio"),DOCUMENT:zt("deleted document"),COMPRESSED_FILE:zt("deleted archive"),CODE:zt("deleted code"),DISK_IMAGE:zt("deleted disk image"),EXECUTABLE:zt("deleted executable"),SHORTCUT:zt("deleted shortcut"),LINK:zt("deleted link"),FONT:zt("deleted font"),SANDBOX:zt("deleted app folder")},function(){var e,t,n,i,r;i=vr._CATEGORIES,r=[];for(e in i)n=i[e],r.push(function(){var i,r,o,s;for(o=n.trim().split(" "),s=[],i=0,r=o.length;r>i;i++)t=o[i],s.push(vr.EXTENSION_TO_CATEGORY[t]=e);return s}());return r}(),vr._file_index={},vr.from_key=function(e){return vr._file_index[e]},vr.from_elem=function(e){var t;if(e)return t=e.readAttribute("data-identity"),t?vr.from_key(t):vr.from_elem(e.up("[data-identity]"))};var gr,wr,br,yr,kr,Er,Yn=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};gr=INLINE_JS.BrowseActions=ft.BrowseActions=Class.create({initialize:function(e){return this._set_files(e)},firefly_logging_helper:function(e){return Ir.in_search_mode()&&e?(this._firefly_log_values.action_type=e,rt.SearchClientActivityLogger.log("result_action",Ir.active_user.id,this._firefly_log_values)):void 0},unlisten:function(){},get_action_names:function(){var e;return e=this.get_files(),e.length<2?this._get_actions_single(e.first()):this._get_actions_multi(e)},get_files:function(){return this._files},get_action_by_name:function(e){return this.evaluate_action(gr.option_dict[e],e)},evaluate_action:function(e,t){var n,i,r;return n=function(e){return function(t,n){return null!=n&&null==t?n:Se.isFunction(t)?t.call(e):null!=t?t:n}}(this),r={icon_href:e.icon_href,target:e.target,click_handler:e.click_handler,type:e.type,name:t||e.name,is_dropdown:!!e.is_dropdown,icon:n(e.icon),text:n(e.text),detail_text:n(e.detail_text),href:n(e.href,""),kind:n(e.kind,"icon"),button_label:n(e.button_label,e.text)},Se.isFunction(e.subactions)?r.subactions=e.subactions.call(this):Se.isArray(e.subactions)?r.subactions=function(){var t,n,r,o;for(r=e.subactions,o=[],t=0,n=r.length;n>t;t++)i=r[t],o.push(this.get_action_by_name(i));return o}.call(this):e.subactions&&wt(0,"subactions must be a function or an array of actions"),r},_set_files:function(e){var t;return this._files=$A(e),this._log_extras={},this.get_files().length>0?(t=e.first(),this._log_extras={path:t.fq_path,ns_id:t.ns_id},this._firefly_log_values={file_nsid:t.ns_id,file_sjid:t.sjid,firefly:hr.firefly_enabled,match_type:t.match_type,position:t.sort_rank,request_id:t.request_id,viewport:"full-view"}):void 0},_get_actions_single:function(e){var t,n,i,r,o,s,a,_,l,u,d,c,h,p;return t=[],e?(i=Ir.public_folder_enabled&&e.fq_path.toLowerCase().startsWith("/public/"),_=Ir.public_folder_enabled&&"/public"===e.fq_path.toLowerCase(),s=e.target_ns,n=e.ns_id!==f.root_ns,u=e.type===It.SHARED_FOLDER,l=e.type===It.SANDBOX,a=e.type===It.PACKAGE,o=e.in_root_coll,r=e.compressible,e.is_deleted?(t=t.concat(["restore"]),(null!=(c=Ir.permanent_delete_is_disabled_by_ns_id)?c[e.ns_id]:void 0)||t.push("purge"),t):(p=null!=__CONDITIONAL_JS__.UnityFeatures&&(null!=(h=__CONDITIONAL_JS__.UnityCheckFileCache)?h.is_cached_and_locally_available(e.ns_id,e.ns_path):void 0),d=p?"open":"download",e.dir?(t.push(l?"app_info":Me.Tiburon.foldersUI()?"share":e.is_shared_folder()||e.could_be_shared_folder()?"single_entry_share_dropdown_variant_menu":"single_entry_share_dropdown_variant_token_share_only"),t.push(d),_||(t=t.concat(["delete","rename","move"]),a||s||t.push("copy")),Ir.can_use_photos_features&&Ir.can_use_photos_features&&t.push("album_from_folder")):(t.push(i||Ir.public_app_token?"copy_url":Me.Tiburon.filesUI()?"share":"single_entry_share_dropdown_variant_token_share_only"),t.push(d),Ir.can_show_preview(e)&&Ir.browser_supports_comments&&t.push("comment"),t=t.concat(["delete","rename","move","copy","revisions"]),o&&Ir.can_use_photos_features&&t.push("carousel"===Ir.photos_experience?"view_in_carousel":"view_in_photos"),r&&t.push("compress")),t)):[]},_get_actions_multi:function(e){var t,n,i;return t=["download","delete","move","copy","restore","purge"],t.push("carousel"===Ir.photos_experience?"view_in_carousel":"view_in_photos"),n=ur.profile_files(e),(n.deleted>0||n.public_folder>0)&&(t.removeItem("move"),t.removeItem("copy"),t.removeItem("delete")),n.shared_folders>0&&t.removeItem("copy"),n.deleted>0&&(t.removeItem("send_copy"),t.removeItem("delete"),t.removeItem("download")),Ir.inside_dir||t.removeItem("download"),(n.deleted!==e.length||0!==n.shared_folders&&(n.shared_folders!==(i=e.length)||1!==i))&&t.removeItem("restore"),(n.deleted!==e.length||n.can_permanently_delete!==e.length)&&t.removeItem("purge"),n.in_root_coll===e.length&&Ir.can_use_photos_features||(t.removeItem("view_in_photos"),t.removeItem("view_in_carousel")),t},get_disabled_action_names:function(){var e,t,n,i,r;for(e=!1,r=this.get_files(),n=0,i=r.length;i>n;n++)if(t=r[n],e=!0,!t.read_only){e=!1;break}return Ir.inside_read_only_shared_folder||e?["move","rename","delete","restore","purge","upload","new_folder","compress"]:[]},show_disabled_action_warning:function(e){return k.warning(Ir.inside_read_only_shared_folder?"move"===e?zt("You don't have permission to move files in this folder."):"rename"===e?zt("You don't have permission to rename files in this folder."):"delete"===e?zt("You don't have permission to delete files in this folder."):"restore"===e?zt("You don't have permission to restore files in this folder."):"purge"===e?zt("You don't have permission to permanently delete files in this folder."):"upload"===e?zt("You don't have permission to upload files into this folder."):"new_folder"===e?zt("You don't have permission to create a new folder in this folder."):"compress"===e?zt("You don't have permision to create a compressed file in this folder."):zt("You only have permission to view this folder."):zt("You do not have permission to perform the requested action."))}}),Object.extend(gr,{PUBLIC_FOLDER_PATH_LENGTH:7,showCopyPublicUrlModal:function(e){var t,n;return mi.show(ur.append_ellipsis(zt("Copy public link")),tn.fromElm("copy-public-url"),{wit_group:"copy_public_link"}),mi.onHide=function(){return $("flash_copy_container").remove(),delete mi.onHide,mi.hide()},t=We.clipboard_overlay(e,Se("#real_copy"),function(){return k.success(zt("Link copied to clipboard!")),mi.hide()}),t.css({zIndex:1001}),n=$("modal-content").down("#public_url"),wt(n,"Text element not found for copy pulic link"),n.setValue(e),n.select()},shortenPublicLink:function(){var e;return Zt.shorten_url($F("public_url"),gr.updatePublicLink),e=new Element("img",{id:"publink_loading",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",className:"right"}),$("modal-content").down("a").__date(e)},updatePublicLink:function(e){var t;return $("public_url").setValue(e),$("public_url").select(),$("publink_loading").remove(),$("flash_copy_container").remove(),t=We.clipboard_overlay(e,Se("#real_copy"),function(){return k.success(zt("Link copied to clipboard!")),mi.hide()}),t.css({zIndex:1001})},option_dict:{new_folder:{icon:"folder_add",text:zt("New folder"),click_handler:function(){return Ir.new_folder()}},global_restore:{icon:"restore",text:function(){return wt(Ir.inside_deleted_dir,"Global restore from not a deleted dir"),Ir.inside_deleted_shared_folder?ur.append_ellipsis(zt("Rejoin shared folder")):zt(Ir.inside_deleted_sandbox?"Restore app folder":"Restore folder")},click_handler:function(){var e,t,n,i,r;return e=Ir.containing_fq_path(),n=e.toLowerCase(),Ir.inside_deleted_sandbox?(wt(Ir.old_path_to_ns_id[n],"Deleted sandbox missing nsid"),Hr.restore_sandbox(Ir.active_user,e,Ir.old_path_to_ns_id[n])):Ir.inside_deleted_shared_folder?(wt(Ir.old_path_to_ns_id[n],"Deleted shared folder missing nsid"),an.show_rejoin_modal(Ir.active_user,e,Ir.old_path_to_ns_id[n])):(t=o.parse(location.href).setFragment("").toString(),i={prev:t},i[O.UID_PARAM_NAME]=Ir.active_user,r=o({path:"/restore"+e}).updateQuery(i),window.location.href=String(r))}},restore:{icon:"restore",text:function(){var e,t;return e=this.get_files(),t=ur.profile_files(e),ur.append_ellipsis(t.shared_folders===e.length?Bt("Rejoin shared folder","Rejoin shared folders",e.length,{comment:"BUTTON"}):zt("Restore",{comment:"Restore a previously-deleted file"}))},click_handler:function(){var e,t,n,i,r,s,a,_;if(t=this.get_files(),0===t.length);else{if(1!==t.length)return li.show_bulk_restore(t,Ir.active_user);if(e=t.first(),!e.is_deleted)return;i=e.fq_path,n=i.toLowerCase(),
e.type===It.SANDBOX?(wt(Ir.old_path_to_ns_id[n],"Restore missing ns"),Hr.restore_sandbox(Ir.active_user,i,Ir.old_path_to_ns_id[n])):(a=e.type)===It.SHARED_FOLDER||a===It.TEAM_SHARED_FOLDER?(wt(Ir.old_path_to_ns_id[n],"Rejoin missing ns"),an.show_rejoin_modal(Ir.active_user,i,Ir.old_path_to_ns_id[n])):e.dir?(r=o.parse(location.href).updateQuery({select:e.filename}),s={prev:String(r)},s[O.UID_PARAM_NAME]=Ir.active_user,_=o({path:"/restore"+e.fq_path}).updateQuery(s),window.location=String(_)):li.show_undelete(e)}}},global_share:{icon:"rainbow_16",text:function(){return ur.append_ellipsis(Ir.inside_team_folder?zt("Team folder options",{comment:"BUTTON. please keep this as short as possible"}):Ir.inside_shared_folder?zt("Shared folder options",{comment:"BUTTON. please keep this as short as possible."}):""===Ir.containing_fq_path()?zt("Share a folder",{comment:"BUTTON. this initiates a wizard that lets the user select a folder to share."}):zt("Share this folder",{comment:"BUTTON. this button lets the user share the current folder that they're viewing."}))},click_handler:function(e){return e.preventDefault(),""===Ir.containing_fq_path()?an.start_wizard_for_user(Ir.active_user):Me.Tiburon.foldersUI()?null:Ir.inside_shared_folder?an.show_shared_folder_options_modal(Ir.containing_mount_point(),Ir.active_user):an.show_share_existing_modal(Ir.containing_fq_path(),Ir.active_user)}},share:{icon:"rainbow_16",text:ur.append_ellipsis(zt("Share",{comment:"BUTTON"})),click_handler:function(e,t){var n;return n=this.get_files().first(),an.logAndShowSharingModal(n,t)}},revisions:{icon:"previous_versions",click_handler:function(){return window.location.href=li.build_revisions_uri(this.get_files().first().fq_path,Ir.active_user)},text:zt("Previous versions",{comment:"BUTTON"})},global_token_share:{icon:"s_link",text:ur.append_ellipsis(zt("Share link",{comment:"BUTTON"})),click_handler:function(e,t){return rt.ShmodelUILogger.log("via-global-toolbar"),Un.shmodel(Ir.containing_fq_path(),t+"_global_token_share")}},copy_url:{icon:"world_link",text:ur.append_ellipsis(zt("Copy public link",{comment:"BUTTON"})),click_handler:function(){var e,t;return e=this.get_files().first(),t=Ir.public_app_token?"/spa/"+Ir.public_app_token+e.ns_path:"/u/"+Ir.active_user.id+e.fq_path.substring(gr.PUBLIC_FOLDER_PATH_LENGTH),gr.showCopyPublicUrlModal(String(new o({scheme:"https",authority:Ee.PUBSERVER,path:t})))}},download:{icon:"download",text:function(){return zt("Download",{comment:"BUTTON"})},click_handler:function(){var e,t,n,i,r,s,a,_;return n=this.get_files(),1!==n.length||n[0].dir?li.do_bulk_download(n):(t=n.first(),a=[Ee.BLOCK_CLUSTER,t.fq_path,t.hash],e=a[0],r=a[1],i=a[2],s={w:i,dl:1},_=o({scheme:"https",authority:e,path:"/get"+r,query:s}),window.location=String(_.updateQuery(O.UID_PARAM_NAME,Ir.active_user)))}},view:{href:function(){var e,t,n,i,r;return t=this.get_files().first(),r=[Ee.BLOCK_CLUSTER,Zt.urlquote(t.fq_path),t.hash],e=r[0],i=r[1],n=r[2],"https://"+e+"/get"+i+"?w="+n},icon:"page_white_magnify",text:zt("View file",{comment:"BUTTON"})},ignore:{click_handler:function(){return an.show_ignore_modal(this.get_files().first().fq_path)},icon:"folder_user_delete",text:zt("Permanently remove",{comment:"BUTTON"})},show_del:{click_handler:function(){return Ir.toggle_deleted()},icon:"trash-can",text:zt("Show deleted files",{comment:"BUTTON"})},hide_del:{click_handler:function(){return Ir.toggle_deleted()},icon:"trash-can-open",text:zt("Hide deleted files",{comment:"BUTTON"})},copy:{icon:"copy",text:ur.append_ellipsis(zt("Copy",{comment:"BUTTON"})),click_handler:function(){var e,t;return t=this.get_files(),1===t.length?(e=t.first(),li.show_copy(e.fq_path,e.dir)):t.length>1?li.show_copy_bulk(t):void 0}},move:{icon:"move_16",text:ur.append_ellipsis(zt("Move",{comment:"BUTTON"})),click_handler:function(){var e,t;return t=this.get_files(),1===t.length?(e=t.first(),li.show_move(e.fq_path,e.dir)):t.length>1?li.show_move_bulk(t):void 0}},rename:{icon:"rename",text:zt("Rename",{comment:"BUTTON"}),click_handler:function(){return this.get_files().first().edit()}},delete:{icon:"delete_16",text:ur.append_ellipsis(zt("Delete",{comment:"BUTTON"})),click_handler:function(){var e,t,n,i,r,o,s,a;if(n=this.get_files(),s=n.length,s>=1){if(o=n[0].mount_point)for(i=r=1,a=s;a>=1?a>r:r>a;i=a>=1?++r:--r)if(n[i].mount_point!==o){o="";break}if(e=o?_t.filename(o):null,s>1)return li.show_bulk_delete(Ir.active_user,n,e);if(1===s)return t=n[0],li.show_delete(Ir.active_user,t.fq_path,t.dir,void 0,e,t.is_shared_folder())}}},global_purge:{icon:"cancel",text:ur.append_ellipsis(zt("Permanently delete folder")),click_handler:function(){return li.show_purge(Ir.containing_fq_path(),!0)}},purge:{icon:"cancel",text:ur.append_ellipsis(zt("Permanently delete",{comment:"BUTTON"})),click_handler:function(){var e,t;return t=this.get_files(),1===t.length?(e=t.first(),li.show_purge(e.fq_path,e.dir)):li.show_bulk_purge(t)}},upload:{icon:"upload_16",text:ur.append_ellipsis(zt("Upload")),click_handler:function(){return li.show_upload()}},app_info:{icon:"application_double",text:ur.append_ellipsis(zt("Application info")),click_handler:function(){return window.location.href="/account/security"}},more_actions:{is_dropdown:!0,text:zt("More",{comment:"Show more options"}),click_handler:Prototype.emptyFunction},more_global_actions:{text:zt("More actions"),click_handler:function(){return kr.show_secondary(),document.body.observe("click",kr.hide_secondary)}},view_in_photos:{icon:"s_photo",text:function(){return zt("View in Photos")},click_handler:function(){var e;return e=this.get_files(),li.do_bulk_photo_view(Ir.active_user,e)}},compress:{icon:"s_photo",text:function(){return zt("Compress (experimental)")},click_handler:function(){var e;return e=this.get_files(),li.show_compress_bulk(Ir.active_user,e)}},view_in_carousel:{icon:"s_carousel",text:function(){return zt("View in Timeline")},click_handler:function(){var e;return e=this.get_files(),li.do_bulk_photo_view(Ir.active_user,e)}},album_from_folder:{icon:"create-album",text:function(){return zt("Create album")},click_handler:function(){var e,t;return e=this.get_files(),t=e.first(),li.create_album_from_folder(t.fq_path,t.filename)}},open:{icon:"open",text:function(){return zt("Open")},click_handler:function(){var e;return e=this.get_files().first(),__CONDITIONAL_JS__.UnityFeatures.open_file(e.ns_id,e.ns_path,e.user_id,__CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler,function(){return __CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler(!1)})}},comment:{icon:"s_file_comment",text:function(){return zt("Comment",{comment:"BUTTON"})},click_handler:function(e){var t;return t=this.get_files().first(),Ir.open_preview(t,e,!1,!0)}},single_entry_share_dropdown_variant_token_share_only:{icon:"s_rainbow",text:ur.append_ellipsis(zt("Share")),click_handler:function(e,t){var n;return n=this.get_files().first(),rt.ShmodelUILogger.log_with_target_file("single_entry_share_click",t,n),Un.shmodel(n.fq_path,t)}},single_entry_share_dropdown_variant_menu:{icon:"s_rainbow",text:ur.append_ellipsis(zt("Share")),is_dropdown:!0,subactions:["single_entry_share_dropdown_variant_menu_invite_option","single_entry_share_dropdown_variant_menu_token_share_option"],click_handler:function(){},hover_handler:function(e,t){var n;return n=this.get_files().first(),rt.ShmodelUILogger.log_with_target_file("single_entry_share_hover",t,n)}},single_entry_share_dropdown_variant_menu_invite_option:{icon:"user_add",text:ur.append_ellipsis(zt("Invite people to collaborate")),click_handler:function(e,t){var n,i,r,o;if(n=this.get_files().first(),n.is_shared_folder()){if(At.get_for_user(Ir.active_user).verified_or_show())return rt.ShmodelUILogger.log_with_target_file("sf_options",t,n),i=new un(Ir.active_user,n.fq_path),i.show()}else if(o=Ir.verify_email_after_share_experiment_variant,r=o&&"VERIFY_LAST"===o,r?rt.UserActivityLogger.log("web","email_verify_last_experiment_shown"):o&&rt.UserActivityLogger.log("web","email_verify_last_experiment_not_shown"),r||At.get_for_user(Ir.active_user).verified_or_show())return rt.ShmodelUILogger.log_with_target_file("sf_invite",t,n),i=new In(Ir.active_user,{folder_name:n.fq_path,element_id:"invite-to-new-sf-wizard-modal-"+Ir.active_user.id,must_check_verified:r}),i.show()}},single_entry_share_dropdown_variant_menu_token_share_option:{icon:"s_link",text:ur.append_ellipsis(zt("Send link")),click_handler:function(e,t){var n;return n=this.get_files().first(),rt.ShmodelUILogger.log_with_target_file("token_share",t,n),Un.shmodel(n.fq_path,t)}}}}),br=ft.BrowseActionsContext=Class.create(gr,{initialize:function($super,e){return $super(e),this._listen()},_listen:function(){return $("context-menu-container").stopObserving("click"),$("context-menu-container").stopObserving("contextmenu"),Se("#context-menu-container").off("mouseenter"),$("context-menu-container").on("click",".action button",this._click.bind(this)),$("context-menu-container").on("contextmenu",".action button",this._click.bind(this)),Se("#context-menu-container").on("mouseover","li.primary",this._over.bind(this)),Se("#context-menu-container").on("mouseout","li.primary",this._out.bind(this)),Se("#context-menu-container").on("mouseenter",".action button",this._enter.bind(this))},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),Yn.call(this.get_disabled_action_names(),n)>=0?(this.show_disabled_action_warning(n),!1):(rt.TimeToFirstActionLogger.log(Ir.active_user.id,n),this.firefly_logging_helper(n),i=gr.option_dict[n],rt.BrowseActionsContextMenuLogger.log(this.get_files(),n),(!i.is_dropdown||t.hasAttribute("submenu-index"))&&Or.hide(),e.preventDefault(),i.click_handler.call(this,Z.OREF_CONSTANTS.BROWSE_COMMENT_CONTEXTMENU,e,"browse_actions_context"),"share"===n?rt.SharedFolderActivityLogger.log("web","browse_view_share_existing",Ir.active_user,this._log_extras,!0):void 0)},_reset_all_submenus:function(){return Se("#context-menu-container .hover").removeClass("hover")},_reset_submenu:function(e){return Se(e).removeClass("hover")},_enter:function(e){var t,n,i;return t=Se(e.currentTarget).data("value"),wt(t),n=gr.option_dict[t],wt(n,"Action info is missing for "+t),null!=(i=n.hover_handler)?i.call(this,e,"browse_actions_context"):void 0},_over:function(e){return Se(e.currentTarget).children(".secondary").length?(clearTimeout(this.timeoutID),this._reset_all_submenus(),Se(e.currentTarget).addClass("hover")):void 0},_out:function(e){return Se(e.currentTarget).children(".secondary").length?this.timeoutID=setTimeout(function(t){return function(){return t._reset_submenu(e.currentTarget)}}(this),300):void 0}}),wr=ft.BrowseActionsBasic=Class.create(gr,{initialize:function($super){var e;return e=Sr.get_selected_files(),$super(e),this._render(),this._listen()},_listen:function(){var e;return this.bound_update=this._update.bind(this),this.bound_disable=this._disable.bind(this),this.bound_enable=this._enable.bind(this),this.bound_click=this._click.bind(this),document.observe(Sr.UPDATED_EVT,this.bound_update),document.observe(Or.SHOW_EVT,this.bound_disable),document.observe(Or.HIDE_EVT,this.bound_enable),e=$("browse-root-actions"),e.stopObserving("click"),e.on("click",".action button",this.bound_click)},unlisten:function(){return document.stopObserving(Sr.UPDATED_EVT,this.bound_update),document.stopObserving(Or.SHOW_EVT,this.bound_disable),document.stopObserving(Or.HIDE_EVT,this.bound_enable),$("browse-root-actions").stopObserving("click",this.bound_click)},_update:function(){return this._set_files(Sr.get_selected_files()),this._render()},_disable:function(){return $("browse-root-actions").stopObserving("click"),$("browse-root-actions").down(".secondary")&&$("browse-root-actions").down(".secondary").addClassName("disabled"),$$("#browse-root-actions .action *").invoke("setStyle",{cursor:"default"})},_disable_action:function(e){var t,n;return n="#browse-root-actions #"+e+"_action_button",t=Se(n),t.addClass("disabled"),t.click(function(t){return function(){return t.show_disabled_action_warning(e),!1}}(this))},_enable:function(){return $("browse-root-actions").stopObserving("click"),$("browse-root-actions").on("click",".action button",this._click.bind(this)),$("browse-root-actions").down(".secondary")&&$("browse-root-actions").down(".secondary").removeClassName("disabled"),$$("#browse-root-actions .action *").invoke("setStyle",{cursor:"pointer"})},_render:function(){var e,t,n,i,r,o,s,a,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,S,C,T,A,D,O,N,I;for(c=this.get_files(),n=this.get_action_names(),D=["single_entry_share_dropdown_variant_token_share_only","single_entry_share_dropdown_variant_menu"],m=0,w=D.length;w>m;m++)if(t=D[m],p=n.indexOf(t),p>-1){n.splice(p,1);break}for(e=13.5,l="",h="",1===c.length?(l=_.em_snippet(c[0].filename,e),!c[0].dir&&c[0].bytes>=0&&(h=c[0].size)):1<c.length&&(C=ur.profile_files(c),k=[],C.files&&(E=Bt("%d file","%d files",C.files).format(C.files),k.push(E)),C.folders&&(E=Bt("%d folder","%d folders",C.folders).format(C.folders),k.push(E)),l=Zt.nice_list(k)),o=$("browse-root-actions"),r=o.getLayout().get("width"),f=o.getStyle("font-size"),wt(f.endsWith("px"),"Invalid font size "+f),f=parseInt(f,10),u=new _(l).length*f,O=new _(h).length*f,r-=u+O,N=[],A=[],r-=30,v=0,b=n.length;b>v;v++)x=n[v],t=this.get_action_by_name(x),I=new _(t.text).length*f,s=I+16+8+10+9,r>s?N.push(x):(0===A.length&&(S=N.pop(),A.push(S)),A.push(x)),r-=s;for(A.length&&N.push("more_actions"),i=function(){var e,t,n;for(n=[],e=0,t=N.length;t>e;e++)x=N[e],n.push(this.get_action_by_name(x));return n}.call(this),A.length&&(i[i.length-1].subactions=function(){var e,t,n;for(n=[],e=0,t=A.length;t>e;e++)x=A[e],n.push(this.get_action_by_name(x));return n}.call(this)),a=lt.tmpl("actions_bar_tmpl",{context:this,description:l,filesize:h,has_actions:!!n.length,actions:i,_:zt,Sprite:ee}),$("browse-root-actions").__date(a),d=this.get_disabled_action_names(),T=[],g=0,y=d.length;y>g;g++)t=d[g],T.push(this._disable_action(t));return T},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),wt(n),this.firefly_logging_helper(n),i=gr.option_dict[n],wt(i,"Action info is missing for "+n),e.preventDefault(),rt.TimeToFirstActionLogger.log(Ir.active_user.id,n),i.click_handler.call(this,Z.OREF_CONSTANTS.BROWSE_COMMENT_BUTTON,e,"browse_actions_basic"),"share"===n?rt.SharedFolderActivityLogger.log("web","browse_view_select_share_existing",Ir.active_user,this._log_extras,!0):void 0}}),Object.extend(wr,{STANDARD_ACTIONS:["share","app_info","copy_url","download","delete","rename","restore","purge","view_in_photos","view_in_carousel","compress"]}),yr=ft.GlobalActions=Class.create(gr,{initialize:function($super){return $super()},get_action_names:function(){var e;return Ir.inside_dir?(e=[],Ir.inside_deleted_dir?e=e.concat(["global_restore"]):(e=e.concat(["upload","new_folder"]),this._should_show_shared_folder_options()&&e.push("global_share"),this._should_show_share_link()&&e.push("global_token_share"),e.push(Ir.deleted_shown?"hide_del":"show_del")),e):[]},_should_show_shared_folder_options:function(){return!Ir.is_in_subfolder_of_shared_folder()&&!Ir.inside_sandbox},_should_show_share_link:function(){return!Ir.inside_team_folder&&Ir.is_shmodelable_path(Ir.containing_fq_path())}}),kr=ft.GlobalActionsBasic=Class.create(yr,{initialize:function($super){return $super(),this._listen(),this._render()},_listen:function(){return $("global-actions").stopObserving("click"),$("global-actions").on("click","a",this._click.bind(this)),document.observe(Or.SHOW_EVT,this._disable.bind(this)),document.observe(Or.HIDE_EVT,this._enable.bind(this))},_render:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c;for(t=this.get_action_names(),c=t.intersect(kr.STANDARD_ACTIONS),u=t.without.apply(t,kr.STANDARD_ACTIONS),1===u.length&&(c=t,u=[]),u.length&&c.push("more_global_actions"),d=function(){var e,t,n;for(n=[],e=0,t=c.length;t>e;e++)a=c[e],n.push(this.get_action_by_name(a));return n}.call(this),n=function(){var t,n,i;for(i=[],t=0,n=d.length;n>t;t++)e=d[t],"button"===e.kind&&i.push(e);return i}(),_=function(){var t,n,i;for(i=[],t=0,n=d.length;n>t;t++)e=d[t],"button"!==e.kind&&i.push(e);return i}(),i=lt.tmpl("global_actions_tmpl",{context:this,standard_actions:n.concat(_),secondary_actions:function(){var e,t,n;for(n=[],e=0,t=u.length;t>e;e++)a=u[e],n.push(this.get_action_by_name(a));return n}.call(this),Sprite:ee}),$("global-actions").__date(i),Se(document).trigger($e.GA_RENDERED),r=this.get_disabled_action_names(),l=[],o=0,s=r.length;s>o;o++)e=r[o],l.push(this._disable_action(e));return l},_disable:function(){return $("global-actions").stopObserving("click"),$$("#global-actions .action a").invoke("removeClassName","title_bubble"),$$("#global-actions .action a").invoke("addClassName","disabled")},_disable_action:function(e){var t,n;return n="#global-actions #"+e+"_button",t=Se(n),t.addClass("disabled"),t.click(function(t){return function(){return t.show_disabled_action_warning(e),!1}}(this))},_enable:function(){var e,t,n,i,r;for($("global-actions").stopObserving("click"),$("global-actions").on("click","a",this._click.bind(this)),$$("#global-actions .action a").invoke("removeClassName","disabled"),$$("#global-actions .action a").invoke("addClassName","title_bubble"),t=this.get_disabled_action_names(),r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(this._disable_action(e));return r},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),wt(n),i=gr.option_dict[n],wt(i,"Action info is missing for "+n),kr.hide_secondary(),Sr.deselect_all(),e.preventDefault(),i.click_handler.call(this,e,"global_actions_basic"),"global_share"===n?""===this._log_extras.path?rt.SharedFolderActivityLogger.log("web","browse_view_share_button",Ir.active_user,this._log_extras,!0):rt.SharedFolderActivityLogger.log("web","folder_view_share_button",Ir.active_user,this._log_extras,!0):void 0}}),Object.extend(kr,{STANDARD_ACTIONS:["upload","new_folder","global_share","global_token_share","global_restore","global_purge"],show_secondary:function(){var e,t;return t=$("secondary-actions"),e=$("more_global_actions_button"),t.show(),e.addClassName("down")},hide_secondary:function(){var e,t;return(t=$("secondary-actions"))?(e=$("more_global_actions_button"),t.hide(),e.removeClassName("down")):void 0}}),Er=ft.GlobalActionsContext=Class.create(yr,{initialize:function($super,e){return $super(e),this._listen()},_listen:function(){return $("context-menu-container").stopObserving("click"),$("context-menu-container").stopObserving("contextmenu"),$("context-menu-container").on("click",".action button",this._click.bind(this)),$("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(e,t){var n,i;return n=t.readAttribute("data-value"),Yn.call(this.get_disabled_action_names(),n)>=0?(this.show_disabled_action_warning(n),!1):(this.firefly_logging_helper(n),i=gr.option_dict[n],Sr.deselect_all(),i.is_dropdown||Or.hide(),e.preventDefault(),i.click_handler.call(this,e,"global_actions_context"),"global_share"===n?""===this._log_extras.path?rt.SharedFolderActivityLogger.log("web","browse_view_right_click_share",Ir.active_user,this._log_extras,!0):Ir.inside_shared_folder?rt.SharedFolderActivityLogger.log("web","folder_view_right_click_options",Ir.active_user,this._log_extras,!0):rt.SharedFolderActivityLogger.log("web","folder_view_right_click_share",Ir.active_user,this._log_extras,!0):void 0)}});var xr;xr=ft.BrowseClipboard=function(){var e,t,n,i,r,o,a,_,l,u,d,c,h;return e=0,t=1,r=[],n=null,h=function(){var e,t,n,i,o,s;if(!je.focus_in_input()&&(n=Sr.get_selected_files(),n&&n.length)){for(i=0,o=n.length;o>i;i++){if(t=n[i],t.bytes<0)return k.error(zt("Deleted files cannot be added to the clipboard")),!1;if(t.target_ns)return s=zt("'%(filename)s' cannot be added to the clipboard"),s=s.format({filename:t.filename}),k.error(s),!1}return r=n,e=n.length,s=Bt("Added %d item to clipboard","Added %d items to clipboard",e).format(e),k.success(s),!0}},o=function(){return h()?(n=e,!1):void 0},a=function(){return h()?(n=t,!1):void 0},_=function(t){var i;return wt("undefined"!=typeof t,"BrowseClipboard _paste got an undefined path"),r.length?(i=n===e?li.do_bulk_copy:li.do_bulk_move,i(r,t),!0):void 0},c=function(){var e;if(!(je.focus_in_input()||Ir.in_search_mode()||Ir.inside_deleted_dir))return e=_(Ir.containing_fq_path()),e?!1:void 0},i=function(){return r=[]},u=function(e){var t,n,o,s,a,_,l;for(o=e.memo.files,s=0,_=o.length;_>s;s++)for(n=o[s],a=0,l=r.length;l>a;a++)if(t=r[a],t.fq_path===n.fq_path||t.fq_path.startsWith(n.fq_path+"/"))return void i()},l=function(e){return wt(null!=e.memo.file&&null==e.memo.files),e.memo.files=[e.memo.file],u(e)},d=function(){var e,t,n,i,r;for(Se(document).on(s.RENAME,function(){return function(e,t){return e.memo=t,l(e)}}(this)),r=[s.DELETE,s.MOVE],t=0,n=r.length;n>t;t++)e=r[t],document.observe(e,u);return i=key.main_modifier(),key(i+"+c",Ir.KEY_SCOPE,o),key(i+"+x",Ir.KEY_SCOPE,a),key(i+"+v",Ir.KEY_SCOPE,c)},{init:function(){return d()}}}();var Sr,Cr;Sr=ft.BrowseSelection=function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x,S,C,T,A,D,O,N,I,L;return C=[],i=null,l=null,a=null,o=[],N=function(){return $$("#browse-files li.browse-file.file-select").invoke("removeClassName","file-select").invoke("removeClassName","file-select-one"),Sr.get_selected_files().invoke("get_div").findAll(function(e){return e}).invoke("addClassName","file-select"),1===Sr.get_selected_files().length?Sr.get_selected_files().invoke("get_div").findAll(function(e){return e}).invoke("addClassName","file-select-one"):void 0},I=function(){return a||($$("#browse-files li.browse-file[draggable]").invoke("writeAttribute","draggable",!1),Ir.in_search_mode())?void 0:Sr.get_selected_files().filter(function(e){return!e.editing}).invoke("get_div").findAll(function(e){return e}).invoke("writeAttribute","draggable","true")},L=function(e){return e.apply(null,$A(arguments).slice(1)),document.fire(Sr.UPDATED_EVT)},T=function(e,t){var n,r;return r=C.length,C=e instanceof vr?[e]:$A(e),C.length!==r&&Gt("Selected",C.length,"files"),n=t||C.last(),wt(!n||n instanceof vr,"Invalid anchor type"+n),i=n},T=T.wrap(L),e=function(e,t){return e&&C.push(e),i=t||e},e=e.wrap(L),k=function(e){var t;return t=C.indexOf(e),-1!==t?C.splice(t,1):void 0},k=k.wrap(L),E=function(){return C=[]},E=E.wrap(L),A=function(e){return o=e,$$("#browse-files li.browse-file.context-select").invoke("removeClassName","context-select"),e.invoke("get_div").findAll(function(e){return e}).invoke("addClassName","context-select")},m=function(t){var n,r,s,a,_,l,u,d,c,h,f,p,m;if(p=$(t.target),d=p.match("li.browse-file")?p:p.up("li.browse-file"),n=p.match("a")?p:p.up("a"),s=vr.from_elem(d),!t.isRightClick()&&d&&!n&&!d.hasClassName("unselectable")&&(Ir.keyboard_nav=!1,!o.length)){if(l=Zt.is_mac(),l&&t.metaKey||!l&&t.ctrlKey)return-1===C.indexOf(s)?e(s):k(s);if(t.shiftKey){for(r=Ir.files.indexOf(i),m=Ir.files.indexOf(s),u=Ir.files.indexOf(C.last()),h=C.slice(0),_=r>u?-1:1,a=r;a!==u;)a+=_,f=h.indexOf(Ir.files[a]),-1!==f&&h.splice(f,1);for(_=r>m?-1:1,a=r;a!==m;)a+=_,c=h.indexOf(Ir.files[a]),-1!==c&&h.splice(c,1),h.push(Ir.files[a]);return T(h,i)}return T(s)}},v=function(e){var t,n,r,s,_,u,d,c,h;if(!(e.isRightClick()||o.length||Zt.in_scrollbar(e.pointerX()))){for(u=$(e.target),Element.match(u,"object")&&(u=u.parentNode),h=["browse-box","context-menu-container","modal","modal-overlay"],d=!1,r=0,s=h.length;s>r;r++)if(c=h[r],u.descendantOf(c)||u.match("#"+c)){d=!0;break}return d?(_=u.match("li.browse-file")?u:u.up("li.browse-file"),n=vr.from_elem(_),t=u.match("[draggable]")||u.up("[draggable]"),n&&!t&&(l=i,e.shiftKey||(n?l=n:u.match("#browse-files")&&(l=Ir.files.last())),a=[],e.metaKey||e.ctrlKey)?a=Sr.get_selected_files():void 0):void T()}},D=function(e){var t,n;return t=vr.from_elem(p(e)),e.preventDefault(),t?(n="browse_file_row",rt.ShmodelUILogger.log_with_target_file("token_share",n,t),Un.shmodel(t.fq_path,n)):void 0},p=function(e){var t;return t=$(e.target),t.match("li.browse-file")?t:t.up("li.browse-file")},f=function(){return function(e){var t,n,i,r,o,s,a;return n=p(e),t=vr.from_elem(n),e.preventDefault(),t?(i="browse_file_row",a=rt.ShmodelUILogger.get_target_item(t),rt.ShmodelUILogger.log("single_entry_share",i,a),s=t.dir&&(t.is_shared_folder()||t.could_be_shared_folder()),s?Me.Tiburon.foldersUI()?an.logAndShowSharingModal(t,i):t.could_be_shared_link()?(At.get_for_user(Ir.active_user).verified_or_show(),r=Ir.in_search_mode()?Se(n).find(".inline-share-button")[0]:Se(n).find(".sharing .inline-share-button")[0],Cr.open(t.fq_path,t.is_shared_folder(),r,Ir.active_user,a,Ir.can_change_new_ns_options)):(o=function(){return Sr.show_share_modal_if_email_verified(Ir.active_user,t.is_shared_folder(),a,t.fq_path,Ir.can_change_new_ns_options)},Tt.show_modal(e,Ir.active_user.id,o)):Me.Tiburon.filesUI()?an.logAndShowSharingModal(t,i):(o=function(){return Un.shmodel(t.fq_path,i)},At.get_for_user(Ir.active_user).verified_or_show(),Sr.firefly_logging_helper(t,"single_entry_share_button_file_link"),Tt.show_modal(e,Ir.active_user.id,o))):void 0}}(this),r=function(e){var t,n,i;return i=$(e.target),n=i.match("li.browse-file")?i:i.up("li.browse-file"),t=vr.from_elem(n),t?m(e):void 0},h=null,u=function(){var e;return clearInterval(h),e=function(){return Ir.keyboard_nav=!1,$("browse-files").addClassName("mouse-active")},h=setTimeout(e,100)},s=function(){return Ir.keyboard_nav?void 0:(Ir.keyboard_nav=!0,$("browse-files").removeClassName("mouse-active"))},g=function(e){var t,n,i,r,o,s,_,d;if(u(),Sr.is_selecting()){for(t=Ir.files.indexOf(l),d=Ir.files.indexOf(vr.from_elem(e.target)),wt(t<Ir.files.length&&t>=0,"anchor_index: "+t+" "+l),wt(d<Ir.files.length&&d>=0,"target_index: "+d),n=Ir.files.slice(Math.min(t,d),Math.max(t,d)+1),i=a.slice(0),s=0,_=n.length;_>s;s++)o=n[s],r=i.indexOf(o),-1===r?i.push(o):i.splice(r,1);return T(i)}},_=function(){return l=null,a=null},y=function(e){var t,n;return"undefined"!=typeof Dr&&null!==Dr&&Dr.reset(),s(),e&&Event.extend(e).preventDefault(),n=C.length?C.last()===Ir.files.first()?Ir.files.first():(t=Ir.files.indexOf(C.last())-1,Ir.files[t]):Ir.files.last(),T(n),n?Ir.scrollTo(n.get_div()):void 0},w=function(e){var t,n;return"undefined"!=typeof Dr&&null!==Dr&&Dr.reset(),s(),e&&Event.extend(e).preventDefault(),n=C.length?C.last()===Ir.files.last()?Ir.files.last():(t=Ir.files.indexOf(C.last())+1,Ir.files[t]):Ir.files.first(),T(n),n?Ir.scrollTo(n.get_div()):void 0},n=function(t){var n,r,o,a,_,l,u,d;if("undefined"!=typeof Dr&&null!==Dr&&Dr.reset(),s(),t&&Event.extend(t).preventDefault(),!(C.length>0))return y();if(_=Ir.files.indexOf(C.last()),n=Ir.files.indexOf(i),!(i===C.last()||n>_))return k(C.last()),Ir.scrollTo(C.last().get_div());if(_>0){for(d=[],o=a=u=_-1;0>=u?0>=a:a>=0;o=0>=u?++a:--a){if(r=Ir.files[o],l=C.indexOf(r),e(r,i),-1===l){Ir.scrollTo(r.get_div());break}d.push(C.splice(l,1))}return d}},t=function(t){var n,r,o,a,_,l,u,d,c;if("undefined"!=typeof Dr&&null!==Dr&&Dr.reset(),s(),t&&Event.extend(t).preventDefault(),C.length>0){if(_=Ir.files.indexOf(C.last()),n=Ir.files.indexOf(i),i===C.last()||_>n){for(c=[],o=a=u=_+1,d=Ir.files.length;d>=u?d>a:a>d;o=d>=u?++a:--a){if(r=Ir.files[o],l=C.indexOf(r),e(r,i),-1===l){Ir.scrollTo(r.get_div());break}c.push(C.splice(l,1))}return c}return k(C.last()),Ir.scrollTo(C.last().get_div())}return w()},x=function(){return"undefined"!=typeof Dr&&null!==Dr&&Dr.reset(),T(Ir.files),!1},S=function(){return"undefined"!=typeof Dr&&null!==Dr&&Dr.reset(),T(null,null,null)},c=function(){return $$(".file-select").invoke("removeClassName","file-select").invoke("removeClassName","file-select-one"),setTimeout(N,100)},b=function(t){return t.memo.files.each(function(t){var n;return n=C.indexOf(t[0]),-1!==n?(C.splice(n,1),e(t[1])):void 0})},d=function(e,t){var n;return Ir.in_search_mode()&&e&&t?(n={file_nsid:e.ns_id,file_sjid:e.file_sjid,firefly:hr.firefly_enabled,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:"full-view",action_type:t},rt.SearchClientActivityLogger.log("result_action",Ir.active_user.id,n)):void 0},O=function(e,t,n,i,r,o){var s,a,_,l;if(a="file_row_sharing_menu",t){if(At.get_for_user(e).verified_or_show())return rt.ShmodelUILogger.log("sf_options",a,n),d("single_entry_share_button_folder_options"),s=new un(e,i),"function"==typeof o&&o(),s.show()}else if(l=Ir.verify_email_after_share_experiment_variant,_=l&&"VERIFY_LAST"===l,_?rt.UserActivityLogger.log("web","email_verify_last_experiment_shown"):l&&rt.UserActivityLogger.log("web","email_verify_last_experiment_not_shown"),_||At.get_for_user(e).verified_or_show())return rt.ShmodelUILogger.log("sf_invite",a,n),d("single_entry_share_button_folder_invite"),s=new In(e,{folder_name:i,element_id:"invite-to-new-sf-wizard-modal-"+e.id,must_check_verified:_,can_change_options:r},this.sf_invite_modal_rules),"function"==typeof o&&o(),s.show()},document.observe(lr.REMOVE,function(e){return e.memo.files.each(k)}),document.observe(lr.MOVE,b),{UPDATED_EVT:"db:select:updated",init:function(e){var i;return this.sf_invite_modal_rules=e,document.observe("click",r),document.observe("mousedown",v),document.observe("mouseup",_),document.observe("dragend",_),document.observe("mouseup",I),$("browse-files").on("mouseover","li.browse-file",g),$("browse-files").on("click",".shmodel-file",D),$("browse-files").on("click",".inline-share-button",f),document.observe(Sr.UPDATED_EVT,N),document.observe(Sr.UPDATED_EVT,I),document.observe($e.RENDER,N),document.observe($e.RENDER,I),document.observe($e.UPDATE,T.bind(null,null,null)),i=key.main_modifier(),key("up",Ir.KEY_SCOPE,y),key("down",Ir.KEY_SCOPE,w),key(i+"+a",Ir.KEY_SCOPE,x),key("escape",Ir.KEY_SCOPE,S),key("shift+up",Ir.KEY_SCOPE,n),key("shift+down",Ir.KEY_SCOPE,t)},set_selected_files:function(e){return T(e)},get_selected_files:function(){return C.slice(0)},get_selected_fq_paths:function(){return C.map(function(e){return e.fq_path})},has_selected_files:function(){return C.length},is_selected:function(e){return-1!==C.indexOf(e)},is_selecting:function(){return!!l},deselect_all:E,set_context_selected:function(e){return A(e)},flicker_selected:c,firefly_logging_helper:function(e,t){return d(e,t)},show_share_modal_if_email_verified:O}}(),Cr=ft.SharingGrowthExperimentsDropdown={open:function(e,t,n,i,r,o){var s;if(this.fq_path=e,this.existing_sf=t,this.button=n,this.user=i,this.target_item=r,this.can_change_options=o,this.$menu=Se("#sharing-growth-experiments-dropdown-menu"),s=this.$button&&this.$button.length){if(this.$button[0]===this.button)return void this._hide();this._hide()}return this._show()},_show:function(){var e;return this.$menu.show(),this.$button=Se(this.button),this.$button.addClass("pressed"),e={offsetLeft:-1*Math.abs(this.$button.outerWidth()-this.$menu.outerWidth())+6,offsetTop:46,setWidth:!1,setHeight:!1},je.clone_position(this.$menu,this.$button,e),Se("#browse-box").addClass("dropdown-menu-open"),this._listen()},_listen:function(){return this.$menu.on("click dblclick",function(e){return e.stopPropagation()}),Se(document).on("mousedown",Se.proxy(this._click_outside_menu_callback,this)),this.$menu.find(".option-to-share-folder").on("click",Se.proxy(this._sf_click,this)),this.$menu.find(".option-to-share-link").on("click",Se.proxy(this._share_link_click,this))},_unlisten:function(){return this.$menu.hide().off("click dblclick"),Se(document).off("mousedown",this._click_outside_menu_callback),this.$menu.find(".option-to-share-folder").off("click",Se.proxy(this._sf_click,this)),this.$menu.find(".option-to-share-link").off("click",Se.proxy(this._share_link_click,this))},_sf_click:function(e){var t;return t=function(e){return function(){return Sr.show_share_modal_if_email_verified(e.user,e.existing_sf,e.target_item,e.fq_path,e.can_change_options)}}(this),this._hide(),Tt.show_modal(e,this.user.id,t)},_share_link_click:function(e){var t;return t=function(e){return function(){var t;return t="file_row_sharing_menu",rt.ShmodelUILogger.log("token_share",t,e.target_item),e._firefly_logging_helper("single_entry_share_button_folder_link"),
Un.shmodel(e.fq_path,t)}}(this),this._hide(),Tt.show_modal(e,Ir.active_user.id,t)},_firefly_logging_helper:function(e){return Sr.firefly_logging_helper(Ir.find_file(this.fq_path),e)},_clicked:function(e,t){return e.is(t.target)||e.has(t.target).length},_click_outside_menu_callback:function(e){return this._clicked(this.$menu,e)||this._clicked(this.$button,e)?void 0:this._hide()},_hide:function(){return this._unlisten(),Se("#browse-box").removeClass("dropdown-menu-open"),this.$button.removeClass("pressed"),this.$button=null}};var Tr;Tr=ft.DragScroll={_timer:null,_mouse_y:0,_initial_mouse_y:null,_scroll_amount:40,_scroll_window:50,_min_drag_distance:20,_exclude_move_event:null,init:function(e,t){return this._exclude_move_event=e,null!=t?this._scroll_window=t:void 0},start:function(){return this._initial_mouse_y=null,this._listen(),this._timer=setInterval(this._check_for_scroll.bind(this),100)},end:function(){return this._unlisten(),clearInterval(this._timer)},_mousemove:function(e){var t;return("function"==typeof this._exclude_move_event?this._exclude_move_event(e):void 0)?this._mouse_y=0:(t=e.pointerY(),this._mouse_y=t-je.scroll_offsets().top)},_listen:function(){return document.observe("mousemove",this._mousemove.bind(this)),document.observe("dragover",this._mousemove.bind(this))},_unlisten:function(){return document.stopObserving("mousemove",this._mousemove.bind(this)),document.stopObserving("dragover",this._mousemove.bind(this))},_check_for_scroll:function(){var e;return null===this._initial_mouse_y&&(this._initial_mouse_y=this._mouse_y),Math.abs(this._mouse_y-this._initial_mouse_y)<this._min_drag_distance?void 0:(e=0,this._mouse_y<this._scroll_window?e=-1*this._scroll_amount:this._mouse_y>je.viewport_dimensions().height-this._scroll_window&&(e=this._scroll_amount),e?je.scroll_to(je.scroll_offsets().left,je.scroll_offsets().top+e):void 0)}};var Ar;Ar=ft.BrowseDrag={_BODY_DRAG_CLASS:"external_drag",_STATUS_CLASS:"dragging",_STATUS_OFFSET:10,_SELECTION_CONST:"SELECTION",_current_item_key:null,_drag_from_window:!1,init:function(){var e;if(Modernizr.draganddrop)return this.listen(),e=function(e){var t;return t=Se(e.target),t.closest("#browse-location").length||"browse-location"===t.attr("id")},Tr.init(e,Se("#browse-header").height())},listen:function(){var e;return e=$(document.body),document.observe($e.UPDATE,this._update_body_data.bind(this)),e.on("dragleave","[dropzone]",this._dropzone_dragleave.bind(this)),e.on("dragend",this._body_dragend.bind(this)),e.on("dragover","[dropzone]",this._dropzone_dragover.bind(this)),Prototype.Browser.IE&&(e.on("dragenter","[dropzone]",this._dropzone_dragover.bind(this)),e.on("mousedown",this._ie_start_drags.bind(this)),e.on("mouseover","a.filename-link",this._ie_mouseover.bind(this))),e.observe("dragover",this._body_dragover.bind(this)),e.observe("dragleave",this._body_dragleave.bind(this)),e.observe("dragstart",this._body_dragstart.bind(this)),e.observe("mousemove",this._body_mousemove.bind(this)),e.on("dragstart","li.browse-file",this._file_dragstart.bind(this)),document.observe(Sr.UPDATED_EVT,this._build_selected_drag_icon.bind(this)),document.observe($e.RENDER,this._build_selected_drag_icon.bind(this)),e.on("mousedown","li.browse-file",this._build_file_drag_icon.bind(this)),e.on("drop","[dropzone]",this._drop.bind(this))},_file_mousemove:function(e){var t;if(window.event&&1===window.event.button)return t=e.findElement("[draggable]"),t&&t!==document&&t.dragDrop?(t.dragDrop(),Ar._ie_end_drags()):void 0},_ie_start_drags:function(e,t){return"OBJECT"!==t.tagName&&$(t).match("[draggable]")?$("browse-files").observe("mousemove",this._file_mousemove):void 0},_ie_end_drags:function(){return $("browse-files").stopObserving("mousemove")},_update_body_data:function(){var e,t;return e=Ir.inside_dir?"copy move":!1,t=Ir.inside_dir?Ir.containing_fq_path():!1,$(document.documentElement).writeAttribute("dropzone",e),$(document.documentElement).writeAttribute("data-fq_path",t)},_body_dragover:function(e){var t;return t=this._get_event_browse_files(),t.length?this._update_status_position(e,t):!this._drag_from_window&&this._can_drop_transfer(e.dataTransfer)?_i.show_drop_indicators(e):void 0},_body_dragleave:function(e){var t,n,i;return n=e.x||e.clientX,i=e.y||e.clientY,t=je.viewport_dimensions(),n>0&&n<t.width&&i>0&&i<t.height?void 0:_i.hide_drop_indicators()},_body_dragstart:function(){return this._drag_from_window=!0},_body_dragend:function(){return $("breadcrumb-dropdown")&&($("breadcrumbs-box").removeClassName("down"),$("breadcrumb-dropdown").hide()),this._clear_event_browse_files(),this._remove_drop_indicators(),_i.hide_drop_indicators(),Tr.end(),this._drag_from_window=!1},_body_mousemove:function(){return _i.hide_drop_indicators()},_ie_mouseover:function(e,t){return je.focus_in_input()?void 0:t.focus()},_dropzone_dragover:function(e,t){var n,i,r,o;if(!Je.isFileDragEnabled())return!0;if(e.preventDefault(),r=this._get_event_browse_files(),o=this._target_fq_path(t),r.pluck("fq_path").indexOf(-1===o)){if(!this._can_drop(e,t))return void t.addClassName("drag_nodrop");try{i=e.dataTransfer.effectAllowed}catch(e){}return e.dataTransfer.dropEffect="move"===i||"copyMove"===i||"linkMove"===i||"all"===i?"move":"copy",e.preventDefault(),n=$$(".dragover"),n.removeItem(t),n.invoke("removeClassName","dragover"),oi.disabled||t.addClassName("dragover"),_i.folder_dragover(o)}},_dropzone_dragleave:function(e,t){return this._clear_hover_state(t)},_file_dragstart:function(e,t){var n,i,r,o,s,a,_,l,u,d;if(Zt.clear_selected(),Sr.is_selecting())return e.preventDefault();if(e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("URL","about:blank"),a=vr.from_elem(t),this._set_event_browse_files(a),_=this._get_event_browse_files(),_.length<=1&&!a.dir){d=a.href,l=(a.filename||zt("file")).replace(/:/g,"-"),u="application/octet-stream";try{e.dataTransfer.setData("DownloadURL",[u,l,d].join(":"))}catch(e){}}r=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",width:1,height:1}),n=!0;try{e.dataTransfer.setDragImage(r,150,150)}catch(e){s=e,n=Zt.ie8}return this._add_drop_indicators(e),Tr.start(),n?(this._update_status_position(e,_),i=$("drag-status"),i.removeClassName("rotatein").removeClassName("fadein").removeClassName("selection"),_.length>1&&i.addClassName("rotatein"),this._is_dragging_selection()&&i.addClassName("selection"),i.addClassName("fadein")):void 0},_add_drop_indicators:function(e){var t,n,i,r,o;if($(document.body).addClassName(this._STATUS_CLASS),!oi.disabled){for(r=$$('[dropzone="copy move"]'),o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(this._can_drop(e,t)?t.addClassName("can_drop"):void 0);return o}},_remove_drop_indicators:function(){return this._clear_hover_state(),$(document.body).removeClassName(this._STATUS_CLASS),$$(".can_drop").invoke("removeClassName","can_drop")},_build_selected_drag_icon:function(){var e,t,n,i,r,o,s,a,_,l,u;for(u=Sr.get_selected_files(),n=new Element("div",{id:"drag-selection-status"}),l=u.slice(0,4),r=s=0,a=l.length;a>s;r=++s)t=l[r],e=t.get_div(),e&&(_=e.down(".icon"),_.stopObserving("load"),_.observe.bind(_).defer("load",Ar._build_selected_drag_icon),o=_.cloneNode(!1),Element.addClassName(o,"icon icon"+r),n.__sert(o));return i=new Element("span",{className:"badge"}),i.__date(u.length),n.appendChild(i),$("drag-selection-status").replace(n)},_build_file_drag_icon:function(e,t){var n,i,r,o;return n=vr.from_elem(t),o=n.get_div().down(".icon").cloneNode(!1),Element.addClassName(o,"icon icon0"),r=new Element("span",{className:"badge"}),r.__date("1"),i=new Element("div",{id:"drag-file-status"}),i.__date(o).__sert(r),$("drag-file-status").replace(i)},_drop:function(e,t){var n,i,r,s,a,_,l,u,d,c,h,f,p,m,v;if(i=this._get_event_browse_files(),this._linkfile_drop_enabled()&&(_=Je.getDraggedLink(e.dataTransfer)),null!=_?(m=Je.buildUrlLinkfileContents(_),p=new Blob([m],{type:"text/plain"}),f=o.parse(_).getAuthority(),p.name=Ir.unused_filename(f+".url"),p.overwrite=!1,l=[p],rt.LinkfileActivityLogger.log("droplink","url",f,!0,"browse",{})):(l=e.dataTransfer.files,u=e.dataTransfer.items),e.preventDefault(),!t.readAttribute("quicksend"))return this._is_read_only(t)?(v=zt("You don't have permission to add to this folder."),void k.error(v)):Ir.inside_read_only_shared_folder?(v=zt("You don’t have permission to move these files."),void k.error(v)):(s=null,a=vr.from_elem(t),n=t.readAttribute("data-fq_path"),a?s=a.fq_path:(n||""===n)&&(s=n),l&&l.length?_i.supported()?_i.browse_indicators_enabled()||_i.modal_indicators_enabled()?_i.upload(s,l,u):k.error(zt("You can't drag and drop upload right now.")):k.error(zt("Drag and drop not supported. Please try the simple uploader.")):i.length&&("copy"===e.dataTransfer.dropEffect||"copy"===e.dataTransfer.effectAllowed?li.do_bulk_copy(i,s):Ir.inside_dir&&Ir.containing_fq_path()===s||li.do_bulk_move(i,s)),this._remove_drop_indicators(),_i.hide_drop_indicators());if(l&&l.length)r=function(){return _i.upload(Gn.DEST_FOLDER,l,u)},Gn.get_folder_name(r);else if(i.length)for(c=0,h=i.length;h>c;c++)d=i[c],d.id=Y.guid(),Gn.add_dropbox_file(d)},_set_event_browse_files:function(e){var t;return t=Sr.is_selected(e),this._current_item_key=t?this._SELECTION_CONST:e.to_key()},_clear_event_browse_files:function(){return this._current_item_key=null},_get_event_browse_files:function(){var e,t,n,i;try{if(i=this._current_item_key,this._is_dragging_selection())return Sr.get_selected_files();if(i)return n=vr.from_key(i),n?[n]:[]}catch(e){t=e,console.log(t)}return[]},_is_dragging_selection:function(){return this._current_item_key&&this._current_item_key===this._SELECTION_CONST},_is_read_only:function(e){return e.readAttribute("read_only")?!0:e.readAttribute("is_read_only_mount")?!0:!1},_linkfile_drop_enabled:function(){return"undefined"!=typeof Blob&&null!==Blob},_can_drop_transfer:function(e){var t;return t=["Files"],this._linkfile_drop_enabled()&&t.push.apply(t,["text/x-moz-url","text/uri-list","Url"]),w.intersection(null!=e?e.types:void 0,t).length>0},_can_drop:function(e,t){var n,i;return t.readAttribute("quicksend")?!0:this._is_read_only(t)?!1:(n=this._target_fq_path(t),i=this._get_event_browse_files(),i.length?!li.bulk_move_error(i,n):this._can_drop_transfer(e.dataTransfer)?(_i.supported(),!0):!1)},_target_fq_path:function(e){var t;return t=vr.from_elem(e),t?t.fq_path:e.readAttribute("data-fq_path")},_clear_hover_state:function(e){var t,n,i,r;for(r=$$("#browse .dragover"),n=0,i=r.length;i>n;n++)t=r[n],t!==e&&t.removeClassName("dragover");return $$("#browse .drag_nodrop").invoke("removeClassName","drag_nodrop")},_update_status_position:function(e){return e=Event.extend(e),Zt.scry("drag-status").setStyle({left:e.pointerX()-je.scroll_offsets().left+this._STATUS_OFFSET+"px",top:e.pointerY()-je.scroll_offsets().top+this._STATUS_OFFSET+"px"})}};var Dr;Dr=ft.BrowseJump={_active:"",_listening:!1,_RESET_WAIT:1e3,_RESET_TIMER_ID:null,_CODEPOINTS:null,_BLACKLIST:["/","\\",":","?","*","<",">","|"].map(function(e){return e.charCodeAt(0)}),update:function(){var e,t,n,i,r,o;for(Dr._listening||(Dr.listen(),Dr._listening=!0),e=[],o=Ir.files,i=0,r=o.length;r>i;i++)n=o[i],t=Dr.to_codepoint_list(n.filename),e.push([t,n]);return e.sort(function(e,t){return Dr.cmp_codepoints(e[0],t[0])}),Dr._CODEPOINTS=e},reset:function(){return Dr._active=""},is_active:function(){return Dr._active},jump:function(e){return e?(Sr.set_selected_files([e]),Ir.scrollTo(e.get_div())):void 0},listen:function(){var e,t,n,i,r;for(document.observe("keypress",function(e){var t;if(key.getScope()===Ir.KEY_SCOPE&&!(je.focus_in_input()||e.metaKey||e.altKey||e.altGraphKey||e.ctrlKey||(t=e.charCode||e.keyCode,32>t||t>=33&&40>=t))){if(32===t){if(!Dr._active)return;e.preventDefault()}if(-1===Dr._BLACKLIST.indexOf(t))return clearTimeout(Dr._RESET_TIMER_ID),Dr._active+=String.fromCharCode(t).toLowerCase(),Dr.jump(Dr.nearest_file(Dr._active)),Dr._RESET_TIMER_ID=setTimeout(Dr.reset,Dr._RESET_WAIT)}}),i=[s.DELETE,s.COPY,s.MOVE,s.RENAME,s.PURGE,s.RESTORE,s.UPLOAD,s.SF_NEW,s.SF_LEAVE,s.SF_UNSHARE,s.SF_REJOIN,s.SF_IGNORE,s.LINKS_REMOVE,lr.ADD,lr.REMOVE,lr.MOVE],r=[],t=0,n=i.length;n>t;t++)e=i[t],document.observe(e,function(){return Dr.update()}),r.push(Se(document).on(e,function(){return Dr.update()}));return r},nearest_file:function(e){var t,n,i,r,o,s,a,_;if(null!=(s=Dr._CODEPOINTS)?s.length:void 0){for(t=Dr.to_codepoint_list(e),a=Dr._CODEPOINTS,r=0,o=a.length;o>r;r++)if(_=a[r],i=_[0],n=_[1],Dr.cmp_codepoints(t,i)<1)return n;Dr._CODEPOINTS.last()[1]}return null},cmp_codepoints:function(e,t){var n,i,r;for(wt(e.length>0&&t.length>0,"bad input to cmp_codepoints"),n=i=0,r=e.length;r>=0?r>i:i>r;n=r>=0?++i:--i){if(null==t[n])return 1;if(e[n]!==t[n])return e[n]<t[n]?-1:1}return t.length>e.length?-1:0},to_codepoint_list:function(e){var t,n,i,r;for(e=e.toLowerCase(),r=[],t=n=0,i=e.length;i>=0?i>n:n>i;t=i>=0?++n:--n)r.push(e.charCodeAt(t));return r}};var Or;Or=ft.ContextMenu={KEY_SCOPE:"context",SHOW_EVT:"db:contextmenu:show",HIDE_EVT:"db:contextmenu:hide",_prev_key_scope:null,listen:function(){return Se(document).click(this.hide_on_click),Se(document).on($e.UPDATE,this.hide_on_click),key("esc",this.KEY_SCOPE,function(){return function(){return Or.hide()}}(this))},unlisten:function(){return Se(document).off("click",this.hide_on_click),Se(document).off($e.UPDATE,this.hide_on_click)},hide_on_click:function(e){return 3===e.which||Se(e.target).parents("#context-menu").length?void 0:Or.hide()},show_for_file:function(e,t,n){var i,r;return Ir.keyboard_nav=!1,this.hide(),i=vr.from_elem(n),r=Sr.is_selected(i)?Sr.get_selected_files():(Sr.deselect_all(),[i]),Sr.set_context_selected(r),this._show(t,new e(r))},show_global:function(e,t){return this.hide(),this._show(t,new e)},show_shmodel:function(e){var t,n,i,r,o,s;return t=["get_original"],o=e.findElement("img"),"true"===o.readAttribute("enable-download")?(r=o.readAttribute("data-original-href"),n=[]):(r="",n=["get_original"]),this.hide(),s={get_original:{icon:"download",text:zt("Download original"),href:r}},i=Class.create({get_action_names:function(){return t},get_disabled_action_names:function(){return n},get_action_by_name:function(e){var t;return t=s[e],t.name=e,t}}),this._show(e,new i)},show_for_lightbox:function(e){var t,n,i,r,s,a,_;return t=["download","view_original"],this.hide(),s=e.findElement("img"),"false"===s.readAttribute("enable-download")?(n=["download","view_original"],r="",_=""):(n=[],r=o.parse(s.readAttribute("data-original-href")).updateQuery({dl:1}).toString(),_=s.readAttribute("data-original-href")),a={download:{icon:"download",text:zt("Download"),href:r},view_original:{icon:"view_original",text:ur.append_ellipsis(zt("View original")),href:_,target:"_blank"}},i=Class.create({initialize:function(){return this._listen()},_listen:function(){var e;return e=$("context-menu-container"),e.stopObserving("click"),e.stopObserving("contextmenu"),e.on("click",".action button",this._click.bind(this)),e.on("contextmenu",".action button",this._click.bind(this))},_click:function(e,t){var n,i,r;return n=t.readAttribute("data-value"),i=a[n],Or.hide(),e.preventDefault(),null!=(r=i.click_handler)?r.call(this,e):void 0},get_action_names:function(){return t},get_disabled_action_names:function(){return n},get_action_by_name:function(e){var t;return t=a[e],t.name=e,t}}),this._show(e,new i)},_show:function(e,t,n){var i,r,o,s,a,_,l,u,d,c,h,f,p,m,v;if(null==n&&(n=!1),v="INPUT"===(null!=e&&null!=(h=e.target)?h.tagName.toUpperCase():void 0)&&"TEXT"===(null!=e&&null!=(f=e.target)?f.type.toUpperCase():void 0)||"TEXTAREA"===(null!=e&&null!=(p=e.target)?p.tagName.toUpperCase():void 0),_=["#page-footer","#account-header","#browse-global-actions-bar","#modal","#modal-overlay","#file-preview-modal","#file-viewer","#react-file-viewer","#notify-wrapper",".db-modal-wrapper","#sharing-growth-experiments-dropdown-menu",".inline-share-button",".inline-member-list-button","#wizard-overlay","#react-bubble-dropdown-root",".preview-sf-members-box",".db-modal",".db-modal-overlay",".waiting_for_items"],m=$(e.target),!Se(m).parents("#context-menu").length){if(i=Se("#file-preview-modal"),!i.find(m).length||!Se(m).is("img"))for(r=0,u=_.length;u>r;r++)if(a=_[r],s=$$(a))for(l=0,d=s.length;d>l;l++)if(o=s[l],m.descendantOf(o)||m.match(a))return;if(!((null!=e?e.shiftKey:void 0)||v)&&(Event.stop(e),null==this._context_menu_tmpl&&(this._context_menu_tmpl=lt.tmpl("context_menu_tmpl")),t.get_action_names().length))return fi.hide_all(),$("context-menu-container").__date(this._context_menu_tmpl({context:t,actions:function(){var e,n,i,r;for(i=t.get_action_names(),r=[],e=0,n=i.length;n>e;e++)c=i[e],r.push(t.get_action_by_name(c));return r}(),disabled_actions:t.get_disabled_action_names(),big:n,Sprite:ee})),this.position_at(e.clientX,e.clientY),$("context-menu-container").show(),this.listen(),this._prev_key_scope=key.getScope(),key.setScope(this.KEY_SCOPE),document.fire(this.SHOW_EVT)}},position_at:function(e,t){var n,i,r,o;return o=je.viewport_dimensions(),i=parseInt($("context-menu").getStyle("width"),10),n=parseInt($("context-menu").getStyle("height"),10),r=15,$("context-menu").setStyle(e+i>o.width-r?{left:o.width-i-r+"px"}:{left:e+"px"}),$("context-menu").setStyle(t+n>o.height-r?{top:o.height-n-r+"px"}:{top:t+"px"})},hide:function(){return $("context-menu-container").empty()?void 0:(this.unlisten(),Sr.set_context_selected([]),$("context-menu-container").__date(),key.getScope()===this.KEY_SCOPE&&key.setScope(this._prev_key_scope),document.fire(this.HIDE_EVT))}};var Nr,Ir,$r,Lr,Rr,Mr,Fr,Yn=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Nr=ft.BROWSE_SNIPPET_LEN=25,Fr=ft.SEARCH_SNIPPET_LEN=20,Lr=ft.COMMENT_COUNT_SNIPPET_LEN=3,Mr=ft.LAST_MODIFIED_FNAME_SNIPPET=4,Rr=[dr.FILES_BY_NAME,!0,"FILES_BY_NAME"],Ir=INLINE_JS.Browse=ft.Browse={KEY_SCOPE:"browse",SCROLL_DURATION:.5,msg:!1,files:[],reloading:!1,creating_folder:!1,first_load:!0,last_sort:Rr,folder_loading_notification:null,folder_loading_timeout:null,keyboard_nav:!1,paginating:!1,is_initialized:!1,init:function(e,t,n,i,r,s,a){return this.browse_actions_ctor=t,this.global_actions_ctor=n,this.browse_actions_context_ctor=i,this.global_actions_context_ctor=r,this.ns_id_to_mount_point=s,"number"!=typeof a?void bt("a user_id was not passed into Browse.init"):(this.active_user=G.get_viewer().get_user_by_id(a),__CIRCULAR_DEPENDENCY__.active_user_loaded=!0,this.active_user?(this.unselectable(),this.listen(),je.viewport_dimensions(),this.browser_supports_previews=st.chrome?e&&Zt.pdf_plugins().length:e,this.compiled_search_tmpl=lt.tmpl("search_list_item_tmpl"),b.AuthenticatedRequest({url:o({path:"/flash_detect_log"}),data:{installed:FlashDetect.installed,major:FlashDetect.major,minor:FlashDetect.minor,revision:FlashDetect.revision,revisionStr:FlashDetect.revisionStr,raw:FlashDetect.raw}}),this.is_initialized=!0):void bt("No active_user was found in Browse.init"))},setup:function(e,t){var n;return null==t&&(t=null),null==e?void this._setup_actions():(this.ns_id_to_mount_point=e.ns_id_to_mount_point,this.old_path_to_ns_id=e.old_path_to_ns_id,this.compiled_tmpl=lt.tmpl("list_item_tmpl"),this.render_timeout=null,this.inside_root_folder=""===e.containing_fq_path,this.inside_dir=e.inside_dir,this.inside_deleted_dir=e.inside_deleted_dir,this.inside_shared_folder=e.inside_shared_folder,this.can_nest_in_containing_ns=e.can_nest_in_containing_ns,this.can_change_new_ns_options=!e.inside_shared_folder||e.containing_sf_perm_role===I.NameSpaceAccess.ACCESS_OWNER,this.inside_read_only_shared_folder=e.inside_read_only_shared_folder,this.inside_sandbox=e.inside_sandbox,this.public_app_token=e.public_app_token,this.public_folder_enabled=e.public_folder_enabled,this.inside_deleted_sandbox=e.inside_deleted_sandbox,this.inside_deleted_shared_folder=e.inside_deleted_shared_folder,this.inside_team_folder=e.inside_team_folder,this.is_read_only=e.is_read_only,this.permanent_delete_is_disabled_by_ns_id=e.permanent_delete_is_disabled_by_ns_id,this.contents_cache_key=e.contents_cache_key,n="inside_deleted_dir",this.inside_deleted_dir?$("browse").addClassName(n):$("browse").removeClassName(n),this.block_hash=e.block_hash,this.block_hash_param=e.block_hash_param,this.inside_dir&&(this._containing_ns_id=e.containing_ns_id,this._containing_ns_path=e.containing_ns_path,this._containing_fq_path=e.containing_fq_path,this._containing_mount_point=e.containing_mount_point,this._containing_sf_perm_role=e.containing_sf_perm_role,this.breadcrumb(),this._setup_actions(),e.file_info||e.paginated||this.show_message(zt('<h3>This folder is empty</h3> Add files using the <a href="/install">desktop application</a> or the upload button above.'))),e.paginated?this._start_pagination(e.first_page):this._push_files(e.file_info,t))},_setup_actions:function(){var e,t,n,i;for(i=[this.browse_actions,this.global_actions],t=0,n=i.length;n>t;t++)e=i[t],null!=e&&e.unlisten();return this.browse_actions=new this.browse_actions_ctor,this.global_actions=new this.global_actions_ctor},entered_search:function(){return this._stop_pagination()},_start_pagination:function(e){var t;return null!=e.unsupported_sort&&this.reset_sort(),this.paginating=!0,t=Ir.active_user.id,this.pagination_manager=new T,this.pagination_manager.initialize(e,"sjid","/browse_get_next",t,function(e){return function(t,n){return e._new_data_available(t,n)}}(this)),this.pagination_manager.startAutoFetching(),Se("#more-loading").show(),this.disable_sorting()},_stop_pagination:function(){return this.paginating?(this.paginating=!1,this.pagination_manager.stopAutoFetching(),this.pagination_manager=null,Se("#more-loading").hide(),this.enable_sorting(),this._stop_waiting_for_items()):void 0},_new_data_available:function(e,t){var n,i;if(this.paginating)return i=this._push_files(t),oe.getGandalfRule("file-viewer-react")&&ke.updateFiles(this.files),this.in_search_mode()||(this.smartfill(),ur.load_visible_thumbs(),this.fire_visible_change_callbacks()),n=1===e.loadedPageCount(),n||(this._is_item_selection_needed()&&(this._are_all_selected_items_fetched()||e.areAllItemsReady())&&(this._stop_waiting_for_items(),this.set_selection_from_fq_paths_or_index(Ir)),document.fire($e.NEW_PAGE,{page_files:i}),Se(document).trigger($e.NEW_PAGE,{page_files:i})),e.areAllItemsReady()?this._stop_pagination():void 0},_is_item_selection_needed:function(){return this.select_fq_paths&&this.select_fq_paths.length>0||this.select_index>-1},_are_all_selected_items_fetched:function(e){var t,n,i,r,o,s,a,_,l;if(null==e&&(e=this.files),this.select_fq_paths&&this.select_fq_paths.length>0){for(l=this.select_fq_paths,r=0,s=l.length;s>r;r++){for(t=l[r],i=!1,_=t.toLowerCase(),o=0,a=e.length;a>o;o++)if(n=e[o],n.fq_path.toLowerCase()===_){i=!0;break}if(!i)return!1}return!0}return this.select_index>-1?this.select_index<e.length:wt(0,"Expected something to select (@select_index or @select_fq_paths)")},_wait_for_items:function(){return Se("#waiting-for-items").show(),Se("#global-actions").addClass("disabled"),Se("body").addClass("waiting_for_items")},_stop_waiting_for_items:function(){return Se("body").removeClass("waiting_for_items"),Se("#global-actions").removeClass("disabled"),Se("#waiting-for-items").hide()},_push_files:function(e,t){var n,i,r,o,s;for(null==t&&(t=null),i=[],o=0,s=e.length;s>o;o++)r=e[o],n=ur.make_browsefile(r,t),n.track_in_browse(),i.push(n);return Dr.update(),i},_get_helper:function(e){return wt(this.inside_dir,"accessed "+e+", but not inside a directory"),Ir[e]},containing_ns_id:function(){return this._get_helper("_containing_ns_id")},containing_ns_path:function(){return this._get_helper("_containing_ns_path")},containing_mount_point:function(){return this._get_helper("_containing_mount_point")},containing_fq_path:function(){return this.inside_dir?this._get_helper("_containing_fq_path"):""},containing_sf_perm_role:function(){return this._get_helper("_containing_sf_perm_role")},listen:function(){var e,t,n,i,r,o,a,_,l,u,d,c,h,f,p,m;for(Se("#fulltext-search-all-link").click(this.unscoped_search),Se("#noresults-search-all-link").click(this.unscoped_search),$("browse-files").on("click","li.browse-file",this.click.bind(this)),$("browse-files").on("dblclick","li.browse-file",this.dblclick.bind(this)),$("browse-files").on("contextmenu","li.browse-file",Or.show_for_file.bind(Or,this.browse_actions_context_ctor)),this.enable_sorting(),f="#browse-sort a.sortable-column-header",Zt.add_sort_arrow_mouseover($("name-sorter"),!0,f,!1),Event.observe(window,"scroll",this.window_scroll.bind(this)),Event.observe(window,"resize",this.updateOffset.bind(this)),$(document.body).on("click","a.crumb",this.crumb_click.bind(this)),$("browse-files").on("click","a.parent-dir",this.parent_click.bind(this)),document.observe("contextmenu",Or.show_global.bind(Or,this.global_actions_context_ctor)),document.observe(Sr.UPDATED_EVT,this.selection_handler.bind(this)),document.observe(s.COPY,function(e){return function(t){return e.inside_dir&&t.memo.to_fq_path===e.containing_fq_path()?e.force_reload():void 0}}(this)),d=[s.MOVE,s.RESTORE,s.UPLOAD,s.SF_NEW,s.SF_REJOIN,s.SF_IGNORE,s.LINKS_REMOVE,s.LINKS_ADD],r=0,a=d.length;a>r;r++)n=d[r],i=function(e){return function(){return e.inside_dir&&!Ir.in_search_mode()?e.force_reload():void 0}}(this),document.observe(n,i),Se(document).on(n,i);for(c=[s.SF_LEAVE,s.SF_UNSHARE],o=0,_=c.length;_>o;o++)n=c[o],document.observe(n,function(e){return function(t){return e.inside_dir?t.memo.target_ns_id===e.containing_ns_id()?e.reload_fqpath(t.memo.folder_deleted?"":e.containing_fq_path()):e.force_reload():void 0}}(this));for(h=[s.DELETE,s.PURGE],u=0,l=h.length;l>u;u++)n=h[u],document.observe(n,function(e){return function(t){var n,i,r,o,a,_,l,u;if(e.inside_dir){if(t.eventName===s.PURGE||t.eventName===s.DELETE&&!mr.get_del()){for(i=o=l=e.files.length-1;(0>=l?0>=o:o>=0)&&-1===t.memo.files.indexOf(e.files[i]);i=0>=l?++o:--o)a=e.files[i];for(Sr.deselect_all(),u=t.memo.files,_=0,r=u.length;r>_;_++)n=u[_],n.get_div().remove(),e.files.removeItem(n);return e.files.length?Sr.set_selected_files(null!=a?a:e.files.last()):e.show_empty()}return e.keyboard_nav&&(e.select_fq_paths=[e.containing_fq_path()+"/"+t.memo.files.last().filename]),e.force_reload()}}}(this));return document.observe(Or.SHOW_EVT,this.disable_sorting.bind(this)),document.observe(Or.HIDE_EVT,this.enable_sorting.bind(this)),e=function(){var e,t;return e=$("browse-header"),t=e.cumulativeOffset().top+e.getHeight(),je.viewport_dimensions().height-t},key("pagedown",this.KEY_SCOPE,function(t){return Event.extend(t).preventDefault(),window.scrollBy(0,e())}),key("pageup",this.KEY_SCOPE,function(t){return Event.extend(t).preventDefault(),window.scrollBy(0,-1*e())}),p=function(){var e;return e=Ir.in_search_mode()?hr:Ir,0===Ir.files.length?e.show_empty():e.hide_empty()},document.observe(lr.ADD,function(e){return function(t){var n,i,r,o;for(o=t.memo.files,r=0,i=o.length;i>r;r++)n=o[r],e.insert_file(n,!0);return p()}}(this)),document.observe(lr.REMOVE,function(e){return function(t){var n,i,r,o;for(o=t.memo.files,r=0,i=o.length;i>r;r++)n=o[r],e.remove_file(n);return p()}}(this)),document.observe(lr.MOVE,function(e){return function(t){var n,i,r,o,s,a,_,l,u;for(i=e.in_search_mode(),a=t.memo.files,l=[],o=0,r=a.length;r>o;o++){if(_=a[o],n=_[0],u=_[1],i){if(null==n)continue;s=e.get_file_pos(n)}e.remove_file(n),e.insert_file(u),l.push(i&&s>=0?e.update_file_pos(u,s):void 0)}return l}}(this)),Se(document).on(s.COMPRESS,function(e){return function(t,n){var i;return e.force_reload(),1===n.compressed_files.length&&1===n.original_files.length?(i=ur.make_browsefile(n.compressed_files.first()),e.preview_compressed(i,n.original_files.first())):void 0}}(this)),t=this.fire_visible_change_callbacks.bind(this),Se(window).on("resize",t),this._last_visible_change_timeout_id=null,m=function(e){return function(){return clearTimeout(e._last_visible_change_timeout_id),e._last_visible_change_timeout_id=setTimeout(t,250)}}(this),Se(window).on("scroll",m)},disable_sorting:function(){return $("browse-sort").stopObserving("click"),$$("#browse-sort *").invoke("setStyle",{cursor:"default"})},enable_sorting:function(){return $("browse-sort").stopObserving("click"),$("browse-sort").on("click","#browse-sort a.sortable-column-header",this.sort_handler.bind(this)),$$("#browse-sort *").invoke("setStyle",{cursor:"pointer"})},click:function(e,t){var n,i,r;return n=Se(e.target),(n.is("img.icon")||n.closest("a.filename-link").length>0||n.closest(".filename-col__comment-count-bubble").length>0)&&this._click(e,t),n.is("a.parent-dir")&&(i=vr.from_elem(t))?(r={file_nsid:i.ns_id,file_sjid:i.sjid,firefly:hr.firefly_enabled,match_type:i.match_type,position:i.sort_rank,request_id:i.request_id,viewport:"full-view",action_type:"click_path_link"},rt.SearchClientActivityLogger.log("result_action",Ir.active_user.id,r)):void 0},dblclick:function(e,t){return $(e.target).match("a")?void 0:this._click(e,t)},open_file:function(e,t,n,i){var r;return null==n&&(n=!1),null==i&&(i=Z.OREF_CONSTANTS.BROWSE_UNKNOWN),r={file_nsid:e.ns_id,file_sjid:e.sjid,firefly:hr.firefly_enabled,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:n?"dropdown-view":"full-view"},e.dir?((this.in_search_mode()||n)&&(r.action_type="folder_open",rt.SearchClientActivityLogger.log("result_action",Ir.active_user.id,r)),t?this.open_folder_in_new_window(e):this.open_folder(e),rt.TimeToFirstActionLogger.log(Ir.active_user.id,"folder_open")):!t&&this.can_show_preview(e)?((this.in_search_mode()||n)&&(r.action_type="file_view",rt.SearchClientActivityLogger.log("result_action",Ir.active_user.id,r)),rt.TimeToFirstActionLogger.log(Ir.active_user.id,"file_view"),this.open_preview(e,i,n)):((this.in_search_mode()||n)&&(r.action_type="file_view",rt.SearchClientActivityLogger.log("result_action",Ir.active_user.id,r)),rt.TimeToFirstActionLogger.log(Ir.active_user.id,"file_view"),window.open(e.href,"_blank"))},close_preview_callback:function(){return Se(document).off("db:filepreview:close",this.close_preview_callback),pr.close_shared_link_view(),Ir.set_title()},preview_compressed:function(e,t){return ro.show(e,Ir.active_user,{files:[e,t],file_view_target:Z.FileViewTargetType.PRIVATE,hide_comments:!0})},open_preview:function(e,t,n,i){return null==t&&(t=Z.OREF_CONSTANTS.BROWSE_UNKNOWN),null==n&&(n=!1),null==i&&(i=!1),this.can_show_preview(e)?(ur.filepreview_from_selected(e,n,i,t),Se(document).on("db:filepreview:close",this.close_preview_callback)):void 0},_click:function(e,t){var n,i;this.keyboard_nav=!1,n=vr.from_elem(t),n.editing||(i=2===e.which||Zt.is_mac()&&e.metaKey,Ir.open_file(n,i,!1,Z.OREF_CONSTANTS.BROWSE_FILE_OPEN),e.preventDefault())},crumb_click:function(e,t){var n,i;return this.keyboard_nav=!1,e.preventDefault(),i=t.readAttribute("data-fq_path"),n=this.details_from_fq_path(i),mr.set_path_url(n.ns_id,n.ns_path)},parent_click:function(e,t){var n,i,r,o;return this.keyboard_nav=!1,e.preventDefault(),o=t.readAttribute("data-parent_ns_path"),r=parseInt(t.readAttribute("data-parent_ns_id"),10),mr.set_path_url(r,o),n=vr.from_elem(t),n?(i={file_nsid:n.ns_id,file_sjid:n.sjid,firefly:hr.firefly_enabled,match_type:n.match_type,position:n.sort_rank,request_id:n.request_id,viewport:"full-view",action_type:"click_path_link"},rt.SearchClientActivityLogger.log("result_action",Ir.active_user.id,i)):void 0},selection_handler:function(){return Sr.get_selected_files().length?$("browse-box").addClassName("selected"):$("browse-box").removeClassName("selected")},POST_SCROLL_WAIT:100,_last_scroll_timeout:null,window_scroll:function(){var e,t,n,i;return this.in_search_mode()&&!hr.end_of_results&&(n=ur.get_files_in_view(),i=n[0],t=n[1],e=this.files.length-(i+t),50>=e&&!$("browse").hasClassName("pending-search")&&hr.load_more_results()),clearTimeout(this._last_scroll_timeout),this._last_scroll_timeout=setTimeout(ur.load_visible_thumbs.bind(ur),this.POST_SCROLL_WAIT)},unscoped_search:function(){return hr.search(!1)},updateOffset:function(){return this.div_parent?(this._cumulativeOffset=this.div_parent.cumulativeOffset(),
this.viewportOffset()):void 0},reset_sort:function(){var e,t;return this.last_sort=Rr,t="#browse-sort a.sortable-column-header",e=$$(t)[0],Zt.add_sort_arrow_mouseover(e,!0,t,!1),$("kind-sorter-label").__date(cr.DISPLAY.FILES_BY_KIND),ee.src(e.down("img"),"web","arrow-up-gray")},sort_handler:function(e,t,n){var i,r,o,s;return t=$(t),t.blur(),s=t.readAttribute("data-sort"),null!=n||(n=this.last_sort[0]===dr[s]?"false"===t.readAttribute("data-ascending"):"FILES_BY_MODIFIED"!==s),cr.has_label(s)?(r=cr.next(s),$("sharing-sorter-label").__date(r.display),s=r.label,t.writeAttribute("data-sort",s),n=cr.IS_ASC[s]):t.writeAttribute("data-ascending",n?"true":"false"),o="#browse-sort a.sortable-column-header",Zt.add_sort_arrow_mouseover(t,n,o,!0),i=dr[s],this.sort(i,n,s),e?e.stop():void 0},toggle_deleted:function(){var e;return e=!mr.get_del(),mr.set_del_url(e)},unused_filename:function(e,t){var n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v;for(null==t&&(t=!1),v=_t.filename_without_extension(e),m=_t.file_extension(e,n=!0),o=[],f=Ir.files,u=0,d=f.length;d>u;u++)i=f[u],h=_t.filename_without_extension(i.filename),c=_t.file_extension(i.filename,n=!0),a=0===h.toLowerCase().indexOf(v.toLowerCase()),s=m.toLowerCase()===c.toLowerCase(),l=!t||i.dir,a&&s&&l&&o.push(i.filename.toLowerCase());for(m=m?"."+m:"",r=v+m,_=1;;){if(p=r.toLowerCase(),Yn.call(o,p)<0)break;r=v+" ("+_+")"+m,_++}return r},new_folder:function(){var e,t,n,i,r,o,s,a,l,u,d,c;if(!this.reloading&&!this.creating_folder)return Ir.sharing_create_and_share_new_folder_enabled&&!this.inside_shared_folder?(r=new On(Ir.active_user,{element_id:"create-and-share-new-folder-modal-"+Ir.active_user.id,destination_dir:this.containing_fq_path()}),void r.show()):(this.hide_empty(),this.selectable(),n=this.unused_filename(zt("New folder"),l=!0),c=lt.tmpl("new_folder_tmpl",{name:n,Sprite:ee,_:zt}),i=-1,this.files.length&&(d=je.scroll_offsets(),d.top>0&&(u=this.files[0].get_div().getLayout().get("margin-box-height"),i=Math.floor(d.top/u))),i>0?this.files[i].get_div().__sert({after:c}):$("browse-files").__sert({top:c}),o=$$("#browse-files .browse-new-folder .name").first(),wt(null!=o,"expected new_folder_name to be defined"),e=this.containing_fq_path(),a=function(e){return function(t){var n,i,r;return r=t.responseText.evalJSON(!0),wt(1===r.new_browse_files.length,"No new file data returned."),n=_t.filename(r.new_browse_files.first().fq_path),i=zt("Created folder '%(folder_name)s'"),i=i.format({folder_name:_.em_snippet(n,25)}),k.success(i),e.select_fq_paths=[r.new_browse_files.first().fq_path],e.force_reload()}}(this),s=function(e){return function(){var t;return t=$$("#browse-files li.browse-new-folder").first(),t&&t.remove(),e.creating_folder=!1}}(this),t=new Ajax.InPlaceEditor(o,"/cmd/new"+Zt.urlquote(e),{htmlResponse:!1,okControl:!1,cancelControl:!1,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:!0,onFailure:function(){},onComplete:s,savingText:zt("Creating folder..."),onLeaveEditMode:this.unselectable,ajaxOptions:{method:"POST",onSuccess:a,subject_user:Ir.active_user},callback:function(e){return function(t,n){return e.creating_folder=!0,{to_path:n||"",folder:"yes"}}}(this)}),t.enterEditMode())},open_folder:function(e){var t,n,i;return wt(e.dir,"Only open directories, not files"),!Ir.inside_dir||Ir.containing_ns_path()!==e.ns_path||this.in_search_mode()?((1!==Sr.get_selected_files().length||0!==Sr.get_selected_files().indexOf(e))&&(Sr.deselect_all(),t="function"==typeof e.get_div?e.get_div():void 0,t&&t.addClassName("file-select")),clearTimeout(this.folder_loading_timeout),this.folder_loading_timeout=setTimeout(function(t){return function(){var n;if(t.reloading)return n=zt("Loading %(filename)s..."),n=n.format({filename:_.em_snippet(e.filename,50)}),t.folder_loading_notification=k.success(n,60,!0)}}(this),1e3),e.target_ns?(n=e.target_ns,i=""):(n=e.ns_id,i=e.ns_path),e.is_deleted?mr.set_path_url(n,i,!0):mr.set_path_url(n,i)):void 0},open_folder_in_new_window:function(e){return window.open(mr._make_url(e.ns_id,e.ns_path),"_blank")},show_message:function(e){var t,n;return"string"!=typeof e?(n=$("browse-files").down(".browse-message"),void(n&&n.show())):(this.msg=e,t=new Element("div",{class:"browse-message"}),t.__date(e),$("browse-files").__sert(t))},sort:function(e,t,n,i){var r;if(i||e!==this.last_sort[0]||t!==this.last_sort[1])return this.last_sort=[e,t,n],r=e(t),this.files.sort(r),this.smartfill(),ur.load_visible_thumbs(),this.fire_visible_change_callbacks()},resort:function(){var e,t,n,i;return t=this.last_sort,n=t[0],e=t[1],i=t[2],this.sort(n,e,i,!0)},in_search_mode:function(){return Se("#browse").hasClass("search")},flex_column:function(){return $("sharing-sorter").readAttribute("data-sort")},update_shared_with_string:function(){var e;return e=zt(this.inside_shared_folder?"Additional sharing":"Shared with"),cr.set_column_display("SHARED_WITH",e),Se("#sharing-sorter-label").text(cr.DISPLAY[this.flex_column()])},smartfill:function(){var e,t,n,i,r,o,s,a;for(e=$("browse-files"),a=[],i=this.in_search_mode(),s=this.files,r=0,o=s.length;o>r;r++)t=s[r],n=this.flex_column(),a.push(this.compiled_tmpl({file:t,in_search_mode:i,flex_column:n,Browse:Ir,Emstring:_,FilePath:_t,GandalfUtil:oe,SharingUIUtil:Me,Sprite:ee,_:zt}));return e.__date(a),document.fire($e.RENDER),Se(document).trigger($e.RENDER)},search_smartfill:function(e,n){var i,r,o,s,a,l,u;for(null==n&&(n=null),u=[],a=0,l=e.length;l>a;a++)r=e[a],s=ur.make_browsefile(r,n),s.track_in_browse(),o=this.compiled_search_tmpl({Browse:Ir,BrowseInterface:t,Emstring:_,file:s,FilePath:_t,HTML:lt,searchHelpers:S,SharingUIUtil:Me,Sprite:ee,Util:Zt,_:zt}),i=Se(o.toHTML()),u.push(i);return Se("#browse-files").append(u),document.fire($e.RENDER),Se(document).trigger($e.RENDER),ur.load_visible_thumbs(),this.fire_visible_change_callbacks()},add_file:function(e){return this.files.push(e),e.target_ns&&(Ir.ns_id_to_mount_point[e.target_ns]=e.fq_path),e.bytes<0?this.deleted_shown=!0:void 0},insert_file:function(e,t){var n;if(e)return t=t||0,n=this.find_file(e.fq_path),n&&n!==e&&this.remove_file(n),vr._file_index[e.to_key()]=e,this.update_file_pos(e),t&&e.get_div().setStyle({display:"none"}),document.fire($e.RENDER),Se(document).trigger($e.RENDER)},add_files:function(e){return Ir._push_files(e.file_info)},get_file_pos:function(e){var t;return t=this.files.indexOf(e),wt(-1!==t,"file not present in @files"),wt(e.to_key()in vr._file_index,"file not present in BrowseFile._file_index"),t},remove_file:function(e){var t,n;if(e)return t=this.files.indexOf(e),-1!==t?(this.files.splice(t,1),delete vr._file_index[e.to_key()],null!=(n=e.get_div())?n.remove():void 0):void 0},update_file_pos:function(e,n){var i,r,o,s,a,l,u,d;return null==n&&(n=-1),d=this.files.indexOf(e),-1!==d&&this.files.splice(d,1),delete e.sort_rank,l=this.last_sort[0],a=this.last_sort[1],n>=0&&(d=n),s=this.in_search_mode()?d:Zt.bsearch(this.files,e,l(a),!0),this.files.splice(s,0,e),o=e.get_div(),i=$("browse-files"),o&&o.remove(),u=this.in_search_mode()?this.compiled_search_tmpl({Browse:Ir,BrowseInterface:t,Emstring:_,file:e,FilePath:_t,HTML:lt,searchHelpers:S,SharingUIUtil:Me,Sprite:ee,Util:Zt,_:zt}):this.compiled_tmpl({Browse:Ir,Emstring:_,file:e,flex_column:this.flex_column(),FilePath:_t,GandalfUtil:oe,in_search_mode:this.in_search_mode(),SharingUIUtil:Me,Sprite:ee,_:zt}),r=i.childElements(),s<r.length?i.childElements()[s].__sert({before:u}):i.__sert(u)},find_file:function(e){return this.files.find(function(t){return t.fq_path.toLowerCase()===e.toLowerCase()})},reset_state:function(){return this.msg=!1,this.dragging=!1,this.files=[],this.selected_files=[],this.selection=[],vr._file_index={},Ar._body_dragend()},clear:function(){return $("browse-files").__date(),this.hide_empty(),hr.hide_empty()},show_empty:function(){var e;return this.hide_empty(),e=Se("#browse-empty-team-folder").length&&this.inside_team_folder&&!this.is_in_subfolder_of_team_folder()?"#browse-empty-team-folder":"#browse-empty",Se(e+" .drag-prompt").toggle(!this.is_read_only),Ir.in_search_mode()?void 0:Se(e).show()},hide_empty:function(){return Se("#browse-empty, #browse-empty-team-folder").hide()},update:function(e,t){return null==t&&(t=null),$("browse-box").show(),this.in_search_mode()?(this.search_smartfill(e.file_info,t),this.setup(null)):(this.clear(),"string"==typeof e&&(e=JSON.parse(e)),this.setup(e,t),this.resort(),document.fire($e.UPDATE),Se(document).trigger($e.UPDATE,[e]))},reload_fqpath:function(e,t){return this.reload(null,Zt.urlquote(e),t)},force_reload:function(){return this.reload(this.containing_ns_id(),Zt.urlquote(this.containing_ns_path()),!0)},set_title:function(){var e;if(Ir.in_search_mode())return void hr.set_title();if(Ir.inside_dir)return e=this.containing_fq_path(),document.title=e?_t.filename(e)+" - Dropbox":G.get_viewer().is_paired&&Ir.active_user.role===O.ROLE_WORK?G.get_viewer().team_name+" - Dropbox":G.get_viewer().is_paired&&Ir.active_user.role===O.ROLE_PERSONAL?zt("Personal")+" - Dropbox":zt("Home")+" - Dropbox"},set_selection_from_fq_paths_or_index:function(e){var t,n,i,r,o,s,a,_;if(a=e.select_fq_paths,_=e.select_index,a||_>-1){if(n=[],a)for(r=0,o=a.length;o>r;r++)i=a[r],s=this.find_file(i),s&&n.push(s);return!n.length&&_>-1&&(t=this.files[_],t&&n.push(t)),n.length&&(Sr.set_selected_files(n),this.scrollToWithPadding(n.first().get_div(),100)),e.select_fq_paths=!1,e.select_index=-1}},set_selection_from_item_counters:function(){var e,t,n,i,r,o,s,a,_,l;if(null!=this.select_item_counters){for(n={},a=this.select_item_counters,i=0,o=a.length;o>i;i++)t=a[i],n[t]=!0;for(l=[],_=this.files,r=0,s=_.length;s>r;r++)e=_[r],e.root_coll_item_counter in n&&l.push(e);return Sr.set_selected_files(l),this.select_item_counters=null}},reload:function(e,t,n){var i,r,s,a,_,l,u,d;return a="Browse.reload ns_path contains an invalid character: # ; ? : @ & = + $ (ns_path = "+t+")",wt(-1===t.search(v.URL_ESCAPE_REGEX),a),null==e&&(e=Ir.active_user.root_ns),t=_t.normalize(t),ur.get_mode()!==ur.BROWSE_MODE&&(this.clear(),ur.set_browse_mode()),hr._clear_on_reload&&hr.clear_searchbox(),ii.uploading||ri.hide(),this._stop_pagination(),this.reloading||this.inside_dir&&t===this.containing_ns_path()&&e===this.containing_ns_id()&&!n?void 0:(u=this.first_load?f.referrer:"",s=this.deleted_shown?"?show_deleted=yes":"",l={ns_id:e,referrer:u,delays_parent_request_rendering:this.first_load,sort_label:this.last_sort[2],sort_is_ascending:this.last_sort[1],sort_folders_first:dr.FOLDERS_FIRST},l=Object.extend(l,this.extra_reload_args),Gt("Browse.reload:",t),this.reloading=!0,d="/browse"+t+s,i=2,r=["browse",e,t,s,Ir.active_user.id,i],_=function(e){return function(t){return e.reset_state(),e.update(t),(e.files.length?e.hide_empty.bind(e):e.show_empty.bind(e))(),clearTimeout(e.folder_loading_timeout),k.isShown()&&k.current()===e.folder_loading_notification&&k.clear(),je.scroll_clear_cache(),e._is_item_selection_needed()&&(e.paginating&&!e._are_all_selected_items_fetched()?e._wait_for_items():e.set_selection_from_fq_paths_or_index(Ir)),ro.shown()||e.set_title(),e.update_shared_with_string()}}(this),Se(document).trigger($e.BEFORE_UPDATE,{ns_id:e,ns_path:o.decode(t)}),new Ajax.DBRequest(d,{allow_retries:!0,subject_user:Ir.active_user,parameters:l,log_timing:!0,on304:function(){},onSuccess:function(e){return function(t){var n,i,r,o,s,a,l,u;if(!e.in_search_mode()){if(o=JSON.parse(t.responseText),u=null,l=null,_(o),u){for(a=[],r=0,s=u.length;s>r;r++)n=u[r],a.push(Ir.find_file(n.fq_path));Sr.set_selected_files(a),window.scrollTo(l[0],l[1])}else Ir.set_selection_from_item_counters();return Ir.sharing_autoselect_first_file_enabled&&!Sr.has_selected_files()&&(i=e.files[0],Sr.set_selected_files([i])),e.first_load?(Be.mark_time_to_view(),Be.mark_time_to_interactive()):void 0}}}(this),onFailure:function(e){return function(){return e.first_load&&e.reload.bind(e).defer(f.root_ns,""),clearTimeout(e.folder_loading_timeout)}}(this),cleanUp:function(e){return function(){return e.first_load=!1,e.reloading=!1}}(this),no_feed_reload:!0,evalJSON:!1}),!0)},is_in_subfolder_of_shared_folder:function(){return Ir.inside_shared_folder&&Ir.containing_ns_path()},is_in_subfolder_of_team_folder:function(){return Ir.inside_team_folder&&Ir.containing_ns_path()},is_shmodelable_path:function(e){var t;return Ir.public_app_token?!1:""===e?!1:Ir.public_folder_enabled&&(t=e.toLowerCase(),t.startsWith("/public/"))?!1:!0},can_show_preview:function(e){var t;return this.browser_supports_previews||"photo"===(t=e.preview_type)||"video"===t},can_get_details_from_fq_path:function(e){var t,n;return t=this.containing_fq_path(),n=this.containing_mount_point(),n&&e.startsWith(n)||t.startsWith(e)},details_from_fq_path:function(e){var n,i,r,o;return wt(this.can_get_details_from_fq_path(e)),i=this.containing_mount_point(),i&&e.startsWith(i)?(r=this.containing_ns_id(),o=e.slice(i.length),n=_t.filename(e,this._get_root_name())):(r=f.root_ns,o=e,n=_t.filename(e,this._get_root_name())),{ns_id:r,ns_path:o,fq_path:e,folder_name:n||this._get_root_name(),url:String(t.browse_uri_for_fq_path(Ir.active_user,e)),icon:e.length?"folder_32":this._get_root_icon()}},update_header_status:function(e){return Se("#browse-header-status").text(e)},update_header_height:function(){var e,t,n,i;return t=Se("#browse-header"),e=Se("#browse-files"),i=0,"fixed"===t.css("position")&&(i=Se(window).scrollTop()),je.is_page_scrollable()||(i=Math.abs(parseFloat(Se("html").css("top"))||0)),n=t.offset().top+t.height()-e.offset().top-i,e.css("padding-top",n)},_make_breadcrumbs_data:function(){var e,t,n,i,r,o,s;for(t=this.containing_fq_path(),e=[],o=t.split("/"),n=i=0,s=o.length;s>=0?s>i:i>s;n=s>=0?++i:--i)r=_t.normalize(o.slice(0,n+1).join("/")),e.push(this.details_from_fq_path(r));return e},_get_root_icon:function(){return G.get_viewer().is_paired?Ir.active_user.role===O.ROLE_WORK?"work_icon":Ir.active_user.role===O.ROLE_PERSONAL?"personal_icon":void 0:"glyph"},_get_root_name:function(){return G.get_root_name(Ir.active_user)},_get_max_breadcrumb_width:function(e){var t,n,i;return n=e?this._DROPDOWN_WIDTH:new _(this._get_root_name()).length,this.use_shorter_breadcrumbs?(t=Se("#browse-rightmenu").width(),i=Se("#browse-global-actions-bar").width(),(i-t)*this._FUDGE_FACTOR/this._PX_TO_EM-n):this._MAX_BREADCRUMB_WIDTH-n},_PX_TO_EM:16,_FUDGE_FACTOR:.75,_DROPDOWN_WIDTH:2.625,_MAX_BREADCRUMB_WIDTH:20,_CONNECT_WIDTH:1.64,breadcrumb:function(){var e,n,i,r,o,s,a,l,u,d,c,h;for(n=this._make_breadcrumbs_data(),h=n.collect(function(e){return new _(e.fq_path?e.folder_name:"").length}),c=0,i=0,wt(n.length>0,"expected at least one breadcrumb"),u=this._get_max_breadcrumb_width(),o=s=d=n.length-1;(0>=d?0>=s:s>=0)&&(c+=h[o],!(c>u));o=0>=d?++s:--s)i+=1,c+=this._CONNECT_WIDTH;return r=n.slice(0,n.length-Math.max(1,i)),n=n.slice(r.length,n.length),!r.length&&n.length>1&&n.shift(),a=n.pop(),e=lt.tmpl("breadcrumb_tmpl",{breadcrumbs:n,dropdown:r,containing_fq_path:this.containing_fq_path(),url_root:t.get_browse_root(Ir.active_user),root_name:this._get_root_name(),Sprite:ee}),l=a.folder_name,""!==a.fq_path&&(l=_.em_snippet(l,this._get_max_breadcrumb_width(r.length>1))),$("browse-location").__date(e),$("browse-location").__sert(" "+l),r.length>1?this._render_breadcrumbs_dropdown(r):void 0},_render_breadcrumbs_dropdown:function(e){var t,n,i,r;return n=$("breadcrumbs-box"),e.reverse(),r=lt.tmpl("breadcrumb_li_tmpl",{breadcrumbs:e,Sprite:ee,Emstring:_}),$("browse-location").__sert(r),i=$("breadcrumb-dropdown"),t=function(e){var t;return e.stopPropagation(),i.show(),t=Se(n),je.clone_position(Se(i),t,{setWidth:0,setHeight:0,offsetTop:t[0].offsetHeight,offsetLeft:parseInt(t.css("padding-left"),10)})},n.observe("click",t),n.observe("dragover",t),document.observe("click",function(){return n.removeClassName("down"),i.hide()})},viewportOffset:function(){var e,t,n;if(this.files.length){if(!this.div_parent){if(t=this.files[0].get_div().offsetParent,!t)return;this._viewportOffset={},this.div_parent=$(t),this._cumulativeOffset=this.div_parent.cumulativeOffset()}return e=Zt.scrollLeft(this.div_parent),n=Zt.scrollTop(this.div_parent),this.scrollTop&&this.scrollLeft&&this.scrollTop===n&&this.scrollLeft===e||(this._viewportOffset.top=this._cumulativeOffset.top-n,this._viewportOffset.left=this._cumulativeOffset.left-e,this.scrollLeft=e,this.scrollTop=n),this._viewportOffset}},selectable:function(){return Zt.enableSelection($("browse-files"))},unselectable:function(){return Zt.disableSelection($("browse-files"))},_header_offset:function(){var e;return e=$("browse-header"),e.getHeight()+e.cumulativeOffset().top}.cached(1e3),scrollTo:function(e){return this.scrollToWithPadding(e,3)},scrollToWithPadding:function(e,t){var n,i,r,o,s;if(e)return o=je.viewport_dimensions(),s=je.scroll_offsets(),i=e.cumulativeOffset().top-s.top,n=e.getHeight(),r=this._header_offset(),r>i?je.scroll_to(0,s.top+i-r-t):i+n>o.height&&je.scroll_to(0,s.top+i+n-o.height+t),$("modal-overlay").visible()&&"absolute"===$("modal").getStyle("position")?mi.fix_position():void 0},_visible_change_callbacks:{},_next_visible_change_callback_id:0,add_visible_change_callback:function(e){return this._visible_change_callbacks[this._next_visible_change_callback_id]=e,this._next_visible_change_callback_id++},remove_visible_change_callback:function(e){return delete this._visible_change_callbacks[e]},fire_visible_change_callbacks:function(){var e,t,n,i,r,o,s;if(!Se.isEmptyObject(this._visible_change_callbacks)){i=ur.get_files_in_view(),s=i[0],e=i[1],r=this._visible_change_callbacks,o=[];for(n in r)t=r[n],o.push(t(this.files,this.active_user.id,s,e));return o}}},$r=ft.BrowseUpdate=function(){var e,n,i,r,o,s,a,_;return a=function(e){var t,n,i;if(Ir.inside_dir)return n=e.parent_changes,null!=n.change_to_fq_path?("moved"===n.change_type?n.is_changing_view?(t=zt("The folder '%s' has been moved. <a href=\"/home%s\">View</a>"),t=t.format(n.old_fq_path.escapeHTML(),Zt.urlquote(n.new_fq_path))):t=zt("This folder has been moved"):"renamed"===n.change_type?n.is_changing_view?(t=zt("The folder '%s' has been renamed. <a href=\"/home%s\">View</a>"),t=t.format(n.old_fq_path.escapeHTML(),Zt.urlquote(n.new_fq_path))):(t=zt("This folder has been renamed to '%s'."),i=n.change_to_fq_path.split("/"),t=t.format(i[i.length-1].escapeHTML())):(t=zt("The folder '%s' has been deleted."),t=t.format(n.old_fq_path.escapeHTML())),n.is_changing_view?k.error(new lt(t)):n.old_fq_path===Ir.containing_fq_path()&&k.success(new lt(t)),void Ir.reload_fqpath(n.change_to_fq_path)):s(e)},_=function(e){var n,i,r,o,a,_,l,u,d,c;if(o=[],c=[],Ir.in_search_mode()){hr.clear_cache();for(_ in Ir.ns_id_to_mount_point)_ in e.mount_points||(e.mount_points[_]=null);u=e.mount_points;for(_ in u)if(a=u[_],_=parseInt(_,10),l=Ir.ns_id_to_mount_point[_],a!==l)for(a?Ir.ns_id_to_mount_point[_]=a:delete Ir.ns_id_to_mount_point[_],d=Ir.files,i=0,r=d.length;r>i;i++)n=d[i],0===n.fq_path.indexOf(l)&&n.target_ns!==_&&(a?(n.fq_path=a+n.fq_path.slice(l.length),n.href=t.get_browse_root(Ir.active_user)+a+n.href.slice(5+l.length),o.push([n,n])):c.push(n));return s(e,[],c,o)}},s=function(e,t,n,i){var r,s,a,_,l,u,d,c,h,f,p,m,v,g,w,b,y,k,E,x;for(null==t&&(t=[]),null==n&&(n=[]),null==i&&(i=[]),v=e.added,d=0,h=v.length;h>d;d++)a=v[d],s=_t.normalize(_t.parent_dir(a.ns_path)),(Ir.in_search_mode()||a.ns_id===Ir.containing_ns_id()&&s===Ir.containing_ns_path())&&(r=ur.make_browsefile(a),r.track_in_browse(),t.push(r));for(g=e.removed,c=0,f=g.length;f>c;c++)_=g[c],n.push(Ir.find_file(_));for(w=e.moved,m=0,p=w.length;p>m;m++)b=w[m],l=b[0],x=b[1],E=_t.normalize(_t.parent_dir(x.ns_path)),k=null,y=Ir.in_search_mode()||x.ns_id===Ir.containing_ns_id()&&E===Ir.containing_ns_path(),u=Ir.in_search_mode(),!y||u&&Ir.find_file(x.ns_path)||(k=ur.make_browsefile(x),k.track_in_browse()),i.push([Ir.find_file(l),k]);return document.fire(lr.ADD,{files:t}),Se(document).trigger(lr.ADD,{files:t}),document.fire(lr.MOVE,{files:i}),ur.load_visible_thumbs(),Ir.fire_visible_change_callbacks(),o(t,n,i)},e=function(e,t,n){return e.css("background",""),Se(document).trigger($e.UPDATE_RENDERED),document.fire(lr.REMOVE,{files:n})},o=function(e,t,i){var o,s,a,_,l,u,d,c,h,f,p,m;for(p=e.length+t.length<=10,a=0,l=e.length;l>a;a++)o=e[a],o&&o.get_div()&&n(o,p,e,t,i);for(_=0,u=t.length;u>_;_++)o=t[_],o&&o.get_div()&&r(o,p,e,t,i);for(f=[],c=0,d=i.length;d>c;c++)h=i[c],s=h[0],m=h[1],s&&r(s,p,e,t,i),f.push(m?n(m,p,e,t,i):void 0);return f},i=function(e){var t;return t=Sr.is_selected(e)?"#83B8DC":"#CCEAFF",Se(e.get_div()).css("background-color",t)},r=function(t,n,r,o,s){var a;return i(t),a=Se(t.get_div()),n?a.show().slideUp("normal",function(){return e(a,r,o,s)}):(a.hide(),e(a,r,o,s))},n=function(t,n,r,o,s){var a;return i(t),a=Se(t.get_div()),n?a.hide().slideDown("normal",function(){return e(a,r,o,s)}):(a.show(),e(a,r,o,s))},{init:function(){var e,t;return t=Rt[Ir.active_user.id],e=t.subscribe_sfj({name:"BrowseUpdater",handler:function(){var n,i,r,o,s,l,u;return o=Ir.in_search_mode(),n=o?_:a,u=o?"/update/list_search":"/update/list_dir",Ir.inside_dir||o?(o?(l=hr.get_state(),r={all_terms:l.query}):r={fq_dir:Ir.containing_fq_path(),show_deleted:Ir.deleted_shown},r.ns_map=function(){var e,n;e=t.get_ns_map(),n=[];for(i in e)s=e[i],n.push(i+"_"+s);return n}().join(","),wt(Ir.active_user,"No active_user was set before calling "+u+". Active user loaded? "+(__CIRCULAR_DEPENDENCY__.active_user_loaded||!1)+". Error before loading? "+(__CIRCULAR_DEPENDENCY__.an_error_happened_before_loading||!1)+". Error after loading? "+(__CIRCULAR_DEPENDENCY__.an_error_happened_after_loading||!1)+".",!0,[],!1),new Se.ajax(u,{data:r,dataType:"json",type:"POST",subject_user:Ir.active_user,success:function(i){return n(i),t.handler_success(e,{ns_map:i.ns_map})},error:function(){return t.handler_failure(e)}})):void t.handler_failure(e)}})}}}();var Pr;Pr=ft.ProgressWatcher={job_info:{},INIT_POLL_INT:1e3,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1e3,watch:function(e,t){var n,i,r;if(e.async_task_id){if(!e.async_task_id.match(/^[A-Za-z0-9_\-=]*$/))return;i=e.async_task_id}else i=e.job_id;return Pr.job_info[i]={},n=Pr.job_info[i],n.subject_user=e.subject_user||(null!=(r=e.parameters)?r[O.UID_PARAM_NAME]:void 0),n.req=e,n.is_async_task=!!e.async_task_id,n.poll_int=Pr.INIT_POLL_INT,n.poll_count=0,n.int_id=setInterval(Pr.update_for(i),n.poll_int),n.failures=0,n.start_time=ae.time(),n.dont_hide=t},update_for:function(e){return function(){return Pr.update(e)}},backoff:function(e){var t;return t=Pr.job_info[e],clearInterval(t.int_id),t.poll_int=Math.min(Math.floor(1.5*t.poll_int),3e4),t.int_id=setInterval(Pr.update_for(e),t.poll_int)},update:function(e){var t,n;return n=Pr.job_info[e],St.peek(e)?Pr.done(e):(n.poll_count++,n.poll_count%10===0&&Pr.backoff(e),!n.modaled&&ae.time()-n.start_time>Pr.MODAL_WAIT_MS&&(t=n.req.options,Ct.show(t.progress_text),t.onProgress=Ct.update,null!=t.on_modal_shown&&t.on_modal_shown(),n.modaled=!0),n.is_async_task?Pr.get_async_task_status(e):Pr.get_job_status(e))},get_job_status:function(e){return new Ajax.DBRequest("/job_status/"+e,{method:"post",subject_user:Pr.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=Pr.job_info[e],i=t.responseText,0===i.indexOf("err"))return Pr.done(e),void(n.req.options.onFailure&&!St.handled(e)&&n.req.options.onFailure(t));if(0===i.indexOf("done"))return n.req.options.job=!1,St.peek(e)||new Ajax.Request("/job_results/"+e,{method:"post",parameters:{t:Ye.read(qe.JS_CSRF_COOKIE)},onSuccess:function(t){return St.handled(e)?void 0:(nn.clearWorkingMessage(),n.req.options.onSuccess?n.req.options.onSuccess(t):void 0)},onFailure:function(t){return St.handled(e)?void 0:(nn.clearWorkingMessage(),n.req.options.onFailure?n.req.options.onFailure(t):void 0)}}),Pr.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;return n=Pr.job_info[e],n.failures++,n.failures>=Pr.FAILS_MEAN_FAIL?(n.req.options.onFailure&&n.req.options.onFailure(t,!0),nn.remove(n.req),Pr.done(e)):void 0}})},get_async_task_status:function(e){return new Ajax.DBRequest("/async_task_status/"+e,{method:"post",subject_user:Pr.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=Pr.job_info[e],i=t.responseText,0===i.indexOf("done:")||0===i.indexOf("err:"))return St.handled(e),nn.clearWorkingMessage(),0===i.indexOf("done:")&&(t.responseText=i.substr(5)),n.req.options.onSuccess&&n.req.options.onSuccess(t),n.req.options.onComplete&&n.req.options.onComplete(t),Pr.done(e);if(0===i.indexOf("async_task_err:"))return k.error(new lt(i.substr(15))),St.handled(e),nn.clearWorkingMessage(),Pr.done(e),Ir.force_reload();try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=Pr.job_info[e],n.failures++,n.failures>=Pr.FAILS_MEAN_FAIL){try{n.req.options.onFailure&&n.req.options.onFailure(t,!0)}catch(e){}return nn.remove(n.req),Pr.done(e)}}})},done:function(e){var t;return t=Pr.job_info[e],clearInterval(t.int_id),t.dont_hide?Ct.update("1/1"):(delete Pr.job_info[e],t.req.async_task_id&&t.req.async_task_id!==e?void 0:Ct.hide(e))}};var qr,Ur,jr,Yn=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};jr=ft.NamespaceEvents=function(){function e(e){this.ns_id=e,this.earliest=Number.MAX_VALUE,this.events=[],this.seen={},this.done=!1}return e}(),qr=ft.EventDatePicker=function(){function e(e){var t,n,i;this.on_change=e,Se(document.body).on("click",function(e){return function(t){return e.hide_calendar(t)}}(this)),i=new Element("div",{id:"cal_container"}),Se(i).bind("click",function(e){return e.preventDefault()}),Se(document.body).append(i),this.calendar=new Ei("cal_container",{onDateChange:function(e){return function(t){return e.on_change(t)}}(this),disable_future:!0}),Se(i).css("position","fixed"),n=Se("#cal_date"),t=Se("#cal_container"),je.clone_position(t,n,{setWidth:!1,setHeight:!1,offsetTop:n.height(),offsetLeft:n.width()-t.children().first()[0].offsetWidth}),this.hide_calendar()}return e.prototype.show_calendar=function(){return this.shown?(Se("#cal_container").hide(),void(this.shown=!1)):(Se("#cal_container").show(),this.shown=!0)},e.prototype.hide_calendar=function(e){return e&&Se(e.target).closest("#cal_date").length>0?void 0:(Se("#cal_container").hide(),this.shown=!1,!0)},e}(),Ur=INLINE_JS.Events=ft.Events={ns:null,role:"all",now:Number(new Date),timestamp:Zt.start_of_day(new Date(Number(new Date)+864e5)),request_in_flight:!1,one_day:864e5,user_navigated_away:!1,init:function(e,t,n,i,r){var o,s,a;return null==r&&(r=!1),this.awaitingFirstRender=!0,a=v.deconstruct_url(),this.first_event_map=e,this.roles=t,this.rss_data=n,this.role_has_events=i,this.deletions_only=r,this.role_picker=Q.get_controller(Se("#role-selector")),1===this.roles.length?this.role=this.roles[0].role:a.qargs.role?(this.role=a.qargs.role,this.role_picker.set_state(this.role)):this.deletions_only&&(this.role=this.roles[this.roles.length-1].role),this.date_picker=new qr(function(e){return function(t){return e.change_date(t),e.set_url(),rt.WebMiscActivityLogger.log("filter_events_date")}}(this)),this._init_state(),this.role_picker.on_state_change=function(e){return function(){return e.role=e.role_picker.get_state(),e.ns&&!w(e.valid_roles()).any(function(t){return t.ns_ids.contains(e.ns.ns_id)})&&(e.ns=null,ki.set_selected_by_value(Se("#namespace-list")[0],"false")),e.set_url(),e.get_more(!0)}}(this),se.set_during_login_callback(function(){return function(){return window.location.reload()}}(this)),Se(window).bind("beforeunload",function(e){return function(){return void(e.user_navigated_away=!0)}}(this)),Se("#namespace-list-container")[0]&&Se("#namespace-list-container")[0].observe("db:change",function(e){return function(t){return e.ns=e.namespaces[JSON.parse(t.memo)],e.set_url(),e.get_more(!0),rt.WebMiscActivityLogger.log("filter_events_shared_folder")}}(this)),Se(window).on("scroll",function(e){return function(){return document.body.scrollTop=Math.min(document.body.scrollTop,document.body.scrollHeight-je.viewport_dimensions().height-10),e.get_more()}}(this)),a.qargs.ns&&(ki.set_selected_by_value(Se("#namespace-list")[0],a.qargs.ns),this.ns=this.namespaces[a.qargs.ns]),a.qargs.date&&(s=a.qargs.date.split("-").map(Number),o=new Date(s[2],s[1]-1,s[0]),this.date_picker.calendar.selected_date=o,this.change_date(o)),this.update_calendar_first_day(),this.get_more()},_init_state:function(){var e,t,n,i,r,o,s,a;for(this.namespaces={},o=w(this.roles).values(),e=0,n=o.length;n>e;e++)for(a=o[e],s=a.ns_ids,t=0,i=s.length;i>t;t++)r=s[t],this.namespaces[r]=new jr(r);return this.ns?this.ns=this.namespaces[this.ns.ns_id]:void 0},change_date:function(e){return this.timestamp=Number(e)+this.one_day,(this.timestamp<this.earliest()||this.timestamp>this.latest)&&(this.latest=this.timestamp,this._init_state()),Se("#cur_date_text").text(Br.localize(e)),this.get_more(!0)},is_scrolled_down:function(){var e,t,n;return n=je.scroll_offsets().top,t=je.viewport_dimensions().height,e=Se("#events").height(),n+t+50>=e},get_more:function(e){var t,n,i;if(!this.request_in_flight)return w(this.valid_nss()).all(function(e){return e.done})?void this.render():e||this.is_scrolled_down()?(this.request_in_flight=!0,this.render(),n=function(e){return function(){return w(e.valid_nss()).map(function(e){return e.ns_id}).join(",")}}(this),t=Math.min(this.earliest(),this.timestamp/1e3,Math.floor(this.now/1e3)),i={page_size:25,ns_ids:n(),timestamp:t},this.deletions_only&&(i.deletions_only=!0),new Ajax.DBRequest("/events/ajax",{method:"POST",parameters:i,onSuccess:function(e){return function(t){var i,r,o,s,a,_,l,u,d,c,h,f,p,m;for(i=JSON.parse(t.responseText),e.request_in_flight=!1,f=i.events,o=0,_=f.length;_>o;o++)r=f[o],r.html=Se(r.html)[0],h=r.pkey+" "+(r.html.textContent||r.html.innerText),d=e.namespaces[r.ns_id],d.seen[h]||(d.events.push(r),d.seen[h]=!0,d.earliest=r.timestamp);if(i.events.length>0)for(p=i.ns_ids,s=0,l=p.length;l>s;s++)c=p[s],e.namespaces[c].earliest=w(i.events).map(function(e){return e.timestamp}).min();if(e.render(),i.events.last())e.get_more();else if(w(i.ns_ids).join(",")!==n())e.get_more();else for(m=i.ns_ids,a=0,u=m.length;u>a;a++)c=m[a],e.namespaces[c].done=!0;return P.configureAllLinks("#event-table",".inline-restore","events")}}(this),onError:function(e){return function(){return e.request_in_flight=!1,e.user_navigated_away?void 0:k.error(zt("We had problems loading your events feed; please try again later."))}}(this)})):void this.render()},valid_roles:function(){return"all"!==this.role?w(this.roles).filter(function(e){return function(t){return t.role===e.role}}(this)):this.roles},valid_nss:function(){return this.ns?[this.ns]:w(this.valid_roles()).map(function(){return function(e){return e.ns_ids}}(this)).flatten().map(function(e){return function(t){return e.namespaces[t]}}(this)).uniq()},earliest:function(){return w(this.valid_nss()).map(function(){return function(e){return e.earliest}}(this)).max()},latest:Number.MAX_VALUE,update_calendar_first_day:function(){return this.date_picker.calendar.options.first_day=Zt.start_of_day(new Date(w(this.valid_nss()).map(function(e){return function(t){return e.first_event_map[t.ns_id]}}(this)).min())),this.date_picker.calendar.selected_date<this.date_picker.calendar.options.first_day&&(this.date_picker.calendar.selected_date=Zt.start_of_day(new Date(Number(this.date_picker.calendar.options.first_day)+this.one_day)),this.change_date(this.date_picker.calendar.selected_date)),this.date_picker.calendar.render()},set_url:function(){var e,t,n,i;return n=new Date(this.timestamp-this.one_day),t=this.now-this.timestamp>0,e={},this.ns&&(e.ns=this.ns.ns_id),"all"!==this.role&&(e.role=this.role),t&&(e.date=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()),i=this.deletions_only?"/deleted_files":"/events",v.push_state(i,e)},on_preview_open:function(e){var t;return t=G.get_viewer().get_user_by_id(e.user_id),Se(document).on("db:filepreview:close",this.on_preview_close),
ro.show(e,t),!1},on_preview_close:function(){return Se(document).off("db:filepreview:close",this.on_preview_close),document.title=zt("Recent events - Dropbox")},render:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p,m,v,g,b,y,E,x;if(this.role_has_events[this.role]&&this.update_calendar_first_day(),e=w(this.valid_nss()).map(function(){return function(e){return e.events}}(this)).flatten(),t=this.earliest(),E=w(e).sortBy(function(e){return-e.timestamp}),r=w(E).filter(function(e){return function(n){return n.timestamp>=t&&n.timestamp<e.timestamp/1e3&&(null!==e.ns||!n.is_dup)}}(this)),this.role_has_events[this.role]){for(Se("#event-table").empty(),o=0,_=r.length;_>o;o++)m=r[o],n=Se(m.html),v=w(this.valid_roles()).filter(function(){return function(e){return e.ns_ids.contains(m.ns_id)}}(this)).map(function(){return function(e){return e.name}}(this)).join(" & "),this.deletions_only?n.find("span.role-path").text(v):n.find("span.role-label > span").text(v),Se("#event-table").append(n),null!=m.preview_jsinfo&&(i=m.preview_jsinfo,u=n.find("#prev_link"),u.on("click",this.on_preview_open.bind(this,i)),y=n.find(".inline-button"),y.on("click",this._inline_share_button.bind(this,i)));Se("#events-container").show(),Se("#events-sub-header").show(),Se("#events-sub-header").css("visibility","visible"),Se("#events-empty-state").hide(),Se(".empty-explanation").hide()}else this.request_in_flight||(Se("#events-container").hide(),Se("#events-sub-header").hide(),Se("#events-empty-state").show(),Se(".empty-explanation").show());for(this.request_in_flight?Se("#more-loading").show():(this.awaitingFirstRender&&(this.awaitingFirstRender=!1,rt.WebMiscActivityLogger.log("events-first-load",{time:Number(new Date)-this.now})),Se("#more-loading").hide()),Se("#more-loading").css("marginTop",this.earliest()===Number.MAX_VALUE?"140px":"20px"),d=Se("#namespace-list > li"),a=0,l=d.length;l>a;a++)s=d[a],p=w(this.valid_roles()).map(function(){return function(e){return e.ns_ids}}(this)).flatten().any(function(){return function(e){return e===Se(s).data("value")}}(this)),f=Se(s).data("value")===!1,x=f||p,Se(s).css("display",x?"":"none");return b=Yn.call(function(){var e,t,n,i;for(n=this.valid_roles(),i=[],e=0,t=n.length;t>e;e++)h=n[e],i.push(h.ns_ids.length>1);return i}.call(this),!0)>=0,this.request_in_flight?void 0:(b?(Se("#namespace-list-container").css("visibility","visible"),Se("#namespace-list-container").show()):Se("#namespace-list-container").hide(),g=this.rss_data[null!=(c=this.ns)?c.ns_id:void 0]||this.rss_data[this.role],g&&this.role_has_events[this.role]?(Se("#rss-feed a").attr("data-title",g.title),Se("#rss_url").val(g.url),Se("#reset-rss-link").on("click",function(){return function(){return new Ajax.DBRequest("/reset_rss",{parameters:{ns_id:g.ns_id},onSuccess:function(){return k.success(zt("RSS feed url successfully reset.")),st.redirect("/events")}}),!1}}(this)),Se("#rss_url").focus(),Se("#rss-feed").show(),Se("#rss-feed").css("visibility","visible")):Se("#rss-feed").hide())},show_rss_modal:function(){var e,t;return mi.show(zt("Subscribe to this RSS feed"),Se("#rss-modal")[0]),t=Se("#rss_url").val(),e=We.clipboard_overlay(t,Se("#real_copy"),function(){return k.success(zt("Link copied to clipboard!")),mi.hide()},Se(".modal-buttons")),e.css({zIndex:1001})},_inline_share_button:function(e,t){var n,i;return t.preventDefault(),n="events_table_row",i=rt.ShmodelUILogger.get_target_item(e),rt.ShmodelUILogger.log("single_entry_share",n,i),new Qn(e.user_id,e.fq_path,n).show()}};var Br;Br=ft.DateUtil={fromSecondsSinceEpochUTC:function(e){var t;return t=new Date(1970,0,1),t.setSeconds(e),t},applyTimezoneOffset:function(e,t){var n,i;return n=parseInt(t,10),i=60*(t-n),e.setHours(e.getHours()+n),e.setMinutes(e.getMinutes()+i)},contextualFormat:function(e){var t,n,i,r,o;return i=new Date(Date.now()),r=(i.getTime()-e.getTime())/1e3,t=0,28800>r?ae.ago(e):(this.applyTimezoneOffset(i,O.TIMEZONE_OFFSET),this.applyTimezoneOffset(e,O.TIMEZONE_OFFSET),o=new Date(Date.now()),this.applyTimezoneOffset(o,O.TIMEZONE_OFFSET),o.setDate(o.getDate()-1),e.getYear()===i.getYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()?(n=zt("Today %(time)s"),n.format({time:Br.format(e,O.time_format)})):e.getYear()===o.getYear()&&e.getMonth()===o.getMonth()&&e.getDate()===o.getDate()?(n=zt("Yesterday %(time)s"),n.format({time:Br.format(e,O.time_format)})):Br.format(e,O.datetime_format))},toUTCDate:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},differenceStr:function(e,t){var n,i,r,o,s,a,_;return s=(e.getTime()-t.getTime())/1e3,60>s?Bt("%d sec","%d secs",s).format(s):3600>s?(r=parseInt(s/60,10),Bt("%d min","%d mins",r).format(r)):86400>s?(i=parseInt(s/3600,10),Bt("%d hour","%d hours",i).format(i)):2592e3>s?(n=parseInt(s/86400,10),Bt("%d day","%d days",n).format(n)):4838400>s?(a=parseInt(s/604800,10),Bt("%d week","%d weeks",a).format(a)):31536e3>s?(o=parseInt(s/2592e3,10),Bt("%d month","%d months",o).format(o)):(_=parseInt(s/31536e3,10),Bt("%d year","%d years",_).format(_))},localize:function(e){return wt(null!=O.date_format,"Date format missing."),Br.format(e,O.date_format)},format:function(e,t){var n;return wt("string"==typeof t,"Date format requires a format string"),n={yy:function(){return function(){return e.getFullYear().toString().substring(2)}}(this),yyyy:function(){return function(){return e.getFullYear().toString()}}(this),M:function(){return function(){return(e.getMonth()+1).toString()}}(this),MM:function(){return function(){return(e.getMonth()+1).toString().lpad(2)}}(this),d:function(){return function(){return e.getDate().toString()}}(this),dd:function(){return function(){return e.getDate().toString().lpad(2)}}(this),h:function(){return function(){return(e.getHours()%12||12).toString()}}(this),H:function(){return function(){return e.getHours().toString()}}(this),HH:function(){return function(){return e.getHours().toString().lpad(2)}}(this),m:function(){return function(){return e.getMinutes().toString()}}(this),mm:function(){return function(){return e.getMinutes().toString().lpad(2)}}(this),a:function(){return function(){return e.getHours()>11?zt("PM",{comment:"PM as in evening"}):zt("AM",{comment:"AM as in morning"})}}(this)},t.replace(/([a-zA-Z]+)/g,function(e){return null!=n[e]?n[e]():e})}};var zr;zr=INLINE_JS.Timezone=ft.Timezone={check_timezone:function(){var e;if(G.get_viewer().is_signed_in)return e=zr.get_current_timezone(),null==O.auto_timezone_offset||O.auto_timezone_offset!==e?zr.update(e):void 0},get_current_timezone:function(){var e,t,n,i;return t=new Date,t.setSeconds(0),t.setMilliseconds(0),i=t.toGMTString(),e=new Date(i.substring(0,i.lastIndexOf(" "))),n=(t-e)/36e5},update:function(e){return wt("number"==typeof e,"Timezone offset was not a number: "+e),new Ajax.DBRequest("/set_timezone",{parameters:{offset:e},noAutonotify:!0})},update_timezones_dropdown:function(e,t){var n,i;return null==t&&(t=null),i=zr.timezones_by_country[e],Se("#timezone_id").empty(),Se("#timezone_id").append(function(){var e,r,o;for(o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(Se('<option value="'+n.id+'">'+n.name+"</option>").prop("selected",n.id===t));return o}())},auto:function(){var e;return e=$F("timezone_auto"),e?Se("#tz").hide():(zr.default_country&&(Se("#timezone_country").val(zr.default_country),zr.update_timezones_dropdown(zr.default_country)),Se("#tz").show())},load_data:function(e,t){return zr.timezones_by_country=e,zr.default_country=t}};var Hr,Vr;Vr=ft.CreateApp={init:function(e,t){var n,i,r;return this.accepted_tos_by_uid=e,this.form=n=Se("#create-app-form"),this.email_verification=null,G.get_viewer().is_paired||(r=G.get_viewer().get_users()[0],this.select_user(r.id)),i=function(){return function(e){var t;return t=e.target.name,n.find("input[name="+t+"]").each(function(){return Se(this).parents("label").removeClass("active"),n.removeClass(Se(this).data("next"))})}}(this),n.find("input[type=radio]").change(function(e){return i(e),Se(e.target).parents("label").addClass("active"),n.addClass(Se(this).data("next"))}),n.find("input[type=checkbox]").change(function(e){var t;Se(this).filter("#accept-tos").length||(Se(e.target).parents("label").toggleClass("active"),t=n.find("input[name="+Se(this).attr("name")+"]:checked"),n.toggleClass(Se(this).data("next"),0!==t.length))}),n.find(".role-choice input").change(function(e){return function(t){var r,o;return r=n.find(".role-choice input:checked"),o=r.val(),G.get_viewer().is_uid_signed_in(o)?e.select_user(o):(r.prop("checked",!1),i(t),se.show_modal({user_id:o,on_success:function(){return r.prop("checked",!0).trigger("change")}}),!1)}}(this)),n.find("input:checked").trigger("change"),n.find("input[name=tos_accept]").change(function(e){return function(){return e.update_submit_enabled()}}(this)),n.find("#send-verify-email, #resend-verify-email").click(function(e){return function(){return e.email_verification.send_email(t,function(){return n.addClass("verify-email-sent"),e.email_verification.flash_email_sent_notification(),e.email_verification.ensure_polling(function(){return e.email_verification.user.is_email_verified?(n.addClass("email-verified"),n.removeClass("verifiy-email-sent"),n.removeClass("email-unverified"),e.update_submit_enabled()):void 0})}),!1}}(this)),n.submit(function(e){return n=Se(e.target),ui.ajax_submit(n[0],!1,function(e){return window.location.href=e.responseText}),!1})},select_user:function(e){return this.email_verification=At.get_for_user(G.get_viewer().get_user_by_id(e)),this.form.find("#accept-tos-wrapper").toggle(!this.accepted_tos_by_uid[e]),this.form.find("input[name=tos_accept]").prop("checked",!1),this.form.removeClass("verify-email-sent"),this.form.find("#verify-email-wrapper").toggle(!this.email_verification.user.is_email_verified),this.form.toggleClass("email-verified",this.email_verification.user.is_email_verified),this.update_submit_enabled()},update_submit_enabled:function(){var e,t;return t=this.email_verification.user,e=this.accepted_tos_by_uid[t.id]||this.form.find("input[name=tos_accept]").prop("checked"),this.form.find("#create-button").prop("disabled",!e)}},Hr=INLINE_JS.Apps=ft.Apps={init_apps:function(){return Se("#show-disabled-apps").click(function(){return Se(this).parent().hide(),Se("#disabled-apps").show(),!1})},init_app_info:function(e,t,n){return this.user_email=n,Se("#app-info .icon-container").each(function(e,t){var n;return n=Se(t),n.append(Dropbox.createChooseButton({success:function(e){return n.find(".icon").attr("src",e[0].thumbnailLink),n.find("input[type=hidden]").val(e[0].link)},linkType:"direct",extensions:["images"]}))}),this._hoverable_tmpl=lt.tmpl("hoverable_tmpl"),this._webhook_info_row_tmpl=lt.tmpl("webhook_info_row_tmpl"),Se("#domain-list").on("click",".img-container",function(t){Hr.remove_domain(t.currentTarget.parentNode,e)}),Se("#oauth-uri-list").on("click",".img-container",function(t){Hr.remove_oauth_uri(t.currentTarget.parentNode,e)}),Se("#webhook-list").on("click",".img-container",function(t){Hr.remove_webhook(t.currentTarget.parentNode,e)}),Se("#webhook-list").on("click",".webhook-actions.enabled .webhook_disable",function(t){Hr.update_webhook_url(t.currentTarget,e,!1)}),Se("#webhook-list").on("click",".webhook-actions.disabled .webhook_enable",function(t){Hr.update_webhook_url(t.currentTarget,e,!0)}),Se("#delete-app-button").on("click",function(){Hr.confirm_disable(t,e,0)}),Se("#webhook_url").on("click change paste focus",function(){Se("#webhook-form").removeClass("error")}),Se(".modal-buttons .freshbutton-blue.modal-okay").on("click",function(){return INLINE_JS.Modal.hide()}),this.init_app_info_add_redirect_uri(),Se("#oauth2-allow-implicit-grant").on("change",function(t){return Hr.set_oauth2_allow_implicit_grant(t.currentTarget,e)})},init_app_info_add_redirect_uri:function(){var e,t,n,i;t=/^\#?add_redirect_uri=(.*)$/.exec(window.location.hash||""),t&&(i=window.decodeURIComponent(t[1]),e=Se("#oauth-add-uri-form"),Se("input[name=oauth_uri]",e).val(i),n=Se("#add-redirect-uri-modal")[0],Se("#add-redirect-uri-modal-uri").text(i),mi.show(zt("Add OAuth redirect URI"),n,{doit:function(){var e;return window.history&&window.history.replaceState?(e=window.location.href,e=e.substring(0,e.indexOf("#")),window.history.replaceState({},document.title,e)):window.location.hash="",mi.hide(),Hr.submit_new_oauth_uri(Se("#oauth-add-uri-form")[0])}}))},init_app_datastores_browse:function(e){return this.ds_info=e,G.get_viewer().is_paired?(this.role_picker=Q.get_controller(Se("#role-selector")),this.role_picker.on_state_change=this.app_datastores_browse_render.bind(this),se.set_during_login_callback(function(e){return function(t,n){return e.app_datastores_browse_reload_info(function(){return n()},function(){return n("Error displaying datastores"),window.location.reload()})}}(this))):void 0},app_datastores_browse_reload_info:function(e,t){return Se.ajax({url:"/developers/apps/datastores/info",success:function(t){return function(n){return t.ds_info=n,t.app_datastores_browse_render(),"function"==typeof e?e():void 0}}(this),error:function(){return function(e){return"function"==typeof t?t(e):void 0}}(this)}),!1},app_datastores_browse_render:function(){return this.app_datastores_browse_render_id("#apps_developed_container"),this.app_datastores_browse_render_id("#apps_used_container"),this.app_datastores_browse_render_empty()},app_datastores_browse_render_empty:function(){var e,t,n,i;if(t=Se("#no_apps_container").empty(),0===Se("#apps_developed_container").children().length&&0===Se("#apps_used_container").children().length)switch(e=Se("<div class='empty-state'></div>").appendTo(t),null!=(n=this.role_picker)?n.get_state():void 0){case $t.PERSONAL:case $t.WORK:return i=G.get_viewer().get_user_by_role(this.role_picker.get_state()),e.append("You don't have any datastores in your "+G.get_role_title(i)+" Dropbox.");default:return e.append("You don't have any datastores in your Dropbox.")}},app_datastores_browse_render_id:function(e){var t,n,i,r,o,s,a;for(r=this.app_datastores_browse_get_id_info(e),n=Se(e),n.empty(),t="",o=0,s=r.length;s>o;o++)i=r[o],this.app_datastores_should_render(i.uid)&&(t+=i.html);return t?(n.append(this.app_datastores_browse_get_id_header(e)),a=Se("<div class='app-list clearfix'/>").appendTo(n),a.html(t)):void 0},app_datastores_should_render:function(e){var t;return null!=this.role_picker?(t=G.get_viewer().get_user_by_id(e),this.role_picker.is_role_visible(t.role)):!0},app_datastores_browse_get_id_info:function(e){switch(e){case"#apps_developed_container":return this.ds_info.apps_developed;case"#apps_used_container":return this.ds_info.apps_used;default:return wt(!1,"invalid ds group id")}},app_datastores_browse_get_id_header:function(e){switch(e){case"#apps_developed_container":return Se("<h2>Apps you develop</h2>");case"#apps_used_container":return Se("<h2>Apps you use</h2>");default:return wt(!1,"invalid ds group id")}},confirm_disable:function(e,t,n){var i,r;return i=zt(n?"Are you sure you want to disable '%(app_name)s'?":"Are you sure you want to delete '%(app_name)s'?"),tn.fillVal(i.format({app_name:e.escapeHTML()}),"app-disable-text"),mi.show(zt(n?"Confirm disable":"Confirm delete"),$("app-disable-modal")),r="/developers/disable_app/"+t,$("app-disable-modal").down("form").action=r,$("disable-app-button").setValue(zt(n?"Disable":"Delete"))},enable_app:function(e){var t;return t="/developers/enable_app/"+e,Se("#status-button-form").attr("action",t).submit()},show_uninstall:function(e,t,n,i,r,o){var s;if(e&&Event.stop(e),mi.vars={app_id:n,user_id:o},s=Se("#delete-"+i+"-app-confirm"),"sandbox"===i){if(!r)return void Hr.do_uninstall();Se(".app_folder",s).text(r)}return Se(".app_name",s).text(t),mi.show(zt("Remove %(app_name)s?").format({app_name:_.em_snippet(t,22)}),s[0],mi.vars),null},do_uninstall:function(){var e;return e=mi.vars.user_id,new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:mi.vars.app_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(t){var n;return k.success(t.responseText),n=Se(".apps-"+e),Se("#inst-app-"+mi.vars.app_id+"-row",n).hide().removeClass("active_app"),0===Se(".active_app",n).length&&n.hide(),0===Se(".active_app").length?(Se("#empty-explanation").text(zt("You have no apps linked to your Dropbox.")),Se("#applications-explanation",n).remove()):void 0},subject_user:e}),mi.hide()},enable_users_in_dev:function(e,t){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+e,{onSuccess:function(){return mi.show(zt("Limit raised to %d users").format(t),$("increased-dev-user-limit-modal")),Se("#users-in-dev-none, #users-in-dev-some").hide(),Se("#users-in-dev-max").show()}}),!1},unlink_all_users_in_dev:function(e){return mi.show(zt("Unlink all users"),$("confirm-unlink-all-users"),{doit:function(){return new Ajax.DBRequest("/developers/unlink_all_users/"+e,{onSuccess:function(){return Se("#current-app-users-1, #current-app-users-2").text("0"),mi.hide()}})}}),!1},unlink_all_teams_in_dev:function(e){return mi.show(zt("Unlink all teams"),$("confirm-unlink-all-teams"),{doit:function(){return Se.ajax({url:"/developers/unlink_all_teams/"+e,type:"POST",success:function(){return Se("#current-app-teams").text("0"),mi.hide()}})}}),!1},restore_sandbox:function(e,t,n){var i,r,o;return i=Se("#restore-sandbox")[0],mi.show(zt("Restore app folder '%(filename)s'").format({filename:_.em_snippet(_t.filename(t),17)}),i),o=Se("#restore-sandbox-form")[0],r={ns_id:n},r[O.UID_PARAM_NAME]=e.id,ui.add_vars(o,r)},submit_restore_sandbox:function(e){var t;return t=$("restore-sandbox-form"),ui.ajax_submit(t,!1,function(e){return mi.hide(),k.success(zt("Restored app folder")),e.responseText.length?Ir.reload_fqpath(e.responseText):Ir.reload("","",!0)},!1,e.target),!1},submit_app_info:function(e){var t;return t=Se(e).find("input[name=name]").val(),ui.clear_errors(e),ui.ajax_submit(e,!1,function(){return k.success("App info updated."),t?Se("#app-info h1").text(t):void 0})},submit_folder_name:function(e){var t;return t=Se(e).find("input[name=folder]").val(),ui.clear_errors(e),ui.ajax_submit(e,!1,function(){return k.success("App folder name updated."),Se("#folder-name .text").text(t),Hr.hide_folder_input()})},submit_new_webhook:function(e){var t,n,i,r,s,a,_,l,u,d,c,h;return n=Se(e),s=Se("#webhook-list"),r=Se("<img>").attr("src","/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif").css("vertical-align","middle"),i=n.find("input[name=webhook_url]"),c=function(e,t){return t&&t.remove(),0===s.find(".hoverable-url").length&&s.addClass("hide-status"),Se("#webhook-form-error").text(e),Se("#webhook-form").addClass("error")},_=i.val(),""===_?void c("Empty URI"):(l=o.parse(_),"http"!==(u=l.scheme)&&"https"!==u?void c("URI scheme must be http or https"):l.authority?"localhost"===(d=l.authority)||"127.0.0.1"===d||0===l.authority.indexOf("[::1]")?void c("Webhooks doesn't support localhost as Dropbox can't contact your local server. Please use an internet accessible URI."):s.find("tbody").length>=f.MAX_WEBHOOKS_PER_APP?void c("You can register a maximum of %d webhook URIs per app.".format(f.MAX_WEBHOOKS_PER_APP)):(t=Se(this._webhook_info_row_tmpl({url:_,status:"Verifying"}).toHTML()),t.find(".status").append(r),t.find(".webhook-actions").removeClass("disabled").addClass("enabled"),s.append(t),s.removeClass("hide-status"),Se("#webhook-form").removeClass("error"),a=ui.collect_form_vars(e),i.val(""),h=(new Date).getTime(),Se.ajax({url:"/developers/apps/update/add_webhook",type:"POST",dataType:"json",data:a,success:function(e){var n,r;return"invalid"===e.status?(c(e.failure_text,t),i.val(_)):(r=(new Date).getTime()-h,n=Math.max(0,1e3-r),setTimeout(function(){return"ok"===e.status?t.find(".status").text("Enabled"):"error"===e.status?(t.find("textarea").text(e.failure_text),t.find(".status").text(e.status_text).addClass("error"),t.find(".timestamp").text("Just now"),t.find(".webhook-failure-info").css("display","")):void 0},n))},error:function(){return k.error("Unable to complete your request."),t.remove(),i.val(_)}})):void c("Improperly formatted URI (typo maybe?)"))},remove_webhook:function(e,t){var n,i;return Se("#webhook-form").removeClass("error"),i=Se(e).find(".value").text(),n=Se("<img>").attr("src","/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif").css("vertical-align","middle"),Se(e).find(".status").text("Removing").removeClass("error").append(n),Se.ajax({url:"/developers/apps/update/remove_webhook",type:"POST",data:{app_id:t,webhook_url:i},dataType:"json",success:function(){var t,n;return t=e.parentNode,n=t.parentNode,n.removeChild(t),0===n.getElementsByClassName("hoverable-url").length&&Se(n).addClass("hide-status"),Se("#webhook_url").val()?void 0:Se("#webhook_url").val(i)},error:function(){return k.error("Unable to complete your request.")}})},update_webhook_url:function(e,t,n){var i,r,o,s,a;return a=Se(e.parentNode.parentNode).find(".value").text(),Se("#webhook-form").removeClass("error"),o=e.parentNode.parentNode.parentNode,i=Se("<img>").attr("src","/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif").css("vertical-align","middle"),r=Se(o).find(".status").text(),n="Disabled"===r,s=n?"Enabling":"Disabling",Se(o).find(".status").text(s).removeClass("error").append(i),Se.ajax({url:"/developers/apps/update/update_webhook_url",type:"POST",data:{app_id:t,webhook_url:a,enable:n},dataType:"json",success:function(){var e;return r=Se(o).find(".status").text(),e="Disabling"===r?"Disabled":"Enabled",Se(o).find(".status").text(e).removeClass("error").removeClass("img"),"Disabling"===r?Se(o).find(".webhook-actions").removeClass("enabled").addClass("disabled"):Se(o).find(".webhook-actions").removeClass("disabled").addClass("enabled")},error:function(){return k.error("Unable to complete your request.")}})},set_oauth2_allow_implicit_grant:function(e,t){return Se.ajax({url:"/developers/apps/update/oauth2_allow_implicit_grant",type:"POST",data:{app_id:t,allow:Se(e).val()},dataType:"json",success:function(){return k.success("OAuth 2 allow implicit grant updated.")},error:function(){return k.error("Error updating OAuth 2 allow implicit grant.")}})},submit_new_oauth_uri:function(e){var t;return t=Se(e).find("input[name=oauth_uri]").val(),ui.clear_errors(e),ui.ajax_submit(e,!1,function(){return k.success("OAuth URI added."),Hr.add_oauth_uri(t),Se(e).find("input[name=oauth_uri]").val("")})},add_oauth_uri:function(e){var t;return t=Se("#oauth-uri-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_oauth_uri:function(e,t){var n,i;return i=Se(e).find(".value").text(),n=function(){var t;return k.success("OAuth URI removed."),t=e.parentNode,t.removeChild(e),0===t.getElementsByTagName("div").length?t.hide():void 0},Se.ajax({url:"/developers/apps/update/remove_oauth_uri",type:"POST",data:{app_id:t,oauth_uri:i},dataType:"json",success:n,error:function(){return k.error("Unable to complete your request.")}})},submit_new_domain:function(e){var t;return t=Se(e).find("input[name=domain_name]").val(),ui.clear_errors(e),ui.ajax_submit(e,!1,function(){return k.success("Domain added."),Hr.add_domain(t),Se(e).find("input[name=domain_name]").val("")})},add_domain:function(e){var t;return t=Se("#domain-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_domain:function(e,t){var n,i;return i=Se(e).find(".value").text(),n=function(){var t;return k.success("Domain removed."),t=e.parentNode,t.removeChild(e),0===t.getElementsByTagName("div").length?t.hide():void 0},Se.ajax({url:"/developers/apps/update/remove_domain",type:"POST",data:{app_id:t,domain_name:i},dataType:"json",success:n,error:function(){return k.error("Unable to complete your request.")}})},show_need_users_modal:function(){return mi.show(zt("Please test this app",{comment:"Error message"}),$("app-need-users-modal")),!1},show_need_teams_modal:function(){return mi.show(zt("Please test this app",{comment:"Error message"}),$("app-need-teams-modal"))},show_name_branding_modal:function(){return mi.show(zt("Please rename this app",{comment:"Error message"}),$("app-name-branding-modal")),!1},show_need_icon_modal:function(){return mi.show(zt("Please add an icon for this app",{comment:"Error message"}),$("app-need-icon-modal")),!1},check_for_nongenerated_oauth_tokens:function(e){var t;return t="/developers/prod_request/"+e,new Ajax.DBRequest("/developers/has_nongenerated_oauth_tokens/"+e,{onSuccess:function(e){return"true"===e.responseText?st.redirect(t):mi.show(zt("Please auth at least one user with the OAuth flow",{comment:"Error message"}),$("app-need-nongenerated-token"))},onFailure:function(){return st.redirect(t)}}),!1},hide_folder_input:function(){return Se("#folder-name").show(),Se("#folder-input").hide()},show_folder_input:function(){return Se("#folder-name").hide(),Se("#folder-input").show(),Se("#folder-input input[name=folder]").focus()}};var Yr,Wr;Wr=INLINE_JS.twitter_auth_complete=function(e){return wt(null!=e,"user_id must be provided"),Yr.onLoginSuccessCallback?Yr.onLoginSuccessCallback(e):window.location.reload(),!1},Yr=ft.Twitter={is_authed:function(e){return e=parseInt(e),null==Yr._authed_users&&(Yr._authed_users={}),Yr._authed_users[e]},set_is_authed:function(e,t){return e=parseInt(e),null==Yr._authed_users&&(Yr._authed_users={}),Yr._authed_users[e]=t},get_progress_container:function(){var e;return wt(Yr.progress_container,"Twitter is missing progress_container"),e=$(Yr.progress_container),wt(e,"Missing progress_container elm"),e},follow_dropbox:function(e,t){var n;return wt(null!=t,"user_id must be provided"),e.showWorking&&e.showWorking(),n=function(){return e.onFailure?e.onFailure():window.location.reload()},new Ajax.DBRequest("/twitter/follow_us",{onSuccess:function(t){return t.responseText.startsWith("ok")?e.onSuccess?e.onSuccess():void 0:n()},onFailure:function(){return n()},subject_user:t})},do_auth:function(e,t){var n,i;return wt(null!=t,"user_id must be provided"),i=o({path:"/twitter/request_token"}).updateQuery(O.UID_PARAM_NAME,t).toString(),window.open(i,"twitter_auth","width=800,height=400"),n=function(t){return Yr.set_is_authed(t,!0),"function"==typeof e?e(t):void 0},Yr.onLoginSuccessCallback=n},show_auth:function(e){return e&&(Yr.onLoginSuccessCallback=e),tn.updateFromElm(Yr.get_progress_container(),"inline-twitter-auth")},show_posting:function(){return Yr.should_hide_modal()&&mi.hide(),Yr.get_progress_container().update(tn.fromElm("sharing-progress"))},show_complete:function(e){var t;return t=Yr.get_progress_container(),t.update(tn.fromElm("sharing-posted")),Yr.show_complete_into(e,t)},show_complete_into:function(e,t){var n,i,r,o,s;return n="twitter",o=zt("View tweet"),s=void 0,s=e.startsWith("ok")?"http://www.twitter.com/":e,i=t.down("#view-post"),i.href=s,i.update(o),r=ee.make("web",n),i.__sert({top:r})},post:function(e,t,n,i){var r,o;return wt(null!=i,"user_id must be provided"),wt(e,"Twitter message is empty"),r={message:e,from_referrals:Yr.from_referrals,from_getspace:Yr.from_getspace},new Ajax.DBRequest("/twitter_post",{parameters:r,onSuccess:function(t){var n,r;return"login"===t.responseText?(Yr.onLoginSuccessCallback=function(){return Yr.post(e,null,null,i)},(n=Yr.custom_show_auth||Yr.show_auth)()):(Yr.should_hide_modal()&&mi.hide(),(r=Yr.onPostSuccessCallback||Yr.show_complete)(t.responseText))},subject_user:i}),(o=Yr.custom_show_posting||Yr.show_posting)()},custom_post:function(e,t,n){return wt(null!=n,"user_id must be provided"),t&&(Yr.onPostSuccessCallback=t),e?(wt(e,"Twitter message doesn't exist"),G.get_viewer().is_signed_in?Yr.post(e,null,null,n):window.open("http://www.twitter.com/home?status="+encodeURI(e))):void 0},get_user_info:function(e,t){return wt(null!=t,"user_id must be provided"),new Ajax.DBRequest("/twitter/user_info",{noAutonotify:1,parameters:{},onSuccess:function(t){return e(JSON.parse(t.responseText))},subject_user:t})},should_hide_modal:function(){return"undefined"==typeof Yr.hide_modal?!0:Yr.hide_modal}};var Kr,Jr,Gr,Sn=function(e,t){function n(){this.constructor=e}for(var i in t)Cn.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Cn={}.hasOwnProperty,Tn=function(e,t){return function(){return e.apply(t,arguments)}};Kr=ft.LightboxPreviewBase=function(){function e(e){this.link_hash=e.link_hash,this.filename=e.filename,this.fq_path=e.fq_path,this.thumbnail_url_tmpl=e.thumbnail_url_tmpl,this.dl_url=e.dl_url,this.ns_id=e.ns_id,this.ns_path=e.ns_path,this.display_time=e.display_time||null,this.more_actions_item_tmpl=lt.tmpl("lightbox_more_actions_item_tmpl")}return e.prototype.shutdown=function(){},e.prototype.preload=function(){},e.prototype.render=function(){},e.prototype.image_size=function(){var e;return e=document.viewport.getDimensions(),Lt(e.width,e.height)},e.prototype.get_more_actions_above_divider=function(){var e,t;return t=[],e=this.more_actions_item_tmpl({_id:"lightbox_download_link",_href:this.dl_url,_ns_id:this.ns_id,_ns_path:this.ns_path,sprite_name:"lightbox_download",item_text:zt("Download"),more_classes:"more-actions-item",Sprite:ee}),t.push(e),t},e.prototype.get_more_actions_below_divider=function(){return[]},e.prototype.is_a_photo_preview=function(){return this instanceof Jr},e.prototype.is_a_video_preview=function(){return this instanceof Gr},e.prototype.get_actions=function(e){var t,n,i,r,s,a,_;return a=[],e.enable_sublinks&&("WHITE_BUTTON"===e.share_button_experiment_variant?(i=Se("#lightbox-share-action-base").clone().attr("id","lightbox-share-button"),s=this.shmodel_link?function(e){return function(){return rt.ShmodelUILogger.log("via-shmodel-lightbox"),window.open(o.parse(e.shmodel_link).updateQuery("m","1"))}}(this):function(e){return function(t){return t.preventDefault(),rt.ShmodelUILogger.log("via-browse-lightbox"),Un.shmodel(e.fq_path,"browse_lightbox")}}(this)):(i=Se("<a />",{id:"lightbox_share_link",class:"title_bubble black"}),i.html(ee.make("web","link_white")),this.is_a_photo_preview()?i.attr("title",zt("Share link to photo")):this.is_a_video_preview()?i.attr("title",zt("Share link to video")):wt(!1,"preview needs to be a photo or video"),this.shmodel_link?(i.attr("href",o.parse(this.shmodel_link).updateQuery("m","1")),i.attr("target","_blank"),s=function(){return function(){return rt.ShmodelUILogger.log("via-shmodel-lightbox")}}(this)):(i.attr("href","#"),s=function(e){return function(t){return t.preventDefault(),rt.ShmodelUILogger.log("via-browse-lightbox"),Un.shmodel(e.fq_path,"browse_lightbox")}}(this))),i.on("click",s),a.push(i[0])),e.include_delete&&(_=zt("Delete"),"WHITE_BUTTON"===e.share_button_experiment_variant?(t=Se("#lightbox-delete-action-base").clone().attr("id","lightbox-delete-link"),t.find(".sprite-text-inner").text(_),t.on("click",function(e){return e.preventDefault(),Qr.delete_current()})):(t=Se("<a />",{id:"lightbox-delete-button",href:"#",class:"title_bubble black",title:_}),t.html(ee.make("web","lightbox_delete_16")),t.on("click",function(e){return e.preventDefault(),Qr.toggle_delete()})),a.push(t[0])),"WHITE_BUTTON"===e.share_button_experiment_variant?(r=function(){return function(e){return e.preventDefault(),Qr.toggle_more_actions_menu()}}(this),n=Se("#lightbox-more-actions-base").clone().attr("id","lightbox-more-actions-button").on("click",r),a.push(n[0])):(wt(null!=Qr.more_actions_button,"Lightbox should have a more_actions_button added on init"),a.push(Qr.more_actions_button)),a},e.prototype.delete_pressed=function(){var e;return e=zt("Deleting..."),document.fire(Qr.PHOTO_DELETE_EVT,this),k.success(e)},e.prototype.set_more_actions_event_handlers=function(){},e.prototype.replace_dl_action_with_open_action_if_file_available=function(){var e,t,n,i;if(null!=__CONDITIONAL_JS__.UnityFeatures)return i=Ir.active_user.id,n=function(e){return function(t,n,i){var r,o;return r=Se("#lightbox_download_link"),r.data("ns-id")===t&&r.data("ns-path")===n?(o=Se(e.more_actions_item_tmpl({_id:"unity_open_action",_href:"#",_ns_id:t,_ns_path:n,sprite_name:"lightbox_open",item_text:zt("Open"),more_classes:"more-actions-item",Sprite:ee}).toHTML()),r.replaceWith(o),
o.on("click",function(){return __CONDITIONAL_JS__.UnityFeatures.open_file(t,n,i,__CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler,function(){return __CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler(!1)})})):void 0}}(this),(null!=(t=__CONDITIONAL_JS__.UnityCheckFileCache)?t.is_cached_and_locally_available(this.ns_id,this.ns_path):void 0)?n(this.ns_id,this.ns_path,i):(e=function(e){return function(t){return t.is_locally_available?n(e.ns_id,e.ns_path,i):void 0}}(this),__CONDITIONAL_JS__.UnityFeatures.check_file(this.ns_id,this.ns_path,i,e))},e}(),Jr=INLINE_JS.PhotoPreview=ft.PhotoPreview=function(e){function t(e){t.__super__.constructor.call(this,e),this.original_url=String(o.parse(e.original_url).updateQuery(O.UID_PARAM_NAME,Ir.active_user)),this.shmodel_link=e.shmodel_link,this.fail_image_src="/static/images/preview_fail-vflc3IDxf.png",this.is_gif()&&(this.thumbnail_url_tmpl=this.original_url),this.loaded=!1,this.enable_download=e.enable_download}return Sn(t,e),t.prototype.show_fail=function(e){var t;return t=Se(e).find(".lightbox_fail_text").text(zt("Unable to preview this item."))},t.prototype.fallback=function(e){var t,n;return t=$(e.target),t.writeAttribute({src:this.fail_image_src,width:128,height:128}),n=t.up("div.content-item"),n?this.show_fail(n):void 0},t.prototype.is_gif=function(){return"gif"===_t.file_extension(this.filename).toLowerCase()},t.prototype.preload=function(e){var t,n,i;return i=o.parse(this.thumbnail_url_tmpl).updateQuery({size:this.image_size()}).toString(),this.is_gif()&&(i=this.thumbnail_url_tmpl),n=function(t){return function(){return"function"==typeof e&&e(),t.loaded=!0}}(this),Zt.preload_image(i,this.fallback.bind(this),n),t=$(Zt.preloaded_images[i]),t.writeAttribute("data-original-href",this.original_url),t.setAttribute("enable-download",this.enable_download),t.writeAttribute("class","thumbnail"),t},t.prototype.render=function(e,t){var n,i,r,o,s;return this.loaded&&t(),i=this.preload(t),s=Se("<div />",{class:"content-item"}).append(i),n=Se("<div />",{class:"lightbox_fail_text"}),s.append(n),r=i.getAttribute("src").length,o=i.getAttribute("src").substring(r-this.fail_image_src.length,r),o===this.fail_image_src&&this.show_fail(s),e.appendChild(s[0]),s[0]},t.prototype.advance_on_click=!0,t.prototype.get_more_actions_above_divider=function(e){var n,i;return i=t.__super__.get_more_actions_above_divider.call(this,e),n=this.more_actions_item_tmpl({_id:"view_original",_href:this.original_url,_target:"_blank",sprite_name:"lightbox_view_original",item_text:zt("View original"),more_classes:"more-actions-item",Sprite:ee}),i.push(n),i},t}(Kr),Gr=ft.VideoPreview=function(e){function t(e){this._player_error=Tn(this._player_error,this),this._player_ready=Tn(this._player_ready,this),t.__super__.constructor.call(this,e),this.preview_url=e.preview_url,this.shmodel_link=e.shmodel_link,this.thumbnail_div=null,this.metadata_link=null!=e.metadata_link?e.metadata_link:void 0,this.metadata=null,this.player=null}return Sn(t,e),t.prototype.render_error=function(e){var t,n,i,r,o;return n=Se("<div/>"),i=Se("<img/>",{src:"/static/images/preview_fail-vflc3IDxf.png",class:"video-preview-fail"}),r=Se("<div/>",{class:"video-preview-fail"}),"needflash"===e?r.html(zt('Install <a href="http://get.adobe.com/flashplayer/">Adobe Flash Player</a> to view this video.')):r.text(zt("Unable to preview this item.",o="web",t="preview means showing the item in the same browser window without downloading a copy.")),n.append(i,r),n[0]},t.prototype._player_ready=function(){var e;return e=function(){return Se(".vjs-poster").show(),Se(".vjs-big-play-button").show(),Se(".vjs-big-play-button").focus()},e.defer()},t.prototype._onPlay=function(){return Se(".vjs-poster").hide(),Se(".vjs-big-play-button").hide()},t.prototype._onEnded=function(){return Se(".vjs-poster").show(),Se(".vjs-big-play-button").show(),Se(".vjs-loading-spinner").hide()},t.prototype._player_error=function(e){return this.shutdown(),this.div=this.render_error(e),Se("#file-preview-modal .content-item").html(this.div)},t.prototype.preload=function(){},t.prototype.render=function(e){return this.div=this.render_video(e),this.div},t.prototype.render_video=function(e){var t,n,i,r,s,a;return a=new Element("div",{class:"video-player content-item"}),s=.8*this.image_size().split("x")[0],r=parseInt(.55*s,10),n=!1,i=o.parse(this.thumbnail_url_tmpl).updateQuery({size:this.image_size()}).toString(),t=function(e){return function(t){return e.metadata=t}}(this),this.player=_e.embed(a,{src:this.preview_url,type:O.transcoder_hls4web?"application/vnd.apple.mpegurl":"video/flv",width:s,height:r,controls:!0,preload:"auto",poster:i,onError:this._player_error,onReady:this._player_ready,metadata:this.metadata,metadata_link:this.metadata_link,metadata_cb:t}),e.appendChild(a),Se(".vjs-poster").hide(),Se(".vjs-big-play-button").hide(),this.player.on("play",this._onPlay),this.player.on("ended",this._onEnded),a},t.prototype.shutdown=function(){var e,t,n;if(Se(".vjs-big-play-button").blur(),this.player){try{this.player.trigger("shutdown"),"Hls"===this.player.techName&&null!=(n=this.player.tech.sourceBuffer)&&n.abort(),this.player.dispose()}catch(t){e=t}return this.player=null}},t}(Kr);var Qr;Qr=INLINE_JS.Lightbox=ft.Lightbox=function(){var e,t,n,i,r,a,_,l,u,d,c,h,f,p,m,g,w,b,y,k,E,x,S,C,T,A,D,O,N,I,L,R,M,F,P,q,U,j,B,z,H,V,Y,W,K,J,G,Q,X,te,ne,ie,re,oe,se,_e,le;return se=[],ie=0,_e=!1,oe=!0,G=void 0,e=/^\d+\-\d+\-\d+\s+\d+\.\d+\.\d+/,le=!1,C=void 0,u=void 0,Y=-1,W=null,f=null,g=!1,F=!1,k=!1,w=null,m=function(e){return e.complete!==!1},H=function(){var e;if(!$$("#file-preview-modal .loading-image").length)return e=new Element("img",{class:"loading-image",src:"/static/images/icons/ajax-loader-black-vflweQQeE.gif"}),$$("#file-preview-modal .preview-content").first().__sert(e)},h=function(){return $$("#file-preview-modal .loading-image").invoke("remove")},I=function(){var e,t,n,i,r,o,s;return t=$$("#file-preview-modal .content-item").first().down("img.thumbnail"),t&&m(t)?(i=$$("#file-preview-modal .preview").first().getDimensions(),e=void 0,t.naturalHeight?e={width:t.naturalWidth,height:t.naturalHeight}:(e=t.getDimensions(),t.naturalHeight=e.height,t.naturalWidth=e.width),n=e.width/i.width,s=e.height/i.height,o=Math.max(n,s),t.style.visibility="",1>o?(t.style.width="",t.style.height=""):(t.style.width=Math.floor(e.width/o)+"px",t.style.height=Math.floor(e.height/o)+"px"),r=Se("#file-preview-modal .paging-block").position().left-16,Se("#file-preview-modal .filename").css("max-width",r)):void 0},l=void 0,E=function(){var e,t,n,i,r,o,s,a;for(t=$("file-preview-modal"),o=t.down(".menu"),n=t.down(".header"),s=$$(".lightbox-not-important"),a=[],i=0,r=s.length;r>i;i++)e=s[i],a.push(e.addClassName("opacity-zero"));return a},V=function(){var e,t,n,i,r;for(l&&clearTimeout(l),i=$$(".lightbox-not-important"),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(e.removeClassName("opacity-zero"));return r},L=function(e){var t;return V(),t=e&&$(e.target).descendantOf("file-preview-menu"),null!=l&&clearTimeout(l),!oe||le||t?void 0:l=setTimeout(E,3112)},J=function(){return null!=l&&clearTimeout(l),oe=!1},K=function(){return oe=!0,L()},p=function(e){var t;return t=se.length,(t+(ie+e)%t)%t},A=function(e){var t,n;if(!C.no_preload)return n=B.bind(null,e),"function"==typeof(t=se[e]).preload?t.preload(n):void 0},D=function(){var e,t,n,i,r;for(i=[1,2,3,4,5,6,-1,-2],r=[],e=0,t=i.length;t>e;e++)n=i[e],r.push(Math.abs(n)<se.length?A(p(n)):void 0);return r},M=function(e){return C.filename_in_url?(null!=e?on.replace_hash("lh",e):on.replace_hash(""),w=e):void 0},N=function(){var e,t;return e=Se("#file-preview-modal"),t=(null!=C?C.num_previews:void 0)||se.length,e.find(".lightbox-index-text-container").text(g&&F&&k?zt("Could not load folder",{comment:"Error shown when a folder fails to load"}):g?F?zt("Loading...",{comment:"Shown while waiting for photos/videos to load"}):"":zt("%(cur_file_num)s of %(num_total_files)s",{comment:"Indicating which we're viewing, like '3 of 10'"}).format({cur_file_num:ie+1,num_total_files:t})),1===se.length?(e.find(".prev").addClass("opacity-zero"),e.find(".next").addClass("opacity-zero")):0===ie&&C.no_wrap?(e.find(".prev").addClass("opacity-zero"),e.find(".next").removeClass("opacity-zero")):ie===se.length-1&&C.no_wrap?(e.find(".prev").removeClass("opacity-zero"),e.find(".next").addClass("opacity-zero")):(e.find(".prev").removeClass("opacity-zero"),e.find(".next").removeClass("opacity-zero"))},r=function(e,t,n,i){var r;return r={user_id:null,target:t,platform:Z.FileViewPlatformType.WEB,ns_id:e.ns_id,sjid:null,ns_path:e.ns_path,shared_link_url:n,origin:Z.FileViewOriginType.PHOTOS,action:Z.FileViewActionType.CLICK,extra:{file_ext:i}}},P=function(t,n){var i,o,s,a,_,l,u,d,c,p,v,g,w,b,y,k,E,x,S,T;if(Y=ae.time(),wt(ie<se.length,"Invalid index "+ie),S=se[ie],"object"!=typeof S)return W&&clearTimeout(W),void(W=setTimeout(function(){return null!=Qr.shown&&Qr.shown?P(t,n):void 0},100));for(Se("#file-preview-modal").trigger(Qr.LIGHTBOX_SHOW_EVT,{preview:S}),_=_t.file_extension_for_logging(S.filename),u=Z.FileViewTargetType.PRIVATE,l=null,g="lightbox",null!=S.fq_path?(u=Z.FileViewTargetType.PRIVATE,g="browse_lightbox"):null!=S.shmodel_link&&(u=Z.FileViewTargetType.SHARED_LINK,l=S.shmodel_link,g="shmodel_lightbox"),d=r(S,u,l,_),rt.FileViewLogger.log(d),rt.WebLightboxLogger.log(rt.WebLightboxLogger.VIEW,{context:g,file_ext:_}),b=Se("#file-preview-modal"),T=b.find(".preview-content"),x=t?j:B,T.empty(),a=S.render(T[0],x),b=b[0],f||(f=b.on("contextmenu","img.thumbnail",Or.show_for_lightbox.bind(Or))),M(S.link_hash),N(),b.down(".filename").__date(S.display_time?S.filename.match(e)?S.display_time:S.display_time+" - "+S.filename:S.filename),b.down(".filename").writeAttribute("title",S.filename),k=lt.tmpl("lightbox_more_actions_item_tmpl"),y=S.get_more_actions_above_divider(C),s=S.get_more_actions_below_divider(C),s.length&&(y.push(k({divider:!0,Sprite:ee})),y=y.concat(s)),$("lightbox-more-actions-list").__date(y),S.set_more_actions_event_handlers(C),"True"===Se(b).data("is-unity-allowed")&&null!=__CONDITIONAL_JS__.UnityFeatures&&S.replace_dl_action_with_open_action_if_file_available(),o=S.get_actions(C),c=document.createDocumentFragment(),p=0,v=o.length;v>p;p++)i=o[p],c.appendChild(i);return b.down(".actions").__date(),b.down(".actions").appendChild(c),"WHITE_BUTTON"===C.share_button_experiment_variant&&(E=Se("#lightbox-more-actions-button .sprite-div").width(),Se("#lightbox-more-actions-menu").css("right",E/2)),b.down(".album-name").hide(),b.down(".filename").removeClassName("faded"),a=a.down("img.thumbnail"),a&&(m(a)?(a.show(),I()):(a.hide(),H(),a.observe("load",function(){return h(),a.style.visibility="hidden",a.show(),I()}))),w={preview_obj:S,index:ie,direction:n},document.fire(Qr.PHOTO_CHANGE_EVT,w)},U=function(e){var t,n,i,r,s;if(-1!==Y)return s=ae.time()-Y,t=("undefined"!=typeof Kn&&null!==Kn?Kn.is_album:void 0)?"album_shmodel":"not_photos",n={current_view:t},i=Se("#file-preview-modal .content-item img.thumbnail")[0],null!=i&&null!=i.src&&(r=o.parse(i.src).getQuery(),"size"in r&&(n.size=r.size)),Be.log_ajax_transition(s,e,n),Y=-1,D()},j=function(){return U("file-preview-lightbox-load-initial")},B=function(e){var t;return"number"!=typeof e?U("file-preview-lightbox-load"):(null!=(t=se[e])&&(t.loaded=!0),e===ie?U("file-preview-lightbox-load"):void 0)},q=function(e){var t;return t=Se("#lightbox-click-catcher"),t.length||(t=Se("<div />",{id:"lightbox-click-catcher",style:"position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 2;"}),t.appendTo("#file-preview-modal .modal-preview-content"),st.msie_version_at_most(10)&&(t.css("background","black"),t.fadeTo(0,0))),t.off("click"),t.on("click",function(t){return t.preventDefault(),e()}),t.show()},d=function(){return Se("#lightbox-click-catcher").hide()},i=function(){var e;return e=Se("#lightbox-more-actions-button"),e.hasClass("toggled")?(d(),e.removeClass("toggled"),$("lightbox-more-actions-menu").hide(),Se(document).trigger("dropdownClosed",[1]),K(),!0):!1},S=function(){var e;return e=Se("#lightbox-more-actions-button"),e.hasClass("toggled")?void 0:(c(),e.addClass("toggled"),wi.hide_all(),Se("#lightbox-more-actions-menu").show(),Se(document).trigger("dropdownOpened",[1]),J(),q(Qr.close_more_actions_menu))},X=function(){return Se("#lightbox-more-actions-button").hasClass("toggled")?i():S()},x=function(e){var t;return g&&(F=!0,N()),i(),e&&e.preventDefault(),ie===se.length-1&&C.no_wrap?void 0:(null!=(t=se[ie])&&t.shutdown(),ie=p(1),0===ie&&L(),P(null,Qr.NEXT))},O=function(e){var t;return g&&(F=!0,N()),i(),e&&e.preventDefault(),0===ie&&C.no_wrap?void 0:(null!=(t=se[ie])&&t.shutdown(),ie=p(-1),P(null,Qr.PREV))},n=function(e){return e&&e.preventDefault(),se[ie].advance_on_click?e.clientX<Se(window).width()/10?O():x():void 0},a=function(e){var t,n,i,r,o,s,a;for(t=se.dict_by("fq_path"),r=void 0,r=e.memo.files?e.memo.files.collect(function(e){return e.fq_path}):e.memo.fq_paths,a=[],o=0,s=r.length;s>o;o++)i=r[o],t[i]?(n=se.indexOf(t[i]),se.splice(n,1),C.num_previews&&C.num_previews--,a.push(C.num_previews||se.length?n===se.length?O():P():u())):a.push(void 0);return a},R=function(e){return se[ie].is_a_timeline_preview()?se[ie].toggle_select(e):void 0},te=function(){return Event.stopObserving(document,"mousemove",L),Event.stopObserving(document,"click",L),document.stopObserving(Qr.PHOTO_DELETE_EVT,T),document.stopObserving(s.DELETE,a),clearInterval(G)},u=function(e){var t,n,i,r;return e&&e.preventDefault(),Qr.shown?(null!=(n=se[ie])&&n.shutdown(),t=$("file-preview-modal"),t.hide(),t.down(".preview-content").__date(),je.scroll_unlock_document(),te(),M(),Qr.shown=0,t.stopObserving("click",Qr.back),null!=(i=$$(".preview-content"))&&null!=(r=i.first())&&r.stopObserving("click"),Se("#file-preview-modal").trigger(Qr.LIGHTBOX_HIDE_EVT)):void 0},re="db:filepreview:exitselect",t=function(e){var t;return C.keep_url?u():(null!=(t=se[ie])&&t.shutdown(),window.history.go(-1)),null!=e&&(e.originalEvent&&(e=e.originalEvent),Event.extend(e).stop()),document.fire(re,se[ie])},T=function(e){return li.do_delete(Ir.active_user,e.memo.fq_path)},y=function(){var e;return _e||(e=Se("#file-preview-modal"),e.on("click",".close",t),key("esc",Qr.KEY_SCOPE,function(e){return Se("#lightbox-more-actions-button").hasClass("toggled")?i():le?c():t(e)}),e.on("click",".next",x),e.on("click",".prev",O),e.on("click",".preview-container",n),key("left, k",Qr.KEY_SCOPE,function(){return O()}),key("right, j",Qr.KEY_SCOPE,function(){return x(),!1}),key("up, down",Qr.KEY_SCOPE,function(){return!1}),key("x, s, space",Qr.KEY_SCOPE,function(e){return R(e),!1}),C.include_delete&&"WHITE_BUTTON"!==C.share_button_experiment_variant&&(key("delete, command+backspace, backspace",Qr.KEY_SCOPE,function(e){return Event.extend(e).preventDefault(),Qr.toggle_delete()}),Se("#lightbox-delete-photo").on("click",function(){return Q(),se[ie].delete_pressed()}),Se("#lightbox-delete-cancel").on("click",c)),v.add_exit_callback("/lightbox",function(){return u()}),Zt.disableSelection(e.find(".preview-container")[0]),Zt.disableSelection(e.find(".header")[0]),_e=!0),Event.observe(document,"mousemove",L),Event.observe(document,"click",L),document.observe(s.DELETE,a),document.observe(Qr.PHOTO_DELETE_EVT,T),key.setScope(Qr.KEY_SCOPE),G=setInterval(I,500)},b=function(){var e,t,n,i,r;if(w){for(r=[],e=t=0,n=se.length;n>t;e=++t)i=se[e],i.link_hash&&i.link_hash.toLowerCase()===w.toLowerCase()?(ie=e,r.push(Qr.shown?P():Qr.show())):r.push(void 0);return r}},ne=function(){return on_script_loaded(function(){return on.watch("lh",function(e){return w=e,b()}),on.watch("f",function(e){var t,n,i,r,o;for(o=[],t=n=0,i=se.length;i>n;t=++n)r=se[t],r.filename.toLowerCase()===e.toLowerCase()?(ie=t,o.push(Qr.shown?P():Qr.show())):o.push(void 0);return o})})},z=function(){return wi.hide_all(),Se("#file-preview-modal .delete-file-prompt").show(),Se(document).trigger("dropdownOpened",[1]),V(),le=!0,q(Qr.toggle_delete),Se("#lightbox-delete-photo").focus()},c=function(){var e,t;return le?(e=Se("#file-preview-modal .delete-file-prompt"),e.hide(),Se(document).trigger("dropdownClosed",[1]),null!=(t=e.find(":focus")[0])&&t.blur(),L(),le=!1,d()):void 0},Q=function(){return i(),le?c():z()},_=function(){return se[ie].delete_pressed()},{init_from_preview_objs:function(e,t,n){var i,r,o,s,a;for(null==n&&(n=!0),a=[],r=0,o=e.length;o>r;r++)i=e[r],s=i.is_video?new Gr({filename:i.filename,fq_path:i.path,thumbnail_url_tmpl:i.thumbnail_url,preview_url:i.preview_url,dl_url:i.dl_url,shmodel_link:i.shmodel_link,ns_id:i.ns_id,ns_path:i.path,link_hash:i.item_id+"-"+i.filename,metadata_link:i.metadata_link}):new Jr({filename:i.filename,fq_path:i.path,thumbnail_url_tmpl:i.thumbnail_url,dl_url:i.dl_url,original_url:i.orig_url,shmodel_link:i.shmodel_link,ns_id:i.ns_id,ns_path:i.ns_path,link_hash:i.item_id+"-"+i.filename,enable_download:i.enable_download}),a.push(s);return Qr.init(a,{include_delete:!1,keep_url:!0,filename_in_url:!0,enable_sublinks:n}),document.on(Qr.EXIT_SELECT_EVT,function(e){var n;return key.setScope("all"),n=Se(t)[a.indexOf(e.memo)],Zt.scroll_to_thumb(n),Se(n).addClass("wiggobble"),setTimeout(function(){return Se(n).removeClass("wiggobble")},1e3)})},init:function(e,t){return Qr.shown?void 0:(Qr.more_actions_button=new Element("a",{id:"lightbox-more-actions-button",href:"#",class:"lightbox-more-actions-button title_bubble black extra-margin",title:zt("More actions")}),Qr.more_actions_button.observe("click",function(e){return e.preventDefault(),Qr.toggle_more_actions_menu()}),Qr.more_actions_button.__date(ee.make("web","lightbox_more")),t=t||{},C={include_delete:t.include_delete||!1,keep_url:t.keep_url||!1,num_previews:t.num_previews||null,filename_in_url:t.filename_in_url||!1,no_wrap:t.no_wrap||!1||!0,no_preload:t.no_preload||!1,enable_sublinks:null!=t.enable_sublinks?t.enable_sublinks:!0,share_button_experiment_variant:t.share_button_experiment_variant||!1},g=t.is_loading||!1,wt(!C.filename_in_url||C.keep_url,"filename_in_url cannot be used with keep_url off"),se=e,null!=t.start_index&&Qr.show(t.start_index),C.filename_in_url&&ne(),$(document.body).on("click",".more-actions-item",function(e,t){return t.down("a").getAttribute("href").length<2&&e.preventDefault(),Qr.close_more_actions_menu()}))},update_previews:function(e){return se=e},show:function(e){var t,n;if(!Qr.shown)return wt(se&&se.length,"Lightbox.show() requires file preview objects to show"),y(),null!=e&&(ie=e),Se("#file-preview-modal").trigger("lightbox-init-show",{preview:se[ie]}),(null!=(n=se[ie])?n.enable_download:void 0)?Qr.more_actions_button.show():Qr.more_actions_button.hide(),wt(!Qr.shown,"Trying to reshow file preview modal"),$("file-preview-modal").show(),je.scroll_lock_document(),P(!0),Qr.shown=1,C.keep_url||(t=v.deconstruct_url(v.get_url()),0!==t.path.indexOf("/lightbox/")&&v.push_state("/lightbox"+t.path,t.qargs)),L()},jump_to:function(e){return wt(Qr.shown,"Lightbox should be showing"),ie=e,P(),L()},set_no_wrap:function(e){return C.no_wrap=e},update_with_error:function(){return k=!0,N()},num_previews:function(){return C.num_previews||se.length},get_previews:function(){return se},current_index:function(){return ie},close_more_actions_menu:i,toggle_more_actions_menu:X,toggle_delete:Q,delete_current:_,back:t,PHOTO_CHANGE_EVT:"db:lightbox:photo_change",PHOTO_DELETE_EVT:"db:lightbox:photo_delete",PHOTO_REMOVE_FROM_ALBUM_EVT:"db:lightbox:photo_remove_from_album",EXIT_SELECT_EVT:re,NEXT:1,PREV:-1,vid_thumbnail_hidden:null,KEY_SCOPE:"lightbox",LIGHTBOX_HIDE_EVT:"lightbox-hide",LIGHTBOX_SHOW_EVT:"lightbox-preview"}}();var Xr;Xr=ft.Tour=function(){var e,t,n,i,r,o,s,a,_,l,u,d;return t=6,e=0,u=function(e){var n,i,r,o,s,a,_,l,u,d,c;for($$(".page-end").each(Element.remove),_=e,c=t-e-1,n=document.createDocumentFragment(),i=o=0,l=_;l>=0?l>o:o>l;i=l>=0?++o:--o)a=new Element("img",{src:"/static/images/page-left-vflvWgvOr.png",class:"page-end-left page-end"}),a.style.left=28-5*i+"px",a.style.zIndex=t-i,n.appendChild(a);for(r=s=0,u=c;u>=0?u>s:s>u;r=u>=0?++s:--s)d=new Element("img",{src:"/static/images/page-right-vflnAeb-6.png",class:"page-end-right page-end"}),d.style.right=31-5*r+"px",d.style.zIndex=t-r,n.appendChild(d);return $("book").appendChild(n)},d=function(e){return(e>0?Element.show:Element.hide)("tour-page-back"),(t>e+1?Element.show:Element.hide)("tour-page-forward")},_=function(e){return $$(".pages").invoke("hide"),$("page-"+e).show()},n=function(t){return d(t),u(t),_(t),e=t},a=function(t){var i;return Event.extend(t).preventDefault(),i=e-1,0>i?void 0:(n(i),v.push_state("/tour/"+i))},o=function(i){var r;return Event.extend(i).preventDefault(),r=e+1,r>=t?void 0:(n(r),v.push_state("/tour/"+r))},l=function(e,t){var i;return e.preventDefault(),i=parseInt(t.href.split("/").last(),10),n(i),v.push_state("/tour/"+i)},r=function(){return $("tour-page-back").observe("click",a),$("tour-page-forward").observe("click",o),key("right",o),key("left",a),$("toc").on("click","a",l)},i=function(e){var i;return i=parseInt(e,10)||0,(0>i||i>=t)&&(i=0),n(i)},s=function(){var e,t,n,i,r;for(i=$$(".page-right img"),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(Zt.preload_image(e.src));return r},{setup:function(){return Se(function(){return v.add_callback("/tour",i),r(),s()})}}}();var Zr;Zr=__PARENT_SCOPE__.FilePreview=INLINE_JS.FilePreview=ft.FilePreview={PARTIAL_TEXT_LENGTH_THRESHOLD:65536,pdfLink:null,_pdfLoader:new D,_has_marked_time_to_interactive:!1,init_pdf:function(e,t,n,i,r,s){var a,_;return null==s&&(s={}),this.pdfLink=i,this.iframe_src=t,this.presentationMode=r,this._log_pdf_render_time(e),window.addEventListener("message",this._preview_listener,!1),Se(function(e){return function(){var n,i,r,a;return a=o.parse(t),n=Se("#pdf-embed-container"),s=w.defaults(s,{annotationMarkerEnabled:"True"===n.attr("data-docpreview-annotation-marker-enabled"),annotationHighlightEnabled:"True"===n.attr("data-docpreview-annotation-highlight-enabled"),annotationRegionEnabled:"True"===n.attr("data-docpreview-annotation-region-enabled")}),a=s.annotationMarkerEnabled?a.updateQuery("annotation_marker","1"):a.removeQuery("annotation_marker"),a=s.annotationHighlightEnabled?a.updateQuery("annotation_highlight","1"):a.removeQuery("annotation_highlight"),a=s.annotationRegionEnabled?a.updateQuery("annotation_region","1"):a.removeQuery("annotation_region"),r=a.getQuery(),e._pdfLoader.startListening(),e._pdfLoader.openFile(r.file,{presentationMode:e.presentationMode}),delete r.file,a.setQuery(r),i=Se("#pdf-embed-iframe"),i.attr("src",String(a)),i.attr("type","application/pdf"),i.attr("allowfullscreen",""),i.addClass("pdfjs"),Se("html, body").addClass("full_height"),e._fire_pdf_render_event(),n.trigger("previewrendered")}}(this)),this.preview_status=n,st.chrome&&(_=function(){var e;return e=Se('link[rel="shortcut icon"]').remove(),Se("head").append(e)},setTimeout(_,1e3)),a=$$("#pdf-embed-container iframe"),window.setTimeout(function(){return function(){return a.invoke("setStyle",{visibility:"visible"})}}(this),200)},init_excel:function(e){var t;return window.addEventListener("message",this._preview_listener,!1),t=Se("#pdf-embed-iframe"),t.on("load",function(e){return function(){return e._has_marked_time_to_interactive||(e._has_marked_time_to_interactive=!0,Be.mark_time_to_interactive()),Se("#html-container").trigger("previewrendered")}}(this)),t.attr("src",e)},excel_preview_unsupported:function(){return this.preview_failed()},init_font:function(){return Se(function(){return function(){return!$(document.documentElement).hasClassName("fontface")||$(document.body).hasClassName("gecko")?$(document.body).removeClassName("file-preview-body"):void 0}}(this))},init_htmlified:function(){return window.htmlified_height?(this.htmlified_loaded(),void Se("#htmlified-wrapper").trigger("previewrendered")):window.postMessage?setTimeout(function(e){return function(){return window.htmlified_height?void 0:e.preview_failed()}}(this),1e4):void this.preview_failed()},htmlified_loaded:function(){var e;return null!=(e=$("htmlified-loading"))&&e.remove(),$("htmlified").style.visibility="",Be.mark_time_to_interactive()},init_video:function(e,t,n,i,r,o,s){return Se(function(a){return function(){var _,l,u;return u=.9*s.width(),l=.55*u,_=a._video_preview_failed,"hls"===i?a.player=_e.embed("#video",{src:n,type:"application/vnd.apple.mpegurl",width:u,height:l,controls:!0,poster:r,onError:_,onReady:a._player_ready,metadata_link:o}):(Se("#video").empty(),e?t?a.player=_e.embed("#video",{src:n,type:"video/mp4",width:u,height:l,controls:!0,poster:r,onError:_,onReady:a._player_ready,metadata_link:o}):_():a.player=_e.embed("#video",{src:n,type:"video/flv",width:u,height:l,controls:!0,poster:r,onError:_,onReady:a._player_ready,metadata_link:o})),Se(".vjs-poster").hide(),Se(".vjs-big-play-button").hide(),a.player.on("play",a._onPlay),a.player.on("ended",a._onEnded)}}(this))},photo_loaded:function(e){var t,n;return(null!=(t=window.performance)&&null!=(n=t.timing)?n.navigationStart:void 0)?(e-=window.performance.timing.navigationStart,Be.log_ajax_transition(e,"file-preview-photo")):void 0},switch_preview:function(e,t,n,i,r){var s,a,_,l,u,d,c,h;return this.iframe_src?(_=INLINE_JS.URI.parse(this.iframe_src),h=INLINE_JS.URI.parse(_.getQuery().file),c=h.updateQuery({revision_id:e}).toString(),a=o.parse(this.iframe_src).updateQuery({file:c}),d={annotationMarkerEnabled:t,annotationHighlightEnabled:t,annotationRegionEnabled:t},s=Se("#pdf-embed-iframe"),s.on("load",n),this.init_pdf("pdf-js",a.toString(),f.DOC_PREVIEW_AVAILABLE,c,this.presentationMode,d)):(u={thumbnailUrl:i,commentActivity:r},l={action:"switch-preview",parameters:u},window.postMessage(JSON.stringify(l),"*"))},_player_ready:function(){var e;return e=function(){return Se(".vjs-poster").show(),Se(".vjs-big-play-button").show(),Se(".vjs-big-play-button").focus()},e.defer()},_onPlay:function(){return Se(".vjs-poster").hide(),Se(".vjs-big-play-button").hide()},_onEnded:function(){return Se(".vjs-poster").show(),Se(".vjs-big-play-button").show(),Se(".vjs-loading-spinner").hide()},_video_preview_failed:function(e){return"needflash"===e&&Se("#video-preview-flash-message").show(),Zr.preview_failed()},preview_failed:function(){var e;return e=Se(document.body),e.hasClass("shmodel-body")&&e.removeClass("file-preview-body"),k.error(zt("Preview failed.")),Se(document).trigger("preview_failed")},_fire_pdf_render_event:function(){var e;return document.createEvent&&window.dispatchEvent?(e=document.createEvent("UIEvents"),e.initUIEvent("pagerender",!1,!1,window,0),window.dispatchEvent(e)):void 0},_log_pdf_render_time:function(e){var t;return t=function(e){var t,n,i;return(null!=(t=window.performance)&&null!=(n=t.timing)?n.navigationStart:void 0)?(i=ae.time()-window.performance.timing.navigationStart,Be.log_ajax_transition(i,e)):void 0},Event.observe(window,"pagerender",function(){return Event.stopObserving(window,"pagerender"),t(e)}),Event.observe(window,"parsecomplete",function(){return Event.stopObserving(window,"parsecomplete"),t(e+"-parse")})},_preview_listener:function(e){var t,n,i,r,o;if(n={"https://dl.dropbox.com":!0},n["https://"+Ee.DL_DOC_DOMAIN]=!0,n["https://"+Ee.DL_DOC_USER_CONTENT_DOMAIN]=!0,n["https://"+Ee.PUBSERVER]=!0,n["https://"+Ee.WEB_STATIC_DROPBOX_HOST]=!0,n[e.origin]){i={};try{i=JSON.parse(e.data),t=i.action}catch(n){r=n,t=e.data}switch(t){case"pagerendered":if(!this._has_marked_time_to_interactive)return this._has_marked_time_to_interactive=!0,Be.mark_time_to_interactive();break;case"failed":return this._has_marked_time_to_interactive||(this._has_marked_time_to_interactive=!0,Be.mark_time_to_interactive()),Zr.preview_failed()}}}};var eo,to;to=ft.ShmodelLogger={CLICK_SIGN_IN:"click_sign_in",CLICK_ADD_TO_MY_DROPBOX:"click_add_to_my_dropbox",REMOVE_LINK:"remove_link",CLICK_FILENAME:"click_filename",CLICK_DOWNLOAD:"click_download",LOGIN_THRU_DEFAULT_DROPDOWN:"login_thru_default_dropdown",CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN:"click_signup_thru_default_dropdown",CLICK_SHARE:"click_share",log:function(e){return new Ajax.DBRequest("/shmlog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:window.location.href}})},attachLogListener:function(e,t){return null!=t?t.observe("click",function(n){return to.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target?(Event.stop(n),function(){return window.location.href=t.href}.defer()):void 0}):void 0}},eo=ft.RegistrationLogger={log:function(e){var t;return t=window.location.href,new Ajax.DBRequest("/share/reglog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:t}})},attachLogListener:function(e,t){return null!=t?t.observe("click",function(n){return eo.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target?(Event.stop(n),function(){return window.location.href=t.href}.defer()):void 0}):void 0}};var no;no=ft.ModalFlow=function(){function e(e,t,n,i,r,o,s){var a,_,l,u;for(this.title=e,this.icon=t,this.states=n,this.next_state_table=i,this.previous_state_table=r,this.initial=o,this.onStart=s,this._state_map={},l=this.states,a=0,_=l.length;_>a;a++)u=l[a],this._state_map[u.name]=u;this.state=null,this._exit_listeners=[],this._cleanup_queue=[]}return e.prototype.start=function(){var e,t,n,i;for(this.vars={},n=this.states,e=0,t=n.length;t>e;e++)i=n[e],i.next=this._next.bind(this,i),i.back=this._back.bind(this,i),i.onSubmitFn=i.onSubmit?function(e,t){return e.onSubmit(this,e,t),!1}.bind(this,i):function(){return function(e){return e.next(),!1}}(this).bind(this,i),i.contents.on("submit",i.onSubmitFn),i.contents.find(".backbutton").on("click",i.back);return mi.onHide=this._onExit.bind(this),this.onStart&&this.onStart(),this.to_state(this.initial),!1},e.prototype.to_state=function(e){var t;return this.state=this._state_map[e],t=this.title,null!=this.state.title&&(t=this.state.title),mi.show(t,this.state.contents[0]),this.state.enter(this)},e.prototype._next=function(e){var t;return e===this.state?(t=this.next_state_table[this.state.name](this),"__exit__"===t?this.exit():this.to_state(t)):void 0},e.prototype._back=function(e){var t;if(e===this.state){if(t=this.previous_state_table[this.state.name](this),"__cancel__"===t)return this.exit();if(t)return this.to_state(t)}},e.prototype.exit=function(){return this._onExit()},e.prototype._onExit=function(e){var t,n,i,r,o,s,a,_;for(s=this.states,t=0,i=s.length;i>t;t++)_=s[t],_.contents.off("submit",_.onSubmitFn);for(this._cleanUpExitListeners(),a=this._exit_listeners,n=0,r=a.length;r>n;n++)(o=a[n])(e);return mi.onHide=null,mi.hide()},e.prototype.addExitListener=function(e){return this._exit_listeners.push(e)},e.prototype.removeExitListener=function(e){return this._cleanup_queue.push(e)},e.prototype._cleanUpExitListeners=function(){var e,t,n,i,r,o;for(r=this._cleanup_queue,o=[],t=0,i=r.length;i>t;t++)e=r[t],n=this._exit_listeners.indexOf(e),o.push(this._exit_listeners.splice(n,1));return o},e}();var io;io=ft.TwoFactorAuth={_checkpoint_token:null,_email:null,_container_selector:null,_error_selector:null,_is_offline_setup:null,_invalid_code_count:null,_current_flow:null,set_user:function(e){return this._user=G.get_viewer().get_user_by_id(e),wt(this._user,e+" is invalid"),Se("#twofactor-enter-password .email-placeholder").text(this._user.email)},login_init:function(){return this._container_selector="#twofactor-confirm",this._error_selector="#twofactor-confirm .error-message",this.login_listen()},login_listen:function(){return Se("#resend-link").on("click",this.resend_phone_code.bind(this)),Se("#code").focus()},init:function(e,t){return this._container_selector=".twofactor-account-form",this._error_selector=".twofactor-account-form .error-message",this.account_listen(),Zt.async_load_script(e),Zt.async_load_script(t)},account_listen:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,f,p;return n={name:"delivery_choice",enter:function(e){return function(){var t;return e.hide_error(),t=0,Se(".delivery-choice").each(function(){var e;return e=Se(this).height(),t=Math.max(e,t)}),Se(".delivery-choice").height(t),Se(".delivery-choice.selected > input").prop("checked",!0)}}(this),contents:Se("#twofactor-delivery-choice"),
onSubmit:function(e){return function(t,n){return t.vars.sms=!("on"!==Se("#use-sms")[0].getValue()),t.vars.sms?n.next():e.fetch_offline_key(t,n)}}(this)},i={name:"enter_phone_number",enter:function(e){return function(){var t,n;return e.hide_error(),e._is_offline_setup=!1,e._phone_number=null,t=$("twofactor-enter-phone"),n=e.fill_phone_number_for_edit(t,Se("#twofactor-row-"+e._user.role+" #twofactor-sms-number").text()),n.focus()}}(this),contents:Se("#twofactor-enter-phone"),onSubmit:this.submit_phone_number.bind(this)},r={name:"offline_setup",enter:function(e){return function(){return e.hide_error(),e._is_offline_setup=!0,e._phone_number=null}}(this),contents:Se("#twofactor-offline-setup")},t={name:"confirm_phone",enter:function(e){return function(t){var n;return e._invalid_code_count=0,e._is_offline_setup?$("twofactor-enable-confirm").addClassName("offline"):(n=t.vars.phone_number,wt(n,"expected a display_phone argument"),$("phone-number-placeholder").__date(n),$("twofactor-enable-confirm").removeClassName("offline")),e.hide_error(),$("phone-code").clear().focus(),e.fill_delivery_choice(n)}}(this),onSubmit:this.submit_phone_code.bind(this),contents:Se("#twofactor-enable-confirm")},e={name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_none"),contents:Se("#twofactor-enter-backup-phone")},d=new no(this.DEFAULT_ENABLE_TITLE,this.LOCK_ICON,[{name:"enable_start",enter:this.hide_error.bind(this),contents:Se("#twofactor-start")},{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.ENABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_enabled=!1,t.vars.mode="ENABLE",t.vars.passed_password=!0,n.next()}}(this)),contents:Se("#twofactor-enter-password")},n,i,r,t,e,{name:"recovery_code",enter:function(e){return function(){return e.fill_backup_phone(e._backup_phone),e.hide_error.bind(e)}}(this),onSubmit:this.submit_finish.bind(this,!1),contents:Se("#twofactor-recovery")},{name:"congrats_done",enter:this.after_enabled.bind(this),title:zt("Congrats! You've enabled two-step verification!"),contents:Se("#twofactor-done")}],{enable_start:function(){return"password"},password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"recovery_code"},recovery_code:function(){return"congrats_done"},congrats_done:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{enable_start:function(){return null},password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"},recovery_code:function(){return"backup_phone"},congrats_done:function(){return null}},"enable_start",function(){return this.vars.passed_password=!1}),d.addExitListener(function(e){return function(t){return d.vars.passed_password&&t&&!e.successfully_enabled?k.error(zt("Two-step verification isn’t enabled")):void 0}}(this)),u=new no(this.DEFAULT_EDIT_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){var i;return e.successfully_enabled=!1,Se(".delivery-choice").removeClass("selected"),i=!Se("#twofactor-row").hasClass("with-sms"),Se(i?"#app-choice":"#sms-choice").addClass("selected"),Se("#twofactor-recovery").addClass("edit-mode"),t.vars.passed_password=!0,n.next()}}(this)),contents:Se("#twofactor-enter-password")},n,i,r,t,{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_everything"),contents:Se("#twofactor-enter-backup-phone")}],{password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"}},"password",function(){return this.vars.passed_password=!1}),u.addExitListener(function(e){return function(t){return u.vars.passed_password&&t&&!e.successfully_enabled?k.error(zt("Two-step verification has not been changed")):void 0}}(this)),_=new no(this.DEFAULT_DISABLE_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.DISABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_disabled=!1,t.vars.passed_password=!0,n.next()}}(this)),contents:Se("#twofactor-enter-password")},{name:"disable",enter:this.hide_error.bind(this),contents:Se("#twofactor-disable"),onSubmit:this.disable_submit.bind(this)}],{password:function(){return"disable"},disable:function(){return"__exit__"}},{password:function(){return null},disable:function(){return"__cancel__"}},"password",function(){return this.vars.passed_password=!1}),_.addExitListener(function(e){return function(t){return _.vars.passed_password&&t&&!e.successfully_disabled?k.error(zt("Two-step verification is still enabled")):void 0}}(this)),o=new no(this.ADD_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:Se("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!0,"save_backup_phone"),contents:Se("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),l=new no(this.EDIT_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:Se("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_backup_phone"),contents:Se("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),h=new no(this.EDIT_RECOVERY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){return new Ajax.DBRequest(e.RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var i,r;if(r=JSON.parse(t.responseText.trim()),"OK"===r.result)return i=r.codes,e.fill_backup_codes(i,"backup-code-list-edit-container"),n.next();switch(r.result){case"EXPIRED":return e.show_error_expired();case"ALREADY_DISABLED":return Se("#twofactor-row").removeClass("twofactor-enabled"),k.success(zt("Two-step verification is already disabled. Did you maybe disable it in another window?")),mi.hide()}},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),contents:Se("#twofactor-enter-password")},{name:"recovery_code",enter:this.hide_error.bind(this),contents:Se("#twofactor-recovery-edit"),onSubmit:function(e){return function(t,n){return e._checkpoint_token=null,n.next()}}(this)}],{password:function(){return"recovery_code"},recovery_code:function(){return"__exit__"}},{password:function(){return null},recovery_code:function(){return null}},"password"),p=function(e){return function(t){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_FINISH_HREF,{parameters:{checkpoint_token:e._checkpoint_token,device_response:JSON.stringify(t)},noAutonotify:!0,onSuccess:function(t){var n;return n=t.responseText.trim(),s.to_state("register_success"),Se(document).trigger("security-key-manager:UPDATE_KEYS",e._user.id)},onFailure:function(e){var t,n;return t=JSON.parse(e.responseText.substr(4)),n=null!=t.security_key_register?t.security_key_register.message_text:k.DEFAULT_ERROR,Se("#twofactor-security-key-register-error #error-msg").text(n),s.to_state("register_error")},cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),c=function(e){return function(t,n){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_START_HREF,{parameters:{checkpoint_token:e._checkpoint_token},onSuccess:function(e){var t;return t=JSON.parse(e.responseText),u2f.register(t.registerRequests,t.authenticateRequests,p),n.next()},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),f=new no(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"unsupported_browser",enter:this.hide_error.bind(this),contents:Se("#twofactor-security-key-unsupported-browser")}],{unsupported_browser:function(){return"__exit__"}},{},"unsupported_browser"),a=new no("Confirm password",this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(){return Se(document).trigger("security-key-modal:PASSWORD_CONFIRMED",[e._user.id,e._checkpoint_token]),mi.hide()}}(this)),contents:Se("#twofactor-enter-password")}],{password:function(){return"__exit__"}},{},"password"),s=new no(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:Se("#twofactor-enter-password")},{name:"intro",enter:this.hide_error.bind(this),contents:Se("#twofactor-security-key-intro")},{name:"prepare_register",enter:this.hide_error.bind(this),contents:Se("#twofactor-security-key-prepare-register"),onSubmit:c},{name:"register",enter:this.hide_error.bind(this),contents:Se("#twofactor-security-key-register")},{name:"register_error",enter:this.hide_error.bind(this),contents:Se("#twofactor-security-key-register-error"),onSubmit:c},{name:"register_success",enter:function(e){return function(){return e.hide_error.bind(e),e._checkpoint_token=null}}(this),onSubmit:function(e,t){return k.success(zt("Successfully added security key.")),t.next()},contents:Se("#twofactor-security-key-register-success")}],{password:function(){return"intro"},intro:function(){return"prepare_register"},prepare_register:function(){return"register"},register:function(){return"register_success"},register_error:function(){return"register"},register_success:function(){return"__exit__"}},{},"password"),this._bind_phone_input_to_save_button(),this._register_skip_link_click_to_submit_finish(),Se(".enable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,d)}}(this)),Se(".disable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,_)}}(this)),Se(".add-twofactor-backup-link").on("click",function(e){return function(t){return e.start_flow(t,o)}}(this)),Se(".edit-twofactor-backup").on("click",function(e){return function(t){return e.start_flow(t,l)}}(this)),Se(".edit-twofactor-recovery").on("click",function(e){return function(t){return e.start_flow(t,h)}}(this)),Se(".edit-twofactor-sms, .edit-twofactor-offline").on("click",function(e){return function(t){return e.start_flow(t,u)}}(this)),Se(document).on("twofactor:ADD_SECURITY_KEY",function(e){return function(t,n){return Se("#twofactor-security-key-unsupported-browser").length?e.start_flow(t,f,n):e.start_flow(t,s,n)}}(this)),Se(document).on("twofactor:ASK_PASSWORD_CONFIRM",function(e){return function(t,n){return e.start_flow(t,a,n)}}(this)),Se("#generate-new-recovery-code").on("click",function(e){return function(){return e.show_loading(),new Ajax.DBRequest(e.NEW_RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var n,i;if(n=t.responseText.trim(),i=JSON.parse(n),"OK"===i.result)return e.fill_backup_codes(i.codes,"backup-code-list-edit-container");switch(n){case"EXPIRED":return h.to_state("password"),e.show_error_expired();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),k.success(zt("Two-step verification is disabled. Did you maybe disable it in another window?")),mi.hide()}},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),Se("#twofactor-enter-backup-phone #country-code").on("change",this.reset_phone_field.bind(this)),Se("#resend-link").on("click",this.enable_resend_phone_code.bind(this)),Se("#twofactor-delivery-choice input").change(function(){return Se(".delivery-choice").removeClass("selected"),Se(this).parents(".delivery-choice").addClass("selected")}),Se("#show-qr").on("click",function(){return Se("#twofactor-offline-setup").addClass("showing-qr"),!1}),Se("#hide-qr").on("click",function(){return Se("#twofactor-offline-setup").removeClass("showing-qr"),!1}),"#backup2fa"===window.location.hash&&Se("#twofactor-row").hasClass("allow-autopop")?this.start_flow(o):void 0},_bind_phone_input_to_save_button:function(){return this.$save_button=Se("#twofactor-enter-backup-phone").find(".back-next").find(".savebutton"),this.$phone_input=Se("#twofactor-enter-backup-phone").find(".twofactor-backup-phone-number").find(".phone-text"),this.$phone_input.on("keyup",function(e){return function(){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this.$phone_input.on("input",function(e){return function(){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this._toggle_save_phone_button(this.$phone_input,this.$save_button)},_register_skip_link_click_to_submit_finish:function(){return Se("#twofactor-enter-backup-phone").find(".back-next").find("#skipstep").on("click",function(e){return function(){return e.submit_finish(!0,e._current_flow,e._current_flow.state,null)}}(this))},_toggle_save_phone_button:function(e,t){var n;return n=""===Se.trim(e.val()),t.prop("disabled",n)},start_flow:function(e,t,n){return null==n&&(n=null),e.preventDefault(),delete this._phone_number,null==n&&(n=Se(e.target).data("uid")),io.set_user(G.get_viewer().get_user_by_id(n)),this._current_flow=t,t.start(),!1},connect_login_init:function(){return this._container_selector="#twofactor-form",this._error_selector="#twofactor-form .error",Se("#resend-link").on("click",this.connect_resend_phone_code.bind(this))},resend_phone_code:function(){var e;if(!this.is_resending())return this.show_resending(),e="/twofactor_resend",Se("#twofactor-confirm").hasClass("backup")&&(e=o.parse(e).updateQuery({backup:!0}).toString()),new Ajax.DBRequest(e,{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable(!0);case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return k.error(zt("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-confirm").submit()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1},connect_resend_phone_code:function(){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return k.error(e.error_unreachable(!0));case"BADCARRIER":return k.error(e.error_bad_carrier());case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return k.error(e.error_not_a_mobile());case"RATELIMIT":return k.error(zt("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-form").submit()}}}(this),onFailure:function(e){return function(){return k.error(e.error500())}}(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},enable_resend_phone_code:function(){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable();case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return k.error("You've asked for too many SMS messages. Please try again in a few minutes.");case"EXPIRED":return e._current_flow.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},DEFAULT_ENABLE_TITLE:zt("Enable two-step verification"),DEFAULT_EDIT_TITLE:zt("Edit two-step verification"),DEFAULT_DISABLE_TITLE:zt("Disable two-step verification"),ADD_BACKUP_TITLE:zt("Add a backup phone number"),EDIT_BACKUP_TITLE:zt("Edit backup phone number"),EDIT_RECOVERY_TITLE:zt("View backup codes"),ADD_SECURITY_KEY_TITLE:zt("Add security key"),LOCK_ICON:"lock32",ENABLE_CONFIRM_HREF:"/account/twofactor/confirm_password",DISABLE_CONFIRM_HREF:"/account/twofactor/disable_confirm_password",EDIT_CONFIRM_HREF:"/account/twofactor/edit_confirm_password",ADD_SECURITY_KEY_START_HREF:"/account/twofactor/u2f_start_registration",ADD_SECURITY_KEY_FINISH_HREF:"/account/twofactor/u2f_finish_registration",RECOVERY_CODE_HREF:"/account/twofactor/get_rescue_code",NEW_RECOVERY_CODE_HREF:"/account/twofactor/new_rescue_code",enter_password_shown:function(){var e;return this.hide_error(),Se("#twofactor-recovery").removeClass("edit-mode"),e=$("twofactor-enter-password"),Se("#password",e).val("").focus(),!1},submit_password:function(e,t,n,i){var r;return(r=$("password").getValue())?(this.show_loading(),new Ajax.DBRequest(e,{parameters:{password:r},onSuccess:function(e){return function(r){var o;if(o=r.responseText.trim(),o.startsWith("OK:"))return e._checkpoint_token=o.substr(3),t(n,i);switch(o){case"EXPIRED_PASSWORD":return e.show_error_expired_password();case"INVALID":return e.show_error(zt("Invalid password"));case"RATELIMIT":return e.show_error(zt("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_ENABLED":return $("twofactor-row").addClassName("twofactor-enabled"),k.success(zt("Two-step verification is already enabled. Did you maybe enable it in another window?")),mi.hide();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),k.success(zt("Two-step verification is already disabled. Did you maybe disable it in another window?")),mi.hide()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(zt("Please enter your password"))},fetch_offline_key:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,offline:!0},onSuccess:function(n){return function(i){var r;if(r=i.responseText.trim(),r.startsWith("OK:"))return n.fill_key(r.substr(3)),t.next();switch(r){case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_key:function(e){var t,n,i;return e=e.replace(new RegExp("=+$"),""),t=e.toLowerCase().replace(/(.{4})/g,"$1 "),$("secret-div").__date(t),$("qr-div").__date(),i=Ee.IS_PROD?"Dropbox":"DropboxDev",n={text:"otpauth://totp/"+i+":"+this._user.email+"?secret="+e+"&issuer="+i,width:200,height:200},Modernizr.canvas||(n.render="table"),Se("#qr-div").qrcode(n),Modernizr.canvas?void 0:Se("#qr-div > table").css("margin","0 auto")},submit_phone_number:function(e,t){var n,i;return n=Se("#twofactor-enter-phone .twofactor-phone-number"),Q.get_controller(n).validate_on_submit()?(i=n.val(),this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,phone_number:i},onSuccess:function(r){return function(o){switch(o.responseText.trim()){case"OK":return r._phone_number=i,e.vars.phone_number=i,t.next();case"EXPIRED":return e.to_state("password"),r.show_error_expired();case"UNREACHABLE":return r.show_error_unreachable(n);case"BADCARRIER":return r.show_error_bad_carrier(n);case"INVALIDNUMBER":return r.show_error_invalid_number(n);case"NOTAMOBILE":return r.show_error_not_a_mobile(n);case"RATELIMIT":return r.show_error(zt("You've added too many phone numbers. Please try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void 0},submit_phone_code:function(e,t){var n;return(n=$("phone-code").getValue().trim())?-1===n.search(/^\d{6}$/)?void this.show_error(zt("Invalid security code")):(this.show_loading(),new Ajax.DBRequest("/account/twofactor/confirm_phone",{parameters:{checkpoint_token:this._checkpoint_token,twofactor_code:n,use_json:!0},onSuccess:function(n){return function(i){var r,o;if(o=JSON.parse(i.responseText.trim()),"OK"===o.result)return n.fill_backup_codes(o.codes,"backup-code-list-container"),t.next();switch(o.result){case"INVALID":return n._invalid_code_count+=1,r=zt(n._invalid_code_count<=2?"Invalid code":n._is_offline_setup?"Invalid code. Check the clock on your phone: it must be accurate to the minute.":"Invalid code"),n.show_error(r);case"EXPIRED":return e.to_state("password"),n.show_error_expired();case"RATELIMIT":return n.show_error(zt("Too many invalid codes. Try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(zt("Please enter the security code"))},enter_backup_phone_number_shown:function(e){var t,n;return this.hide_error(),t=$("twofactor-enter-backup-phone"),n=this.fill_phone_number_for_edit(t,Se("#twofactor-row-"+this._user.role+" #twofactor-backup-number").text()),n.focus(),"back_next"===e?(Se("#twofactor-backup-back-next").show(),Se("#twofactor-backup-cancel-save").hide(),Se("#twofactor-backup-back-save").hide()):"cancel_save"===e?(Se("#twofactor-backup-back-next").hide(),Se("#twofactor-backup-cancel-save").show(),Se("#twofactor-backup-back-save").hide()):"back_save"===e?(Se("#twofactor-backup-back-next").hide(),Se("#twofactor-backup-cancel-save").hide(),Se("#twofactor-backup-back-save").show()):void 0},submit_backup_phone_number:function(e,t,n,i,r){var o,s;if(o=Se("#twofactor-enter-backup-phone .twofactor-backup-phone-number"),Q.get_controller(o).validate_on_blur()){if(s=o.val()){if(this.is_primary_number(s))return void Q.get_controller(o).show_error(zt("You can’t use your primary phone as your backup"),o)}else if(e)return void Q.get_controller(o).show_error(zt("Please enter phone number"),o);if(this._backup_phone=s,"save_backup_phone"===t)this.save_added_backup_phone(n,e,s);else if("save_everything"===t)this.submit_finish(!1,n,i,r);else if("save_none"===t)return i.next()}},is_same_phone_number:function(e,t){return e&&t?e.replace(/\D+/g,"")===t.replace(/\D+/g,""):!1},is_primary_number:function(e){var t;return t=Se("#twofactor-row-"+this._user.role),this._is_offline_setup?!1:this._phone_number?this.is_same_phone_number(e,this._phone_number):this.is_same_phone_number(e,t.data("primary_phone"))?!0:this.is_same_phone_number(e,Se("#twofactor-sms-number",t).text())?!0:!1},save_added_backup_phone:function(e,t,n){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/set_backup_phone",{parameters:{checkpoint_token:this._checkpoint_token,backup_phone_number:n},onSuccess:function(i){return function(r){var o;switch(r.responseText.trim()){case"OK":return i.hide_error(),o="#twofactor-row-"+i._user.role,Se(o+" #twofactor-backup-number").text(n),Se(o).toggleClass("with-backup",!!n),k.success(n?t?zt("Backup phone number added"):zt("Backup phone number updated"):zt("Backup phone number removed")),mi.hide();case"EXPIRED":return e.to_state("password"),i.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_phone_number_for_edit:function(e,t){var n,i;return i=Se("input.text-input-input",e),t?(n=Q.get_controller(Se(".phone-number-input",e)),n.set(t),i.val(n.get_local_number()),i.length&&i[0].select(),Se("#twofactor-backup-back-save").find("#skipstep").hide(),Se(".text-input-wrapper").find("label").hide(),i):i.val("")},fill_delivery_choice:function(e){return Se("#twofactor-delivery-phone-label,#confirm-phone-primary").toggle(!!e),Se("#twofactor-delivery-offline-label").toggle(!e),Se("#confirm-phone-primary-number").text(e),Se("#twofactor-row-"+this._user.role).data("primary_phone",e)},fill_backup_phone:function(e){return Se("#confirm-phone-backup").toggle(!!e),Se("#confirm-phone-backup-number").text(e)},insert_spaces_into_code:function(e){return e.toLowerCase().replace(/(.{4})/g,"$1 ")},fill_backup_codes:function(e,t){var n,i,r,o,s,a,_;if(i=Se("#"+t),i.empty(),n=Se("<ol/>",{class:"twofactor-backup-list"}),0===e.length)return i.siblings().css("display","none"),Se(".codesbox__error").css("display","block");for(o=e[0].length,16===o&&n.css("column-count","1"),s=0,a=e.length;a>s;s++)r=e[s],_=Se("<li/>",{class:"twofactor-backup-list__item"}),n.append(_.append(Se("<span/>",{class:"twofactor-backup-list__code",text:this.insert_spaces_into_code(r)})));return i.append(n),i.siblings().css("display","block"),Se(".codesbox__error").css("display","none")},submit_finish:function(e,t,n){var i;return this.show_loading(),i={checkpoint_token:this._checkpoint_token},this._backup_phone&&!e&&(i.backup_phone_number=this._backup_phone),new Ajax.DBRequest("/account/twofactor/enable_finish",{parameters:i,onSuccess:function(e){return function(i){switch(i.responseText.trim()){case"OK":return e.successfully_enabled=!0,"ENABLE"!==t.vars.mode?e.after_enabled(t,n):n.next();case"EXPIRED":return t.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},after_enabled:function(e,t){var n,i;return this._checkpoint_token=null,this.hide_error(),n=Se("#twofactor-row-"+this._user.role),n.toggleClass("with-sms",!!this._phone_number),Se("#twofactor-sms-number",n).text(this._phone_number||""),n.toggleClass("with-backup",!!this._backup_phone),Se("#twofactor-backup-number",n).text(this._backup_phone||""),n.addClass("twofactor-enabled"),Se("tr[id^='session_row_']").slice(1).hide(),"ENABLE"!==e.vars.mode?(i="/account/#security",k.success(new lt(zt('Two-step verification updated. Any <a href="%(path)s">existing sessions, devices and apps</a> can still access your Dropbox.').format({path:i}))),null!=t?t.next():void 0):void 0},disable_submit:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/disable",{parameters:{checkpoint_token:this._checkpoint_token},onSuccess:function(n){return function(i){var r;switch(i.responseText.trim()){case"OK":return n.successfully_disabled=!0,n._checkpoint_token=null,r=Se("#twofactor-row-"+n._user.role),r.removeClass("twofactor-enabled with-sms with-backup"),Se(document).trigger("security-key-manager:UPDATE_KEYS",n._user.id),Se("#twofactor-sms-number, #twofactor-backup-number",r).text(""),Se("tr[id^='session_row_']").slice(1).hide(),k.success(zt("Two-step verification is now disabled.")),t.next();case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},show_error:function(e,t){var n;return t?void Q.get_controller(t).show_error(e):(n=$$(this._error_selector),e===this.error_expired_password()||e===this.error_unreachable(!0)?n.invoke("update",e):n.invoke("__date",e),n.invoke("show"))},show_error500:function(){return this.show_error(this.error_500())},show_error_bad_carrier:function(e){return this.show_error(this.error_bad_carrier(),e)},show_error_invalid_number:function(e){return this.show_error(this.error_invalid_number(),e)},show_error_not_a_mobile:function(e){return this.show_error(this.error_not_a_mobile(),e)},show_error_unreachable:function(e,t){return null==t&&(t=!1),this.show_error(this.error_unreachable(t),e)},show_error_expired:function(e){return this.show_error(this.error_expired(),e)},show_error_expired_password:function(e){return this.show_error(this.error_expired_password(),e)},error_500:function(){return zt("Sorry, an error occurred. Please try again later.")},error_bad_carrier:function(){return zt("Unfortunately, your carrier isn’t supported at this time.")},error_invalid_number:function(){return zt("That isn’t a valid phone number.")},error_not_a_mobile:function(){return zt("That phone number doesn’t appear to be a valid mobile number.")},error_unreachable:function(e){return null==e&&(e=!1),zt(e?'We couldn\'t reach your phone number. If this has happened before <a href="https://www.dropbox.com/help/364/">click here</a>.':"We couldn't reach your phone number. Are you sure it's correct?")},error_expired:function(){return zt("Since it's been a while, please enter your password again.")},error_expired_password:function(){return zt('Your password has expired. Please create a new password <a target="_blank" href="/password_expired">here</a>.')},hide_error:function(){return $$(this._error_selector).invoke("__date")},show_loading:function(){return this.hide_error(),$$(this._container_selector).invoke("addClassName","loading")},hide_loading:function(){return $$(this._container_selector).invoke("removeClassName","loading")},is_resending:function(){return $$(this._container_selector)[0].hasClassName("resending")},show_resending:function(){return $$(this._container_selector).invoke("addClassName","resending")},hide_resending:function(){return $$(this._container_selector).invoke("removeClassName","resending")},hide_resending_with_delay:function(){return setTimeout(this.hide_resending.bind(this),3e3)},notify_resent:function(){return k.success(zt("We sent you another code. It may take a few minutes to arrive."))},reset_phone_field:function(e){var t,n;return t=e.element(),n=Se(".sick-input",t.form),Se("input",n).val("").focus(),this.fill_example_phone_number(t,n)},fill_example_phone_number:function(e,t){var n,i;return"undefined"!=typeof phone_helpers&&null!==phone_helpers?(n=Se(e).val().substr(1),i=phone_helpers.get_example_mobile_number(n),Se("label",t).text(zt("Example: ")+i)):void 0},reset_phone_field_and_backup_country:function(e){var t;return this.reset_phone_field(e),""===Se("#backup-phone-number").val()?(t=Se("#twofactor-enter-backup-phone #country-code"),t.val(e.element().getValue()),this.fill_example_phone_number(t,Se(".sick-input",t[0].form))):void 0}};var ro;ro=__PARENT_SCOPE__.FileViewer=INLINE_JS.FileViewer=ft.FileViewer={KEY_SCOPE:"fileviewer",_MODAL_FILEINFO:0,_MODAL_PREVIEW:1,MAX_CHECK_LOCK_TRIES:8,_FADE_MSEC:300,file:null,has_preview:!1,preview_locked:!1,preview_lock_listener:null,modal_type:this._MODAL_FILEINFO,is_loaded:!1,has_key_listener:!1,preview_status_timeout_obj:null,preview_status_request:null,hiding:!1,check_lock_request:null,check_lock_timeout:null,file_locked:!1,file_view_target:Z.FileViewTargetType.PRIVATE,file_view_origin:Z.FileViewOriginType.UNKNOWN,file_view_action:null,
_frameMessenger:null,_cached_browser_window_title:null,annotation_enabled_for_this_revision:!0,_preview_flippable_component:null,active_user:null,_pdfLoader:new D,_is_browse_drag_enabled:null,_file_view_attempts:0,_trigger_preview_state_update:function(e){return Se(document).trigger("db:filepreview:previewupdate",[e])},_trigger_openwith_state_update:function(e){return Se(document).trigger("db:filepreview:openwithupdate",[e])},_get_extension:function(e){var t;return t=e.lastIndexOf("."),-1===t?"":e.substr(t+1)},_get_preview_type_from_extension:function(e){var t,n;return t=e.substring(0,3),n="rtf"===t||"odt"===t?"doc":"pps"===t?"ppt":t},_file_view_target_is_private:function(){return this.file_view_target===Z.FileViewTargetType.PRIVATE},_file_view_target_is_shared:function(){return this.file_view_target===Z.FileViewTargetType.SHARED_LINK||this.file_view_target===Z.FileViewTargetType.SHARED_CONTENT_LINK},_shared_link_url:function(){return this._file_view_target_is_shared()?this.file.href:null},show:function(){return this._file_view_attempts=0,this._cached_browser_window_title=document.title,this._setup_and_load.apply(this,arguments)},_setup_and_load:function(e,t,n,i){var r,o,s,a,_,l,u;if(null==n&&(n={}),i in Z.OriginReferrerTypeToFileViewOriginAndAction?(l=Z.OriginReferrerTypeToFileViewOriginAndAction[i],_=l[0],a=l[1]):(u=[null,null],_=u[0],a=u[1]),n=w.defaults(n,{files:[],force_file_unlocked:!0,should_focus_comment_input:!1,hide_comments:!1,hide_restore:!1,file_view_target:Z.FileViewTargetType.PRIVATE,file_view_origin:_,file_view_action:a}),null==this._is_browse_drag_enabled&&(this._is_browse_drag_enabled=Se.proxy(function(){return!this.shown()},this)),s=Se("#file-viewer"),this.hiding)s.finish();else{if(this.shown())return this.prev_scope=key.getScope(),void key.setScope(this.KEY_SCOPE);s.hide()}return r=s.find(".file-viewer-comment-container"),n.hide_comments?r.hide():r.show(),o=s.find(".restore-button"),o.length&&(n.hide_restore?o.hide():o.show()),this.file=e,this.active_user=t,this.flippable_files=this._filterFlippableFiles(n.files),this.file_view_target=n.file_view_target,this.file_view_origin=n.file_view_origin,this.file_view_action=n.file_view_action,this.should_focus_comment_input=n.should_focus_comment_input,this.total_files=n.files.length,this._start_time=Date.now(),"download"!==this.file.preview_type?(je.scroll_lock_document(),s.css("pointer-events","").fadeIn(this._FADE_MSEC),this.load(this.file,n.force_file_unlocked,i)):void(window.location.href=this.file.href)},_getFilesToPreloadActivities:function(){var e,t,n,i,r,o,s;for(t=[],e=this.currentFlippableFileIndex(),s=[1,2,3,4,5,6,-1,-2],r=0,o=s.length;o>r;r++)n=s[r],i=e+n,i>=0&&i<this.flippable_files.length&&t.push(this.flippable_files[i]);return t},load:function(e,t,n){var i,r,o;return null==t&&(t=!1),this.file=e,document.title=this.file.filename,i=Se("#file-viewer"),"True"===i.data("is-openwith-allowed")&&__CONDITIONAL_JS__.OpenWith.file_supported(this.file)&&(t?this.file_locked=!1:(this.file_locked=!0,this.check_lock())),Se(document.activeElement).blur(),this._render_viewer(),o=this.modal_type===this._MODAL_FILEINFO,r=this._getFilesToPreloadActivities(),Se("#file-viewer").trigger("db:filepreview:open",[this.file,this.file_view_target,this.active_user.id,this.should_focus_comment_input,o,n,r]),Se("#file-viewer").on("db:commenting:init",function(e){return function(){return Se("#file-viewer").trigger("db:filepreview:fileinfo",[e.file,e.file_view_target,e.active_user.id,e.should_focus_comment_input,o,n,r])}}(this))},_filterFlippableFiles:function(e){var t;return function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],Ft.isFlippable(t.preview_type)&&r.push(t);return r}()},currentFlippableFileIndex:function(){var e,t,n,i,r;for(r=this.flippable_files,t=n=0,i=r.length;i>n;t=++n)if(e=r[t],this.file.sjid===e.sjid)return t;return-1},cancel_check_lock:function(){return this.file_locked=!1,null!=this.check_lock_request&&(this.check_lock_request.abort(),this.check_lock_request=null),null!=this.check_lock_timeout?(clearTimeout(this.check_lock_timeout),this.check_lock_timeout=null):void 0},check_lock:function(){var e,t,n,i,r,o,s,a;if(null==this.check_lock_request)return this.check_lock_timeout=null,r=0,a=this.active_user.id,s=this.file.fq_path,o=1e3,i=function(t){return function(){return r++,r<t.MAX_CHECK_LOCK_TRIES?(2===r?INLINE_JS.Notify.warning(zt("Office Online is saving your file.")):5===r&&INLINE_JS.Notify.warning(zt("Office Online is taking longer than expected to save. ",0/0)),t.check_lock_timeout=setTimeout(e,o),o=2*o):(clearTimeout(t.check_lock_timeout),t.check_lock_request=null,t.file_locked=!1,t._render_preview(!0,!0))}}(this),n=function(e){return function(t){return t=JSON.parse(t),(null!=t?t.has_lock:void 0)?i():(e.check_lock_request=null,e.file_locked=!1,e._render_preview(!0,!0))}}(this),t=function(){return i()},(e=function(e){return function(){return e.check_lock_request=b.WebRequest({url:"/ow/msft/check_lock",data:{user_id:a,fq_path:s},success:n,error:t})}}(this))()},shown:function(){return"none"!==Se("#file-viewer").css("display")},clear_preview_url_timer:function(){return null!=this.previewUrlTimer?clearTimeout(this.previewUrlTimer):void 0},set_preview_url_w_timeout:function(){return this.clear_preview_url_timer(),this.previewUrlTimer=setTimeout(function(e){return function(){return e.set_preview_url()}}(this),250)},set_preview_url:function(){var e,t,n;return e=o.parse(v.get_url()),t=e.getPath(),n=e.removeQuery("select").updateQuery({preview:this.file.filename}).getQuery(),v.push_state(o.encode_parts(t),n,{immediatelyRestoreState:!1})},unset_preview_url:function(){var e,t,n;return this.clear_preview_url_timer(),e=o.parse(v.get_url()),(this._file_view_target_is_shared()||!e.getPath().match(/^\/s[h]?\/.+/)&&this._file_view_target_is_private())&&"preview"in e.getQuery()?(t=e.getPath(),n=e.removeQuery("select").removeQuery("preview").getQuery(),v.push_state(o.encode_parts(t),n)):void 0},render_file_failed:function(){var e,t;return t=this.file,e=this.active_user,this._teardown_and_hide(),t.doc_preview_status=f.DOC_PREVIEW_UNAVAILABLE_BAD_FILE,this._setup_and_load(t,e,{files:this.flippable_files,force_file_unlocked:!this.file_locked,file_view_target:this.file_view_target,file_view_origin:this.file_view_origin,file_view_action:this.file_view_action,should_focus_comment_input:this.should_focus_comment_input}),Se("#file-viewer").show(),Se("#file-viewer").trigger("preview_failed")},_log_view:function(e,t){var n;return this._file_view_attempts++,n={user_id:this.active_user.id,target:this.file_view_target,platform:Z.FileViewPlatformType.WEB,ns_id:this.file.ns_id,sjid:this.file.sjid,ns_path:this.file.ns_path,origin:this.file_view_origin,action:this.file_view_action,shared_link_url:this._shared_link_url(),extra:{file_ext:_t.file_extension_for_logging(this.file.filename),file_bytes:this.file.bytes,file_mtime:this.file.ts,preview_type:this.file.preview_type,preview_status:this.file.doc_preview_status,time_taken:e,in_progress:t,is_team:1===this.active_user.is_team,paid:1===this.active_user.paid,file_view_attempts:this._file_view_attempts}},rt.FileViewLogger.log(n)},preload_office_static:function(e){var t,n,i;if(null!=__CONDITIONAL_JS__.OpenWith.PRELOAD_URLS)return n=this._get_extension(e),n in __CONDITIONAL_JS__.OpenWith.PRELOAD_URLS?(t=Se("#file-viewer .open-with-static-content-container"),i=Se("<iframe/>",{src:__CONDITIONAL_JS__.OpenWith.PRELOAD_URLS[n]}),t.html(i)):void 0},unload_office_static:function(){var e;return e=Se("#file-viewer .open-with-static-content-container"),e.empty()},_render_viewer:function(){var e,t,n,i,r,s,a,l,u,d,c,h,p,m,v;return t=Se("#file-viewer"),e=t.find(".download-button"),i=o.parse(this.file.href).updateQuery({dl:1}).toString(),this.preload_office_static(this.file.filename),m=function(n){return function(r){var o,s,a,l,u,d;return null==r&&(r=!0),l=_.em_snippet(n.file.filename,35),o=t.find(".title-bar .filename"),d={class:"icon",alt:n.file.caption},u=ee.html("web",n.file.icon,d).toHTML(),s=Se("<span />",{class:"filename-text"}).text(l),o.html(u).append(s),t.addClass("has-preview"),G.get_viewer().is_team_assume_user_session&&t.addClass("room-for-team-assume-user-top-bar"),n.file.htmlified_link?t.addClass("htmlified-preview"):"excel"===n.file.preview_type?(t.addClass("html-preview"),t.find(".loading").css("z-index","-1")):t.addClass(n.file.preview_type+"-preview"),r&&t.find(".loading").show(),e.on("click",function(e){return e.preventDefault(),window.location.href=i}),void 0===n.file.tkey&&ro.active_user.is_email_verified?(a=function(e){return this.file.tkey=e.tkey,this._update_title_bar_buttons()},b.WebRequest({url:"/sm/get_token",type:"POST",data:{path:n.file.fq_path},dataType:"json",subject_user:n.active_user.id,success:a.bind(n)})):n._update_title_bar_buttons(),n.modal_type=n._MODAL_PREVIEW,n._first_render_completed=!1,n._listen()}}(this),s=function(e){return function(){return t.removeClass(),t.find(".loading").hide(),e._unlisten()}}(this),p=function(e){return function(t,n,i,r,o){var s;return null==t&&(t=!1),null==n&&(n=!0),null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=!0),e._log_view(Date.now()-e._start_time,r),s=e._get_extension(e.file.filename),("doc"===s||"docx"===s||"odt"===s||"ppt"===s||"pptx"===s||"xls"===s||"xlsx"===s||"pdf"===s||"eps"===s||"ai"===s||"psd"===s||"svg"===s||"txt"===s||"rtf"===s||"pspimage"===s||"tif"===s||"tiff"===s||"yuv"===s||"url"===s||"webloc"===s||"website"===s||"wopitest"===s)&&e._trigger_preview_state_update({preview_state:"open",file_obj:e.file}),t||(m(n),e._update_title_bar_buttons()),e._render_preview(i,o),e._initial_resize()}}(this),h=function(n){return function(r){var o,s,a,l;return null==r&&(r=!1),o=n.file.filename.indexOf("."),s=n.file.filename.substring(o+1),l="key"===s&&null===n.file.preview_type?"/static/images/icons128/"+_t.file_icon("_other")+".png":"/static/images/icons128/"+_t.file_icon(n.file.filename)+".png",n._trigger_preview_state_update({preview_state:"closed",file_obj:null}),a=_.em_snippet(n.file.filename,20),t.find(".title-bar .filename").text(a),t.addClass("no-preview"),t.find(".file-thumbnail img").attr({src:l}),t.find(".file-type").text(a),t.find(".file-size").text(n.file.size),t.find(".file-modified").text(n.file.ago||""),e.on("click",function(){return st.unsafeRedirect(i)}),n.modal_type=n._MODAL_FILEINFO,n._listen(),n._log_view(Date.now()-n._start_time,r),n._update_title_bar_buttons(),n._initial_resize()}}(this),r=this._get_extension(this.file.filename),d=("doc"===(c=this.file.preview_type)||"excel"===c||"keynote"===c||"adobecs"===c||"linkfile"===c)&&(this.file.bytes<f.MAX_PDF_FILE_SIZE_B||"pdf"!==_t.file_extension(this.file.filename).toLowerCase())&&!st.msie_version_at_most(9),this.has_preview=Ft.isFlippable(this.file.preview_type)||"text"===this.file.preview_type&&this.file.bytes<f.MAX_TEXT_FILE_SIZE_B||"html"===this.file.preview_type&&"sandbox"in document.createElement("iframe")||"linkfile"===this.file.preview_type||d&&this.file.doc_preview_status===f.DOC_PREVIEW_AVAILABLE&&!this.file_locked,a=d&&this._preview_progressive_try(r)&&this.file.doc_preview_status!==f.DOC_PREVIEW_UNAVAILABLE_BAD_FILE&&!this.file_locked,this.has_preview||a?p(!1,!("doc"===this.file.preview_type),!1,!1,this.has_preview):(l=this.file_locked||d&&this.file.doc_preview_status===f.DOC_PREVIEW_IN_PROGRESS)?(m(),u=o({path:"/doc_preview_status"+this.file.fq_path}).toString(),v=Date.now(),(n=function(e){return function(){var t;return t=Date.now(),t-v>=5e3?void setTimeout(Se.proxy(e.render_file_failed,e),0):e.preview_status_request=Se.ajax(u,{success:function(t){return e.file?e.file.doc_preview_status=parseInt(t,10):void 0},complete:function(t,i){return"abort"===i||e.file_locked?void 0:e.file.doc_preview_status===f.DOC_PREVIEW_AVAILABLE?(e.has_preview=!0,p(!0,!1,!0,!0)):e.file.doc_preview_status===f.DOC_PREVIEW_IN_PROGRESS?e.preview_status_timeout_obj=setTimeout(n,1e3):void e.render_file_failed()},timeout:5e3-(t-v),subject_user:e.active_user})}}(this))()):h()},switch_preview:function(e,t,n,i){var r,o,s,a;if((null!=e||null!=t)&&null!=this.file){if(this.annotation_enabled_for_this_revision=n,null!=e&&(this.file.href=e),null!=t&&(this.file.direct_blockserver_link=t),r=Se("#file-viewer .preview-content-container"),"photo"!==this.file.preview_type)return a="",r.html(a),this._render_preview(!1,!0,i);if(null!=(s=this._preview_flippable_component)?s.isMounted():void 0)return this._preview_flippable_component.props["thumbnail-url-tmpl"]===e&&(o=!0),this._preview_flippable_component.setProps({"thumbnail-url-tmpl":e,onLoad:i},function(e){return function(){return o?e._preview_flippable_component.onImageLoad():void 0}}(this))}},_remove_loading:function(e){var t;return null==e&&(e=!0),t=Se("#file-viewer .loading"),t.hide(),t.css("z-index",""),this.is_loaded=e},_render_blank:function(){var e,t;return e=Se("#file-viewer .preview-content-container"),t=ce.createElement(at,{icon:this.file.icon,filename:this.file.filename,created:new Date(1e3*this.file.ts),size:this.file.size}),ce.render(t,e.get(0))},_render_linkfile:function(){var e,t;return e=Se("#file-viewer .preview-content-container"),t=ce.createElement(pt,{filename:this.file.filename,source:"browse","authenticated-data-link":!0}),ce.render(t,e.get(0))},_update_title_bar_buttons:function(){var e,t,n,i,r,o,s,a,_,l,u,d,c,h,p,m,v,g,w,b,y,k,E,x,S;return o=Se("#file-viewer"),r=o.find(".share-button"),this._file_view_target_is_shared()&&r.remove(),e=o.find(".download-button"),t=o.find(".split-button.openwith"),i=null!=t?t.find(".main-button"):void 0,n=null!=t?t.find(".more-button"):void 0,_=zt("Open",{comment:"Open a file natively on the user's computer"}),a=function(){return"True"===o.data("is-unity-allowed")&&null!=__CONDITIONAL_JS__.UnityFeatures},s=function(e){return function(t){var n,i;return"True"===o.data("is-openwith-allowed")&&(null!=(n=__CONDITIONAL_JS__.OpenWith)?n.get_open_handler_for(t,e.active_user):void 0)&&t.bytes<(null!=(i=__CONDITIONAL_JS__.OpenWith)?i.MAX_SUPPORTED_FILE_SIZE_B:void 0)&&t.doc_preview_status!==f.DOC_PREVIEW_UNAVAILABLE_PROTECTED_DOC}}(this),g=function(e){return function(t){return __CONDITIONAL_JS__.UnityFeatures.open_file(e.file.ns_id,e.file.ns_path,e.file.user_id,__CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler,function(){return __CONDITIONAL_JS__.UnityFeatures.standard_open_file_handler(!1)},t)}}(this),m=function(){return g(!1)},v=function(){return g(!0)},w=function(e){return function(){var t,n,i;return t=__CONDITIONAL_JS__.OpenWith.get_open_handler_for(e.file,e.active_user),t?(null!=(i=__CONDITIONAL_JS__.OpenWithMicrosoftLogger)&&i.log_open_button_pressed(e.active_user.id,_t.file_extension(e.file.filename).toLowerCase(),e.file.ns_id,e.file.ns_path),n=t.uri+"?hpt_click_ts="+Date.now(),st.redirect(n)):void 0}}(this),S=function(e){return function(t,r,o){var s,a,l,u,d,c,h,f,p,g;return p=[],h=null!=r,h&&(r.can_open_directly||null==r.can_open_directly)&&(s=r.open_application_name||zt("Open"),f=zt("Desktop"),__CONDITIONAL_JS__.UnityFeatures.client_supports_open_in_file_browser()&&(f=zt("Open in %(app_name)s").format({app_name:s})),p.push({id:"ow_desktop",label:f,icon:"ow_desktop",callback:m})),t&&(c=__CONDITIONAL_JS__.OpenWith.get_open_handler_for(e.file,e.active_user),p.push({id:"ow_web",label:c.name,icon:c.icon,callback:w})),h&&__CONDITIONAL_JS__.UnityFeatures.client_supports_open_in_file_browser()&&(d=r.file_browser_display_name||zt("File Browser"),f=zt("Show in %(file_browser)s").format({file_browser:d}),!h||r.can_open_directly||t||(_=f),p.push({id:"ow_folder",label:f,icon:"ow_folder",callback:v})),k(_,p),l=t||h?h?!1:!0:!1,l||o?e._show_more_button(o,l):e._hide_more_button(),a=function(t,n,i,r){return e._open_button_update_state_timeout&&clearTimeout(e._open_button_update_state_timeout),e._open_button_update_state_timeout=setTimeout(function(){return e._trigger_openwith_state_update({user_id:t,button_display_state:n,file_extension:i,target_button:r}),e._open_button_update_state_timeout=null},200)},u=_t.file_extension(e.file.filename).toLowerCase(),t?h?a(e.active_user.id,"visible",u,n):a(e.active_user.id,"visible",u,i):h&&r.can_open_directly&&(null!=(g=__CONDITIONAL_JS__.OpenWith)?g.is_adobe_app(r.open_application_identifier):void 0)?a(e.active_user.id,"visible",u,i):a(null,"hidden",null,null)}}(this),E=function(n){return null!=t&&t.toggleClass("shown",n),e.toggle(!n)},k=function(e,t){return t instanceof Array||(t=[t]),0===t.length?E(!1):1===t.length?d(e,t[0].callback):c(e,t)},d=function(e,n){return null!=t||null!=i?(E(!0),t.removeClass("split"),i.text(e),i.off("click").on("click",n)):void 0},c=function(e,r){var s,a,_,l,u;if(null!=t||null!=i||null!=n){for(E(!0),t.addClass("split"),i.text(e),s=o.find(".openwith-dropdown"),i.off("click").on("click",function(e){return r[0].callback(e)}),n.off("click").on("click",function(e){var t;return t=Se(this).parent().siblings(".openwith-dropdown"),t.is(":visible")?void 0:(t.removeAttr("style"),fi.show(t,this,null,!0),e.stopPropagation())}),s.find("li").hide(),a=function(e){var t;return t=s.find("."+e.id),t.find("a .sprite-text-inner").text(e.label),ee.src(t.find("a .sprite")[0],"web",e.icon),t.find("a").off("click").on("click",function(t){return t.preventDefault(),e.callback(t)}),t.show()},_=0,l=r.length;l>_;_++)u=r[_],a(u);return Se("#file-viewer-container").off("click",fi.hide_all).on("click",fi.hide_all)}},x=!!a(),l=!!s(this.file),u=!!this.file.tkey,S(l,null,u),x?(h=function(e){var t,n;return n=function(t){return e.file_browser_display_name=t,S(l,e,u)},t=function(){return S(l,null,u)},__CONDITIONAL_JS__.UnityFeatures.file_browser_display_name(n,t)},(null!=(b=__CONDITIONAL_JS__.UnityCheckFileCache)?b.is_cached_and_locally_available(this.file.ns_id,this.file.ns_path):void 0)?h(null!=(y=__CONDITIONAL_JS__.UnityCheckFileCache)?y.get(this.file.ns_id,this.file.ns_path):void 0):(p=function(e){return e.is_locally_available?h(e):void 0},__CONDITIONAL_JS__.UnityFeatures.check_file(this.file.ns_id,this.file.ns_path,this.file.user_id,p))):void 0},_show_more_button:function(e,t){var n,i,r,o,s;return s=Se("#file-viewer"),n=s.find(".more-options-button"),n.show(),r=s.find(".more-options-dropdown"),n.on("click",function(e){return r.is(":visible")?void 0:(fi.show(r,n,null,!0),e.stopPropagation())}),Se("#file-viewer-container").on("click",fi.hide_all),o=r.find(".remove-link"),o.off("click"),e?(o.show(),o.on("click",function(e){return function(){return fi.hide_all(),Kn.confirm_remove(e.file.filename,e.file.tkey,0,0,0,e.file.user_id)}}(this))):o.hide(),i=r.find(".download-button"),i.toggle(t)},_hide_more_button:function(){var e,t;return t=Se("#file-viewer"),e=t.find(".more-options-button"),e.off("click").hide(),Se("#file-viewer-container").off("click",fi.hide_all),t.find(".remove-link").off("click")},_initial_resize:function(){var e;if(!this.is_loaded)return e=function(){return Se("window").trigger("resize")},setTimeout(e,0)},_get_progressive_url:function(e,t){var n,i,r,s;return s=this.active_user,e=this._get_preview_type_from_extension(e),r=o.parse(t),i=!1,"doc"===e||"key"===e||"keynote"===e||"adobecs"===e?"pdf-js"!==f.PDF_PREVIEW_MODE&&(r=r.updateQuery({post_message_on_failure:1})):"xls"===e&&(n=Yt.is_xls_edit_enabled()?"xls/edit":"xls/preview"),n&&(r.setAuthority(i?Ee.WEBSERVER:r.getAuthority().replace("dl-web","dl-doc")),r.setPath(r.getPath().replace("/pri/get/","/get/")),r.setPath(r.getPath().replace("/get/","/"+n+"/"))),r=r.updateQuery({get_preview:1,saveas:this._is_saveas_experiment_enabled()?1:0})},_get_pdf_js_url:function(e){return"pdf-js"===f.PDF_PREVIEW_MODE&&(e=o.parse(A.static_url_pdfjs_viewer)),e},_preview_is_progressive:function(e){return e=this._get_preview_type_from_extension(e),"doc"===e||"ppt"===e||"xls"===e||"key"===e||"keynote"===e||"eps"===e||"ai"===e},_preview_progressive_try:function(e){var t,n;return this._preview_is_progressive(e)?this.file.doc_preview_status===f.DOC_PREVIEW_IN_PROGRESS?!0:(e=this._get_preview_type_from_extension(e),t=this.file.doc_preview_status===f.DOC_PREVIEW_UNAVAILABLE_FAILED,n="key"===e||"keynote"===e,t||n):!1},_set_previews_sandbox_params:function(e){return e=this._get_preview_type_from_extension(e),"xls"!==e?"":null},_prepare_annotation_url:function(e){return this._is_annotation_marker_enabled()&&(e=e.updateQuery("annotation_marker","1")),this._is_annotation_highlight_enabled()&&(e=e.updateQuery("annotation_highlight","1")),this._is_annotation_region_enabled()&&(e=e.updateQuery("annotation_region","1")),e},_render_preview:function(e,t,n){var i,r,s,a,_,l,u,d,c,h,p,m,v,g,w,b,y,k,E,x,S,C;if(null==e&&(e=!1),null==t&&(t=!0),null==n&&(n=null),w=function(e){return function(){return e._remove_loading(),"function"==typeof n?n():void 0}}(this),e&&this._remove_loading(!1),b=Se("#file-viewer .preview-content-container"),!(b.find("iframe").length>0)){if(this.file.htmlified_link)return d=Se("<iframe/>",{src:this.file.htmlified_link,sandbox:"allow-modals allow-scripts allow-forms"}),b.append(d),d.on("load",w);if("doc"===this.file.preview_type)return s=this._get_extension(this.file.filename),r=this._get_preview_type_from_extension(s),C=this._get_progressive_url(s,this.file.direct_blockserver_link),t||(C=C.updateQuery({generate_preview:1}),C.setAuthority(C.getAuthority().replace("dl-web","dl-doc"))),p="ppt"===r,C.updateQuery("sjid",this.file.sjid),this._pdfLoader.openFile(C,{presentationMode:p}),C=this._get_pdf_js_url(),C=C.updateQuery(O.UID_PARAM_NAME,this.active_user),C=this._prepare_annotation_url(C),d=Se("<iframe/>",{src:String(C),type:"application/pdf"}),d.addClass("pdfjs"),b.append(d),d.on("load",w);if("html"===this.file.preview_type)return d=Se("<iframe/>",{src:this.file.href,sandbox:""}),b.append(d),d.on("load",w);if("excel"===this.file.preview_type)return C=this._get_progressive_url("xls",this.file.direct_blockserver_link),d=Se("<iframe/>",{src:C,sandbox:"allow-modals allow-scripts allow-forms"}),this._set_previews_sandbox_params("xls",d),b.append(d),d.on("load",w);if("keynote"===this.file.preview_type)return C=this._get_progressive_url("html",this.file.href),C=C.updateQuery({generate_preview:1}),C=C.updateQuery({post_message_on_failure:1}),d=Se("<iframe/>",{src:C,type:"text/html"}),b.append(d),d.on("load",w);if("adobecs"===this.file.preview_type)return C=this._get_progressive_url("adobecs",this.file.direct_blockserver_link),C=C.updateQuery({generate_preview:1}),this._pdfLoader.openFile(C),C=this._get_pdf_js_url(),C=C.updateQuery(O.UID_PARAM_NAME,this.active_user),C=this._prepare_annotation_url(C),d=Se("<iframe/>",{src:String(C),type:"application/pdf"}),d.addClass("pdfjs"),b.append(d),d.on("load",w);if("linkfile"===this.file.preview_type)return this._remove_loading(),this._render_linkfile();if(i=this.currentFlippableFileIndex(),a=this._get_extension(this.file.filename),Ft.isFlippable(this.file.preview_type)){if(Se("#file-viewer .loading").css("z-index","1"),"video"===this.file.preview_type)k=this.file.video_transcode_url,S=this.file.thumbnail_url_tmpl;else if("photo"===this.file.preview_type)for("gif"===a&&this.file.bytes<=f.MAX_GIF_FILE_SIZE_B&&(l=o.parse(this.file.href).updateQuery({raw:1}).toString()),S=this.file.thumbnail_url_tmpl,c=[],E=[1,2,3,4,5,6,-1,-2],m=0,v=E.length;v>m;m++)u=E[m],h=i+u,h>=0&&h<this.flippable_files.length&&c.push(this.flippable_files[h].thumbnail_url_tmpl);return _={"preview-type":this.file.preview_type,"preview-url":k,"thumbnail-url-tmpl":S,gifUrl:l,"file-extension":a,"file-meta":{filename:this.file.filename,mtime:this.file.ts,formattedSize:this.file.size},imagesToPreload:c,index:i,count:this.flippable_files.length,totalFiles:this.total_files,onPrevious:function(e){return function(){return e.loadPreviousFlippable()}}(this),onNext:function(e){return function(){return e.loadNextFlippable()}}(this),onLoad:w,onError:function(e){return function(){e._remove_loading()}}(this)},(null!=(x=this._preview_flippable_component)?x.isMounted():void 0)?(g=this._preview_flippable_component.props,this._preview_flippable_component.setProps(_)):(y=ce.createElement(Ft,_),this._preview_flippable_component=ce.render(y,b.get(0)))}return this._render_blank()}},post_preview_message:function(e){var t,n,i,r,o,s,a,_,l;for(i=Se("#file-viewer .preview-content-container iframe"),_=[],r=0,o=i.length;o>r;r++)n=i[r],l=n.src,a="://",s=l.indexOf(a),t=-1===s?l.indexOf("/"):l.indexOf("/",s+a.length),-1!==t&&(l=l.substring(0,t)),_.push(n.contentWindow.postMessage(e,l));return _},_watchFile:function(){return oe.getGandalfRule("tap-to-refresh")?this.watcher=new m(this.file,this.active_user,this._rerenderPreview.bind(this)):void 0},_rerenderPreview:function(){var e;return e=Se("#file-viewer .preview-content-container iframe"),e.attr("src",e.attr("src"))},_unwatchFile:function(){var e;return null!=(e=this.watcher)&&e.stop(),delete this.watcher},loadPreviousFlippable:function(){var e;return Ft.isFlippable(this.file.preview_type)&&this.currentFlippableFileIndex()>0?(this.load(this.flippable_files[this.currentFlippableFileIndex()-1]),this.set_preview_url(),e=this._getFilesToPreloadActivities(),Se("#file-viewer").trigger("db:filepreview:prev",[this.file,this.file_view_target,this.active_user.id,e])):void 0},loadNextFlippable:function(){var e;return Ft.isFlippable(this.file.preview_type)&&this.currentFlippableFileIndex()<this.flippable_files.length-1?(this.load(this.flippable_files[this.currentFlippableFileIndex()+1]),this.set_preview_url(),e=this._getFilesToPreloadActivities(),Se("#file-viewer").trigger("db:filepreview:next",[this.file,this.file_view_target,this.active_user.id,e])):void 0},_listen:function(){var e,t,n;return e=Se("#file-viewer"),this._pdfLoader.startListening(),Je.addFileDragEnabledCheck(this._is_browse_drag_enabled),e.find(".js-close-button").on("click",Se.proxy(this._on_close,this)),this._watchFile(),this.has_key_listener||(key("esc",this.KEY_SCOPE,function(e){return function(t){return mt.isFullscreen()||je.focus_in_input()||je.is_input(t.target)||Se(".annotation-bubble").length>0?void 0:e._teardown_and_hide()}}(this)),key("left",this.KEY_SCOPE,function(e){return function(){return e.loadPreviousFlippable()}}(this)),key("right",this.KEY_SCOPE,function(e){return function(){return e.loadNextFlippable()}}(this)),this.has_key_listener=!0),this.prev_scope=key.getScope(),key.setScope(this.KEY_SCOPE),this.modal_type===this._MODAL_PREVIEW?(e.find(".share-button").on("click",Se.proxy(this._share,this)),n=function(e){return function(t){return e.file.fq_path.toLowerCase()===t.memo.fq_path.toLowerCase()?(e.file.tkey=t.memo.tkey,e._update_title_bar_buttons()):void 0}}(this),t=function(e){return function(t){return e.file.tkey===t.memo.token?(e.file.tkey=null,e._update_title_bar_buttons()):void 0}}(this),this.share_link_callback=n.bind(this),this.remove_link_callback=t.bind(this),document.observe(s.LINKS_ADD,this.share_link_callback),document.observe(s.LINKS_REMOVE,this.remove_link_callback)):this.modal_type===this._MODAL_FILEINFO&&e.find(".share-button").on("click",Se.proxy(this._share,this)),Se(window).on("resize",Se.proxy(this._resize,this)),this.handleMessageFromChild=function(e){switch(e.action){case"failed":return ro.render_file_failed();case"lock_preview":return ro.preview_locked=!0;case"unlock_preview":return ro.preview_locked=!1;case"toggle_preview_lock":return ro.preview_locked=!ro.preview_locked;case"hide_iframe":return ro._teardown_and_hide();case"loaded":return ro.post_preview_message('{"action":"listening_sfj"}');case"pagerendered":return ro._handle_page_rendered(e.parameters)}},this._frameMessenger=new it,this._frameMessenger.configureChildMessaging(".preview-content-container > iframe",Se.proxy(this.handleMessageFromChild,this),["failed","lock_preview","unlock_preview","toggle_preview_lock","hide_iframe","loaded","pagerendered"]),this._frameMessenger.startListening(),window.onbeforeunload=function(){return ro.preview_locked?"":void 0}},_unlisten:function(){var e;return e=Se("#file-viewer"),this._pdfLoader.stopListening(),e.off("click",Se.proxy(this._teardown_and_hide,this)),Je.removeFileDragEnabledCheck(this._is_browse_drag_enabled),e.find("#file-viewer-container").off("click",function(e){return e.stopPropagation()}),e.find(".js-close-button").off("click",Se.proxy(this._on_close,this)),this.modal_type===this._MODAL_PREVIEW?(e.find(".share-button").off("click",Se.proxy(this._share,this)),e.find(".download-button").off("click"),Se(document).off("click",fi.hide_all),document.stopObserving(s.LINKS_ADD,this.share_link_callback),document.stopObserving(s.LINKS_REMOVE,this.remove_link_callback)):this.modal_type===this._MODAL_FILEINFO&&e.find(".share-button").off("click",Se.proxy(this._share,this)),Se(window).off("resize",Se.proxy(this._resize,this)),key.setScope(this.prev_scope),this._unwatchFile()},_resize:function(){},_share:function(e){return rt.ShmodelUILogger.log("via-browse-file-viewer"),e.preventDefault(),oe.getGandalfRule("simple-sharing")?ti.createAndShowInbandModalFromFile(this.active_user,this.file):new Qn(this.active_user.id,this.file.fq_path,"file_viewer").show()},_on_close:function(e){return e.preventDefault(),this._teardown_and_hide()},_teardown_and_hide:function(){var e;if(!this.hiding&&(this.hiding=!0,this.clear_preview_url_timer(),this.unload_office_static(),this._trigger_preview_state_update({preview_state:"closed",file_obj:null}),!this.preview_locked||confirm("You have unsaved changes. Are you sure you want to leave this page?")))return this.preview_status_timeout_obj&&(clearTimeout(this.preview_status_timeout_obj),this.preview_status_timeout_obj=null),this.preview_status_request&&(this.preview_status_request.abort(),this.preview_status_request=null),this._file_view_target_is_private()&&Sr.set_selected_files(this.file),(this._file_view_target_is_private()||this._file_view_target_is_shared())&&ro.unset_preview_url(),je.scroll_unlock_document(),e=Se("#file-viewer"),e.css("pointer-events","none").fadeOut({duration:this._FADE_MSEC,always:function(t){return function(){var n,i,r;mt.isFullscreen()&&mt.exitFullscreen(),null!=__CONDITIONAL_JS__.UnityFeatures&&(r=zt("Download"),n=e.find(".download-button"),n.text(r),n.off("click")),t._hide_more_button(),e.removeClass("has-preview").removeClass("no-preview"),i=e.find(".preview-content-container"),ce.unmountComponentAtNode(i.get(0)),t._preview_flippable_component=null,i.empty(),e.find(".file-thumbnail img").attr({src:""}),e.find(".title-bar .filename").text(""),e.attr({class:""}),t._unlisten(),t._remove_loading(),document.title=t._cached_browser_window_title,t._cached_browser_window_title=null,t.last_file=t.file,t.file=null,t.preview_locked=!1,window.removeEventListener("message",t.preview_lock_listener),t.is_loaded=!1,t.hiding=!1,t.cancel_check_lock(),e.trigger("db:filepreview:close")}}(this)})},_handle_page_rendered:function(e){var t,n,i,r,o,s,a,_,l;if(!this._first_render_completed){for(t=_t.file_extension_for_logging(this.file.filename),l=e.stats,s=null!=(null!=(a=this.file)?a.bytes:void 0)?this.file.bytes:0,r=Se.extend(e.attributes,{total_time:Date.now()-this._start_time,file_ext:t,source:"file-viewer",originalSize:s,docPreviewStatus:this.file.doc_preview_status}),n=0,i=l.length;i>n;n++)_=l[n],o=function(){switch(_.name){case"Page Request":return"viewer_page_request_time";case"Rendering":return"viewer_rendering_time";case"Overall":return"viewer_overall_time"}}(),r[o]=_.end-_.start;return rt.UserActivityLogger.log("web","file_view_first_page_rendered",r),rt.PreviewActivityLogger.log("file_view_first_page_rendered",{file_ext:t,extra:JSON.stringify(r)}),this._first_render_completed=!0}},resize:function(){return this._resize(null)},hide:function(){return this._teardown_and_hide()},_is_annotation_marker_enabled:function(){return"True"===Se("#file-viewer").attr("data-docpreview-annotation-marker-enabled")&&this.annotation_enabled_for_this_revision},_is_annotation_highlight_enabled:function(){return"True"===Se("#file-viewer").attr("data-docpreview-annotation-highlight-enabled")&&this.annotation_enabled_for_this_revision},_is_annotation_region_enabled:function(){return"True"===Se("#file-viewer").attr("data-docpreview-annotation-region-enabled")&&this.annotation_enabled_for_this_revision;

},_is_saveas_experiment_enabled:function(){return"True"===Se("#file-viewer").attr("data-docpreview-saveas-experiment")}};var oo;oo=ft.Index2={init:function(e,t){var n,i,r,o,s,a,_,l,u;for(t&&Se("#sign-in").on("click",function(e){var t,n,i,r,o;return e.preventDefault(),i=Se("#sign-in-form"),mi.show(zt("Sign in"),i[0],!1,!1,416,!1,"sign-in-modal"),n=i.find("#login_email"),n.focus(),new y(t=n,o=function(){return i.find("#password-field").hide(),i.find("#remember-me").hide(),i.find("#login_submit").val(zt("Continue")),i.find("#forgot_password_link").hide(),i.find("#sso_description_footer").show()},r=function(){return i.find("#password-field").show(),i.find("#remember-me").show(),i.find("#login_submit").val(zt("Sign in")),i.find("#forgot_password_link").show(),i.find("#sso_description_footer").hide()})}),n=function(){return Se("#signup-container").hasClass("form_shown")?void 0:Se.when(Se("#signup-container").animate({marginTop:-245},{easing:"easeInOutCubic",duration:500}).promise()).done(function(){return Se("#signup-container").addClass("form_shown"),Se("#signup-container .text-input input:visible").first().focus()})},e?Se(".photo").show():(Se(".register").find(".login-button").on("click",function(e){return Se("#signup-container").hasClass("form_shown")?void 0:(e.preventDefault(),n())}),oo.animate()),i=function(){return Se("#signup-container").hasClass("form_shown")?void 0:Se(".register").find(".login-button").trigger("click")},Se(".buttons .freshbutton-blue").on("click",function(e){return e.preventDefault(),Se("html, body").animate({scrollTop:0},{queue:!1,duration:500,complete:i}),!1}),Se("#learn-more").on("click",function(e){return e.preventDefault(),Se("html, body").animate({scrollTop:Se("#divider").offset().top},{queue:!1,duration:500}),!1}),Ye.are_enabled()?rt.WebMiscActivityLogger.log("index_page",{event_name:"cookies_enabled"}):k.error(zt("Please enable browser-cookies to use the Dropbox website.")),u=["#devices-background",".register-button","#learn-more",".buttons .freshbutton-blue",".buttons .freshbutton-silver","#sign-in a","#page-header .downloading-link"],r=function(e){return Se(e).on("click",function(){return rt.WebMiscActivityLogger.log("index_page",{event_name:"click",id:e})})},s=0,a=u.length;a>s;s++)o=u[s],r(o);return l=[".bullet-0 .subline",".bullet-0 .description",".bullet-1 .subline",".bullet-1 .description",".bullet-2 .subline",".bullet-2 .description",".bullet-3 .subline",".bullet-3 .description",".bottom .buttons"],_={},Se(window).scroll(function(){var e,t,n,i,r,o,s,a;for(a=[],o=0,s=l.length;s>o;o++)n=l[o],Se(n).length&&!_[n]?(t=Se(window).scrollTop(),e=t+Se(window).outerHeight(),r=Se(n).offset().top,i=r+Se(n).outerHeight(),e>=i?(rt.WebMiscActivityLogger.log("index_page",{event_name:"scroll",id:n}),a.push(_[n]=!0)):a.push(void 0)):a.push(void 0);return a})},_animate_points:function(e,t,n,i,r,o,s){var a,_,l,u;return null==s&&(s=0),s=Math.min(Math.max(s,0),1),l=o(s),u=[function(){var e,i,r;for(r=[],a=e=0,i=t.length;i>=0?i>e:e>i;a=i>=0?++e:--e)r.push([function(){var e,i;for(i=[],_=e=0;2>e;_=++e)i.push(t[a][_]+(n[a][_]-t[a][_])*l);return i}()]);return r}()],e.attr("points",oo.points_array_to_str(u)),s>=1?r.resolve():setTimeout(function(){return oo._animate_points(e,t,n,i,r,o,s+10/i)},10)},animate_points:function(e,t,n,i,r,o){var s;return null==o&&(o=jQuery.easing.linear),s=Se.Deferred(),oo._animate_points(e,t,n,i,s,o),s.done(function(){return"function"==typeof r?r():void 0}).promise()},animate_hide_rects:function(e,t,n){var i,r,o,s,a;for(i=Se.Deferred().resolve().promise(),r=function(n){var r,o,s,a,_;return a=Se(e[n]),r=oo.points_str_to_array(a.attr("points")),_=[r[1],r[1],r[2],r[2]],o=oo.inverse(jQuery.easing.linear),s=t*(o((n+1)/e.length)-o(n/e.length)),i=i.then(function(){return oo.animate_points(a,r,_,s)})},o=s=0,a=e.length;a>=0?a>s:s>a;o=a>=0?++s:--s)r(o);return i.done(function(){return"function"==typeof n?n():void 0}).promise()},animate_delay:function(e){var t;return t=Se.Deferred(),setTimeout(t.resolve,e),t.promise()},animate:function(){return Se.Deferred().resolve().promise().then(function(){return oo.animate_docs()}).then(function(){return oo.animate_graphs()}).then(function(){return oo.animate_photos()})},inverse:function(e,t){return null==t&&(t=1e-6),function(n){var i,r,o;for(r=0,i=1;i-r>t;)o=(r+i)/2,e(o)<n?r=o:i=o;return r}},points_str_to_array:function(e){var t,n,i,r,o,s;for(o=e.split(" "),s=[],n=0,i=o.length;i>n;n++)r=o[n],s.push(function(){var e,n,i,o;for(i=r.split(","),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(parseFloat(t));return o}());return s},points_array_to_str:function(e){var t;return function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(t.join(","));return r}().join(" ")},animate_docs:function(){var e,t,n,i,r,o,s;for(s=[[5,6],[177,1],[184,157],[13,180]],n="",o=t=.475;.625>=t;o=t+=.05)e=o+.05,i=[[s[0][0]+(s[3][0]-s[0][0])*o,s[0][1]+(s[3][1]-s[0][1])*o],[s[1][0]+(s[2][0]-s[1][0])*o,s[1][1]+(s[2][1]-s[1][1])*o],[s[1][0]+(s[2][0]-s[1][0])*e,s[1][1]+(s[2][1]-s[1][1])*e],[s[0][0]+(s[3][0]-s[0][0])*e,s[0][1]+(s[3][1]-s[0][1])*e]],i=oo.points_array_to_str(i),n+="<polygon points='"+i+"' style='fill:#f5f9fc;stroke:none;' />";return r=Se('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="190" width="188">\n   '+n+"\n</svg>"),Se.Deferred().resolve().promise().then(function(){return Se(".doc, .graph, .photo").hide(),Se(".comp.doc").append(r),Se(".comp.doc").show("slide",{direction:"down"},850).promise()}).then(function(){return oo.animate_hide_rects(r.find("polygon"),2500,function(){return r.remove()})}).then(function(){return oo.animate_delay(500)}).then(function(){return Se(".tablet.doc, .phone.doc").show("fade",{easing:"easeInOutCubic"},400).promise()}).then(function(){return oo.animate_delay(1500)}).then(function(){return Se(".tablet.doc, .phone.doc, .comp.doc").hide("fade",{easing:"easeInOutCubic",duration:700}).promise()})},animate_graphs:function(){var e,t;return e=[[83,98],[158,37],[241,77],[171,145]],t=Se('<svg xmlns="http://www.w3.org/2000/svg" version="1.1">\n    <polygon style="fill:#f5f9fc;stroke:none;"/>\n</svg>'),t.find("polygon").attr("points",oo.points_array_to_str(e)),Se.Deferred().resolve().promise().then(function(){return Se(".doc, .graph, .photo").hide(),Se(".tablet.graph .graph-grid").hide(),Se(".tablet.graph").append(t),Se(".tablet.graph").show("fade",{},500).promise()}).then(function(){var n;return n=[e[0],e[1],e[1],e[0]],oo.animate_points(t.find("polygon"),e,n,600,function(){return t.remove()})}).then(function(){return st.msie_version_at_most(8)?void 0:Se(".tablet.graph .graph-grid").show("fade",{},400).promise()}).then(function(){return oo.animate_delay(500)}).then(function(){return Se(".comp.graph, .phone.graph").show("fade",{easing:"easeInOutCubic"},500).promise()}).then(function(){return oo.animate_delay(2e3)}).then(function(){return Se(".graph").hide("fade",{easing:"easeInOutCubic"},700).promise()})},animate_photos:function(){return Se.Deferred().resolve().promise().then(function(){return Se(".doc, .graph, .photo").hide(),Se(".phone.photo img").not(".photo-flash").css({left:-20.7,top:-66*1.15,position:"absolute"}),Se(".phone.photo").show(),Se.when(function(){return st.msie_version_at_most(8)?void 0:Se(".phone.photo .photo-flash").show().hide("fade",{},2e3).promise()}(),function(){return Se.Deferred().resolve().promise().then(function(){return Se(".phone.photo img").not(".photo-flash").animate({left:0,top:0},{duration:800,easing:"easeInOutCubic"}).promise()}).then(function(){return oo.animate_delay(750)}).then(function(){return Se(".tablet.photo, .comp.photo").show("fade",{easing:"easeInOutCubic"},500).promise()})}())})}};var so,ao,_o;_o=ft.UnsupportedBrowser={init:function(){return Se("#unsupported-browser-dismiss").on("click",function(e){return e.preventDefault(),Ht.hide(),Se.ajax({url:"/dismiss_browser_msg",type:"POST"})})}},ao=ft.ExpiredCCNotificationBar={init:function(e){return Se(".expired-dismiss").on("click",function(t){return t.preventDefault(),Ht.hide(),Se.ajax({url:"/dismiss_expired_cc_notification",type:"POST",data:{source:e}})})}},so=ft.BetaLocaleNotificationBar={init:function(e){return Se(".beta-locale-dismiss").on("click",function(t){return t.preventDefault(),Ht.hide(),Se.ajax({url:"/dismiss_beta_locale_notification",type:"POST",data:{source:e}})})}};var lo;lo=INLINE_JS.viewer=G.get_viewer();var uo,co,ho,fo,po,mo,vo,go;if(Se(zr.check_timezone),window._document_observe_listeners)for(vo=window._document_observe_listeners,co=0,fo=vo.length;fo>co;co++)mo=vo[co],document.loaded?mo.func():document.observe(mo.event,mo.func);if(window._jquery_ready_handlers)for(go=window._jquery_ready_handlers,ho=0,po=go.length;po>ho;ho++)uo=go[ho],Se(uo);return Se(function(){return Event.fire(document,"script:loaded")}),ft});