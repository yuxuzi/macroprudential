(function(){var e=function(e,o){function n(){this.constructor=e}for(var r in o)t.call(o,r)&&(e[r]=o[r]);return n.prototype=o.prototype,e.prototype=new n,e.__super__=o.prototype,e},t={}.hasOwnProperty;define("modules/clean/dropins/desktop_saver",["jquery","external/react","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/em_string","modules/clean/filepath","modules/clean/viewer","modules/clean/dropins/universal_saver","modules/clean/dropins/multi_login_iframe","modules/clean/react/dropins/breadcrumbs"],function(t,o,n,r,i,s,u,l,a,c,_,d){var p,h,f,m;return f=n.assert,h=i._,m=i.ungettext,p=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,n),r.prototype.ACCEPTABLE_LABEL_TXT_WIDTH=55,r.prototype.MAX_SAVE_BUTTON_FOLDER_EM_LENGTH=14,r.prototype.init_ui=function(){var e;return this._update_label_widths(),t("#file-container").on("click",".delete-file",function(e){return function(o){var n;t(o.currentTarget).parents(".file-to-save").remove(),n=t(".file-to-save").length,0===n&&e.host_site.close_dialog(),e.update_files_state(e.get_files())}}(this)),e=o.createElement(d,{fqPath:"",rootName:h(a.get_viewer().is_paired?"Files":"Dropbox"),onClick:function(e){return function(t){return e.browse(t)}}(this)}),this._breadcrumbs=o.render(e,t("#breadcrumbs-header")[0]),t("#browse-file-list").on("click","li",function(e){return function(o){var n,r;return n=t(o.currentTarget),n.hasClass("directory")?(r=n.data("fqpath"),e.browse(r,n)):void 0}}(this)),this.act_paired&&(this.multi_login_manager=new _.DropinsMultiLoginManager(null),t("#role-selector").on("click","li",function(e){return function(o){var n,r;return n=t(o.currentTarget),r=n.data("uid"),e._prompt_login_and_set_uid(r,function(){return e.browse(e.user_to_root_map[r])})}}(this)),t("#account-header .user-list-item").click(function(e){return function(o){var n,r;return n=t(o.currentTarget),r=n.data("uid"),r?e._prompt_login_and_set_uid(r):void 0}}(this))),t("#dest-menu").on("click","li.folder",function(e){return function(o){return e._prompt_login_and_set_uid(t(o.currentTarget).data("uid"),null,function(){return t("#dest-menu li").removeClass("selected"),t("#dest-menu li[data-uid="+this.subject_uid+"]").addClass("selected")})}}(this))},r.prototype._update_label_widths=function(){var e,o,n;return o=t("#files-main .label-txt").outerWidth(),n=t("#files-navbar .label-txt").outerWidth(),e=Math.max(o,n,this.ACCEPTABLE_LABEL_TXT_WIDTH),t("#dest-menu, #file-container").css("left",e+"px")},r.prototype.update_files_state=function(e){return this._update_file_count(e.length),setTimeout(function(e){return function(){return e._update_label_widths()}}(this),0),this._update_size()},r.prototype.update_view_state=function(){return this._update_size()},r.prototype.get_destination_folder=function(){return t("#dest-menu li.selected").data("value")},r.prototype.get_destination_uid=function(){return t("#dest-menu li.selected").data("uid")},r.prototype.on_browse_start=function(e){return this._update_breadcrumbs(e),this._update_choose_button()},r.prototype._update_choose_button=function(){return a.get_viewer().is_paired&&this._last_browse_path===this.files_root?t("#choose-location-btn").hide():t("#choose-location-btn").show(),t("#choose-location-btn").val(this._get_choose_button_string())},r.prototype._get_choose_button_string=function(){var e;return e=l.filename(this._last_browse_path),u.em_snippet(h("Save to %(folder_name)s").format({folder_name:e}),this.MAX_SAVE_BUTTON_FOLDER_EM_LENGTH)},r.prototype._get_total_length=function(e){var t,o,n,r;for(f(e.length>0),r=0,t=0,o=e.length;o>t;t++)n=e[t],r+=new u(l.filename(n)).length+this.EMSTRING_SPACE_AROUND_SLASH;return r-this.EMSTRING_SPACE_AROUND_SLASH},r.prototype._update_breadcrumbs=function(e,t){return null==t&&(t=this.subject_uid),e=e.split("/").slice(1).join("/"),this._breadcrumbs.setProps({fqPath:e})},r.prototype._update_file_count=function(e){var o;return o=1===e?h("File"):m("%(count)d file","%(count)d files",e).format({count:e}),t("#files-main .label-txt").text(o)},r.prototype._preferred_height=function(){var e,o;return t("#saver-files").is(":visible")?(e=52,o=209+Math.min(this.get_files().length-1,5)*e,this.get_files().length>6&&(o+=e/2),t("#quota-warning").is(":visible")&&(o+=t("#quota-warning").outerHeight()),o):Math.max(t(document).height(),426)},r.prototype._update_size=function(){return this.host_site.resize(352,this._preferred_height())},r.prototype._prompt_login_and_set_uid=function(e,t,o){var n,r;return a.get_viewer().is_uid_signed_in(e)?(this.subject_uid=e,"function"==typeof t?t():void 0):(r=function(o){return function(){var n,r,i,s;for(o._update_size(),o.subject_uid=e,"function"==typeof t&&t(),s=o.run_when_logged_in[e],r=0,i=s.length;i>r;r++)(n=s[r])();return o.run_when_logged_in[e]=[]}}(this),n=function(e){return function(){return"function"==typeof o&&o(),e._update_size()}}(this),this.host_site.resize(495,305),this.multi_login_manager.show(r,n))},r.prototype._reenable_choose_location_button=function(){return t("#choose-location-btn").prop("disabled",!1).val(this._get_choose_button_string())},r}(c)})}).call(this),function(){define("modules/clean/dropins/hostsite_generic",["jquery","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/ajax"],function(e,t,o,n,r,i){var s,u,l;return l=o.assert,u=n._,s=function(){function o(e,t,o,n){this._version=e,this._is_fb=!1,this._app_key=t,this._origin=o,this._link_type=n,this._parent_communication_error=!1}return o.prototype.CLOSE_MAX_TIME_LIMIT=500,o.prototype._send_message=function(e,o){var n;return null==o&&(o=null),l(this._origin,"Origin must be defined!"),n=JSON.stringify({method:e,params:o}),null!=window.DROPINS_HOST?window.DROPINS_HOST.postMessage(n,this._origin):window.opener?t.msie_version_at_most(11)?window.opener.frames.dropbox_xcomm.sendMessage(n,this._origin,window):window.opener.postMessage(n,this._origin):window.parent!==window.self?window.parent.postMessage(n,this._origin):(this._parent_communication_error=!0,r.error(u("Unable to communicate with the parent window")))},o.prototype._expecting_window_close=function(){return clearTimeout(this._close_timer),this._close_timer=setTimeout(function(e){return function(){return e._parent_communication_error?void 0:r.error(u("Unable to close this window. Please close it manually and return to the previous site."))}}(this),this.CLOSE_MAX_TIME_LIMIT)},o.prototype.ready=function(){return this._send_message("ready")},o.prototype.close_dialog=function(){return this._send_message("close_dialog"),this._expecting_window_close()},o.prototype.publish_files=function(e,t){var o,n;return n=function(e){return function(t){return e._send_message("files_selected",t),e._expecting_window_close()}}(this),o=function(){return function(){return r.error(u("Unable to share the file"))}}(this),new i.WebRequest({url:"/dropins/share",data:{version:this._version,uid_and_fq_paths:JSON.stringify(e),link_type:this._link_type,app_key:this._app_key,source:t},dataType:"json",success:n,error:o})},o.prototype.web_session_token=function(e){return this._send_message("web_session_token",e)},o.prototype.web_session_error=function(){return this._send_message("web_session_error")},o.prototype.resize=function(t,o){var n,r,i;return i=null,n=3,window.opener?(r=function(){var s,u;return window.outerWidth<window.innerWidth||window.outerHeight<window.innerHeight?void(n>0&&(n--,clearTimeout(i),i=setTimeout(r,100))):t>=250&&o>=150?(u=t-e(window).width(),s=o-e(window).height(),window.moveBy(-u/2,-s/2),window.resizeBy(u,s)):void 0})():this._send_message("resize",{width:t,height:o})},o.prototype.unlink_web_session_token=function(){return new i.WebRequest({url:"/dropins/unlink_web_session_token",data:{app_key:this._app_key},dataType:"json",success:function(e){return function(){return e._send_message("web_session_unlinked")}}(this),error:function(){return function(){return r.error(u("Failed to unlink"))}}(this)})},o.prototype.files_saved=function(){return this._send_message("files_saved"),this._expecting_window_close()},o.prototype.job_id=function(e){return this._send_message("job_id",e)},o.prototype.progress=function(e){return this._send_message("progress",e)},o.prototype.error=function(e){return this._send_message("error",e)},o.prototype.save_callback=function(e){return this._send_message("save_callback",e)},o.prototype._log=function(e){return this._send_message("_debug_log",{msg:e})},o}()})}.call(this),function(){var e=[].slice,t=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/dropins/login",["jquery","modules/core/cookies","modules/core/controller_helpers","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/viewer"],function(o,n,r,i,s,u,l,a,c){var _,d,p,h;return h=s._,_=function(){function t(e,t){var i,s,l,a,_,d,p;switch(this.host_site=e,n.are_enabled()||u.error(h("Please enable cookies to use the Dropbox website."),100),t){case"popup":null==window.opener&&u.error(h("Sorry, unable to find the parent page.")),s=function(){var e;return null!=(e=window.opener)&&e.location.reload(),window.close()},i=function(){return window.close()};break;case"web_session":s=function(){return window.location.reload()},i=function(e){return function(){return e.host_site.web_session_error()}}(this);break;default:s=function(){return window.location.reload()},i=function(e){return function(){return e.host_site.close_dialog()}}(this)}for(p=o("form"),_=0,d=p.length;d>_;_++)a=p[_],l=r.get_controller(o(a)),l.send_request=this.safari_workaround(l.send_request.bind(l));o(document).on("db:login:success db:register:success",s),o(".cancel-btn").click(function(){return i(),!1}),c.get_viewer().is_signed_in&&s(),this.host_site.resize(660,440),o("input.autofocus").first().focus()}return t.prototype.safari_workaround=function(t){return function(){var n,r;return n=1<=arguments.length?e.call(arguments,0):[],document.cookie?t.apply(null,n):(r=window.open("/dropins/cookie","_blank","width=10,height=10"),o(r).load(function(){return r.close(),t.apply(null,n)}))}},t}(),p=function(){function e(e){var t;this.host_site=e,t=o("#web-session-confirm"),t.click(function(e){return function(){var o;return o=t.data("confirm-for-uid"),e.create_web_session_token(o)}}(this)),o("#web-session-deny").click(function(e){return function(){return e.host_site.web_session_error()}}(this))}return e.prototype.create_web_session_token=function(e){return a.WebRequest({url:"/dropins/create_web_session_token",data:{app_key:this.host_site._app_key},dataType:"json",subject_user:e,success:function(e){return function(t){return e.host_site.web_session_token(t.token)}}(this),error:function(e){return function(){return e.host_site.web_session_error()}}(this)})},e}(),d=function(){function e(e){var n,r,i;this.host_site=e,this.check_cookie_enabled=t(this.check_cookie_enabled,this),n=function(e){var t,o,n,r;return r=660,t=440,o=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-r)/2,n=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-t)/2,open(e,"dropbox_login","width="+r+",height="+t+",left="+o+",top="+n+",resizable=yes")},i="/dropins/login_popup",r=l({path:i,query:{app_key:this.host_site._app_key,default_view:"register"}}).toString(),o("#popup-sign-in").click(function(){return function(){return n(i)}}(this)),o("#popup-sign-up").click(function(){return function(){return n(r)}}(this)),o(".cancel-btn").click(function(e){return function(){return e.host_site.close_dialog()}}(this)),this.check_cookie_enabled()}return e.prototype.check_cookie_enabled=function(){var e;return n.are_enabled()?void 0:(e=h('Please enable third-party cookies to use the Dropbox website. <a target="_blank" href="/help/8807#cookies">Learn more</a>'),u.error(new i(e),100))},e}(),{DropinLogin:_,DropinWebSession:p,DropinPopupLogin:d}})}.call(this),function(){var e=function(e,o){function n(){this.constructor=e}for(var r in o)t.call(o,r)&&(e[r]=o[r]);return n.prototype=o.prototype,e.prototype=new n,e.__super__=o.prototype,e},t={}.hasOwnProperty,o=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/dropins/mobile_chooser",["jquery","modules/core/i18n","modules/core/notify","modules/core/browser","modules/core/html","modules/clean/ajax","modules/clean/binary_search","modules/clean/filepath","modules/clean/sprite","modules/clean/viewer","modules/clean/dropins/universal_chooser","modules/clean/dropins/tappable","modules/clean/dropins/mobile_util"],function(t,n,r,i,s,u,l,a,c,_,d,p,h){var f,m,b;return m=n._,b=n.ungettext,f=function(n){function d(){return d.__super__.constructor.apply(this,arguments)}return e(d,n),d.prototype.PHOTO_BATCH_SIZE=200,d.prototype._max_file_count=2e3,d.prototype.ui_init=function(){return this._visible_photos_index=[0,0],this._photos_old_cursors=[],this._photos_cursor=null,this._all_photos=[],this._li_tmpl=s.tmpl("dropin_list_item_tmpl"),this._photo_li_tmpl=s.tmpl("photo_list_item_tmpl"),this.set_mode(this._browse_mode_map[this._current_user.id]),this.browse("",this._current_user.id),t("#sign-out-link").click(function(){return window.location.href="/logout?cont="+encodeURIComponent(window.location.href)}),p(t("#nav-back"),function(e){return function(){return e.browse(t("#nav-back").data("fq_path"),e._current_user.id)}}(this)),p(t(".file-list, #photo-list"),"li",{touchDelay:0,touchstartCallback:function(){return function(){return t(".touched").removeClass("touched")}}(this),callback:function(e){return function(o){var n,r,i;return r=t(o.target).closest("li"),r.hasClass("directory")?(n=r.data("fqpath"),i=r.data("uid"),e.browse(n,i)):r.hasClass("selectable")?r.hasClass("selected")?e.deselect(r):e.select(r):void 0}}(this)}),h.hide_ios_navbar(),p(t("#chooser-topbar"),"span",function(e){return function(t){var n;return n=t.currentTarget.className,e.set_mode(n),o.call(n,"dropbox")>=0?e.browse("",e._current_user.id):void 0}}(this)),t("#select-btn").click(function(e){return function(){return e.share_selected()}}(this)),t(".pane-btns .search").click(function(){return t("#search-input").focus().click()}),t("#search-input").on("input",function(e){return function(){return e.search(t("#search-input").val())}}(this)),i.safari&&(t("#search-input").focus(function(){return t("#chooser-footer").css("display","none")}),t("#search-input").blur(function(){return t("#chooser-footer").css("display","")})),setInterval(function(){return h.load_thumbs_special(t(".chooser-thumb:visible"),window),h.load_thumbs_special(t(".dropin-file:visible"),window)},1e3),t(window).scroll(function(e){return function(){return"photos"===e._mode?e.draw_sticky_date():void 0}}(this)),t(window).on("orientationchange",function(e){return function(){return e.center_photo_list()}}(this)),t(window).resize(function(e){return function(){return e.center_photo_list()}}(this)),p(t("#load-more-photos"),function(e){return function(){return t("#photo-list").empty(),e.deselect_all(),e._visible_photos_index=[e._visible_photos_index[1],e._visible_photos_index[1]],e.fetch_photos()}}(this)),p(t("#load-prev-photos"),function(e){return function(){var o,n;return t("#photo-list").empty(),e.deselect_all(),n=Math.max(e._visible_photos_index[0]-e.PHOTO_BATCH_SIZE,0),o=e._visible_photos_index[0],e._visible_photos_index=[n,n],e.render_photo_list(e._all_photos.slice(n,o),t("#photo-list"))}}(this))},d.prototype.init_photos=function(){return this.fetch_photos()},d.prototype.fetch_photos=function(){var e,n,i;return n=function(e){return function(n){var r;return e._all_photos.push.apply(e._all_photos,n.photos),r=n.cursor,o.call(e._photos_old_cursors,r)>=0&&t("#chooser").addClass("all-photos-fetched"),e._photos_cursor=n.cursor,e.render_photo_list(n.photos,t("#photo-list"))}}(this),e=function(){return function(){return r.error(m("Unable to load photos"))}}(this),i=this._photos_cursor,o.call(this._photos_old_cursors,i)>=0?void 0:(this._photos_old_cursors.push(this._photos_cursor),t("#chooser").addClass("loading-photos"),u.WebRequest({url:"/dropins/photos",data:{cursor:this._photos_cursor},dataType:"json",success:n,error:e,complete:function(){return t("#chooser").removeClass("loading-photos")},subject_user:_.get_viewer().photos_user}))},d.prototype.scroll_photos_below_load_prev_btn=function(){return setTimeout(function(){var e,o;return e=70,t(window).scrollTop((null!=(o=t(".chooser-thumb:first").offset())?o.top:void 0)-e-5),t("#load-prev-photos").css("visibility","visible")},1)},d.prototype.draw_sticky_date=function(){var e,o,n,r,i;return r=t("#chooser-sticky-date").offset().top,e=t("#photo-list .date-divider"),i=l(e,function(){return t(this).offset().top-r}),o=i[0],n=i[1],o||n--,t("#chooser-sticky-date").text(t(e[n]).text())},d.prototype.update_prev_photos=function(){return t("#chooser").toggleClass("prev-photos",this._visible_photos_index[0]>0)},d.prototype.update_nav=function(e){var o;return o=e.split("/").slice(-1)[0],t("#nav-back").toggleClass("disabled",""===o),t("#current-folder").text(""!==o?o:m("Dropbox")),t("#nav-back").data("fq_path",e.split("/").slice(0,-1).join("/"))},d.prototype.center_photo_list=function(){var e,o,n,r,i,s;return r=t(".chooser-thumb").first().width()+3,n=t("#chooser").width()-3,i=Math.floor(n/r),s=i*r,o=n-s,t("#photo-list").css("padding-left",o/2+"px"),t("#photo-list .date-divider").css("width",n+"px").css("left",-(o/2)+"px"),e=t(".date-divider + .chooser-thumb"),e.css("width","95px").css("padding-right","1px"),setTimeout(function(){return e.removeAttr("style")},300)},d.prototype.render_photo_list=function(e,o){var n,r,i,s,u,l,a;for(r=t("#photo-list .date-divider").last().text(),a=[],i=0,s=e.length;s>i;i++)u=e[i],u.fq_path=u.path,u.thumbnail_url=u.thumbnail_url,n=new Date(u.time_taken),l=this.pretty_date(n),l!==r&&(r=l,a.push(t("<li/>",{class:"date-divider"}).text(r))),u.selectable=this._fq_path_selectable(u.fq_path),a.push(this._photo_li_tmpl({photo:u,Sprite:c}).toHTML());return o.append(a),this._visible_photos_index[1]+=e.length,this.center_photo_list(),this.update_prev_photos(),t("#load-prev-photos").css("visibility","hidden"),this.scroll_photos_below_load_prev_btn(),this.draw_sticky_date()},d.prototype.get_browse_file_container=function(){return t("#browse-file-list")},d.prototype.render_file_info=function(e,t){var o,n,r,i,s,u;for(r="search"===this._mode,u=[],n=0,i=e.length;i>n;n++)o=e[n],o.caption=a.filename(o.fq_path),o.thumbnail=o.thumbnail_url_tmpl,r?(s=o.fq_path.split("/"),s[0]=m("Dropbox"),s.pop(),o.info=s.slice(-1)[0],o.tooltip=s.join(" › ")):o.info=o.tooltip="",o.selectable=this._fq_path_selectable(o.fq_path,o.is_dir),u.push(this._li_tmpl({file:o,Sprite:c,_:m}).toHTML());return t.toggleClass("empty-folder",0===e.length),t.html(u),t.toggleClass("scrolling",t[0].scrollHeight>t.height()),h.load_thumbs_special(".dropin-file",window)},d.prototype.on_update_selected_counter=function(){return this._multiselect&&setTimeout(function(){return t("#selected-count").text(""),t("#selected-count").text(t("li.selected").length)},300),t(".touched").removeClass("touched")},d.prototype.on_search_start=function(){},d.prototype.on_search_complete=function(){},d.prototype.on_mode_change=function(e){var o;return t(".pane-btns img.active:visible").hide(),t(".pane-btns img.inactive:hidden").show(),o=t(".pane-btns ."+e),o.find("img.inactive").hide(),o.find("img.active").show(),"user"!==e?t("#btn-pointer").css("left",o.offset().left+15).css("right","initial"):t("#btn-pointer").css("right",25).css("left","initial"),setTimeout(function(){return t(".pane-btns span.touched").removeClass("touched")},1),"photos"===e?(this.center_photo_list(),this.draw_sticky_date(),h.load_thumbs_special(".chooser-thumb",window)):void 0},d.prototype.pretty_date=function(e){var t,o,n,r,i;switch(o=new Date,o.setHours(0,0,0,0),t=Math.ceil((o.getTime()-e.getTime())/24/3600/1e3),!1){case!(0>t):return m("In the future");case 0!==t:return m("Today");case 1!==t:return m("Yesterday");case!(7>t):return b("%d day ago","%d days ago",t).format(t);case!(28>t):return r=Math.ceil(t/7),b("%d week ago","%d weeks ago",r).format(r);case!(365>t):return n=Math.ceil(t/31),b("%d month ago","%d months ago",n).format(n);case!(7300>t):return i=Math.ceil(t/365),b("%d year ago","%d years ago",i).format(i);default:return m("Unknown date")}},d}(d)})}.call(this),function(){var e=function(e,o){function n(){this.constructor=e}for(var r in o)t.call(o,r)&&(e[r]=o[r]);return n.prototype=o.prototype,e.prototype=new n,e.__super__=o.prototype,e},t={}.hasOwnProperty;define("modules/clean/dropins/mobile_saver",["jquery","modules/core/i18n","modules/clean/viewer","modules/clean/filepath","modules/clean/dropins/universal_saver","modules/clean/dropins/tappable","modules/clean/dropins/mobile_util"],function(t,o,n,r,i,s,u){var l,a;return a=o._,l=function(o){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,o),i.prototype.init_ui=function(){var e,o;return e=t("#account-popover"),o=t("#user"),this._current_folder="",s(o,function(t){return e.toggleClass("active"),o.toggleClass("active"),t.stopPropagation()}),s(t(document),function(t){return e.is(t.target)||e.has(t.target).length||o.is(t.target)||o.has(t.target).length?void 0:(e.removeClass("active"),o.removeClass("active"))}),s(t("#sign-out-btn"),function(){return window.location.href="/logout?cont="+encodeURIComponent(window.location.href)}),s(t(".file-list"),"li",{touchDelay:0,touchstartCallback:function(){return function(){return t(".touched").removeClass("touched")}}(this),callback:function(e){return function(o){var n,r;return n=t(o.target).closest("li"),n.hasClass("directory")?(r=n.data("fqpath"),e.browse(r,n)):void 0}}(this)}),s(t("#nav-back"),function(e){return function(){return e.browse(e._remove_prefixed_root(e._last_browse_path.split("/").slice(0,-1).join("/")))}}(this)),u.hide_ios_navbar()},i.prototype.update_files_state=function(){},i.prototype.update_view_state=function(){},i.prototype.get_destination_folder=function(){return t("#current-folder-saver").data("save-location")},i.prototype.get_destination_uid=function(){return n.get_viewer().get_users()[0].id},i.prototype.on_browse_start=function(e){return t("#nav-back").toggle(""!==e),t("#current-folder").text(r.filename(e)),window.scrollTo(0,1),t("#choose-location-btn").val(a("Save here"))},i.prototype._reenable_choose_location_button=function(){return t("#choose-location-btn").prop("disabled",!1).val(a("Save here"))},i}(i)})}.call(this),function(){define("modules/clean/dropins/mobile_util",["jquery","modules/clean/photos/legacy_thumb_loader"],function(e,t){var o;return o={load_thumbs_special:function(t,o){var n,r,i,s,u,l,a,c,_,d,p,h,f,m;if(null==o&&(o=window),p=e(t),0!==p.length){for(m=e(o).scrollTop(),f=e(o).height()+m,i=null,n=null,s=0,s=u=0,_=p.length;_>=0?_>u:u>_;s=_>=0?++u:--u)d=p[s],h=e(d).position().top,h>=0-e(d).height()&&(null==i&&h>=m&&f>=h&&(a=s-1,i=s),null==n&&h>f&&(c=s-1,n=s));if(null!=i)return null==n&&(c=p.length,n=c),l=Math.min(n+30,p.length),r=Math.max(a-30,0),this._load_thumbs_from_indices(p,i,c,n,r,l,a,"fp_122")}},_load_thumbs_from_indices:function(o,n,r,i,s,u,l){var a,c,_,d,p,h,f,m,b,g,v;for(b=function(t){return e(t).parent().addClass("thumb-loaded")},a=15,c=[],m=[[n,r],[i,u],[s,l]],p=0,f=m.length;f>p;p++)for(_=m[p],d=h=g=_[0],v=_[1];v>=g?v>=h:h>=v;d=v>=g?++h:--h)c.push(e(o[d]).find("img")[0]);return t.batch_load_thumbs(c,a,b)},hide_ios_navbar:function(){var t;return navigator.userAgent.match(/iPhone/i)&&navigator.userAgent.match(/Safari/i)&&!navigator.userAgent.match(/CriOS/i)?(e("body").css("min-height",e(window).height()+60+"px"),t=window.outerHeight,e("#chooser-main").css("bottom","-60px"),setTimeout(function(){return window.scrollTo(0,1)},1)):e("body").css("min-height",e(window).height()+"px")}}})}.call(this),function(){define("modules/clean/dropins/multi_login_iframe",["jquery","external/keymaster","modules/core/cookies","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/viewer","modules/constants/request"],function(e,t,o,n,r,i,s,u){var l,a;return l=function(){function t(t){e("#popup-sign-in").click(function(o){return function(){var n,i,s,u,l,a;a=410,n=310,i=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-a)/2,l=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-n)/2,u={user_id:t,restrict:e.ajaxSettings.restrict},s=new r({path:"/dropins/ajax_multi_login",query:u}).toString(),o.popup=open(s,"dropbox_login","width="+a+",height="+n+",left="+i+",top="+l+",resizable=yes"),o.popup.focus()}}(this))}return t.prototype.show=function(t,n){var r;return r=function(t){return function(){var o;return t.hide(),null!=(o=e("#ajax-multi-login")[0])&&o.contentDocument.location.reload(),"function"==typeof n?n():void 0}}(this),e("#multi-login-frame-background").one("click",r),e("body").addClass("switch-login"),e('input[name="login_password"]',e("#ajax-multi-login").contents()).focus(),e(window).on("db:multi_login_cancel",r),e(window).on("db:multi_login_success",function(n){return function(r,i){return s.get_viewer().sign_in_user_by_id(i),e("input[name=t]").val(o.read(u.JS_CSRF_COOKIE)),n.hide(),e(".show-after-login").show(),e(".hide-after-login").hide(),"function"==typeof t?t():void 0}}(this))},t.prototype.hide=function(){var t;return e("body").removeClass("switch-login"),null!=(t=this.popup)&&"function"==typeof t.close&&t.close(),e(window).off("db:multi_login_success db:multi_login_cancel")},t}(),a=function(){function t(t){var o,r;return(r=opener||parent)?(INLINE_JS.Notify=r.INLINE_JS.Notify,o=function(){return r.jQuery(r).trigger("db:multi_login_success",t)},s.get_viewer().is_uid_signed_in(t)?void o():(key("esc","all",function(){return r.jQuery(r).trigger("db:multi_login_cancel")}),void e(document).on("db:multilogin:success",function(){return o()}))):void n.error("Unable to contact parent window")}return t}(),{DropinsMultiLoginManager:l,DropinsMultiLoginWindow:a}})}.call(this),function(){define("modules/clean/dropins/tappable",["jquery"],function(e){var t,o,n,r;return t=380,o=function(e,t,o,n){return"function"==typeof e?e.call(t[0],o,n):void 0},r="ontouchstart"in window,n=function(i,s,u){var l,a,c;switch(a={cancelOnMove:!0,touchDelay:0,callback:null,touchstartCallback:null},c=!1,l=function(e){return c?void 0:(c=!0,setTimeout(function(){return c=!1},t),e())},"undefined"==typeof u&&(u=s,s=null),typeof u){case"function":a.callback=u;break;case"object":e.extend(a,u)}return r&&(i.on("touchstart",s,function(e){return n=i.prop("tappable"),o(a.touchstartCallback,i,e),n||(n={event:e,attached:0},i.prop("tappable",n)),n.attached++,window.setTimeout(function(){return n?i.addClass("touched"):void 0},a.touchDelay)}),i.on("touchend",s,function(e){return n=i.prop("tappable"),n?(e=n.event,0===--n.attached&&i.removeProp("tappable").removeClass("touched"),l(function(){return o(a.callback,i,e,!0)}),document.activeElement.blur()):void 0}),a.cancelOnMove&&i.on("touchmove",s,function(){return i.removeProp("tappable").removeClass("touched")}),i.on("touchcancel",s,function(){return i.removeProp("tappable").removeClass("touched")})),i.on("click",s,function(e){return l(function(){return o(a.callback,i,e,!1)})})}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/dropins/universal_chooser",["jquery","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/viewer","modules/clean/dropins/tappable","modules/clean/dropins/multi_login_iframe","modules/constants/viewer"],function(t,o,n,r,i,s,u,l,a){var c,_,d;return d=o.assert,_=n._,c=function(){function o(e,o,n,r,c,_,d,p,h,f,m){var b,g,v,w,y,k,x,C,T;for(this.host_site=e,this._multiselect=o,this._folderselect=n,this._choose_btn_txt=f,this._choose_btn_txt_plural=m,this._browse_mode_map={},this._run_when_logged_in={},C=s.get_viewer().get_users(b=!0),w=0,y=C.length;y>w;w++)T=C[w],this._browse_mode_map[T.id]="dropbox-"+T.role,this._run_when_logged_in[T.id]=[];x=function(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},v=function(e){return e?x(e):"^[^.]+"},this._extensions_re=new RegExp("("+function(){var e,t,o;for(o=[],e=0,t=r.length;t>e;e++)g=r[e],o.push(v(g));return o}().join("|")+")$","i"),this._extensions=r,this._current_user=s.get_viewer().get_user_by_id(c),this._mode=null,this._browse_xhr=null,this._search_xhr=null,this._browse_can_set_mode=!1,this.ui_init(),h&&(this.multi_login_manager=new l.DropinsMultiLoginManager(h)),this._photos_tab_visible()?s.get_viewer().is_photos_user_signed_in?this.init_photos(_,d,p):(k=s.get_viewer().get_uid_by_role(a.ROLE_PHOTOS),this._run_when_logged_in[k].push(function(e){return function(){return new i.WebRequest({url:"/photos_events",dataType:"json",success:function(t){return e.init_photos(t.header_ids,t.header_id_to_name,t.header_id_to_num_photos)}})}}(this))):t(".pane-btns .photos").hide(),t(".cancel-btn").click(function(e){return function(){return e.host_site.close_dialog(),!1}}(this)),u(t("#selected-count"),function(e){return function(){return e.deselect_all()}}(this)),this.host_site.ready()}return o.prototype._browse_mode_list=["dropbox-work","dropbox-personal","dropbox"],o.prototype._max_file_count=0,o.prototype._multiaccount_search=!1,o.prototype.ui_init=function(){},o.prototype.init_photos=function(){},o.prototype.on_mode_change=function(){},o.prototype.get_browse_file_container=function(){},o.prototype.render_file_info=function(){},o.prototype.update_nav=function(){},o.prototype.on_browse_complete=function(){},o.prototype.on_search_start=function(){},o.prototype.on_search_complete=function(){},o.prototype.on_update_selected_counter=function(){},o.prototype._photos_tab_visible=function(){var e,t,o,n;for(n=this._extensions,t=0,o=n.length;o>t;t++)if(e=n[t],".jpg"===e||".jpeg"===e||".png"===e)return!0;return!this._extensions.length},o.prototype._fq_path_selectable=function(e,t){return null==t&&(t=!1),t||this._extensions_re.test(e)},o.prototype.set_mode=function(o){return this._browse_can_set_mode=!1,this._mode!==o?(this.deselect_all(),t("#chooser").removeClass(this._mode).removeClass("dropbox-meta").addClass(o),this.on_mode_change(o),e.call(this._browse_mode_list,o)>=0&&t("#chooser").addClass("dropbox-meta"),this._mode=o):void 0},o.prototype.share_selected=function(){var e,o,n;return o=t("li.selected"),d(o.length,"expected at least one selected li"),n=function(){var n,r,i;for(i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push([t(e).data("uid"),t(e).data("fqpath")]);return i}(),this.host_site.publish_files(n,this._mode)},o.prototype.search=function(e){var o,n,s,u;return this._browse_can_set_mode=!1,null!=(u=this._search_xhr)&&u.abort(),t("#chooser").removeClass("empty-search"),this.render_file_info([],t("#search-file-list")),this.on_search_start(),e?(t("#chooser").addClass("loading-search"),s=function(e){return function(o){var n;return n=o.file_info,t("#chooser").toggleClass("empty-search",0===n.length),e.render_file_info(n,t("#search-file-list")),e.on_search_complete(n.length)}}(this),n=function(e){return function(t,o,n){return e.on_search_complete(null),"abort"!==n?r.error(_("Search failed")):void 0}}(this),o=function(e){return function(){return e._search_xhr=null,t("#chooser").removeClass("loading-search")}}(this),void(this._search_xhr=new i.WebRequest({url:this._multiaccount_search?"/dropins/multiaccount_search":"/dropins/search",data:{query:e,filter_extensions:this._extensions.join(" ")},dataType:"json",success:s,error:n,complete:o,subject_user:this._multiaccount_search?null:this._current_user}))):void this.on_search_complete(null)},o.prototype.browse=function(e,o,n){var u,l,a,c,d;null==e&&(e=""),null==n&&(n=null),null!=(d=this._browse_xhr)&&d.abort(),u=this.get_browse_file_container(o),this._browse_can_set_mode=!0,this.deselect_all(),n?n.addClass("loading-li"):(this.render_file_info([],u),
t("#chooser").addClass("loading-"+this._browse_mode_map[o]).removeClass("empty-"+this._browse_mode_map[o]),this._current_path=e,this._current_user=s.get_viewer().get_user_by_id(o),this.update_nav(e)),c=function(n){return function(r){return n._current_path=e,n._current_user=s.get_viewer().get_user_by_id(o),n._browse_can_set_mode&&n.set_mode(n._browse_mode_map[o]),n.update_nav(e),n.render_file_info(r.file_info.slice(0,n._max_file_count),u),t("#chooser").toggleClass("empty-"+n._browse_mode_map[o],0===r.file_info.length),n.on_browse_complete(e,o,u)}}(this),a=function(e){return function(t,o,i){return n||(e._current_path=null),"abort"!==i?r.error(_("Failed to load files")):void 0}}(this),l=function(e){return function(){return e._browse_xhr=null,t("#chooser").removeClass("loading-"+e._browse_mode_map[o]),null!=n?n.removeClass("loading-li"):void 0}}(this),this._browse_xhr=new i.WebRequest({url:"/dropins/browse",data:{fq_path:e},dataType:"json",success:c,error:a,complete:l,subject_user:o})},o.prototype.deselect_all=function(){return t(".selected").removeClass("selected"),this.update_selected_counter()},o.prototype.deselect=function(e){return t(e).removeClass("selected").removeClass("touched"),this.update_selected_counter()},o.prototype.select=function(e){var o;return o=t(e),this._multiselect||t("li.selected").removeClass("selected"),o.addClass("selected"),this.update_selected_counter()},o.prototype.update_selected_counter=function(){var e;return e=t("li.selected").length,t("#select-btn").prop("disabled",0===e),this._multiselect?(t("#selected-count").text(e).toggle(0!==e),this.on_update_selected_counter()):void 0},o}()})}.call(this),function(){define("modules/clean/dropins/universal_saver",["jquery","modules/core/browser","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/sprite","modules/clean/viewer","modules/clean/dropins/tappable","modules/clean/photos/legacy_thumb_loader"],function(e,t,o,n,r,i,s,u,l,a,c,_,d,p){var h,f,m,b;return b=n.assert,m=i._,f=function(){function t(t,o,n){var i,s,u,l,a;for(this.host_site=t,this.act_paired=null!=n?n:!1,_.get_viewer().is_paired||b(this.act_paired===!1),this.act_paired||(this.subject_uid=_.get_viewer().get_users()[0].id),l=_.get_viewer().get_users(i=!0),s=0,u=l.length;u>s;s++)a=l[s],this.run_when_logged_in[a.id]=[],this.user_to_root_map[a.id]=this._get_prefixed_root(a);this._saver_file_tmpl=r.tmpl("saver_file_tmpl"),this._li_tmpl=r.tmpl("dropin_list_item_tmpl"),this._last_browse_path=null,this._should_intercept_save=!1,this._continue_saving=null,e(window).on("message",function(e){return function(t){var o,n,r,i;if(t.originalEvent.origin===e.host_site._origin)switch(o=JSON.parse(t.originalEvent.data),o.method){case"files":return e.render_files(o.params||[]);case"files_with_callback":return e._should_intercept_save=!0,e.render_files(o.params||[]);case"continue_saving":return(null!=(r=o.params)?r.download_url:void 0)&&(n=[o.params.download_url]),null==n&&(n=null!=(i=o.params)?i.download_urls:void 0),n?"function"==typeof e._continue_saving?e._continue_saving(n):void 0:e.host_site.error(m("Sorry! We can’t find the files to download."))}}}(this)),d(e("#save-btn"),function(t){return function(){var o,n;o=t.get_destination_folder(),b(null!==o),n=t.get_destination_uid(),t.subject_uid=n,b(n,"this better exist"),t.save_files(t.get_files(),o),e("#save-btn").prop("disabled",!0).val(m("Saving..."))}}(this)),d(e("#cancel-btn"),function(e){return function(){e.host_site.close_dialog()}}(this)),e("#choose-dir-cancel-btn").click(function(t){return function(){e("#saver-files, #saver-folders").toggle(),t.update_view_state()}}(this)),d(e("#choose-dir-btn"),function(t){return function(){var o;e("#saver-files, #saver-folders").toggle(),o=t.act_paired?t.files_root:t._get_prefixed_root(_.get_viewer().get_users()[0]),t.browse(o),t.update_view_state()}}(this)),e("#choose-location-btn").on("click",function(t){return function(){var o;o=t._remove_prefixed_root(t._last_browse_path),b(o!==t.files_root,"Can't save to the root 'Files' uid selector"),e("#choose-location-btn").prop("disabled",!0).val(m("Saving...")),t.save_files(t.get_files(),o)}}(this)),e("#unlink-link").click(function(e){return function(){return e.host_site.unlink_web_session_token()}}(this)),o&&(e("#saver-container").addClass("quota-warning"),e("#save-btn").prop("disabled",!0),e("#dest-menu").addClass("disabled")),this.init_ui(),this.host_site.ready()}return t.prototype.FILENAME_SNIPPET_LEN=20,t.prototype._remove_prefixed_root=function(e){var t,o,n;o=this.user_to_root_map;for(n in o)if(t=o[n],0===e.indexOf(t))return e.replace(t,"");return this.act_paired||e!==this.files_root&&""!==e?b(!1,"fq_path is missing the role tile prefixed root="+e):""},t.prototype._get_prefixed_root=function(e){return a.normalize(this.files_root+"/"+_.get_role_title(e))},t.prototype.files_root="/"+m("Files"),t.prototype.user_to_root_map={},t.prototype.run_when_logged_in={},t.prototype.render=function(e){return this.render_files(e.files)},t.prototype._perform_save_files=function(t,n){var r,i,l,a,c,_,d,p,h,f;r=3;try{h=e.parseJSON(decodeURIComponent(o.read("saver_locations")))||[],null==h.length&&(h=[])}catch(e){a=e,h=[]}for(h=e.grep(h,function(e){return e!==n}),h.unshift(n),h=h.slice(0,r),o.create("saver_locations",encodeURIComponent(JSON.stringify(h))),f=[],d=0,p=t.length;p>d;d++)_=t[d],f.push({url:_.url,dest:n+"/"+_.filename});return l=function(t){return function(o){return o.error?(e("#save-btn").prop("disabled",!1).val(m("Save")),t._reenable_choose_location_button(),s.error(o.error)):"COMPLETE"===o.status?(t.host_site.progress(1),t.host_site.files_saved()):"PENDING"===o.status&&o.job?t.host_site.job_id(o.job):t.host_site.error()}}(this),i=function(t){return function(o){var n;try{return t.host_site.error(e.parseJSON(o.responseText).error)}catch(e){return a=e,t.host_site.error()}}}(this),u.WebRequest({url:"/dropins/save_url_batch",data:{app_key:this.host_site._app_key,urls:JSON.stringify(f)},dataType:"json",subject_user:this.subject_uid,success:l,error:i})},t.prototype.save_files=function(e,t){var o;return this._should_intercept_save?(o=setTimeout(function(e){return function(){return e._continue_saving=null,e.host_site.error(m("Sorry! An error occured while retrieving the file."))}}(this),5e3),this._continue_saving=function(n){return function(r){var i,s,u,l;if(null==r&&(r=[]),n._continue_saving=null,clearTimeout(o),r.length!==e.length)return n.host_site.error(m("Sorry we couldn’t find all the files to download. Expected %(expected)s but %(received)s were provided.".format({expected:e.length,received:r.length})));for(s=u=0,l=e.length;l>u;s=++u)i=e[s],i.url=r[s];return n._perform_save_files(e,t)}}(this),this.host_site.save_callback(e)):this._perform_save_files(e,t)},t.prototype.render_files=function(t){var o,n,r,i;for(i=[],n=0,r=t.length;r>n;n++)o=t[n],o.icon=a.file_icon(o.filename)+"_32",i.push(this._saver_file_tmpl({file:o,Sprite:c}).toHTML());return e("#file-container").html(i),1===t.length&&e(".delete-file").hide(),t.length?this.update_files_state(t):void 0},t.prototype.get_files=function(){var t,o,n,r,i;for(o=[],i=e(".file-to-save"),n=0,r=i.length;r>n;n++)t=i[n],o.push({url:e(t).data("url"),filename:e(t).data("filename")});return o},t.prototype.render_file_info=function(e,t,o){var n,r,i,s,u,_;for(null==o&&(o=this.subject_uid),_=[],r=this._extensions,s=0,u=e.length;u>s;s++)i=e[s],null!==o&&(i.fq_path=this.user_to_root_map[o]+i.fq_path),i.caption=l.em_snippet(a.filename(i.fq_path),this.FILENAME_SNIPPET_LEN),i.thumbnail=i.thumbnail_url_tmpl,i.info=i.tooltip="",i.is_dir&&(i.selectable=!0),_.push(this._li_tmpl({file:i,Sprite:c,_:m}).toHTML());return t.html(_),n=t.find(".dropin-file .icon"),p.batch_load_thumbs(n,this.THUMBS_BATCH_SIZE)},t.prototype.browse=function(t,o,n){var r,i,s;return null==t&&(t=""),null==o&&(o=null),null==n&&(n=this.subject_uid),b(t===a.normalize(t),"unnormalized fq_path passed to @browse() fq_path="+t),t!==this._last_browse_path||n!==this.subject_uid?(this._last_browse_path=t,this.subject_uid=n,r=e("#folders-main"),this.act_paired&&t===this.files_root?(r.removeClass("select-folder").addClass("select-role"),this.on_browse_start(t)):(r.addClass("select-folder").removeClass("select-role"),null!=o?(e("li.loading-li").removeClass("loading-li"),setTimeout(function(){return o.addClass("loading-li")},200)):(e("#saver-folders").addClass("loading-files"),e("#browse-file-list").empty(),this.on_browse_start(t)),e("#breadcrumbs-header").show(),s=function(o){return function(r){return o.on_browse_start(t),t===o._last_browse_path?(o.render_file_info(r.file_info,e("#browse-file-list"),n),e("#saver-folders").removeClass("loading-files"),e("#choose-location-btn").prop("disabled",r.inside_read_only_shared_folder)):void 0}}(this),i=function(){return e("#saver-folders").removeClass("loading-files")},u.WebRequest({url:"/dropins/browse",data:{fq_path:this._remove_prefixed_root(t)},dataType:"json",subject_user:this.subject_uid,success:s,error:i}))):void 0},t}(),h=function(){var o,n,r,i,s,u,l,a;return o=function(e){return t.safari?(e.hide(),setTimeout(function(){return e.css("display","")},0)):void 0},n=function(e){return e.removeClass("shown"),o(e)},a=function(e){return e.toggleClass("shown"),o(e)},u=function(e,t){return e.find(".selected").removeClass("selected"),t.addClass("selected")},l=function(t,o){var n,r,i,s,l;for(l=t.find("li"),i=0,s=l.length;s>i;i++)if(r=l[i],n=e(r),n.data("value")===o)return u(t,n),!0;return!1},s=function(e,t){return e.hasClass("selected")||e.hasClass("not_selectable")?a(t):(u(t,e),t.trigger("db:change",e.attr("data-value")),n(t))},r=function(t){return t.on("click","li",function(){return function(o){var n;return t.hasClass("disabled")?void 0:(n=e(o.currentTarget),s(n,t))}}(this)),e(document.body).click(function(o){return e(o.target).parents(".super_ul_select_menu")[0]!==t[0]?n(t):void 0}),e(window).blur(function(){return n(t)}),t.find("li.selected").length?void 0:t.find("li:not(.not_selectable)").first().addClass("selected")},i=function(){var t,o,n,i,s;for(i=e(".super_ul_select_menu"),s=[],o=0,n=i.length;n>o;o++)t=i[o],s.push(r(e(t)));return s},e(i),{init:r,set_selected:u,set_selected_by_value:l}}(),f})}.call(this),function(){define("modules/clean/react/bubble_menu",["jquery","external/react","external/underscore","modules/clean/keycode","modules/clean/react/bubble_dropdown"],function(e,t,o,n,r){var i,s,u,l,a,c;return c=t.DOM,l=t.createElement,a=t.addons.classSet,u=t.PropTypes,s=t.createClass({displayName:"BubbleMenuItem",propTypes:{onClick:t.PropTypes.func,href:t.PropTypes.string,target:t.PropTypes.string,disabled:t.PropTypes.bool,closeOnClick:t.PropTypes.bool,closeFunc:t.PropTypes.func.isRequired,className:t.PropTypes.string},getDefaultProps:function(){return{onClick:function(){},href:"#",closeOnClick:!0}},_handleMouseEnter:function(){return e(this.refs.item.getDOMNode()).closest(".bubble-menu").removeClass("bubble-menu--keyboard")},_handleClick:function(e){return this.props.disabled?(e.preventDefault(),e.stopPropagation()):"#"===this.props.href&&(e.preventDefault(),this.props.onClick(e),this.props.closeOnClick)?this.props.closeFunc():void 0},renderContents:function(){var e;return e={"bubble-menu-item":!0,"bubble-menu-item--disabled":this.props.disabled},c.a({ref:"item",role:"menuitem",className:a(e),href:this.props.href,target:this.props.target,onClick:this._handleClick,onMouseEnter:this._handleMouseEnter,"aria-disabled":this.props.disabled},this.props.children)},render:function(){return c.li({role:"presentation",className:this.props.className?"bubble-menu-item-wrapper "+this.props.className:"bubble-menu-item-wrapper"},this.renderContents())}}),i=t.createClass({displayName:"BubbleMenu",propTypes:o.extend(r.propTypes,{items:u.arrayOf(s)}),render:function(){var e;return l(r,o.extend({},this.props,{ref:"bubble",autofocus:!1,bubbleDropdownShown:this.bubbleDropdownShown}),c.ul({role:"menu",ref:"menu",className:"bubble-menu",tabIndex:"-1"},function(){var o,n,r,i;for(r=this.props.items,i=[],o=0,n=r.length;n>o;o++)e=r[o],i.push(t.addons.cloneWithProps(e,{closeFunc:this.hide,key:e.key}));return i}.call(this)))},componentDidMount:function(){return this.refs.bubble.getTargetButton().setAttribute("aria-haspopup",!0)},bubbleDropdownShown:function(){var t;return this.$menu=e(this.refs.menu.getDOMNode()),this.$menu.attr("aria-labelledby",this.refs.bubble.containerId),this.$menu.focus(),this.$menuitems=this.$menu.find('*[role="menuitem"]'),this.$menu.on("keydown",this.onKeyDown),"function"==typeof(t=this.props).bubbleDropdownShown?t.bubbleDropdownShown():void 0},onKeyDown:function(t){return e(this.$menu).addClass("bubble-menu--keyboard"),t.keyCode===n.DOWN?(this.focusNext(t.target),t.preventDefault(),t.stopPropagation()):t.keyCode===n.UP?(this.focusPrevious(t.target),t.preventDefault(),t.stopPropagation()):void 0},focusPrevious:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},focusNext:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},hideIfShown:function(){return this.refs.bubble.hideIfShown()},toggle:function(){return this.refs.bubble.toggle()},show:function(){return this.refs.bubble.show()},hide:function(){return this.refs.bubble.hide()}}),{BubbleMenuItem:s,BubbleMenu:i}})}.call(this),function(){define("modules/clean/react/dropins/breadcrumbs",["jquery","external/react","modules/clean/css","modules/clean/em_string","modules/clean/filepath","modules/clean/react/bubble_dropdown","modules/clean/react/sprite","modules/core/i18n"],function(e,t,o,n,r,i,s,u){var l,a,c,_,d,p;return d=u._,p=t.DOM,c=t.PropTypes,a=t.createFactory(i),_=t.createFactory(s),l=t.createClass({displayName:"Breadcrumbs",propTypes:{fqPath:c.string.isRequired,rootName:c.string.isRequired,maxLengthEm:c.number,onClick:c.func.isRequired},getDefaultProps:function(){return{maxLengthEm:26}},componentWillMount:function(){return o.require_css("/static/css/react/breadcrumbs-vflF2qDrO.css")},render:function(){var e,t,o,i,s,u,l,c,h,f,m,b,g,v;for(e=1.8,o=[],f=this.props.fqPath.split("/"),i=function(t){return function(o){var i,s,u,l;for(l=0,i=0,s=o.length;s>i;i++)u=o[i],l+=new n(r.filename(u,t.props.rootName)).length+e;return l-e}}(this),s=u=0,m=f.length;m>=0?m>u:u>m;s=m>=0?++u:--u)h=r.normalize(f.slice(0,s+1).join("/")),o.push(h);if(v=i(o),v>this.props.maxLengthEm){for(g=[],b=o.slice(0,-2),l=0,c=b.length;c>l;l++)h=b[l],g.push(h);o=o.slice(-2),i(o)>this.props.maxLengthEm&&g.push(o.shift()),t=p.span({},a({targetButton:p.button({className:"sprite-button breadcrumbs-ellipsis"},_({group:"dropins",name:"ellipsis",alt:d("Show parent folders",{comment:"Overflow menu for folder breadcrumb list"})})),arrow_position:"top-left",vertical_displacement:8,extra_css_class:"breadcrumbs-dropdown"},p.div({className:"breadcrumbs-dropdown-contents"},g.map(function(e){return function(t,o){var n;return n=r.filename(t,e.props.rootName),p.a({key:o,onClick:function(){return e.props.onClick(t)}},_({group:"dropins",name:"folder"}),n)}}(this)))),_({group:"dropins",name:"breadcrumbs_chevron"}))}else t=null;return p.div({className:"breadcrumbs"},t,o.map(function(e){return function(t,n){var i;return i=r.filename(t,e.props.rootName),n===o.length-1?p.span({key:n},i):p.span({key:n},p.a({onClick:function(){return e.props.onClick(t)}},i),_({group:"dropins",name:"breadcrumbs_chevron"}))}}(this)))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/dropins/upload_bubble_picker",["jquery","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/viewer","modules/constants/viewer","modules/core/exception","modules/core/i18n"],function(t,o,n,r,i,s,u,l,a){var c,_,d,p,h,f,m,b,g;return c=n.BubbleMenu,_=n.BubbleMenuItem,h=l.assert,p=a._,b=a.ungettext,m=o.DOM,f=o.createElement,g=s.get_viewer(),d=o.createClass({displayName:"UploadBubblePicker",propTypes:{selectedUserId:o.PropTypes.number,onClick:o.PropTypes.func},getDefaultProps:function(){return{selectedUserId:void 0,onClick:function(){}}},getInitialState:function(){return{signedIn:g.get_users(!1)}},handleSignin:function(t,o){var n;return n=g.get_user_by_id(o,!0),e.call(this.state.signedIn,n)<0?this.setState({signedIn:this.state.signedIn.concat([n])}):void 0},componentDidMount:function(){return t(window).on("db:multi_login_success",this.handleSignin)},componentWillUnmount:function(){return t(window).off("db:multi_login_success",this.handleSignin)},renderMenuButton:function(){return m.button({className:"button-as-link",onClick:function(e){return function(){var t;if(null!=e.props.selectedUserId)t=e.props.selectedUserId;else{if(g.is_paired)return;t=e.state.signedIn[0].id}return h(g.is_uid_signed_in(t),"selected user ID not signed in: "+t),e.props.onClick(t)}}(this)},f(i,{group:"dropins",name:"upload_16",text:p("Upload")}))},renderSignIn:function(t){return e.call(this.state.signedIn,t)<0?m.div({className:"bubble-menu-item-signin"},m.div({},p("Sign in"))):void 0},renderMenuItemContents:function(e,t,o){return m.div({className:"bubble-menu-item-contents"},m.div({className:"table-row"},m.div({className:"table-cell bubble-menu-item-sprite"},f(r,{group:"dropins",name:e,alt:t})),m.div({className:"table-cell bubble-menu-item-text"},t)),m.div({className:"table-row"},m.div({className:"table-cell bubble-menu-item-sprite"}),m.div({className:"table-cell"},this.renderSignIn(o))))},renderMenuItem:function(e){var t;return e.role===u.ROLE_PERSONAL?t=this.renderMenuItemContents("s_house",p("Personal"),e):e.role===u.ROLE_WORK&&(t=this.renderMenuItemContents("s_briefcase",g.team_name,e)),f(_,{key:e.role,onClick:function(t){return function(){var o;return"function"==typeof(o=t.props).onClick?o.onClick(e.id):void 0}}(this)},t)},renderMenuItems:function(){var e,t;return e=function(){var e,o,n,r;for(n=g.get_users(!0),r=[],e=0,o=n.length;o>e;e++)t=n[e],r.push(this.renderMenuItem(t));return r}.call(this)},render:function(){return h(this.state.signedIn.length>0,"must have at least one role signed in to render!"),null==this.props.selectedUserId&&g.is_paired?m.div({className:"upload-bubble-picker"},f(c,{extra_css_class:"upload-bubble-menu",arrow_position:"top",targetButton:this.renderMenuButton(),items:this.renderMenuItems()})):this.renderMenuButton()}})})}.call(this),function(){var e=function(e,o){function n(){this.constructor=e}for(var r in o)t.call(o,r)&&(e[r]=o[r]);return n.prototype=o.prototype,e.prototype=new n,e.__super__=o.prototype,e},t={}.hasOwnProperty,o=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/dropins/desktop_chooser_v2",["jquery","external/react","chooser_legacy","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/binary_search","modules/clean/components/ajax_form","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/sprite","modules/clean/viewer","modules/clean/dropins/universal_chooser","modules/clean/photos/legacy_thumb_loader","modules/clean/react/dropins/breadcrumbs","modules/clean/react/dropins/upload_bubble_picker","modules/clean/search/search_helpers","modules/constants/env","modules/constants/request","modules/constants/viewer"],function(t,n,r,i,s,u,l,a,c,_,d,p,h,f,m,b,g,v,w,y,k,x,C,T,E){var S,q,M,N,I;return q=r.PhotoTimeline,N=s.assert,M=l._,I=l.ungettext,S=function(r){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,r),s.prototype.PHOTO_SIZE=128,s.prototype.PHOTO_TIMELINE_HEADER_HEIGHT=40,s.prototype.THUMBS_BATCH_SIZE=16,s.prototype.SEARCH_PATH_LEN=25,s.prototype._max_file_count=7500,s.prototype._multiaccount_search=!0,s.prototype.ui_init=function(){var e,o;return this._li_tmpl=u.tmpl("dropin_list_item_tmpl"),this._li_upload_tmpl=u.tmpl("dropin_list_item_upload_tmpl"),this._photo_li_tmpl=u.tmpl("photo_list_item_tmpl").bind(this),e=n.createElement(y,{fqPath:"",rootName:"",onClick:function(e){return function(t){return e.browse(t,e._current_user.id)}}(this)}),o=n.createElement(k,{onClick:function(e){return function(o){return e.prompt_login_and_set_uid(o,function(o){var n;return o?(n=new MouseEvent("mouseup",{bubbles:!0,canceable:!0}),t("#upload button")[0].dispatchEvent(n)):e.open_upload_file_chooser()})}}(this)}),this._breadcrumbs=n.render(e,t("#breadcrumbs-header")[0]),this._upload_button=n.render(o,t("#upload")[0]),this._photo_timeline=null,this._upload_queue=[],this._upload_dest=this._upload_uid=null,this._select_anchor_index=null,this.set_mode("recent"),this.load_recent(),this._listen()},s.prototype._listen=function(){var e,n,r,i,s;return t("#chooser-sidebar .pane-btns").on("click","div",function(e){return function(n){var r,i,s,u;return r=t(n.currentTarget),s=r.attr("class"),u=r.data("uid"),i=function(){return e.set_mode(s),"recent"===s?e.load_recent():o.call(e._browse_mode_list,s)>=0?e.browse("",u):void 0},u?e.prompt_login_and_set_uid(u,i):i(),e._upload_button.setProps({selectedUserId:o.call(e._browse_mode_list,s)>=0?e._current_user.id:void 0})}}(this)),this.handle_uploads(t("#upload-form")),this.handle_drag_and_drop(),this._folderselect&&t(".file-list").on("click",".file-name, .icon",function(e){return function(o){var n;return n=t(o.currentTarget).closest("li"),n.hasClass("directory")?(e.browse(n.data("fqpath"),n.data("uid")),!1):void 0}}(this)),t(".file-list, #photo-list").on("click","li",function(e){return function(o){var n,r,i,s,u,l,a;return r=t(o.currentTarget),n=t(o.delegateTarget).find("li"),e._multiselect&&o.shiftKey&&r.hasClass("selectable")?(s=n.index(r),u=e._folderselect?".selectable":":not(.directory).selectable",null==e._select_anchor_index&&(e._select_anchor_index=s),l=Math.min(s,e._select_anchor_index),a=Math.max(s,e._select_anchor_index)+1,i=n.slice(l,a).filter(u),r.hasClass("selected")?e.deselect(i):e.select(i),e._select_anchor_index=s):r.hasClass("directory")&&!e._folderselect?e.browse(r.data("fqpath"),r.data("uid")):r.hasClass("selectable")?(e._multiselect&&r.hasClass("selected")?e.deselect(r):e.select(r),e._select_anchor_index=n.index(r)):void 0}}(this)),t(".file-list, #photo-list").on("dblclick","li:not(.directory).selectable",function(e){return function(o){return e.select(t(o.currentTarget)),e.share_selected()}}(this)),t(".file-list").on("dblclick",".directory",function(e){return function(o){var n;return n=t(o.currentTarget),e.browse(n.data("fqpath"),n.data("uid"))}}(this)),t("#select-btn").click(function(e){return function(){return t("#select-btn").prop("disabled",!0),e.share_selected()}}(this)),s=null,i=null,r="",t("#searchbar").on("keydown keyup paste input blur",function(e){return function(o){return clearTimeout(s),s=setTimeout(function(){var n;return n=t(o.currentTarget).val(),r!==n?(n?r||(i=e._mode,e.set_mode("search")):("search"===e._mode&&e.set_mode(i),i=null),r=n,e.search(n)):void 0},100)}}(this)),t(window).on("db:multi_login_success",function(){return t("#searchbar input").attr("placeholder",M("Search both Dropbox accounts"))}),t("#chooser-main").scroll(function(e){return function(){return"photos"===e._mode?e.update_photos_sticky_date():void 0}}(this)),e=t(".chooser-feedback-form"),n=new p(e),e.on(p.SUCCESS_EVENT,function(){return a.success(M("Thank you for your feedback!")),t("#chooser-sidebar .feedback .bubble-dropdown").hide(),n.reset(),e.find("textarea[name=content]").val("")})},s.prototype.open_upload_file_chooser=function(){return t("#upload-form input[type=file]").click()},s.prototype.prompt_login_and_set_uid=function(e,t){if(e!==this._current_user.id){if(!g.get_viewer().is_uid_signed_in(e))return void this.multi_login_manager.show(function(o){return function(){var n,r,i,s;for(o._current_user=g.get_viewer().get_user_by_id(e),"function"==typeof t&&t(!0),s=o._run_when_logged_in[e],r=0,i=s.length;i>r;r++)(n=s[r])();return o._run_when_logged_in[e]=[]}}(this));this._current_user=g.get_viewer().get_user_by_id(e)}return"function"==typeof t?t(!1):void 0},s.prototype.load_recent=function(){return this.render_file_info([],t("#recent-file-list")),t("#chooser").removeClass("empty-recent"),t("#chooser").addClass("loading-recent"),this._current_path="",_.WebRequest({url:"/dropins/recent",dataType:"json",success:function(e){return function(o){var n;return n=t("#recent-file-list"),e.render_file_info(o.file_info,n),t("#chooser").toggleClass("empty-recent",0===o.file_info.length),e.on_load_recent_complete(n)}}(this),error:function(){return a.error(M("Failed to load recent files"))},complete:function(){return t("#chooser").removeClass("loading-recent")}})},s.prototype.update_nav=function(e){this._breadcrumbs.setProps({fqPath:e,rootName:g.get_root_name(this._current_user)})},s.prototype.handle_drag_and_drop=function(){var e,n,r,i;return n=function(e){return function(){var o;return t(".chooser-drop-indicator").is(":visible")?void 0:(o=M("Drop your file to upload to '%(folder_name)s'").format({folder_name:f.em_snippet(m.filename(e._current_path),20)}),a.success(o,60),t(".chooser-drop-indicator").css("opacity",0).fadeTo(500,.6))}}(this),e=function(){return a.clear(),t(".chooser-drop-indicator").hide()},i=0,r=t(),t(document).on("dragenter",function(){return i+=1,!0}),t(document).on("dragover",function(i){return function(s){var u,l,a,c;return(null!=(l=s.originalEvent.dataTransfer)&&null!=(a=l.types)?a.contains("Files"):void 0)?(c=i._mode,o.call(i._browse_mode_list,c)<0&&(i.set_mode(i._browse_mode_map[i._current_user.id]),i.browse("",i._current_user.id)),u=t(s.target).parents(".file-list .dropin-file.directory"),u[0]!==r[0]&&(r.removeClass("dragover"),r=u,r.addClass("dragover")),r.length?e():n(),!1):(s.originalEvent.dataTransfer.dropEffect="none",!0)}}(this)),t(document).on("dragleave",function(){return i-=1,0===i&&(r.removeClass("dragover"),r=t(),e()),!0}),t(document).on("drop",function(o){return function(n){var s,u,l,c,_,d,p,h,f,m,b,g;if(i=0,e(),r.removeClass("dragover"),u=n.originalEvent.dataTransfer,null!=u.files){for(l={},b=null!=(m=u.items)?m:[],p=0,f=b.length;f>p;p++)h=b[p],c=("function"==typeof h.getAsEntry?h.getAsEntry():void 0)||("function"==typeof h.webkitGetAsEntry?h.webkitGetAsEntry():void 0),null!=c&&(l[c.name]=c);d=function(){var e,t,o,n,r;for(o=u.files,r=[],e=0,t=o.length;t>e;e++)_=o[e],(null!=(n=l[_.name])?n.isDirectory:void 0)||r.push(_);return r}(),d.length!==u.files.length&&a.error(M("Folder uploads not supported. Some files will not be uploaded.")),r.length?(s=r.data("fqpath"),g=r.data("uid"),o.browse(s,g,r)):s=o._current_path,o.enqueue_upload(d,s)}return r=t(),!1}}(this))},s.prototype.on_upload_start=function(e,o,n){var r,i,s;return i={icon:m.file_icon(e)+"_32",caption:f.em_snippet(e,this.FILENAME_SNIPPET_LEN)},s=t(this._li_upload_tmpl({file:i,Sprite:b,_:M}).toHTML()),this._upload_file_li=s,this._upload_dest=o,this._upload_uid=n,"recent"===this._mode?(r=t("#recent-file-list"),s.prependTo(r),this._scroll_to(s)):this._current_path===o&&this._current_user.id===n&&(s.appendTo(this.get_browse_file_container(n)),this._scroll_to(s)),s},s.prototype.on_upload_success=function(e,t){var o,n;return n=this._upload_file_li,this._upload_file_li=this._upload_dest=this._upload_uid=null,n.parent()[0]?(o=m.filename(e),n.attr("data-fqpath",e),n.attr("data-uid",t),n.find(".file-name").text(o),n.removeClass("uploading"),n.addClass("selectable"),this.select(n),this._scroll_to(n),_.WebRequest({url:"/dropins/browse",data:{fq_path:e},dataType:"json",subject_user:t,success:function(e){var t,o,r;return n.parent()[0]?(r=null!=(o=e.file_info[0])?o.thumbnail_url_tmpl:void 0,r?(t=n.find(".icon"),t.error(function(){return t.attr("src",t.data("fail-src")||b.SPACER)}),t.attr("src",r)):void 0):void 0}})):void 0},s.prototype.on_upload_failure=function(e){var t;return null!=(t=this._upload_file_li)&&t.remove(),this._upload_file_li=this._upload_dest=this._upload_uid=null,a.error(e)},s.prototype.handle_upload_response=function(e,t){var o;return o=function(e){var o,n,r;switch(e){case"quota":return r=g.get_viewer().get_user_by_id(t).role,o=r===E.ROLE_WORK?"/business/try":"/upgrade",new u(M("You can't upload any files because your Dropbox is full. <a target=\"_blank\" href='%(path)s'>Get more space</a>").format({path:o}));case"ignored":return M("Sorry! This file name isn’t allowed.");case"too_large":return n=M('The upload limit online is 300MB. You can upload larger files with the <a id="install_link">Dropbox desktop application</a>.'),new u(n.replace('id="install_link"','href="/install" target="_blank"'));default:return M("There was an error while uploading your file.")}},e.path?this.on_upload_success(e.path,t):this.on_upload_failure(o(e.error))},s.prototype.enqueue_upload=function(e,t){var o,n,r,i;if(e.length){for(i=0===this._upload_queue.length,n=0,r=e.length;r>n;n++)o=e[n],this._upload_queue.push([o,t,this._current_user.id]);if(i)return this.process_upload_queue()}},s.prototype.process_upload_queue=function(){var e,t,o,n,r,s,u,l,a,_,d,p,h,f;return e=314572800,_=this._upload_queue[0],u=_[0],s=_[1],p=_[2],l=u.name||u.fileName,a=u.size||u.fileSize,t=function(e){return function(t){return e.handle_upload_response(t,p),e._upload_queue.shift(),e._upload_queue.length?setTimeout(function(){return e.process_upload_queue()},0):void 0}}(this),e>=a?(d=this.on_upload_start(l,s,p),n=function(e){var t;return t=Math.round(e.loaded/e.total*100),d.find(".upload-progress-bar .value").width(t+"%")},r=function(e){var o,n,r;d.find(".upload-progress-bar").hide();try{r=JSON.parse(e.target.responseText)}catch(e){o=e,r={error:"unknown"}}return t(r)},o=function(){return d.find(".upload-progress-bar").hide(),t({error:"unknown"})},d.find(".upload-progress-bar").show(),h=c({authority:C.BLOCK_CLUSTER,path:"/upload_cross_domain",query:{filename:l,dest:s,t:i.read(T.JS_CSRF_COOKIE),overwrite:0,_subject_uid:p}}),f=new XMLHttpRequest,f.open("POST",h,!0),f.setRequestHeader("Content-Type",u.type||"application/octet-stream"),f.withCredentials=!0,f.upload.addEventListener("progress",n,!1),f.addEventListener("load",r,!1),f.addEventListener("error",o,!1),f.send(u)):t(null==a?{error:"unknown"}:{error:"too_large"})},s.prototype.handle_uploads=function(e){var o;return o=e.find("input[name=file]"),o.on("change",function(n){return function(r){var i,s,u,l,a,_,d,p;return r.target.files?(l=r.target.files,((null!=(a=l[0])?a.name:void 0)||(null!=(_=l[0])?_.fileName:void 0))&&n.enqueue_upload(l,n._current_path)):r.target.value&&(u=r.target.value.split("\\").pop(),s=n._current_path,p=n._current_user.id,d=n.on_upload_start(u,s,p),e.find("input[name=_subject_uid]").val(p),e.find("input[name=dest]").val(s),e.submit(),d.find(".upload-msg").show(),o.prop("disabled",!0),i=function(e){var r,s,u,l;t(e.target).off("load",i),o.prop("disabled",!1),d.find(".upload-msg").hide();try{u=c.parse(e.target.contentWindow.location.search).getQuery(),l=JSON.parse(u.res)}catch(e){r=e,l={}}return n.handle_upload_response(l,p)},t("#upload-iframe").on("load",i)),e[0].reset()}}(this))},s.prototype._scroll_to=function(e){var o;return o=t("#chooser-main"),o.animate({scrollTop:e.offset().top-o.offset().top+o.scrollTop()})},s.prototype.init_photos=function(e,o,n){var r,i;return(null!=e?e.length:void 0)?(r={top_offset:0,left_offset:0,thumb_size:this.PHOTO_SIZE,header_height:this.PHOTO_TIMELINE_HEADER_HEIGHT},i={uses_lightbox:!1,uses_timeline_nav:!1,log_thumb_loading:!1},this._photo_timeline=new q(t("#photo-list")[0],t("#chooser-main")[0],e,o,n,{},this._photo_li_tmpl,r,i),this._photo_timeline.render(),this.resize_photo_list(),t(window).resize(function(e){return function(){return e.resize_photo_list()}}(this))):void t("#chooser").addClass("empty-photos")},s.prototype.resize_photo_list=function(){var e,o,n,r,i,s,u;if(null!=this._photo_timeline&&(i=t("#photo-list"),
u=Math.floor(i.parent().width()/this.PHOTO_SIZE),!(0>=u))){for(i.css("width",u*this.PHOTO_SIZE+"px"),this._photo_timeline.THUMBS_PER_ROW=u,this._photo_timeline.update_offsets(0,0),s=this._photo_timeline.events.getValues(),n=0,r=s.length;r>n;n++)o=s[n],o.update_placeholders();return this._photo_timeline._render_viewport(),e=i.find(".cu-month-header:first span").position().left,t("#photos-date").css({marginLeft:e}),this.update_photos_sticky_date()}},s.prototype.update_photos_sticky_date=function(){var e,o,n,r,i;return i=this._photo_timeline.scroll_container.scrollTop,e=this._photo_timeline.events,r=d(e.list,function(t){return e.dict[t].top_offset-i}),o=r[0],n=r[1],o||n--,t("#photos-date").text(e.valueAtIndex(n).name)},s.prototype.render_file_info=function(e,o){var n,r,i,s,l,a,c,_,d,p,v,y,k,C;for(_="search"===this._mode,c="recent"===this._mode,C=g.get_viewer(),this._select_anchor_index=null,y=[],a=0,d=e.length;d>a;a++)l=e[a],l.caption=m.filename(l.fq_path),l.thumbnail=l.thumbnail_url_tmpl,l.tooltip="",_?(n=x.highlightMatch(l.caption,l.filename_highlights),l.caption=new u(n.html()),k=g.get_root_name(C.get_user_by_id(l.user_id)),v=l.fq_path.split("/"),v[0]=k,v.pop(),p=v.join("/"),l.info=M("in")+" "+f.em_snippet(p,this.SEARCH_PATH_LEN)):c&&(k=g.get_root_name(C.get_user_by_id(l.user_id)),i=h.ago(new Date(1e3*l.ts)),s=M("Changed %(ago)s").format({ago:i}),l.info=s+" · "+k),l.selectable=this._fq_path_selectable(l.fq_path,l.is_dir),y.push(this._li_tmpl({file:l,Sprite:b,_:M}).toHTML());return o.html(y),t("#chooser-main").scrollTop(0),r=o.find(".dropin-file .icon"),w.batch_load_thumbs(r,this.THUMBS_BATCH_SIZE,function(e){return t(e).addClass("thumb-loaded")})},s.prototype.on_browse_complete=function(e,t,o){return this._upload_file_li&&t===this._upload_uid&&e===this._upload_dest?(this._upload_file_li.appendTo(o),this._scroll_to(this._upload_file_li)):void 0},s.prototype.on_load_recent_complete=function(e){return this._upload_file_li?(this._upload_file_li.prependTo(e),this._scroll_to(this._upload_file_li)):void 0},s.prototype.get_browse_file_container=function(e){return t("#browse-file-list-"+g.get_viewer().get_user_by_id(e).role)},s.prototype.on_update_selected_counter=function(){var e;return e=t("li.selected").length,t("#select-btn").text(e>1?this._choose_btn_txt_plural:this._choose_btn_txt)},s.prototype.on_search_start=function(){},s.prototype.on_search_complete=function(){},s.prototype.on_mode_change=function(e){return"search"!==e&&t("#searchbar").val(""),"photos"===e?(this._select_anchor_index=null,this.resize_photo_list()):void 0},s}(v)})}.call(this);